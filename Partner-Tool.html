<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Tool - DeinCheck</title>
    <link rel="icon" type="image/png" href="images/favicon-tool.png">
    <link rel="apple-touch-icon" href="images/favicon-tool.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="js/local-persistence.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet">
    <style>
/* SHOPIFY FULLSCREEN OPTIMIZATION */
/* Remove all Shopify margins, padding and constraints */
html, body {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    overflow-x: hidden !important;
}

/* Override Shopify container constraints */
.shopify-section,
.container-fluid,
.page-content,
.main-content {
    margin: 0 !important;
    padding: 0 !important;
    max-width: none !important;
    width: 100% !important;
}

/* Force fullscreen for our tool */
#partner-tool-fullscreen {
    position: relative !important;
    width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    left: 50% !important;
    right: 50% !important;
    margin-left: -50vw !important;
    margin-right: -50vw !important;
    box-sizing: border-box !important;
}

/* Hide Shopify navigation and header */
.shopify-section--header,
#shopify-section-header,
.site-header,
.header,
nav[role="navigation"] {
    display: none !important;
}

/* Apple-like Partner Tool Design */
/* FONT WEIGHT ENHANCEMENT - Make all text bolder like in ProvisionsÃ¼bersicht */
* {
    font-weight: inherit;
}

/* Override default font weights to be bolder */
h1, h2, h3, h4, h5, h6 {
    font-weight: 800 !important;
}

.nav-logo {
    font-weight: 800 !important;
}

.contact-btn {
    font-weight: 700 !important;
}

.hero-badge {
    font-weight: 700 !important;
}

.hero-title {
    font-weight: 900 !important;
}

.hero-subtitle {
    font-weight: 600 !important;
}

.stat-value {
    font-weight: 900 !important;
}

.stat-label {
    font-weight: 700 !important;
}

.section-title {
    font-weight: 800 !important;
}

.section-subtitle {
    font-weight: 600 !important;
}

.card-title {
    font-weight: 800 !important;
}

.btn {
    font-weight: 700 !important;
}

.tariff-name {
    font-weight: 700 !important;
}

.provider-name {
    font-weight: 800 !important;
}

.provision-amount {
    font-weight: 800 !important;
}

/* Make all buttons and interactive elements bolder */
button,
.button,
.btn-primary,
.btn-secondary,
.email-validation-btn,
.submit-btn {
    font-weight: 700 !important;
}

/* Make all card headings bolder */
.email-card h3,
.spotlight-card h3,
.tariff-card h3 {
    font-weight: 800 !important;
}

/* Additional text elements to make bolder */
p, span, div {
    font-weight: 500 !important;
}

.form-label,
.input-label {
    font-weight: 600 !important;
}

.price,
.provision,
.tariff-price {
    font-weight: 800 !important;
}

:root {
    /* Brand Colors */
    --o2-blue: #0019A5;
    --vodafone-red: #E60000;
    --telekom-magenta: #E20074;
    --ayildiz-red: #E30613;     /* Echtes Ay Yildiz Rot */
    --ondeone-blue: #004B9C;
    --yourfone-purple: #663399;   /* Yourfone Lila */
    --freenet-green: #00A651;
    --klarmobil-orange: #FF6600;
    
    /* ğŸ APPLE-LIKE CORE COLORS - 2026 UPDATE */
    --primary: #007AFF;           /* Apple Blue */
    --primary-dark: #0055D4;      /* Apple Blue Dark */
    --primary-light: #5AC8FA;     /* Apple Light Blue */
    --success: #34C759;           /* Apple Green */
    --warning: #FF9500;           /* Apple Orange */
    --danger: #FF3B30;            /* Apple Red */
    --purple: #AF52DE;            /* Apple Purple */
    --pink: #FF2D55;              /* Apple Pink */
    --teal: #5AC8FA;              /* Apple Teal */
    
    /* ğŸ APPLE-LIKE NEUTRALS */
    --white: #FFFFFF;
    --gray-50: #FBFBFD;           /* Ultra Light */
    --gray-100: #F5F5F7;          /* Apple Light Gray */
    --gray-200: #E8E8ED;          /* Border Light */
    --gray-300: #D2D2D7;          /* Border */
    --gray-400: #AEAEB2;          /* Placeholder */
    --gray-500: #8E8E93;          /* Secondary Text */
    --gray-600: #636366;          /* Tertiary */
    --gray-700: #48484A;          /* Dark */
    --gray-800: #2C2C2E;          /* Darker */
    --gray-900: #1C1C1E;          /* Darkest */
    
    /* ğŸ APPLE-LIKE GRADIENTS - 2026 UPDATE */
    --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%);
    --gradient-hero: linear-gradient(180deg, #1C1C1E 0%, #2C2C2E 50%, #1C1C1E 100%);
    --gradient-glass: rgba(255, 255, 255, 0.08);
    --gradient-text: linear-gradient(90deg, #007AFF 0%, #5AC8FA 50%, #AF52DE 100%);
    --gradient-new: linear-gradient(135deg, #FF2D55 0%, #FF9500 100%);
    --gradient-featured: linear-gradient(135deg, #AF52DE 0%, #FF2D55 100%);
    --gradient-mesh: radial-gradient(at 40% 20%, hsla(217, 100%, 60%, 0.3) 0px, transparent 50%),
                     radial-gradient(at 80% 0%, hsla(280, 100%, 70%, 0.2) 0px, transparent 50%),
                     radial-gradient(at 0% 50%, hsla(200, 100%, 70%, 0.2) 0px, transparent 50%),
                     radial-gradient(at 80% 50%, hsla(340, 100%, 70%, 0.15) 0px, transparent 50%),
                     radial-gradient(at 0% 100%, hsla(22, 100%, 60%, 0.15) 0px, transparent 50%);
    
    /* Spacing */
    --space-xs: 0.5rem;
    --space-sm: 0.75rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 2.5rem;
    --space-3xl: 3rem;
    --space-4xl: 4rem;
    
    /* Border Radius */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    --radius-2xl: 24px;
    
    /* Shadows */
    --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    
    /* Typography */
    --font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
}

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: var(--font-family);
    background: var(--gray-50);
    color: var(--gray-900);
    line-height: 1.6;
    font-size: 16px;
    font-weight: 500; /* StÃ¤rkere Basis-Schrift wie in ProvisionsÃ¼bersicht */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-xl);
}

/* Navigation */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: var(--white);  /* Solides WeiÃŸ statt Glasmorphism */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);  /* Dashboard Shadow */
    border-bottom: 1px solid var(--gray-200);
    z-index: 1000;
    height: 80px;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-xl);
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 100%;
}

.nav-logo {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
}

.nav-logo i {
    color: var(--primary);
    font-size: 1.75rem;
}

.contact-btn {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-lg);
    background: var(--gradient-primary);
    color: white;
    text-decoration: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.contact-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* Hero Section */
.hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    overflow: hidden;
    background: var(--gradient-hero);
    color: white;
    margin-top: 0 !important; /* Remove any top margin from Shopify */
}

.hero-background {
    /* ENTFERNT - Kein bunter Hintergrund mehr, nur noch Gradient aus --gradient-hero */
    display: none;
}

.hero-particles {
    /* ENTFERNT - Keine Partikel-Animation mehr fÃ¼r cleanes Design */
    display: none;
}

@keyframes particleFloat {
    0% { transform: translate(0, 0) rotate(0deg); }
    33% { transform: translate(30px, -30px) rotate(120deg); }
    66% { transform: translate(-20px, 20px) rotate(240deg); }
    100% { transform: translate(0, 0) rotate(360deg); }
}

.hero-mesh-gradient {
    position: absolute;
    width: 100%;
    height: 100%;
    background: 
        conic-gradient(from 0deg at 50% 50%, 
            transparent 0deg, 
            rgba(0, 122, 255, 0.1) 60deg, 
            transparent 120deg, 
            rgba(88, 86, 214, 0.1) 180deg, 
            transparent 240deg, 
            rgba(48, 209, 88, 0.1) 300deg, 
            transparent 360deg
        );
    animation: meshRotate 30s linear infinite;
}

@keyframes meshRotate {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
    100% { transform: rotate(360deg) scale(1); }
}

.hero-content {
    position: relative;
    z-index: 1;
    max-width: 900px;
    padding: var(--space-4xl) var(--space-xl);
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-lg);
    background: rgba(255, 255, 255, 0.2);  /* Etwas weniger transparent */
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--space-xl);
    /* Backdrop-Filter entfernt fÃ¼r bessere Performance */
}

.hero-badge i {
    color: #FFD700;
    animation: starGlow 2s ease-in-out infinite alternate;
}

/* Mobile: Partner Programm Badge besser sichtbar machen */
@media (max-width: 768px) {
    .hero-badge {
        margin-top: var(--space-4xl);
        margin-bottom: var(--space-lg);
        padding: var(--space-md) var(--space-xl);
        font-size: 1rem;
        position: relative;
        z-index: 10;
    }
}

@keyframes starGlow {
    from { text-shadow: 0 0 5px #FFD700; }
    to { text-shadow: 0 0 20px #FFD700, 0 0 30px #FFD700; }
}

.hero-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: var(--space-xl);
    letter-spacing: -0.02em;
}

.gradient-text {
    background: linear-gradient(90deg, #007AFF 0%, #5856D6 50%, #30D158 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% 100%;
    animation: gradientShift 3s ease-in-out infinite;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.hero-subtitle {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: var(--space-3xl);
    font-weight: 400;
}

.hero-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-lg);
    margin-top: var(--space-3xl);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.stat-item {
    text-align: center;
    padding: var(--space-lg) var(--space-md);
    border-radius: var(--radius-xl);
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.6s ease;
}

.stat-item:hover {
    transform: translateY(-3px) scale(1.02);
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.stat-item:hover::before {
    left: 100%;
}

.stat-icon {
    font-size: 1.5rem;
    margin-bottom: var(--space-sm);
    background: linear-gradient(135deg, #FFD700, #FF8C00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    z-index: 1;
}

.stat-value {
    font-size: 1.75rem;
    font-weight: 800;
    color: white;
    margin-bottom: var(--space-xs);
    position: relative;
    z-index: 1;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.stat-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
}

/* Remove stat-divider as we now use grid layout */



/* Responsive Hero Stats */
@media (max-width: 768px) {
    .hero-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
        margin-top: var(--space-2xl);
    }
    
    .stat-item {
        padding: var(--space-md) var(--space-sm);
    }
    
    .stat-value {
        font-size: 1.4rem;
    }
    
    .stat-icon {
        font-size: 1.2rem;
    }
}

@media (max-width: 480px) {
    .hero-stats {
        grid-template-columns: 1fr;
        gap: var(--space-sm);
        max-width: 300px;
    }
    
    .stat-item {
        padding: var(--space-md) var(--space-lg);
    }
    
    .stat-value {
        font-size: 1.6rem;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ APPLE-LIKE "WHAT'S NEW" BANNER - 2026 UPDATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.whats-new-banner {
    background: linear-gradient(135deg, #1C1C1E 0%, #2C2C2E 100%);
    border-radius: var(--radius-2xl);
    padding: var(--space-xl) var(--space-2xl);
    margin: var(--space-2xl) 0;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.whats-new-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-mesh);
    opacity: 0.6;
    pointer-events: none;
}

.whats-new-content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-xl);
    flex-wrap: wrap;
}

.whats-new-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--gradient-new);
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    animation: badgePulse 2s ease-in-out infinite;
    box-shadow: 0 4px 15px rgba(255, 45, 85, 0.4);
}

@keyframes badgePulse {
    0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 45, 85, 0.4); }
    50% { transform: scale(1.05); box-shadow: 0 6px 25px rgba(255, 45, 85, 0.6); }
}

.whats-new-text {
    flex: 1;
    min-width: 250px;
}

.whats-new-text h3 {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.whats-new-text p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.95rem;
    font-weight: 500;
    margin: 0;
}

.whats-new-cta {
    display: flex;
    align-items: center;
    gap: 8px;
    background: white;
    color: var(--gray-900);
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    border: none;
}

.whats-new-cta:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.whats-new-cta i {
    transition: transform 0.3s ease;
}

.whats-new-cta:hover i {
    transform: translateX(4px);
}

/* ğŸ NEUE TARIF BADGES */
.tariff-badge-new {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--gradient-new);
    color: white;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(255, 45, 85, 0.4);
    animation: newBadgeGlow 2s ease-in-out infinite;
    z-index: 10;
}

.tariff-badge-updated {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%);
    color: white;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
    z-index: 10;
}

.tariff-badge-hot {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #FF9500 0%, #FF3B30 100%);
    color: white;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(255, 149, 0, 0.4);
    animation: hotBadgeGlow 1.5s ease-in-out infinite;
    z-index: 10;
}

@keyframes newBadgeGlow {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 45, 85, 0.4); }
    50% { box-shadow: 0 4px 20px rgba(255, 45, 85, 0.7); }
}

@keyframes hotBadgeGlow {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 149, 0, 0.4); transform: scale(1); }
    50% { box-shadow: 0 4px 20px rgba(255, 149, 0, 0.7); transform: scale(1.05); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ APPLE-STYLE TARIF CARDS - KOMPLETT NEU 2026
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.tariff-card {
    position: relative;
    background: #FFFFFF;
    border: 1px solid #E5E5EA;
    border-radius: 20px;
    padding: 24px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.tariff-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    border-color: #007AFF;
}

.tariff-card.selected {
    border: 2px solid #007AFF;
    box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.12), 0 12px 40px rgba(0, 0, 0, 0.12);
}

/* Card Title */
.tariff-card .card-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1D1D1F;
    margin: 0 0 6px 0;
    line-height: 1.3;
}

/* Card Description */
.tariff-card .card-desc {
    font-size: 0.9rem;
    color: #86868B;
    margin: 0 0 auto 0;
    font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ CARD PRICING - APPLE-STYLE LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.card-pricing {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px solid #F2F2F7;
    gap: 16px;
}

/* Customer Price - Left Side */
.card-pricing .customer-price {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.card-pricing .price-label {
    font-size: 0.7rem;
    font-weight: 600;
    color: #86868B;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.card-pricing .price-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: #1D1D1F;
    line-height: 1.2;
}

.card-pricing .price-value .price-period {
    font-size: 0.85rem;
    font-weight: 500;
    color: #86868B;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ PROVISION BADGE - APPLE GREEN STYLE (KEIN DOPPELTES â‚¬!)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.card-pricing .provision-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    color: white;
    padding: 10px 16px;
    border-radius: 12px;
    min-width: 80px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
}

.card-pricing .provision-badge .provision-label {
    font-size: 0.55rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    opacity: 0.9;
    margin-bottom: 2px;
    white-space: nowrap;
}

.card-pricing .provision-badge .provision-value {
    font-size: 1.15rem;
    font-weight: 800;
    line-height: 1;
}

/* ğŸ PROVIDER BUTTONS - MODERN */
.provider-btn {
    position: relative;
    padding: var(--space-md) var(--space-lg);
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    overflow: hidden;
}

.provider-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.05) 0%, rgba(90, 200, 250, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.provider-btn:hover::before {
    opacity: 1;
}

.provider-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-light);
}

.provider-btn.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.15), 0 12px 24px rgba(0, 0, 0, 0.1);
}

.provider-btn.active::before {
    opacity: 1;
}

/* ğŸ SPOTLIGHT CARDS - KOMPLETT NEUES DESIGN 2026 */
.spotlight-card {
    position: relative;
    background: white;
    border-radius: 16px;
    padding: 16px;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--gray-200);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.spotlight-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-primary);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.spotlight-card:hover::before {
    transform: scaleX(1);
}

.spotlight-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
}

/* ğŸ PROVISION BADGE - MODERN */
.provision-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1.1rem;
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
}

.provision-badge.highlight {
    background: var(--gradient-new);
    animation: provisionPulse 2s ease-in-out infinite;
}

@keyframes provisionPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes fadeOutUp {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-20px); }
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* ğŸ ANIMATED SECTION HEADERS */
.section-header-modern {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-2xl);
}

.section-icon {
    width: 48px;
    height: 48px;
    background: var(--gradient-primary);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
    box-shadow: 0 8px 20px rgba(0, 122, 255, 0.25);
}

.section-title-text {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--gray-900);
}

.section-subtitle-text {
    font-size: 0.95rem;
    color: var(--gray-500);
    font-weight: 500;
}

/* ğŸ MOBILE RESPONSIVE - KOMPLETT 2026 */
@media (max-width: 768px) {
    .whats-new-banner {
        padding: 16px;
        border-radius: 14px;
    }
    
    .whats-new-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
    }
    
    .whats-new-text {
        min-width: 100%;
    }
    
    .whats-new-text h3 {
        font-size: 1.1rem;
        justify-content: center;
    }
    
    .whats-new-cta {
        width: 100%;
        justify-content: center;
    }
    
    /* Spotlight Grid Mobile */
    .spotlight-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    /* Spotlight Cards Mobile */
    .spotlight-card {
        padding: 14px;
        min-height: 160px;
        border-radius: 14px;
    }
    
    .card-badge {
        top: 8px;
        right: 8px;
        padding: 3px 6px;
        font-size: 8px;
        border-radius: 6px;
    }
    
    .card-provider {
        padding: 3px 8px;
        font-size: 9px;
        margin-bottom: 6px;
    }
    
    .card-title {
        font-size: 0.9rem;
        margin-bottom: 3px;
    }
    
    .card-desc {
        font-size: 0.75rem;
        margin-bottom: 10px;
    }
    
    .card-pricing {
        padding-top: 10px;
        gap: 8px;
    }
    
    .price-label {
        font-size: 9px;
    }
    
    .price-value {
        font-size: 1rem;
    }
    
    .price-period {
        font-size: 0.65rem;
    }
    
    .provision-badge {
        padding: 6px 10px;
        font-size: 0.8rem;
        border-radius: 8px;
        max-width: 75px;
    }
    
    .provision-badge span {
        font-size: 0.8rem;
    }
    
    /* Tariff Cards Mobile */
    .tariffs-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .tariff-card {
        padding: 12px;
        min-height: 140px;
    }
    
    /* Category Cards Mobile */
    .category-cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .category-card {
        padding: 14px 10px;
    }
    
    .category-icon {
        width: 44px;
        height: 44px;
        font-size: 1.1rem;
        margin-bottom: 8px;
    }
    
    .category-card h4 {
        font-size: 0.85rem;
    }
    
    .category-card p {
        font-size: 0.7rem;
    }
    
    /* Provider Buttons Mobile */
    .provider-btn {
        padding: 8px 10px;
        min-width: 90px;
    }
    
    .provider-icon {
        padding: 6px 8px;
        font-size: 0.65rem;
        min-width: 70px;
    }
    
    /* Form Mobile */
    .form-section {
        padding: 24px 0 40px;
    }
    
    .form-header .section-title {
        font-size: 1.35rem;
        gap: 10px;
    }
    
    .form-header .section-title i {
        width: 36px;
        height: 36px;
        font-size: 1rem;
    }
    
    .customer-form {
        padding: 20px 16px;
        border-radius: 16px;
    }
    
    .form-progress {
        gap: 2px;
        margin-bottom: 24px;
    }
    
    .progress-dot {
        width: 28px;
        height: 28px;
        font-size: 11px;
    }
    
    .progress-line {
        width: 24px;
    }
    
    .progress-label {
        font-size: 9px;
    }
    
    .form-section-title {
        font-size: 0.9rem;
        margin-bottom: 12px;
    }
    
    .form-section-title i {
        width: 28px;
        height: 28px;
        font-size: 0.75rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .form-label {
        font-size: 10px;
        margin-bottom: 4px;
    }
    
    .form-input,
    .form-select {
        padding: 10px 12px;
        font-size: 13px;
        border-radius: 8px;
    }
    
    .submit-btn {
        padding: 12px 20px;
        font-size: 14px;
        border-radius: 10px;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸš€ KOMPAKT REDESIGN 2026 - FINALE STYLES (Ã¼berschreibt vorherige)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* ğŸ´ SPOTLIGHT CARDS - KOMPAKT & ELEGANT */
.spotlight-card {
    position: relative;
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 16px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    min-height: 200px;
    display: flex;
    flex-direction: column;
}

.spotlight-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--purple));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.35s ease;
    border-radius: 16px 16px 0 0;
}

.spotlight-card::after {
    display: none;
}

.spotlight-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-light);
}

.spotlight-card:hover::before {
    transform: scaleX(1);
}

/* ğŸ Card Badges - KOMPAKT 2026 */
.card-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 4px;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
}

.card-badge i {
    font-size: 8px;
}

.card-badge.highlight {
    background: linear-gradient(135deg, #FF2D55 0%, #FF9500 100%);
    color: white;
    animation: badgeShine 3s ease-in-out infinite;
}

.card-badge.popular {
    background: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%);
    color: white;
}

.card-badge.premium {
    background: linear-gradient(135deg, #AF52DE 0%, #FF2D55 100%);
    color: white;
}

.card-badge.value {
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    color: white;
}

.card-badge.budget {
    background: linear-gradient(135deg, #FF9500 0%, #FFCC00 100%);
    color: #1C1C1E;
}

@keyframes badgeShine {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 45, 85, 0.3); }
    50% { box-shadow: 0 4px 24px rgba(255, 45, 85, 0.6), 0 0 40px rgba(255, 45, 85, 0.2); }
}

/* ğŸ Card Provider Badge - KOMPAKT 2026 */
.card-provider {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.3px;
    margin-bottom: 8px;
    width: fit-content;
}

.card-provider.o2 { background: linear-gradient(135deg, #0019A5 0%, #003380 100%); color: white; }
.card-provider.telekom { background: linear-gradient(135deg, #E20074 0%, #B8005C 100%); color: white; }
.card-provider.vodafone { background: linear-gradient(135deg, #E60000 0%, #B30000 100%); color: white; }
.card-provider.freenet { background: linear-gradient(135deg, #00A651 0%, #008040 100%); color: white; }
.card-provider.klarmobil { background: linear-gradient(135deg, #FF6600 0%, #CC5200 100%); color: white; }
.card-provider.ayildiz { background: linear-gradient(135deg, #E30613 0%, #B3050F 100%); color: white; }
.card-provider.yourfone { background: linear-gradient(135deg, #663399 0%, #4D2673 100%); color: white; }
.card-provider.ondeone { background: linear-gradient(135deg, #004B9C 0%, #003366 100%); color: white; }

/* ğŸ Card Title & Description - KOMPAKT 2026 */
.card-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 4px;
    line-height: 1.25;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-desc {
    font-size: 0.8rem;
    color: var(--gray-500);
    font-weight: 500;
    margin-bottom: 12px;
    flex-grow: 1;
}

/* ğŸ Card Pricing - KOMPAKT & ELEGANT 2026 */
.card-pricing {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    padding-top: 12px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    gap: 12px;
}

.customer-price {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.price-label {
    font-size: 10px;
    color: var(--gray-500);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.price-value {
    font-size: 1.15rem;
    font-weight: 800;
    color: var(--gray-900);
    line-height: 1.2;
    display: flex;
    align-items: baseline;
    gap: 1px;
}

.price-period {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--gray-500);
    margin-left: 2px;
}

/* ğŸ Provision Badge - KOMPAKT & SCHÃ–N 2026 */
.provision-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border-radius: 10px;
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.25);
    font-size: 0.9rem;
    font-weight: 700;
    white-space: nowrap;
    min-width: auto;
    max-width: 85px;
}

.provision-badge::before {
    display: none; /* Entferne das "Deine Provision" Label */
}

.provision-badge span {
    font-size: 0.9rem;
    font-weight: 700;
    margin-top: 0;
}

/* Provision Badge Varianten */
.provision-badge.premium {
    background: linear-gradient(135deg, #AF52DE 0%, #5856D6 100%);
    box-shadow: 0 4px 12px rgba(175, 82, 222, 0.3);
}

.provision-badge.gold {
    background: linear-gradient(135deg, #FF9500 0%, #FFCC00 100%);
    color: #1a1a1a;
    box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
}

.provision-badge.highlight {
    background: linear-gradient(135deg, #FF2D55 0%, #FF6B6B 100%);
    box-shadow: 0 4px 12px rgba(255, 45, 85, 0.3);
}

.provision-badge.budget {
    background: linear-gradient(135deg, #5AC8FA 0%, #007AFF 100%);
    box-shadow: 0 4px 12px rgba(90, 200, 250, 0.3);
}

.provision-badge.value,
.provision-badge.klarmobil,
.provision-badge.popular {
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
}

@keyframes provisionGlow {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 45, 85, 0.3); }
    50% { box-shadow: 0 6px 16px rgba(255, 45, 85, 0.45); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“ MODERNES FORMULAR - KOMPAKT 2026
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.form-section {
    background: linear-gradient(180deg, #F8F9FA 0%, #FFFFFF 100%);
    padding: 40px 0 60px;
    min-height: auto;
}

.form-header {
    text-align: center;
    margin-bottom: 32px;
}

.form-header .section-title {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.form-header .section-title i {
    width: 44px;
    height: 44px;
    background: var(--gradient-primary);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: white;
    box-shadow: 0 8px 20px rgba(0, 122, 255, 0.25);
}

/* ğŸ Progress Steps - KOMPAKT 2026 */
.form-progress {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    margin-bottom: 32px;
    padding: 0 16px;
}

.progress-step {
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-dot {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--gray-200);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 12px;
    color: var(--gray-500);
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative;
}

.progress-dot.active {
    background: var(--gradient-primary);
    color: white;
    box-shadow: 0 4px 16px rgba(0, 122, 255, 0.35);
    transform: scale(1.05);
}

.progress-dot.completed {
    background: var(--success);
    color: white;
}

.progress-dot.completed::after {
    content: 'âœ“';
    font-size: 14px;
}

.progress-line {
    width: 40px;
    height: 2px;
    background: var(--gray-200);
    border-radius: 2px;
    transition: background 0.4s ease;
}

.progress-line.active {
    background: var(--gradient-primary);
}

.progress-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--gray-500);
    white-space: nowrap;
}

.progress-step.active .progress-label {
    color: var(--primary);
}

/* ğŸ Customer Form Card - KOMPAKT 2026 */
.customer-form {
    background: white;
    border-radius: 20px;
    padding: 28px;
    box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.06),
        0 2px 8px rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(0, 0, 0, 0.04);
    max-width: 800px;
    margin: 0 auto;
}

/* ğŸ Form Sections - KOMPAKT */
.form-group {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--gray-200);
}

.form-group:last-of-type {
    border-bottom: none;
    margin-bottom: 20px;
    padding-bottom: 0;
}

.form-section-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-section-title i {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    color: var(--primary);
}

/* ğŸ Form Row & Fields - KOMPAKT 2026 */
.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 14px;
    margin-bottom: 14px;
}

.form-field {
    position: relative;
}

/* ğŸ Apple-Style Input Fields - KOMPAKT */
.form-label {
    display: block;
    font-size: 11px;
    font-weight: 700;
    color: var(--gray-700);
    margin-bottom: 6px;
    letter-spacing: 0.2px;
    text-transform: uppercase;
}

.form-input,
.form-select {
    width: 100%;
    padding: 12px 14px;
    font-size: 14px;
    font-weight: 500;
    color: var(--gray-900);
    background: var(--gray-100);
    border: 1.5px solid transparent;
    border-radius: 10px;
    outline: none;
    transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
    -webkit-appearance: none;
    appearance: none;
}

.form-input:hover,
.form-select:hover {
    background: var(--gray-50);
    border-color: var(--gray-300);
}

.form-input:focus,
.form-select:focus {
    background: white;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.form-input::placeholder {
    color: var(--gray-400);
    font-weight: 500;
}

/* ğŸ Select Arrow - KOMPAKT */
.form-select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px;
    cursor: pointer;
}

/* ğŸ Submit Button - KOMPAKT & ELEGANT 2026 */
.submit-btn {
    width: 100%;
    padding: 14px 24px;
    font-size: 15px;
    font-weight: 700;
    color: white;
    background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.submit-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.6s ease;
}

.submit-btn:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 122, 255, 0.45);
}

.submit-btn:hover::before {
    left: 100%;
}

.submit-btn:active {
    transform: translateY(-2px) scale(1.01);
}

.submit-btn i {
    font-size: 1.2rem;
}

/* Success Message - Celebration Style */
.success-message {
    display: none;
    text-align: center;
    padding: 60px 40px;
    background: linear-gradient(135deg, rgba(52, 199, 89, 0.1) 0%, rgba(48, 209, 88, 0.05) 100%);
    border-radius: 24px;
    border: 2px solid rgba(52, 199, 89, 0.2);
    margin-top: 32px;
    animation: successPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes successPop {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}

.success-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    box-shadow: 0 16px 48px rgba(52, 199, 89, 0.4);
    animation: successBounce 1s ease infinite;
}

@keyframes successBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.success-icon i {
    font-size: 48px;
    color: white;
}

.success-message h3 {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 12px;
}

.success-message p {
    font-size: 1.1rem;
    color: var(--gray-600);
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ¯ COST OVERVIEW - Neu gestaltet
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.cost-overview {
    background: linear-gradient(135deg, #1C1C1E 0%, #2C2C2E 100%);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 40px;
    color: white;
    position: relative;
    overflow: hidden;
}

.cost-overview::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-mesh);
    opacity: 0.4;
    pointer-events: none;
}

.cost-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    z-index: 1;
}

.cost-title i {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.provision-highlight {
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    border-radius: 16px;
    padding: 24px;
    text-align: center;
    margin-top: 24px;
    position: relative;
    z-index: 1;
    box-shadow: 0 8px 32px rgba(52, 199, 89, 0.3);
}

.provision-highlight i {
    font-size: 1.5rem;
    margin-right: 8px;
}

.provision-highlight span {
    font-size: 2rem;
    font-weight: 900;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“± SMARTPHONE SELECTION - Premium Cards
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.phone-category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 24px;
}

.phone-category-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 20px;
    padding: 32px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
}

.phone-category-card:hover {
    border-color: var(--primary);
    transform: translateY(-8px);
    box-shadow: 0 20px 48px rgba(0, 0, 0, 0.12);
}

.category-icon {
    width: 72px;
    height: 72px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 2rem;
    color: white;
}

.category-icon.apple-icon {
    background: linear-gradient(135deg, #1C1C1E 0%, #3A3A3C 100%);
}

.category-icon.samsung-icon {
    background: linear-gradient(135deg, #1428A0 0%, #0D1B69 100%);
}

.category-icon.other-icon {
    background: linear-gradient(135deg, #FF9500 0%, #FF6600 100%);
}

.phone-category-card h4 {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 8px;
}

.phone-category-card p {
    font-size: 0.9rem;
    color: var(--gray-500);
    font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ”„ SIGNATURE PAD - Modernisiert
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

#signature-canvas {
    background: white;
    border-radius: 16px !important;
    border: 2px dashed var(--gray-300) !important;
    transition: all 0.3s ease;
}

#signature-canvas:hover {
    border-color: var(--primary) !important;
    border-style: solid !important;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ¨ ANIMATIONS - Smooth & Premium
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes pulse-ring {
    0% { transform: scale(0.8); opacity: 1; }
    100% { transform: scale(1.4); opacity: 0; }
}

@keyframes slide-up {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.animate-slide-up {
    animation: slide-up 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“± RESPONSIVE - Mobile First
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@media (max-width: 768px) {
    .spotlight-card {
        padding: 20px;
        min-height: 240px;
        border-radius: 20px;
    }
    
    .card-title {
        font-size: 1.15rem;
    }
    
    .price-value {
        font-size: 1.4rem;
    }
    
    .provision-badge {
        min-width: 80px;
        padding: 10px 12px;
    }
    
    .provision-badge span {
        font-size: 1.1rem;
    }
    
    .customer-form {
        padding: 24px;
        border-radius: 24px;
    }
    
    .form-header .section-title {
        font-size: 1.75rem;
        flex-direction: column;
        gap: 12px;
    }
    
    .submit-btn {
        padding: 18px 24px;
        font-size: 16px;
    }
    
    .form-progress {
        flex-wrap: wrap;
        gap: 12px;
    }
    
    .progress-line {
        display: none;
    }
}

/* Partner Email Section */
.partner-email-section {
    padding: var(--space-4xl) 0;
    background: white;
}

.email-card {
    background: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-3xl);
    text-align: center;
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--gray-200);
    max-width: 600px;
    margin: 0 auto;
}

.email-required-message {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: var(--radius-lg);
    padding: var(--space-md) var(--space-lg);
    margin-top: var(--space-lg);
    color: #856404;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    font-size: 0.95rem;
    font-weight: 500;
    animation: shake 0.5s ease;
}

.email-required-message i {
    font-size: 1.2rem;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.email-icon {
    width: 80px;
    height: 80px;
    background: var(--gradient-primary);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-lg);
    box-shadow: var(--shadow-lg);
}

.email-icon i {
    font-size: 2rem;
    color: white;
}

.email-card h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.email-card p {
    color: var(--gray-600);
    margin-bottom: var(--space-xl);
}

.email-input-wrapper {
    position: relative;
    max-width: 400px;
    margin: 0 auto;
}

.email-input {
    width: 100%;
    padding: var(--space-lg) var(--space-xl);
    padding-left: 3.5rem;
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-weight: 500;
    background: var(--gray-50);
    transition: all 0.3s ease;
    outline: none;
}

.email-input:focus {
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.input-icon {
    position: absolute;
    left: var(--space-lg);
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    font-size: 1.125rem;
}

/* Email Validation Button */
.email-validation-btn {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
}

.email-validation-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-50%) scale(1.02);
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
}

.email-validation-btn.success {
    background: var(--success);
    pointer-events: none;
}

.email-validation-btn.success:hover {
    background: var(--success);
    transform: translateY(-50%);
}

/* Validation Status */
.validation-status {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: var(--success);
    color: white;
    border-radius: var(--radius-md);
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    box-shadow: 0 2px 8px rgba(48, 209, 88, 0.2);
    animation: slideInRight 0.3s ease;
}

.validation-status.error {
    background: var(--danger);
    box-shadow: 0 2px 8px rgba(255, 59, 48, 0.2);
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateY(-50%) translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateY(-50%) translateX(0);
    }
}

/* Adjust email input padding when button is present */
.email-input-wrapper .email-input {
    padding-right: 7rem;
}

/* Notification System */
.notification {
    position: fixed;
    top: 2rem;
    right: 2rem;
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-md) var(--space-lg);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-weight: 500;
    z-index: 1000;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

.notification-success {
    border-color: var(--success);
    color: var(--success);
}

.notification-success i {
    color: var(--success);
}

.notification-error {
    border-color: var(--danger);
    color: var(--danger);
}

.notification-error i {
    color: var(--danger);
}

/* Mobile responsive notifications */
@media (max-width: 768px) {
    .notification {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        font-size: 0.875rem;
    }
    
    .email-validation-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.8rem;
    }
    
    .validation-status {
        padding: 0.4rem 0.6rem;
        font-size: 0.8rem;
    }
    
    .email-input-wrapper .email-input {
        padding-right: 6rem;
    }
}

@media (max-width: 480px) {
    .email-validation-btn span,
    .validation-status span {
        display: none;
    }
    
    .email-validation-btn {
        padding: 0.5rem;
        width: 2.5rem;
    }
    
    .validation-status {
        padding: 0.5rem;
        width: 2.5rem;
        justify-content: center;
    }
    
    .email-input-wrapper .email-input {
        padding-right: 3.5rem;
    }
}

/* ğŸ Spotlight Section - KOMPAKT 2026 */
.spotlight-section {
    padding: 32px 0;
    background: var(--gray-50);
    position: relative;
    overflow: hidden;
}

.spotlight-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 122, 255, 0.02) 0%, transparent 70%);
    animation: rotate 30s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.spotlight-header {
    text-align: center;
    margin-bottom: 24px;
    position: relative;
    z-index: 1;
}

.spotlight-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    background: linear-gradient(135deg, #FF6B35 0%, #FF8E53 100%);
    color: white;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.75rem;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.section-title {
    font-size: clamp(1.4rem, 3vw, 2rem);
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 12px;
    line-height: 1.2;
}

.section-subtitle {
    font-size: 0.9rem;
    color: var(--gray-600);
    max-width: 500px;
    margin: 0 auto;
}

/* ğŸ SPOTLIGHT GRID - KOMPAKT 2026 */
.spotlight-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 16px;
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
}

/* Diese Definition wird von der oberen Ã¼berschrieben */

.spotlight-card:hover::before {
    left: 100%;
}

/* Standard Hover */
.spotlight-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
    border-color: var(--primary);
}

/* ğŸ Card Varianten - KOMPAKT 2026 */

/* Premium Card */
.spotlight-card.premium-card {
    border: 1.5px solid #FFD700;
    background: linear-gradient(135deg, #FFFDF5 0%, #FFFBF0 100%);
    box-shadow: 0 4px 16px rgba(255, 215, 0, 0.2);
}

.spotlight-card.premium-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
}

/* Gold Card */
.spotlight-card.gold-card {
    border: 1.5px solid #FF8C00;
    background: linear-gradient(135deg, #FFF8F0 0%, #FFFBF5 100%);
    box-shadow: 0 4px 16px rgba(255, 140, 0, 0.2);
}

.spotlight-card.gold-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(255, 140, 0, 0.3);
}

/* Budget Card */
.spotlight-card.budget-card {
    border: 1.5px solid var(--success);
    background: linear-gradient(135deg, #F5FFF8 0%, #FAFFFC 100%);
    box-shadow: 0 4px 16px rgba(48, 209, 88, 0.15);
}

.spotlight-card.budget-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(48, 209, 88, 0.25);
}

/* Value Card */
.spotlight-card.value-card {
    border: 1.5px solid #FF69B4;
    background: linear-gradient(135deg, #FFF5FB 0%, #FFF8FC 100%);
    box-shadow: 0 4px 16px rgba(255, 105, 180, 0.15);
}

.spotlight-card.value-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(255, 105, 180, 0.25);
}

/* Klarmobil Card */
.spotlight-card.klarmobil-card {
    border: 1.5px solid var(--klarmobil-orange);
    background: linear-gradient(135deg, #FFF8F0 0%, #FFFBF5 100%);
    box-shadow: 0 4px 16px rgba(255, 102, 0, 0.15);
}

.spotlight-card.klarmobil-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(255, 102, 0, 0.25);
}

/* Featured Card */
.spotlight-card.featured {
    border: 1.5px solid #007AFF;
    background: linear-gradient(135deg, #F5FAFF 0%, #F8FCFF 100%);
    box-shadow: 0 4px 16px rgba(0, 122, 255, 0.15);
}

.spotlight-card.featured:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 122, 255, 0.25);
}

/* Diese card-badge Styles erben von oben - hier nur Varianten */
.card-badge.popular {
    background: linear-gradient(135deg, #007AFF 0%, #5AC8FA 100%);
    color: white;
}

.card-badge.top-provision {
    background: linear-gradient(135deg, #30D158 0%, #34C759 100%);
    color: white;
}

.card-badge.gold {
    background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
    color: white;
}

.card-badge.budget {
    background: linear-gradient(135deg, var(--success) 0%, #34C759 100%);
    color: white;
}

.card-badge.value {
    background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
}

.card-badge.klarmobil {
    background: linear-gradient(135deg, var(--klarmobil-orange) 0%, #FF8C00 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
}

.card-provider {
    position: absolute;
    top: 16px;
    left: 16px;
    padding: 0.2rem 0.5rem;
    border-radius: 6px;
    font-size: 0.65rem;
    font-weight: 600;
    color: white;
    z-index: 10;
}

/* Budget Card Provider - kleinere SchriftgrÃ¶ÃŸe */
.budget-card .card-provider {
    font-size: 0.6rem;
    padding: 0.18rem 0.4rem;
    top: 16px;
    left: 16px;
}

.card-provider.o2 { background: var(--o2-blue); }
.card-provider.freenet { background: var(--freenet-green); }
.card-provider.ayildiz { background: var(--ayildiz-red); }
.card-provider.klarmobil { background: var(--klarmobil-orange); }
.card-provider.telekom { background: var(--telekom-magenta); }
.card-provider.vodafone { background: var(--vodafone-red); }
.card-provider.klarmobil-telekom { background: var(--klarmobil-orange); }
.card-provider.ondeone { background: var(--ondeone-blue); }
.card-provider.yourfone { background: var(--yourfone-purple); }

.card-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
    line-height: 1.2;
    text-align: left;
    margin-top: 3rem;
    padding-right: 90px;
    padding-left: 0;
}

.card-desc {
    color: var(--gray-600);
    margin-bottom: var(--space-xl);
    font-size: 1rem;
}

.card-pricing {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: var(--space-sm);
    margin-top: auto;
    padding-top: var(--space-md);
}

.customer-price {
    flex: 1;
    min-width: 0;
}

.price-label {
    display: block;
    font-size: 0.875rem;
    color: var(--gray-500);
    margin-bottom: var(--space-xs);
}

.price-value {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--gray-900);
}

.price-period {
    font-size: 1rem;
    font-weight: 500;
    color: var(--gray-600);
}

.provision-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-sm) var(--space-md);
    background: linear-gradient(135deg, var(--success) 0%, #32D74B 100%);
    color: white;
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.9rem;
    box-shadow: var(--shadow-md);
    width: 100%;
    max-width: 100px;
    text-align: center;
    white-space: nowrap;
}

.provision-badge.premium {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: var(--gray-900);
    box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
    font-size: 1.1rem;
}

.provision-badge.gold {
    background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(255, 140, 0, 0.3);
    font-size: 1.1rem;
}

.provision-badge.budget {
    background: linear-gradient(135deg, var(--success) 0%, #34C759 100%);
    color: white;
    box-shadow: 0 4px 10px rgba(48, 209, 88, 0.3);
    font-size: 1.1rem;
}

.provision-badge.value {
    background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
    font-size: 0.9rem;
}

.provision-badge.klarmobil {
    background: linear-gradient(135deg, var(--klarmobil-orange) 0%, #FF8C00 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
    font-size: 0.9rem;
}

.provision-badge.highlight {
    background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    font-size: 0.9rem;
}

/* ğŸ New Tariffs Section - KOMPAKT 2026 */
.new-tariffs-section {
    padding: 32px 0;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    position: relative;
    overflow: hidden;
}

.new-tariffs-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.02) 0%, transparent 70%);
    animation: rotateReverse 30s linear infinite;
}

@keyframes rotateReverse {
    from { transform: rotate(360deg); }
    to { transform: rotate(0deg); }
}

.new-badge {
    background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
    color: white;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.75rem;
    padding: 6px 14px;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
    animation: newBadgePulse 3s ease-in-out infinite;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    text-align: center;
}

/* Mobile: "Neu" Button zentrieren und Position anpassen */
@media (max-width: 768px) {
    .new-badge {
        margin: 0 auto 15px auto !important;
        display: block !important;
        width: fit-content !important;
    }
    
    .spotlight-header {
        text-align: center !important;
    }
    
    .spotlight-badge {
        display: block !important;
        text-align: center !important;
        margin: 0 auto 20px auto !important;
    }
}

@keyframes newBadgePulse {
    0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 6px 24px rgba(139, 92, 246, 0.4); }
}

.new-tariffs-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-md);
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
}

.new-tariff-card {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    border: 2px solid var(--gray-200);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    min-height: 300px;
    display: flex;
    flex-direction: column;
}

.new-tariff-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.1), transparent);
    transition: left 0.6s ease;
}

.new-tariff-card:hover::before {
    left: 100%;
}

/* Fresh Card */
.new-tariff-card.fresh-card {
    border: 2px solid #10B981;
    background: linear-gradient(135deg, #ECFDF5 0%, #F0FDF4 100%);
    box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
}

.new-tariff-card.fresh-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(16, 185, 129, 0.25);
}

/* Innovation Card */
.new-tariff-card.innovation-card {
    border: 2px solid #3B82F6;
    background: linear-gradient(135deg, #EFF6FF 0%, #F0F9FF 100%);
    box-shadow: 0 8px 32px rgba(59, 130, 246, 0.15);
}

.new-tariff-card.innovation-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(59, 130, 246, 0.25);
}

/* Trendy Card */
.new-tariff-card.trendy-card {
    border: 2px solid #F59E0B;
    background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
    box-shadow: 0 8px 32px rgba(245, 158, 11, 0.15);
}

.new-tariff-card.trendy-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(245, 158, 11, 0.25);
}

/* Modern Card */
.new-tariff-card.modern-card {
    border: 2px solid #8B5CF6;
    background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%);
    box-shadow: 0 8px 32px rgba(139, 92, 246, 0.15);
}

.new-tariff-card.modern-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(139, 92, 246, 0.25);
}

/* Special Card */
.new-tariff-card.special-card {
    border: 2px solid #EC4899;
    background: linear-gradient(135deg, #FDF2F8 0%, #FCE7F3 100%);
    box-shadow: 0 8px 32px rgba(236, 72, 153, 0.15);
}

.new-tariff-card.special-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(236, 72, 153, 0.25);
}

/* Rising Card */
.new-tariff-card.rising-card {
    border: 2px solid #06B6D4;
    background: linear-gradient(135deg, #ECFEFF 0%, #CFFAFE 100%);
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
}

.new-tariff-card.rising-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 12px 48px rgba(6, 182, 212, 0.25);
}

/* New Card Badges */
.card-badge.fresh {
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.card-badge.innovation {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.card-badge.trendy {
    background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.card-badge.modern {
    background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
}

.card-badge.special {
    background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
}

.card-badge.rising {
    background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
}

/* New Provision Badges */
.provision-badge.fresh {
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    font-size: 0.9rem;
}

.provision-badge.innovation {
    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    font-size: 0.9rem;
}

.provision-badge.trendy {
    background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    font-size: 0.9rem;
}

.provision-badge.modern {
    background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    font-size: 0.9rem;
}

.provision-badge.special {
    background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
    font-size: 0.9rem;
}

.provision-badge.rising {
    background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
    font-size: 0.9rem;
}

/* Birthday Special Card */
.new-tariff-card.birthday-special-card {
    border: 3px solid #FF1493;
    background: linear-gradient(135deg, #FFF0F8 0%, #FFE4E1 100%);
    box-shadow: 0 12px 40px rgba(255, 20, 147, 0.2);
    position: relative;
    overflow: hidden;
}

@keyframes celebrate {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.1) rotate(5deg); }
}

.new-tariff-card.birthday-special-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 16px 56px rgba(255, 20, 147, 0.3);
}

/* Speed Master Card */
.new-tariff-card.speed-master-card {
    border: 3px solid #00CED1;
    background: linear-gradient(135deg, #E0FFFF 0%, #F0FFFF 100%);
    box-shadow: 0 12px 40px rgba(0, 206, 209, 0.2);
}

.new-tariff-card.speed-master-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 16px 56px rgba(0, 206, 209, 0.3);
}

/* New Card Badges for Special Cards */
.card-badge.birthday-special {
    background: linear-gradient(135deg, #FF1493 0%, #FF69B4 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(255, 20, 147, 0.4);
    animation: birthdayGlow 2s ease-in-out infinite;
    font-weight: 700;
    font-size: 0.7rem;
}

@keyframes birthdayGlow {
    0%, 100% { box-shadow: 0 6px 20px rgba(255, 20, 147, 0.4); }
    50% { box-shadow: 0 8px 28px rgba(255, 20, 147, 0.6); }
}

.card-badge.speed-master {
    background: linear-gradient(135deg, #00CED1 0%, #20B2AA 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(0, 206, 209, 0.4);
    font-weight: 700;
}

/* New Provision Badges for Special Cards */
.provision-badge.birthday-special {
    background: linear-gradient(135deg, #FF1493 0%, #FF69B4 100%);
    color: white;
    box-shadow: 0 4px 16px rgba(255, 20, 147, 0.4);
    font-size: 1rem;
    font-weight: 700;
}

.provision-badge.speed-master {
    background: linear-gradient(135deg, #00CED1 0%, #20B2AA 100%);
    color: white;
    box-shadow: 0 4px 16px rgba(0, 206, 209, 0.4);
    font-size: 1rem;
    font-weight: 700;
}

/* Limited Grid fÃ¼r nur 2 Karten */
.new-tariffs-grid.new-tariffs-limited {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-xl);
    max-width: 800px;
    margin: 0 auto;
}

/* Original Price Strikethrough */
.price-original {
    display: block;
    font-size: 0.75rem;
    color: var(--gray-500);
    text-decoration: line-through;
    margin-top: 0.25rem;
}

/* Responsive fÃ¼r New Tariffs Grid */
@media (max-width: 768px) {
    .new-tariffs-grid, .new-tariffs-grid.new-tariffs-limited {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .new-tariffs-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .new-tariffs-grid.new-tariffs-limited {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Smartphone Booking Section */
.smartphone-booking-section {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    margin: var(--space-xl) 0;
    border: 2px solid var(--gray-200);
    box-shadow: var(--shadow-lg);
}

.smartphone-header {
    text-align: center;
    margin-bottom: var(--space-xl);
}

.smartphone-header h3 {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.smartphone-header h3 i {
    color: var(--primary);
}

.smartphone-subtitle {
    color: var(--gray-600);
    font-size: 1rem;
    margin: 0;
}

/* Phone Category Grid */
.phone-category-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.phone-category-card {
    background: var(--gray-50);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.phone-category-card:hover {
    border-color: var(--primary);
    background: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.category-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-md);
    font-size: 1.5rem;
}

.apple-icon {
    background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
    color: white;
}

.samsung-icon {
    background: linear-gradient(135deg, #1428A0 0%, #00A8E8 100%);
    color: white;
}

.other-icon {
    background: linear-gradient(135deg, #FF9500 0%, #FF6B35 100%);
    color: white;
}

.phone-category-card h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: var(--space-xs);
}

.phone-category-card p {
    color: var(--gray-600);
    font-size: 0.875rem;
    margin: 0;
}

/* Phone Selection Steps */
.phone-selection-step {
    margin-top: var(--space-xl);
}

.selection-header {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--gray-200);
}

.back-btn {
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    color: var(--gray-700);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.back-btn:hover {
    background: var(--gray-200);
    border-color: var(--gray-400);
}

.selection-header h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-900);
    margin: 0;
}

/* Phone Models Grid */
.phone-models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-lg);
}

.phone-model-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    cursor: pointer;
    transition: all 0.3s ease;
}

.phone-model-card:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.phone-model-card h5 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.phone-model-card p {
    color: var(--gray-600);
    margin: 0;
    font-size: 0.875rem;
}

/* Storage and Color Grids */
.phone-storage-grid, .phone-colors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-md);
}

.storage-option, .color-option {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.storage-option:hover, .color-option:hover {
    border-color: var(--primary);
    background: var(--gray-50);
}

.storage-option.selected, .color-option.selected {
    border-color: var(--primary);
    background: var(--primary);
    color: white;
}

/* Selected Phone Summary */
.selected-phone-summary {
    margin-top: var(--space-xl);
    padding-top: var(--space-xl);
    border-top: 2px solid var(--gray-200);
}

.phone-summary-card {
    background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
    border: 2px solid var(--primary);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-lg);
}

.phone-summary-info h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: var(--space-xs);
}

.phone-summary-info p {
    color: var(--gray-600);
    margin: 0;
    font-size: 0.875rem;
}

.phone-summary-price {
    text-align: center;
}

.phone-price-label {
    display: block;
    font-size: 0.75rem;
    color: var(--gray-600);
    margin-bottom: var(--space-xs);
}

.phone-price-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
}

.change-phone-btn {
    background: white;
    border: 2px solid var(--primary);
    color: var(--primary);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.change-phone-btn:hover {
    background: var(--primary);
    color: white;
}

/* Responsive */
@media (max-width: 768px) {
    .phone-category-grid {
        grid-template-columns: 1fr;
    }
    
    .phone-models-grid {
        grid-template-columns: 1fr;
    }
    
    .phone-storage-grid, .phone-colors-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .phone-summary-card {
        flex-direction: column;
        text-align: center;
    }
}

/* Categories Section */
.categories-section {
    padding: var(--space-4xl) 0;
    background: white;
}

.category-tabs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
    margin-top: var(--space-xl);
}

.category-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xl);
    background: var(--gray-100);
    border: 2px solid transparent;
    border-radius: var(--radius-xl);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    color: var(--gray-700);
}

.category-tab i {
    font-size: 2rem;
    color: var(--gray-500);
    transition: all 0.3s ease;
}

.category-tab:hover {
    background: var(--gray-200);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.category-tab.active {
    background: var(--gradient-primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
}

.category-tab.active i {
    color: white;
}

/* Category Content */
.category-content {
    padding: var(--space-4xl) 0;
    background: var(--gray-50);
}

.category-content.hidden {
    display: none;
}

.subsection-title {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-xl);
}

.subsection-title i {
    color: var(--primary);
    font-size: 1.25rem;
}

/* Provider Section */
.provider-section {
    margin-bottom: var(--space-4xl);
}

.provider-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: var(--space-xl);
    margin-bottom: var(--space-lg);
}

/* Haupt-Provider-Grid: Alle 6 Provider in einer Reihe */
.provider-section:first-of-type .provider-grid {
    grid-template-columns: repeat(6, 1fr);
    gap: var(--space-md);
}

/* Responsive: Bei kleinen Bildschirmen kleinere Mindestbreite */
@media (max-width: 1200px) {
    .provider-section:first-of-type .provider-grid {
        gap: var(--space-sm);
    }
}

@media (max-width: 900px) {
    .provider-section:first-of-type .provider-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-md);
    }
}

@media (max-width: 600px) {
    .provider-section:first-of-type .provider-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-sm);
    }
}

/* Spezielle Regel fÃ¼r Klarmobil und Freenet Sub-Provider */
#klarmobil-sub-providers .provider-grid,
#freenet-sub-providers .provider-grid {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-lg);
}

/* Responsive Verbesserung fÃ¼r Sub-Provider */
@media (max-width: 768px) {
    #klarmobil-sub-providers .provider-grid,
    #freenet-sub-providers .provider-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--space-md);
    }
}

/* ğŸ PROVIDER BUTTONS - KOMPAKT 2026 */
.provider-btn {
    padding: 10px 14px;
    background: white;
    border: 1.5px solid var(--gray-300);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    min-width: 120px;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Haupt-Provider Buttons: Kompakter fÃ¼r eine Reihe */
.provider-section:first-of-type .provider-btn {
    min-width: auto;
    padding: 8px 10px;
    flex: 1;
}

/* Kleinere Sub-Provider Buttons fÃ¼r besseres Wrapping */
#klarmobil-sub-providers .provider-btn,
#freenet-sub-providers .provider-btn {
    min-width: 110px;
    padding: 8px 12px;
}

.provider-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-color: var(--primary-light);
}

.provider-btn.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15), 0 4px 12px rgba(0, 0, 0, 0.08);
}

.provider-icon {
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: 700;
    color: white;
    text-align: center;
    font-size: 0.75rem;
    white-space: nowrap;
    min-width: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Haupt-Provider Icons: Kompakter fÃ¼r eine Reihe */
.provider-section:first-of-type .provider-icon {
    min-width: auto;
    padding: 6px 10px;
    font-size: 0.7rem;
    width: 100%;
}

/* Sub-Provider Icons - kleinere Mindestbreite und flexibler Text */
#klarmobil-sub-providers .provider-icon,
#freenet-sub-providers .provider-icon {
    min-width: 80px;
    font-size: 0.7rem;
    padding: 6px 10px;
    white-space: normal;
    text-align: center;
    line-height: 1.2;
}

.provider-icon.o2 { background: var(--o2-blue); }
.provider-icon.freenet { background: var(--freenet-green); }
.provider-icon.ayildiz { background: var(--ayildiz-red); }
.provider-icon.ondeone { background: var(--ondeone-blue); }
.provider-icon.yourfone { background: var(--yourfone-purple); }
.provider-icon.vodafone { background: var(--vodafone-red); }
.provider-icon.telekom { background: var(--telekom-magenta); }
.provider-icon.klarmobil { background: var(--klarmobil-orange); }

/* Tariffs Section */
.tariffs-section {
    margin-bottom: var(--space-4xl);
}

/* ğŸ TARIFFS GRID - KOMPAKT 2026 */
.tariffs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
}

.tariffs-grid > * {
    min-width: auto;
    max-width: none;
}

/* ğŸ TARIFF CARD - KOMPAKT 2026 */
.tariff-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 14px;
    padding: 14px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    min-height: 160px;
}

.tariff-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    border-color: var(--primary);
}

.tariff-card .tariff-name {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 4px;
    line-height: 1.25;
}

.tariff-card .tariff-features {
    font-size: 0.75rem;
    color: var(--gray-500);
    margin-bottom: 8px;
}

.tariff-card .tariff-price {
    font-size: 1rem;
    font-weight: 800;
    color: var(--gray-900);
}

.tariff-card .tariff-provision {
    display: inline-flex;
    align-items: center;
    padding: 6px 10px;
    border-radius: 8px;
    background: linear-gradient(135deg, #34C759 0%, #30D158 100%);
    color: white;
    font-size: 0.8rem;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(52, 199, 89, 0.2);
}

/* ğŸ Device Categories - KOMPAKT 2026 */
.device-categories {
    margin-bottom: var(--space-3xl);
}

.category-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.category-card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 14px;
    padding: 20px 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.category-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    border-color: var(--primary);
}

.category-icon {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: 1.4rem;
    color: white;
}

.category-icon.apple { background: linear-gradient(135deg, #A8DADC 0%, #457B9D 100%); }
.category-icon.samsung { background: linear-gradient(135deg, #1428a0 0%, #0d47a1 100%); } /* Samsung Blau */
.category-icon.xiaomi { background: linear-gradient(135deg, #ff6900 0%, #ff4400 100%); } /* Xiaomi Orange */
.category-icon.google { background: linear-gradient(135deg, #4285f4 0%, #34a853 50%, #fbbc05 75%, #ea4335 100%); } /* Google Farben */
.category-icon.other { background: linear-gradient(135deg, #F1FAEE 0%, #A8DADC 100%); color: var(--gray-700); }

.category-card h4 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.category-card p {
    font-size: 0.8rem;
    color: var(--gray-600);
}

/* Selection Steps */
.selection-step {
    margin-bottom: var(--space-4xl);
}

.selection-step.hidden {
    display: none;
}

.step-header {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-lg);
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-md);
    cursor: pointer;
    font-weight: 500;
    color: var(--gray-700);
    transition: all 0.2s ease;
    text-decoration: none;
}

.back-btn:hover {
    background: var(--gray-200);
    transform: translateX(-2px);
}

.selection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
}

.selection-item {
    padding: var(--space-lg);
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    box-shadow: var(--shadow-sm);
}

.selection-item:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.selection-item.active {
    border-color: var(--primary);
    background: rgba(0, 122, 255, 0.05);
}

.selected-device-info {
    background: var(--gray-100);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    text-align: center;
    margin-bottom: var(--space-xl);
    border: 1px solid var(--gray-200);
}

.selected-device-info h4 {
    color: var(--gray-900);
    font-weight: 700;
}

/* Customer Type Section */
.customer-type-section {
    margin-bottom: var(--space-4xl);
}

.customer-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-xl);
}

.customer-type-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-2xl);
    background: white;
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-xl);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 1rem;
    color: var(--gray-700);
    min-height: 150px;
    justify-content: center;
    box-shadow: var(--shadow-sm);
}

.customer-type-btn:hover {
    border-color: var(--primary);
    background: rgba(0, 122, 255, 0.05);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.customer-type-btn.active {
    border-color: var(--warning);
    background: var(--warning);
    color: white;
}

.customer-icon {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gradient-primary);
    color: white;
    font-size: 1.5rem;
}

.customer-type-btn.active .customer-icon {
    background: white;
    color: var(--warning);
}

/* Coming Soon */
.coming-soon {
    text-align: center;
    padding: var(--space-4xl);
    background: white;
    border-radius: var(--radius-2xl);
    border: 1px solid var(--gray-200);
    box-shadow: var(--shadow-sm);
}

.coming-soon-icon {
    width: 100px;
    height: 100px;
    border-radius: var(--radius-xl);
    background: var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-xl);
    font-size: 2.5rem;
    color: var(--gray-500);
}

.coming-soon h3 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.coming-soon p {
    color: var(--gray-600);
    font-size: 1.125rem;
}

/* Form Section */
.form-section {
    padding: var(--space-4xl) 0;
    background: white;
}

.form-section.hidden {
    display: none;
}

.form-header {
    text-align: center;
    margin-bottom: var(--space-4xl);
}

.selected-info {
    background: var(--gray-100);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    margin-top: var(--space-xl);
    border: 1px solid var(--gray-200);
}

.selected-info h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
}

.selected-info p {
    color: var(--gray-600);
}

/* Cost Overview */
.cost-overview {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    margin-bottom: var(--space-3xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
}

.cost-overview.hidden {
    display: none;
}

.cost-title {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-xl);
}

.cost-title i {
    color: var(--primary);
}

.provision-highlight {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    padding: var(--space-lg);
    background: linear-gradient(135deg, var(--success) 0%, #32D74B 100%);
    color: white;
    border-radius: var(--radius-lg);
    font-weight: 700;
    font-size: 1.125rem;
    margin-top: var(--space-lg);
    box-shadow: var(--shadow-md);
}

/* Cross-Sell Section */
.cross-sell-section {
    background: white;
    border-radius: var(--radius-xl);
    margin-bottom: var(--space-3xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

.cross-sell-section.hidden {
    display: none;
}

.cross-sell-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xl);
    background: var(--gray-50);
    cursor: pointer;
    border-bottom: 1px solid var(--gray-200);
}

.cross-sell-header h3 {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--gray-900);
    margin: 0;
}

.cross-sell-header i {
    color: var(--primary);
}

.cross-sell-toggle {
    transition: transform 0.3s ease;
    color: var(--gray-500);
    font-size: 1.125rem;
}

.cross-sell-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
}

.cross-sell-content.open {
    max-height: 1000px;
}

/* Cross-Sell Options */
.cross-sell-option {
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid var(--gray-200);
}

.cross-sell-option:hover {
    background-color: var(--gray-50);
}

.cross-sell-option.selected {
    background-color: rgba(0, 122, 255, 0.05);
    border-left: 4px solid var(--primary);
}

.cross-sell-option:last-child {
    border-bottom: none;
}

/* Form interaction improvements */
button, input[type="button"], input[type="submit"], input[type="checkbox"], input[type="radio"] {
    cursor: pointer;
}

select, option {
    cursor: pointer;
}

label {
    cursor: pointer;
}

/* Customer Form */
.customer-form {
    max-width: 800px;
    margin: 0 auto;
}

.form-group {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    margin-bottom: var(--space-xl);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--gray-200);
}

.form-section-title {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-xl);
    padding-bottom: var(--space-md);
    border-bottom: 2px solid var(--gray-200);
}

.form-section-title i {
    color: var(--primary);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
}

.form-row:has(.form-field:not(.form-field-small)) {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.form-row:has(.form-field-small) {
    grid-template-columns: 1fr 2fr;
}

.form-field {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: var(--space-sm);
    font-size: 0.875rem;
}

/* Smartphone Configuration Modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: 16px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
    padding: 24px 24px 16px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #1a1a1a;
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 4px;
    border-radius: 4px;
}

.modal-close:hover {
    background: #f0f0f0;
    color: #333;
}

.modal-body {
    padding: 24px;
}

.config-section {
    margin-bottom: 24px;
}

.config-section h4 {
    margin: 0 0 12px 0;
    font-size: 1rem;
    font-weight: 600;
    color: #333;
}

.color-options, .storage-options {
    display: grid;
    gap: 8px;
}

.color-options label, .storage-options label {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border: 2px solid #e5e5e5;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
}

.color-options label:hover, .storage-options label:hover {
    border-color: #007AFF;
    background: #f8faff;
}

.color-options input:checked + *, .storage-options input:checked + * {
    border-color: #007AFF;
    background: #f0f7ff;
}

.color-options input, .storage-options input {
    margin-right: 8px;
}

.price-summary {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 8px;
    margin-top: 20px;
}

.price-summary > div {
    margin: 4px 0;
}

.base-price {
    color: #666;
    font-size: 0.9rem;
}

.total-price {
    font-weight: 700;
    font-size: 1.1rem;
    color: #1a1a1a;
}

.provision-info {
    color: #28a745;
    font-weight: 600;
    font-size: 0.9rem;
}

.modal-footer {
    padding: 16px 24px 24px;
    display: flex;
    gap: 12px;
}

.btn-primary, .btn-secondary {
    flex: 1;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
}

.btn-primary {
    background: #007AFF;
    color: white;
}

.btn-primary:hover {
    background: #0056cc;
}

.btn-secondary {
    background: #f1f1f1;
    color: #333;
}

.btn-secondary:hover {
    background: #e1e1e1;
}

/* Enhanced Customer Overview Styling */
.selected-tariff-card {
    background: linear-gradient(135deg, #f8faff 0%, #f0f7ff 100%);
    border: 2px solid #007AFF;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
}

.tariff-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 12px;
}

.tariff-badge.mobile {
    background: #007AFF;
    color: white;
}

.tariff-details {
    display: flex;
    gap: 16px;
    margin: 12px 0;
    flex-wrap: wrap;
}

.data-volume, .provider-name {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    color: #666;
    font-weight: 500;
}

.pricing-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e0e7ff;
}

.pricing-info .price {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1a1a1a;
}

.pricing-info .provision {
    font-size: 0.9rem;
    font-weight: 600;
    color: #28a745;
}

@media (max-width: 768px) {
    .tariff-details {
        flex-direction: column;
        gap: 8px;
    }
    
    .pricing-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}

.form-input {
    padding: var(--space-md) var(--space-lg);
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-md);
    font-size: 1rem;
    font-weight: 500;
    background: white;
    transition: all 0.3s ease;
    font-family: inherit;
    min-height: 48px;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.form-input::placeholder {
    color: var(--gray-400);
}

.form-textarea {
    resize: vertical;
    min-height: 120px;
}

/* IBAN Input Styles */
.iban-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.iban-input {
    flex: 1;
    padding-right: 50px !important;
    text-transform: uppercase;
    font-family: 'Courier New', monospace;
    letter-spacing: 1px;
}

.iban-validation-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.5rem;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
}

.iban-validation-icon.valid {
    opacity: 1;
    color: #4CAF50;
}

.iban-validation-icon.invalid {
    opacity: 1;
    color: #f44336;
}

.iban-validation-icon.invalid i:before {
    content: "\f06a"; /* fa-exclamation-circle */
}

.iban-input.valid {
    border-color: #4CAF50 !important;
    background-color: #f1f8f4;
}

.iban-input.invalid {
    border-color: #f44336 !important;
    background-color: #fff3f3;
}

.iban-feedback {
    font-size: 0.875rem;
    margin-top: 8px;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    display: none;
    animation: slideDown 0.3s ease;
}

.iban-feedback.valid {
    display: block;
    background: #e8f5e9;
    color: #2e7d32;
    border: 1px solid #4CAF50;
}

.iban-feedback.invalid {
    display: block;
    background: #ffebee;
    color: #c62828;
    border: 1px solid #f44336;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.submit-btn {
    width: 100%;
    padding: var(--space-lg) var(--space-xl);
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 700;
    font-size: 1.125rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    box-shadow: var(--shadow-lg);
    min-height: 56px;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
}

.submit-btn:active {
    transform: translateY(0);
}

/* Success Message */
.success-message {
    display: none;
    text-align: center;
    padding: var(--space-3xl);
    background: linear-gradient(135deg, var(--success) 0%, #32D74B 100%);
    color: white;
    border-radius: var(--radius-xl);
    margin-top: var(--space-xl);
    box-shadow: var(--shadow-xl);
}

.success-message.show {
    display: block !important;
    opacity: 1;
    animation: slideUp 0.6s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.success-icon {
    font-size: 3rem;
    margin-bottom: var(--space-lg);
}

.success-message h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: var(--space-sm);
}

.success-message p {
    font-size: 1rem;
    opacity: 0.9;
}

/* Footer */
.footer {
    background: var(--gray-900);
    color: white;
    padding: var(--space-4xl) 0 var(--space-xl);
}

.footer-content {
    text-align: center;
}

.footer-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: var(--space-lg);
}

.footer-logo i {
    color: var(--primary);
    font-size: 1.75rem;
}

.footer p {
    color: var(--gray-400);
    margin-bottom: var(--space-xl);
}

.footer-contact a {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    color: #ffffff;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
}

.footer-contact a:hover {
    color: #9CA3AF;
    transform: translateY(-2px);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 0 var(--space-lg);
    }
    
    .nav-container {
        padding: 0 var(--space-lg);
    }
    
    .nav-logo {
        font-size: 1.25rem;
    }
    
    .nav-logo i {
        font-size: 1.5rem;
    }
    
    .hero-content {
        padding: var(--space-3xl) var(--space-lg);
    }
    
    .hero-stats {
        flex-direction: column;
        gap: var(--space-lg);
    }
    
    .stat-divider {
        width: 60px;
        height: 1px;
    }
    
    .spotlight-grid {
        grid-template-columns: 1fr;
    }
    
    .category-tabs {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .provider-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .category-cards {
        grid-template-columns: 1fr;
    }
    
    .tariffs-grid {
        grid-template-columns: 1fr;
    }
    
    .customer-type-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr !important;
    }
    
    .email-card {
        padding: var(--space-xl);
    }
    
    .spotlight-section,
    .categories-section,
    .category-content,
    .form-section {
        padding: var(--space-2xl) 0;
    }
    
    .partner-email-section {
        padding: var(--space-2xl) 0;
    }
}

/* Tablet responsive for spotlight grid */
@media (max-width: 768px) {
    .spotlight-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-lg);
    }
    
    .card-title {
        padding-right: 70px;
        font-size: 1.3rem;
    }
    
    .card-badge {
        font-size: 0.6rem;
        min-width: 60px;
        padding: 0.18rem 0.4rem;
        top: 14px;
        right: 14px;
    }
    
    .card-provider {
        font-size: 0.6rem;
        padding: 0.18rem 0.4rem;
        top: 14px;
        left: 14px;
    }
    
    .card-title {
        font-size: 1.3rem;
        margin-top: 2.6rem;
        padding-right: 80px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 0 var(--space-md);
    }
    
    .nav-container {
        padding: 0 var(--space-md);
    }
    
    .contact-btn {
        padding: var(--space-xs) var(--space-md);
        font-size: 0.875rem;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .section-title {
        font-size: 1.75rem;
    }
    
    .spotlight-card,
    .category-card,
    .tariff-card {
        padding: var(--space-lg);
    }
    
    /* Spotlight grid zu 1 Spalte */
    .spotlight-grid {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
    }
    
    /* Badge and title adjustments for mobile */
    .card-title {
        padding-right: 60px;
        font-size: 1.25rem;
    }
    
    .card-badge {
        top: 12px;
        right: 12px;
        font-size: 0.55rem;
        padding: 0.15rem 0.35rem;
        min-width: 55px;
        gap: 0.2rem;
    }
    
    .card-provider {
        font-size: 0.55rem;
        padding: 0.15rem 0.35rem;
        top: 12px;
        left: 12px;
    }
    
    .card-title {
        font-size: 1.2rem;
        margin-top: 2.8rem;
        padding-right: 70px;
    }
    
    .form-group {
        padding: var(--space-lg);
    }
    
    .email-card {
        padding: var(--space-lg);
    }
}

/* Filter System */
.filter-section {
    margin-bottom: var(--space-4xl);
    background: white;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-200);
    overflow: hidden;
}

.filter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xl);
    background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
    border-bottom: 1px solid var(--gray-200);
}

.filter-header .subsection-title {
    margin: 0;
    flex: 1;
}

.filter-toggle-btn {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-lg);
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.filter-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.filter-toggle-btn.active {
    background: linear-gradient(135deg, var(--success) 0%, #32D74B 100%);
}

.filter-panel {
    background: white;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.filter-panel.show {
    max-height: 800px;
    padding: var(--space-xl);
}

.filter-group {
    margin-bottom: var(--space-xl);
}

.filter-group:last-of-type {
    margin-bottom: 0;
}

.filter-label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-lg);
    font-size: 1rem;
}

.filter-label i {
    color: var(--primary);
    font-size: 1.125rem;
}

.filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
}

.filter-btn {
    padding: var(--space-sm) var(--space-lg);
    background: var(--gray-100);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    position: relative;
    overflow: hidden;
}

.filter-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.6s ease;
}

.filter-btn:hover::before {
    left: 100%;
}

.filter-btn:hover {
    background: var(--gray-200);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.filter-btn.active {
    background: var(--gradient-primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.filter-btn.special {
    background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-weight: 700;
}

.filter-btn.special:hover {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
}

.filter-btn.special:last-child {
    background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%);
    color: white;
}

.filter-btn.special:last-child:hover {
    background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
}

.filter-results {
    margin-top: var(--space-xl);
    padding-top: var(--space-xl);
    border-top: 2px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-lg);
}

.results-info {
    font-weight: 600;
    color: var(--gray-700);
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.results-info::before {
    content: '';
    width: 12px;
    height: 12px;
    background: var(--success);
    border-radius: 50%;
    display: inline-block;
    animation: pulse 2s ease-in-out infinite;
}

.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
}

.active-filter-tag {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background: var(--primary);
    color: white;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.active-filter-tag button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 2px;
    border-radius: 50%;
    transition: background 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
}

.active-filter-tag button:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Filter Animations */
.filter-panel.show .filter-group {
    animation: filterSlideIn 0.6s ease-out;
    animation-fill-mode: both;
}

.filter-panel.show .filter-group:nth-child(1) { animation-delay: 0.1s; }
.filter-panel.show .filter-group:nth-child(2) { animation-delay: 0.2s; }
.filter-panel.show .filter-group:nth-child(3) { animation-delay: 0.3s; }
.filter-panel.show .filter-group:nth-child(4) { animation-delay: 0.4s; }
.filter-panel.show .filter-group:nth-child(5) { animation-delay: 0.5s; }

@keyframes filterSlideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Tariff cards with filter states */
.tariff-card.filtered-out {
    display: none;
}

.tariff-card.filtered-in {
    opacity: 1;
    transform: scale(1);
    transition: all 0.4s ease;
}

/* Kleine Provider Quick Filter Buttons */
.provider-quick-btn, .provider-reset-btn {
    height: 32px;
    padding: 0 10px;
    border-radius: 6px;
    border: 1px solid var(--gray-300);
    background: var(--white);
    color: var(--gray-600);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
}

.provider-quick-btn i, .provider-reset-btn i {
    font-size: 12px;
}

.provider-quick-btn span, .provider-reset-btn span {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.02em;
}

.provider-quick-btn:hover, .provider-reset-btn:hover {
    background: var(--primary);
    color: var(--white);
    border-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
}

.provider-quick-btn.active, .provider-reset-btn.active {
    background: var(--primary);
    color: var(--white);
    border-color: var(--primary);
}

.provider-reset-btn {
    background: var(--gray-100);
}

.provider-reset-btn:hover {
    background: var(--gray-700);
    border-color: var(--gray-700);
}

/* Mobile Optimierungen fÃ¼r Quick Filter */
@media (max-width: 768px) {
    .provider-quick-filters {
        gap: 8px !important;
        margin-top: 8px;
        flex-wrap: wrap !important;
        justify-content: center;
    }
    
    .provider-quick-btn, .provider-reset-btn {
        min-height: 36px !important;
        padding: 0 12px !important;
        font-size: 12px !important;
    }
    
    .provider-quick-btn span, .provider-reset-btn span {
        font-size: 12px !important;
        font-weight: 600;
    }
    
    .provider-quick-btn i, .provider-reset-btn i {
        font-size: 13px !important;
        margin-right: 4px;
    }
}

.tariff-card.highlight {
    border-color: var(--success);
    box-shadow: 0 0 0 3px rgba(48, 209, 88, 0.1);
    animation: highlightPulse 2s ease-in-out infinite;
}

@keyframes highlightPulse {
    0%, 100% { 
        box-shadow: 0 0 0 3px rgba(48, 209, 88, 0.1);
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 0 6px rgba(48, 209, 88, 0.2);
        transform: scale(1.02);
    }
}

/* No Results State */
.no-results {
    text-align: center;
    padding: var(--space-4xl);
    background: var(--gray-50);
    border-radius: var(--radius-xl);
    border: 2px dashed var(--gray-300);
    margin: var(--space-xl) 0;
}

.no-results-icon {
    width: 80px;
    height: 80px;
    background: var(--gray-200);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-lg);
    font-size: 2rem;
    color: var(--gray-500);
}

.no-results h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-sm);
}

.no-results p {
    color: var(--gray-600);
    margin-bottom: var(--space-lg);
}

.no-results button {
    padding: var(--space-md) var(--space-xl);
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.no-results button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* Compact Filter System */
.compact-filter-bar {
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--space-sm);  /* Weniger Padding: lg â†’ sm */
    margin-bottom: var(--space-lg);  /* Weniger Margin: xl â†’ lg */
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--gray-200);
}

.search-filter-row {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
    flex-wrap: wrap;
}

.search-wrapper {
    position: relative;
    min-width: 250px;
    flex: 1;
    max-width: 400px;
}

.compact-search {
    width: 100%;
    padding: var(--space-sm) var(--space-md);
    padding-left: 2.5rem;
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    background: var(--gray-50);
    transition: all 0.2s ease;
    outline: none;
}

.compact-search:focus {
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.1);
}

.search-wrapper i {
    position: absolute;
    left: var(--space-sm);
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    font-size: 0.875rem;
}

.filter-chips {
    display: flex;
    gap: var(--space-sm);  /* Weniger Gap: lg â†’ sm */
    flex-wrap: wrap;
    flex: 1;
}

.chip-group {
    display: flex;
    align-items: center;
    gap: 6px;  /* Fester, kleinerer Wert statt var(--space-xs) */
}

.chip-label {
    font-size: 0.7rem;  /* Etwas kleiner: 0.75rem â†’ 0.7rem */
    color: var(--gray-600);
    font-weight: 600;
    white-space: nowrap;
    margin-right: 4px;  /* Weniger Abstand zum ersten Chip */
}

.chip {
    padding: 6px 10px;  /* Weniger Padding: var(--space-xs) var(--space-sm) â†’ 6px 10px */
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--gray-700);
    white-space: nowrap;
}

.chip:hover {
    background: var(--gray-200);
    transform: translateY(-1px);
}

.chip.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.filter-actions {
    display: flex;
    gap: var(--space-sm);
}

/* Horizontale Filter-Buttons - alle in einer Reihe */
.filter-actions-horizontal {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    margin: var(--space-sm) 0;
}

.quick-filter-buttons-horizontal {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: wrap;
    justify-content: center;
}

.reset-btn {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    background: var(--gray-100);
    border: 1px solid var(--gray-300);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: var(--gray-600);
}

.reset-btn:hover {
    background: var(--danger);
    color: white;
    border-color: var(--danger);
}

.filter-results-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
    padding-top: var(--space-sm);
    border-top: 1px solid var(--gray-200);
}

.results-text {
    font-size: 0.875rem;
    color: var(--gray-600);
    font-weight: 600;
}

.active-filters-compact {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
}

.active-filters-compact .active-filter-tag {
    padding: 2px var(--space-xs);
    font-size: 0.625rem;
    border-radius: var(--space-xs);
}

/* Global Tariffs Grid */
.global-results-section {
    margin-top: var(--space-2xl);
}

.global-tariffs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-xl);
}

.global-tariff-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.global-tariff-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.6s ease;
}

.global-tariff-card:hover::before {
    left: 100%;
}

.global-tariff-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: var(--shadow-2xl);
    border-color: var(--primary);
}

.global-tariff-card .category-badge {
    position: absolute;
    top: var(--space-lg);
    right: var(--space-lg);
    padding: var(--space-xs) var(--space-sm);
    background: var(--gradient-primary);
    color: white;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.global-tariff-card .category-badge.strom {
    background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%);
}

.global-tariff-card .provider-info {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
}

.global-tariff-card .provider-badge {
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 700;
    color: white;
}

.global-tariff-card .tariff-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-sm);
    line-height: 1.3;
}

.global-tariff-card .tariff-description {
    color: var(--gray-600);
    margin-bottom: var(--space-xl);
    font-size: 0.95rem;
}

.global-tariff-card .tariff-footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: var(--space-lg);
    margin-top: auto;
}

.global-tariff-card .price-info {
    flex: 1;
}

.global-tariff-card .price-label {
    display: block;
    font-size: 0.875rem;
    color: var(--gray-500);
    margin-bottom: var(--space-xs);
    font-weight: 500;
}

.global-tariff-card .price-value {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--gray-900);
}

.global-tariff-card .provision-info {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-md) var(--space-lg);
    background: var(--gradient-primary);
    color: white;
    border-radius: var(--radius-lg);
    font-weight: 700;
    font-size: 1rem;
    box-shadow: var(--shadow-md);
    white-space: nowrap;
}

/* Empty State */
.global-empty-state {
    text-align: center;
    padding: var(--space-4xl);
    background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
    border-radius: var(--radius-2xl);
    border: 2px dashed var(--gray-300);
    margin: var(--space-2xl) 0;
}

.global-empty-state-icon {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-xl);
    font-size: 3rem;
    color: var(--gray-400);
}

.global-empty-state h3 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-sm);
}

.global-empty-state p {
    color: var(--gray-600);
    font-size: 1.125rem;
    margin-bottom: var(--space-xl);
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

/* Responsive Global Filter Design */
@media (max-width: 768px) {
    .global-filter-section {
        padding: var(--space-xl);
    }
    
    .global-filter-section .filter-header {
        flex-direction: column;
        gap: var(--space-lg);
        align-items: stretch;
        text-align: center;
    }
    
    .global-filters-grid {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
    }
    
    .quick-actions {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .global-results-info {
        flex-direction: column;
        text-align: center;
    }
    
    .global-tariffs-grid {
        grid-template-columns: 1fr;
    }
    
    .search-input {
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .global-filter-section {
        padding: var(--space-lg);
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
    
    .global-tariff-card {
        padding: var(--space-lg);
    }
    
    .global-tariff-card .tariff-footer {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-md);
    }
}

/* Responsive Filter Design */
@media (max-width: 768px) {
    .filter-header {
        flex-direction: column;
        gap: var(--space-lg);
        align-items: flex-start;
    }
    
    .filter-toggle-btn {
        align-self: stretch;
        justify-content: center;
    }
    
    .filter-buttons {
        justify-content: center;
    }
    
    .filter-results {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .active-filters {
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .filter-panel.show {
        padding: var(--space-lg);
    }
    
    .filter-btn {
        flex: 1;
        min-width: calc(50% - var(--space-xs));
        text-align: center;
        justify-content: center;
    }
    
    .filter-btn.special {
        min-width: 100%;
    }
}

/* Utility Classes */
.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-0 { margin-top: 0 !important; }
.mb-0 { margin-bottom: 0 !important; }
.mt-1 { margin-top: var(--space-xs) !important; }
.mb-1 { margin-bottom: var(--space-xs) !important; }
.mt-2 { margin-top: var(--space-sm) !important; }
.mb-2 { margin-bottom: var(--space-sm) !important; }
.mt-3 { margin-top: var(--space-md) !important; }
.mb-3 { margin-bottom: var(--space-md) !important; }
.mt-4 { margin-top: var(--space-lg) !important; }
.mb-4 { margin-bottom: var(--space-lg) !important; }

/* ==========================================
   COMPACT FILTER SYSTEM
   ========================================== */

/* Compact Filter Bar */
.compact-filter-bar {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    margin-bottom: var(--space-2xl);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.08),
        0 1px 2px rgba(0, 0, 0, 0.04);
}

/* Search and Filter Row */
.search-filter-row {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
    flex-wrap: wrap;
}

/* Compact Search Wrapper */
.search-wrapper {
    position: relative;
    flex: 0 0 280px;
    min-width: 200px;
}

.search-wrapper .compact-search {
    width: 100%;
    padding: var(--space-sm) var(--space-md) var(--space-sm) 2.5rem;
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-lg);
    font-size: 0.95rem;
    background: white;
    transition: all 0.2s ease;
    outline: none;
}

.search-wrapper .compact-search:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    background: white;
}

.search-wrapper .fas.fa-search {
    position: absolute;
    left: var(--space-sm);
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
    font-size: 0.875rem;
    pointer-events: none;
}

/* Filter Chips Container */
.filter-chips {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    flex: 1;
    flex-wrap: wrap;
}

/* Chip Groups */
.chip-group {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    flex-wrap: wrap;
}

.chip-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--gray-600);
    white-space: nowrap;
}

/* Individual Chips */
.chip {
    padding: 0.4rem 0.75rem;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.chip:hover {
    background: var(--gray-200);
    border-color: var(--gray-300);
    transform: translateY(-1px);
}

.chip.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
}

.chip.active:hover {
    background: var(--primary-dark);
    border-color: var(--primary-dark);
}

/* Filter Actions */
.filter-actions {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.quick-filter-buttons {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.quick-btn {
    width: 28px;
    height: 28px;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--gray-500);
    font-size: 0.75rem;
}

.quick-btn:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: scale(1.1);
}

.quick-btn.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
}

/* Schnellfilter-Buttons mit Text */
.quick-btn-with-text {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--gray-700);
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap;
}

.quick-btn-with-text:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
}

.quick-btn-with-text.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
}

.quick-btn-with-text i {
    font-size: 14px;
}

/* Reset-Button mit Text */
.reset-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: var(--gray-200);
    border: 1px solid var(--gray-300);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--gray-600);
    font-size: 0.875rem;
    font-weight: 500;
}

.reset-btn:hover {
    background: var(--gray-700);
    border-color: var(--gray-700);
    color: white;
    transform: translateY(-1px);
}

.reset-btn {
    width: 32px;
    height: 32px;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--gray-500);
}

.reset-btn:hover {
    background: var(--danger);
    border-color: var(--danger);
    color: white;
    transform: scale(1.05);
}

/* Filter Results Row */
.filter-results-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: var(--space-md);
    border-top: 1px solid var(--gray-200);
    gap: var(--space-md);
    flex-wrap: wrap;
}

.results-text {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-600);
}

/* Active Filters Display */
.active-filters-compact {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    flex-wrap: wrap;
}

.active-filters-compact .filter-tag {
    padding: 0.25rem 0.5rem;
    background: var(--primary);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.active-filters-compact .filter-tag .remove {
    width: 14px;
    height: 14px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.625rem;
    transition: background-color 0.15s ease;
}

.active-filters-compact .filter-tag .remove:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Responsive Design for Compact Filter */
@media (max-width: 768px) {
    .search-filter-row {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm);
    }
    
    .search-wrapper {
        flex: none;
        width: 100%;
    }
    
    .filter-chips {
        justify-content: flex-start;
        gap: var(--space-md);
    }
    
    .chip-group {
        min-width: 100%;
        justify-content: flex-start;
    }
    
    .filter-results-row {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .filter-actions {
        flex-direction: column;
        gap: var(--space-sm);
        align-items: center;
    }
    
    .quick-filter-buttons {
        gap: var(--space-xs);
    }
    
    /* Horizontale Buttons auch mobile responsive */
    .filter-actions-horizontal {
        flex-direction: column;
        gap: var(--space-xs);
    }
    
    .quick-filter-buttons-horizontal {
        flex-wrap: wrap;
        gap: var(--space-xs);
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .compact-filter-bar {
        padding: var(--space-md);
        border-radius: var(--radius-lg);
    }
    
    .chip {
        font-size: 0.75rem;
        padding: 0.35rem 0.6rem;
    }
    
    .chip-label {
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
        display: block;
        width: 100%;
    }
    
    .chip-group {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
        padding: var(--space-xs) 0;
        border-bottom: 1px solid var(--gray-200);
    }
    
    .chip-group:last-child {
        border-bottom: none;
    }
    
    .search-wrapper .compact-search {
        font-size: 0.9rem;
        padding: 0.6rem 0.75rem 0.6rem 2.25rem;
    }
    
    .filter-results-row {
        padding-top: var(--space-sm);
    }
    
    .filter-actions {
        width: 100%;
        justify-content: center;
        padding: var(--space-sm) 0;
        border-top: 1px solid var(--gray-200);
        margin-top: var(--space-sm);
    }
    
    .quick-filter-buttons {
        gap: var(--space-sm);
    }
    
    .quick-btn {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
}
/* Responsive Spotlight Layout */
@media (max-width: 1200px) {
    .spotlight-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
    }
}

@media (max-width: 768px) {
    .spotlight-grid {
        grid-template-columns: 1fr;
        gap: var(--space-md);
    }
    
    .spotlight-card {
        padding: var(--space-md);
        min-height: 260px;
    }
    
    .card-pricing {
        flex-direction: row;
        align-items: flex-end;
        gap: var(--space-sm);
    }
    
    .provision-badge {
        max-width: 90px;
        font-size: 0.8rem;
    }
    
    .card-title {
        font-size: 1.1rem;
    }
    
    .price-value {
        font-size: 1.4rem;
    }
}

/* WhatsApp Widget */
.whatsapp-widget {
    position: fixed;
    bottom: 25px;
    right: 25px;
    z-index: 1000;
}

.whatsapp-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background: #25D366;
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
    text-decoration: none;
    transition: all 0.3s ease;
    animation: whatsappPulse 2s infinite;
}

.whatsapp-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(37, 211, 102, 0.5);
}

.whatsapp-button i {
    font-size: 32px;
    color: white;
}

@keyframes whatsappPulse {
    0%, 100% {
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
    }
    50% {
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3), 0 0 0 10px rgba(37, 211, 102, 0.15);
    }
}

/* Contact Dropdown */
.contact-dropdown {
    position: relative;
}

.contact-btn {
    background: linear-gradient(135deg, var(--primary) 0%, #5856D6 100%);
    color: white;
    padding: var(--space-sm) var(--space-lg);
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    font-size: 0.9rem;
}

.contact-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
}

.contact-btn .fa-chevron-down {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
}

.contact-dropdown .contact-menu.active ~ .contact-btn .fa-chevron-down {
    transform: rotate(180deg);
}

.contact-menu {
    position: absolute;
    top: 110%;
    right: 0;
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    min-width: 300px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1000;
    border: 1px solid var(--gray-200);
}

.contact-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.contact-option {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-lg);
    border-bottom: 1px solid var(--gray-100);
    text-decoration: none !important;
    color: var(--gray-900);
    transition: all 0.2s ease;
}

.contact-option:hover .contact-title,
.contact-option:hover .contact-subtitle {
    text-decoration: none !important;
    border-bottom: none !important;
}

.contact-option * {
    text-decoration: none !important;
    border-bottom: none !important;
}

.contact-option:last-child {
    border-bottom: none;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
}

.contact-option:first-child {
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.contact-option:hover {
    background: var(--gray-50);
}

.contact-option i {
    width: 24px;
    font-size: 1.2rem;
    color: var(--primary);
    text-align: center;
}

.contact-option .fab.fa-whatsapp {
    color: #25D366;
}

.contact-title {
    font-weight: 600;
    color: var(--gray-900);
    display: block;
    margin-bottom: 3px;
    text-decoration: none !important;
    border-bottom: none !important;
}

.contact-subtitle {
    font-size: 0.8rem;
    color: var(--gray-600);
    display: block;
    text-decoration: none !important;
    border-bottom: none !important;
}

/* Remove all red underlines from contact elements */
a[href*="mailto:"], 
a[href*="wa.me"], 
a[href*="whatsapp"],
.contact-option a,
.contact-option span,
.contact-title,
.contact-subtitle {
    text-decoration: none !important;
    border-bottom: none !important;
    box-shadow: none !important;
}

/* Responsive */
@media (max-width: 768px) {
    .whatsapp-widget {
        bottom: 20px;
        right: 20px;
    }
    
    .whatsapp-button {
        width: 55px;
        height: 55px;
    }
    
    .whatsapp-button i {
        font-size: 28px;
    }
    
    .contact-menu {
        min-width: 280px;
        right: -20px;
    }
}

@media (max-width: 480px) {
    .contact-menu {
        min-width: 260px;
        right: -40px;
    }
    
    .contact-btn {
        font-size: 0.8rem;
        padding: var(--space-xs) var(--space-md);
    }
}

/* ===== PROVIDER SECTIONS FOR COLLAPSIBLE VIEW ===== */
.provider-section {
    margin-bottom: 24px;
    border: 1px solid var(--gray-200);
    border-radius: 12px;
    overflow: hidden;
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.provider-header {
    padding: 16px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: 600;
    color: white;
    user-select: none;
}

.provider-header:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.provider-header.o2 {
    background: var(--primary);
}

.provider-header.freenet {
    background: var(--success);
}

.provider-header.vodafone {
    background: var(--danger);
}

.provider-header.telekom {
    background: #e20074;
}

.provider-header.ayildiz {
    background: var(--ayildiz-red);
}

.provider-header.ondeone {
    background: #0033a0;
}

.provider-header.yourfone {
    background: var(--yourfone-purple);
}

.provider-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.provider-toggle {
    font-size: 14px;
    transition: transform 0.3s ease;
}

.provider-name {
    font-size: 18px;
    font-weight: 700;
}

.provider-count {
    font-size: 14px;
    opacity: 0.9;
    font-weight: 500;
}

.provider-tariffs {
    transition: all 0.3s ease;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.tariffs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
    background: var(--gray-50);
}

@media (max-width: 768px) {
    .tariffs-grid {
        grid-template-columns: 1fr;
        padding: 16px;
    }
    
    .provider-header {
        padding: 12px 16px;
    }
    
    .provider-name {
        font-size: 16px;
    }
    
    .provider-count {
        font-size: 13px;
    }
}

/* ===== SIMPLE TARIFFS GRID WITH COLORED LABELS ===== */
.simple-tariffs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    grid-auto-flow: row;
}

.provider-label {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 2;
}

.provider-label.o2 {
    background: var(--primary);
}

.provider-label.freenet {
    background: var(--success);
}

.provider-label.vodafone {
    background: var(--danger);
}

.provider-label.telekom {
    background: #e20074;
}

.provider-label.ayildiz {
    background: var(--ayildiz-red);
}

.provider-label.ondeone {
    background: #0033a0;
}

.provider-label.yourfone {
    background: var(--yourfone-purple);
}

@media (max-width: 768px) {
    .simple-tariffs-grid {
        grid-template-columns: 1fr;
    }
}

/* ===== CLEAN PROVIDER GROUPS WITH HEADERS ===== */
.provider-group {
    margin-bottom: 40px;
}

.provider-header-simple {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    display: inline-block;
}

.provider-header-simple.o2 {
    background: #0056d6;  /* Echtes O2 Blau */
}

.provider-header-simple.freenet {
    background: #00a03e;  /* Echtes Freenet GrÃ¼n */
}

.provider-header-simple.vodafone {
    background: #e60000;  /* Echtes Vodafone Rot */
}

.provider-header-simple.telekom {
    background: #e20074;  /* Echtes Telekom Magenta */
}

.provider-header-simple.ayildiz {
    background: var(--ayildiz-red);  /* Echtes Ay Yildiz Rot */
}

.provider-header-simple.ondeone {
    background: #0033a0;  /* Echtes 1&1 Blau */
}

.provider-header-simple.yourfone {
    background: var(--yourfone-purple);  /* Yourfone Lila */
}

.provider-header-simple.klarmobil {
    background: var(--klarmobil-orange);  /* Echtes Klarmobil Orange */
}

.provider-tariffs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    grid-auto-flow: row;
    margin-bottom: 32px;
    /* Force horizontal flow - should arrange cards left to right, then new row */
}

.provider-groups-container {
    display: block;
    width: 100%;
}

/* Simple tariff cards for "Alle Tariffe" */
.simple-tariff-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.simple-tariff-card:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

/* Card content styles */
.simple-tariff-card .card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
    line-height: 1.3;
}

.simple-tariff-card .card-desc {
    color: var(--text-secondary);
    margin-bottom: var(--space-md);
    font-size: 0.95rem;
    line-height: 1.4;
    flex-grow: 1;
}

.simple-tariff-card .card-pricing {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-top: auto;
}

.simple-tariff-card .customer-price {
    display: flex;
    flex-direction: column;
}

.simple-tariff-card .price-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-xs);
}

.simple-tariff-card .price-value {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
}

.simple-tariff-card .price-period {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.simple-tariff-card .provision-badge {
    background: var(--success);
    color: white;
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

/* Internet Tariff Card Styles */
.internet-card {
    position: relative;
    border: 2px solid var(--gray-200);
}

.internet-card .card-badge {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.internet-card .card-badge.dsl {
    background: #ff9500;
    color: white;
}

.internet-card .card-badge.glasfaser {
    background: #30d158;
    color: white;
}

.internet-pricing .normal-price {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: var(--space-xs);
    display: block;
}

.setup-fee {
    background: var(--gray-100);
    padding: var(--space-sm);
    border-radius: var(--radius-md);
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-align: center;
    margin-top: var(--space-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
}

/* Internet Form Styles */
.radio-group {
    display: flex;
    gap: var(--space-lg);
    margin-top: var(--space-xs);
}

.radio-label {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    cursor: pointer;
    font-weight: 500;
}

.radio-label input[type="radio"] {
    margin: 0;
    accent-color: var(--primary);
}

.form-fields-group {
    transition: all 0.3s ease;
}

.info-box.internet-info {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 1px solid #0ea5e9;
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin-top: var(--space-lg);
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
}

.info-box.internet-info i {
    color: #0ea5e9;
    font-size: 1.2rem;
    margin-top: 2px;
}

.info-box.internet-info p {
    margin: 0;
    color: var(--text-primary);
    line-height: 1.5;
}

.cost-item.setup {
    border-top: 1px solid var(--gray-200);
    padding-top: var(--space-sm);
    margin-top: var(--space-sm);
    font-weight: 600;
}

.tariff-badge.internet {
    background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
}

@media (max-width: 768px) {
    .provider-tariffs-grid {
        grid-template-columns: 1fr;
    }
    
    .provider-header-simple {
        font-size: 20px;
        padding: 10px 16px;
    }
}

/* ========================================
   PROVISIONSLISTE - STYLES
   ======================================== */

.provisionsliste-header {
    text-align: center;
    margin-bottom: 30px;
}

.provisionsliste-header .section-title {
    font-size: 2rem;
    margin-bottom: 10px;
}

.provisionsliste-header .section-subtitle {
    color: var(--gray-500);
    font-size: 1.1rem;
}

/* Filter Bar */
.provisions-filter-bar {
    background: white;
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    border: 1px solid var(--gray-200);
}

.filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    align-items: center;
    margin-bottom: 16px;
}

.provisions-search {
    flex: 1;
    min-width: 200px;
    max-width: 300px;
}

.provisions-search .compact-search {
    width: 100%;
    padding: 10px 40px 10px 16px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-md);
    font-size: 14px;
    transition: all 0.2s;
}

.provisions-search .compact-search:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.provisions-search i {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-400);
}

/* Provider Filter Chips */
.provider-filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    flex: 2;
}

.provider-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: var(--gray-100);
    border: 2px solid var(--gray-200);
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.provider-chip:hover {
    background: var(--gray-200);
    transform: translateY(-1px);
}

.provider-chip.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.provider-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.provider-dot.o2 { background: var(--o2-blue); }
.provider-dot.freenet { background: var(--freenet-green); }
.provider-dot.telekom { background: var(--telekom-magenta); }
.provider-dot.vodafone { background: var(--vodafone-red); }
.provider-dot.ondeone { background: var(--ondeone-blue); }
.provider-dot.klarmobil { background: var(--klarmobil-orange); }
.provider-dot.ayildiz { background: var(--ayildiz-red); }
.provider-dot.yourfone { background: var(--yourfone-purple); }

/* Sort Controls */
.sort-controls {
    min-width: 180px;
}

.sort-select {
    width: 100%;
    padding: 10px 14px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    background: white;
}

/* Quick Actions */
.quick-actions-row {
    display: flex;
    gap: 12px;
    align-items: center;
    padding-top: 12px;
    border-top: 1px solid var(--gray-200);
}

.expand-all-btn,
.collapse-all-btn {
    padding: 8px 14px;
    background: var(--gray-100);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.expand-all-btn:hover,
.collapse-all-btn:hover {
    background: var(--gray-200);
}

.results-count {
    margin-left: auto;
    font-size: 13px;
    color: var(--gray-500);
    font-weight: 600;
}

/* Accordion Container */
.provisions-accordion-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* Provider Accordion */
.provider-accordion {
    background: white;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    border: 1px solid var(--gray-200);
    transition: all 0.2s;
}

.provider-accordion:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.accordion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    cursor: pointer;
    background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
    border-bottom: 1px solid transparent;
    transition: all 0.2s;
}

.accordion-header:hover {
    background: var(--gray-100);
}

.provider-accordion.open .accordion-header {
    border-bottom-color: var(--gray-200);
}

.accordion-title {
    display: flex;
    align-items: center;
    gap: 12px;
}

.provider-badge {
    padding: 6px 14px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 800;
    color: white;
    min-width: 80px;
    text-align: center;
}

.provider-badge.o2 { background: var(--o2-blue); }
.provider-badge.freenet { background: var(--freenet-green); }
.provider-badge.telekom { background: var(--telekom-magenta); }
.provider-badge.vodafone { background: var(--vodafone-red); }
.provider-badge.ondeone { background: var(--ondeone-blue); }
.provider-badge.klarmobil { background: var(--klarmobil-orange); }
.provider-badge.ayildiz { background: var(--ayildiz-red); }
.provider-badge.yourfone { background: var(--yourfone-purple); }
.provider-badge.internet { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
.provider-badge.strom { background: linear-gradient(135deg, #f59e0b, #fbbf24); }

.accordion-title .provider-name {
    font-size: 16px;
    font-weight: 700;
    color: var(--gray-800);
}

.tariff-count {
    font-size: 13px;
    color: var(--gray-500);
    font-weight: 500;
}

.accordion-icon {
    color: var(--gray-400);
    transition: transform 0.3s ease;
    font-size: 14px;
}

.provider-accordion.open .accordion-icon {
    transform: rotate(180deg);
}

/* Accordion Content */
.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.provider-accordion.open .accordion-content {
    max-height: 2000px;
}

/* Provisions Table */
.provisions-table {
    width: 100%;
    border-collapse: collapse;
}

.provisions-table th {
    background: var(--gray-100);
    padding: 12px 16px;
    text-align: left;
    font-size: 12px;
    font-weight: 700;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.provisions-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--gray-100);
    font-size: 14px;
}

.provisions-table tr:hover {
    background: var(--gray-50);
}

.provisions-table tr:last-child td {
    border-bottom: none;
}

.provisions-table .tariff-name {
    font-weight: 700;
    color: var(--gray-800);
}

.provisions-table .price {
    color: var(--gray-600);
    font-weight: 600;
}

.provisions-table .provision {
    text-align: right;
}

/* Data Badge */
.data-badge {
    display: inline-block;
    padding: 4px 10px;
    background: var(--gray-100);
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--gray-700);
}

.data-badge.unlimited {
    background: linear-gradient(135deg, var(--primary), #60a5fa);
    color: white;
}

.data-badge.strom {
    background: linear-gradient(135deg, #f59e0b, #fbbf24);
    color: white;
}

.data-badge.gas {
    background: linear-gradient(135deg, #3b82f6, #60a5fa);
    color: white;
}

/* Provision Value */
.provision-value {
    display: inline-block;
    padding: 6px 14px;
    background: var(--gray-100);
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 800;
    color: var(--gray-700);
}

.provision-value.highlight {
    background: linear-gradient(135deg, var(--success), #68d391);
    color: white;
}

.provision-value.premium {
    background: linear-gradient(135deg, #f59e0b, #fbbf24);
    color: white;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Mobile Responsive */
@media (max-width: 968px) {
    .filter-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .provisions-search {
        max-width: none;
    }
    
    .provider-filter-chips {
        justify-content: flex-start;
    }
    
    .sort-controls {
        width: 100%;
    }
    
    .quick-actions-row {
        flex-wrap: wrap;
    }
    
    .provisions-table th,
    .provisions-table td {
        padding: 10px 12px;
        font-size: 13px;
    }
    
    .accordion-title .provider-name {
        font-size: 14px;
    }
    
    .provider-badge {
        font-size: 11px;
        padding: 5px 10px;
        min-width: 60px;
    }
}

@media (max-width: 640px) {
    .provisions-filter-bar {
        padding: 14px;
    }
    
    .provider-filter-chips {
        gap: 6px;
    }
    
    .provider-chip {
        padding: 6px 10px;
        font-size: 11px;
    }
    
    .provisions-table {
        display: block;
        overflow-x: auto;
    }
    
    .provisions-table th:nth-child(2),
    .provisions-table td:nth-child(2) {
        display: none;
    }
    
    .accordion-header {
        padding: 12px 14px;
    }
    
    .tariff-count {
        display: none;
    }
}

/* ===============================================
   NEUES 1&1 HANDY + TARIF SYSTEM - CSS (2026)
   =============================================== */

/* Laufzeit Selection */
.laufzeit-selection {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin: 24px 0;
    max-width: 700px;
}

.laufzeit-card {
    position: relative;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-xl);
    padding: 28px 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.laufzeit-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.laufzeit-card.active {
    border-color: var(--primary);
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.05), rgba(90, 200, 250, 0.05));
}

.laufzeit-card.active .laufzeit-check {
    display: block;
    color: var(--primary);
}

.laufzeit-check {
    display: none;
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 24px;
}

.laufzeit-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--success), #68d391);
    color: white;
    padding: 4px 16px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.laufzeit-badge.popular {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
}

.laufzeit-months {
    font-size: 28px;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 8px;
}

.laufzeit-price {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 4px;
}

.laufzeit-desc {
    font-size: 13px;
    color: var(--gray-500);
}

/* Continue Button */
.continue-btn {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: var(--radius-lg);
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 16px;
}

.continue-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 122, 255, 0.4);
}

/* Selected Device Preview */
.selected-device-info {
    background: linear-gradient(135deg, var(--gray-50), var(--white));
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 20px 24px;
    margin-bottom: 24px;
}

.selected-device-info h4 {
    font-size: 18px;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.selected-device-info p {
    font-size: 14px;
    color: var(--gray-600);
    margin: 0;
}

/* Tariff Category Tabs */
.tariff-category-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
}

.tariff-cat-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--white);
    border: 2px solid var(--gray-200);
    padding: 12px 24px;
    border-radius: var(--radius-lg);
    font-size: 14px;
    font-weight: 700;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.3s ease;
}

.tariff-cat-btn:hover {
    border-color: var(--primary);
    color: var(--primary);
}

.tariff-cat-btn.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.tariff-cat-btn i {
    font-size: 16px;
}

/* Tariff Cards im Handy-Flow */
.handy-tariff-card {
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-xl);
    padding: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.handy-tariff-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.handy-tariff-card .tariff-badge {
    position: absolute;
    top: -10px;
    right: 16px;
    background: linear-gradient(135deg, var(--warning), #fbbf24);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
}

.handy-tariff-card .tariff-name {
    font-size: 18px;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.handy-tariff-card .tariff-data {
    display: inline-block;
    background: var(--gray-100);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 12px;
}

.handy-tariff-card .tariff-desc {
    font-size: 13px;
    color: var(--gray-500);
    margin-bottom: 16px;
}

.handy-tariff-card .price-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding-top: 16px;
    border-top: 1px solid var(--gray-100);
}

.handy-tariff-card .total-price {
    font-size: 12px;
    color: var(--gray-500);
}

.handy-tariff-card .total-price span {
    display: block;
    font-size: 24px;
    font-weight: 800;
    color: var(--gray-900);
}

.handy-tariff-card .provision-box {
    background: linear-gradient(135deg, var(--success), #68d391);
    color: white;
    padding: 8px 16px;
    border-radius: var(--radius-md);
    text-align: center;
}

.handy-tariff-card .provision-box .prov-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.9;
}

.handy-tariff-card .provision-box .prov-value {
    font-size: 20px;
    font-weight: 800;
}

/* Device Cards Verbesserung */
.device-card {
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-xl);
    padding: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
}

.device-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.device-card .device-badge {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--danger), #f87171);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
}

.device-card .device-icon {
    font-size: 48px;
    color: var(--gray-400);
    margin-bottom: 12px;
}

.device-card .device-name {
    font-size: 16px;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 8px;
}

.device-card .device-price {
    font-size: 14px;
    color: var(--primary);
    font-weight: 700;
}

/* Storage & Color Selection Cards */
.option-card {
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    min-width: 120px;
}

.option-card:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.option-card.selected {
    border-color: var(--primary);
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.05), rgba(90, 200, 250, 0.05));
}

.option-card .option-value {
    font-size: 18px;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.option-card .option-price {
    font-size: 13px;
    color: var(--gray-500);
}

/* Color Swatch */
.color-swatch {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    margin: 0 auto 8px;
    border: 2px solid var(--gray-200);
}

/* Mobile Responsive fÃ¼r neues System */
@media (max-width: 640px) {
    .laufzeit-selection {
        grid-template-columns: 1fr;
    }
    
    .laufzeit-card {
        padding: 20px;
    }
    
    .laufzeit-months {
        font-size: 22px;
    }
    
    .tariff-category-tabs {
        flex-direction: column;
    }
    
    .tariff-cat-btn {
        justify-content: center;
    }
}
    </style>



    <!-- SHOPIFY FULLSCREEN CONTAINER -->
    <div id="partner-tool-fullscreen">
        
        <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-handshake"></i>
                <span>Partner Tool</span>
            </div>
            <div class="nav-contact">
                <div class="contact-dropdown">
                    <button class="contact-btn" onclick="toggleContactMenu()">
                        <i class="fas fa-envelope"></i>
                        Kontakt
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="contact-menu" id="contactMenu">
                        <a href="/cdn-cgi/l/email-protection#3d4d5c4f4953584f4d4f525a4f5c50507d595854535e55585e56135958" class="contact-option">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <span class="contact-title">Email schreiben</span>
                                <span class="contact-subtitle"><span class="__cf_email__" data-cfemail="b8c8d9caccd6ddcac8cad7dfcad9d5d5f8dcddd1d6dbd0dddbd396dcdd">[emailÂ protected]</span></span>
                            </div>
                        </a>
                        <a href="https://wa.me/4915562558936?text=Hallo,%20ich%20interessiere%20mich%20f%C3%BCr%20das%20Partnerprogramm!" class="contact-option" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                            <div>
                                <span class="contact-title">WhatsApp direkt</span>
                                <span class="contact-subtitle">Sofort anschreiben</span>
                            </div>
                        </a>
                        <a href="https://chat.whatsapp.com/JbOpD99h9xJ8t1eJZwM9RZ" class="contact-option" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                            <div>
                                <span class="contact-title">WhatsApp Gruppe</span>
                                <span class="contact-subtitle">Partner-Community beitreten</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background">
            <div class="hero-particles"></div>
            <div class="hero-mesh-gradient"></div>
        </div>
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-star"></i>
                <span>Partner Programm</span>
            </div>
            <h1 class="hero-title">
                Verdienen Sie Provisionen mit<br>
                <span class="gradient-text">Top-Tarifen</span>
            </h1>
            <p class="hero-subtitle">
                Profitieren Sie von attraktiven Provisionen fÃ¼r Mobilfunk, Internet und Strom.<br>
                Einfach, transparent und sofort abrufbar.
            </p>
            <div class="hero-stats">
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="stat-value">150+</div>
                    <div class="stat-label">Tarife</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <div class="stat-value">bis zu 550â‚¬</div>
                    <div class="stat-label">Provision</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value">500+</div>
                    <div class="stat-label">Partner</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value">Ã¼ber 2Mâ‚¬</div>
                    <div class="stat-label">Ausgezahlt</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ğŸ WHAT'S NEW BANNER - Apple Style -->
    <section class="container" style="margin-top: -40px; position: relative; z-index: 10;">
        <div class="whats-new-banner" id="whatsNewBanner">
            <div class="whats-new-content">
                <div class="whats-new-badge">
                    <i class="fas fa-sparkles"></i>
                    <span>NEU 2026</span>
                </div>
                <div class="whats-new-text">
                    <h3>
                        <span id="whatsNewTitle">Neue Tarife & Provisionen</span>
                        <i class="fas fa-arrow-trend-up" style="color: #34C759;"></i>
                    </h3>
                    <p id="whatsNewDescription">Entdecke die neuesten Tarif-Updates und verbesserten Provisionen. Jetzt mit noch mehr VerdienstmÃ¶glichkeiten!</p>
                </div>
                <button class="whats-new-cta" onclick="scrollToTariffs()">
                    <span>Jetzt entdecken</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Partner Email Section -->
    <section class="partner-email-section">
        <div class="container">
            <div class="email-card">
                <div class="email-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h3>Partner-E-Mail</h3>
                <p>Ihre E-Mail-Adresse fÃ¼r die Provisionszuordnung</p>
                <div class="email-input-wrapper">
                    <input type="email" id="partnerEmail" class="email-input" placeholder="ihre@email.de" required="" onblur="validatePartnerEmail()" onkeyup="handleEmailKeyup(event)">
                    <i class="fas fa-envelope input-icon"></i>
                    <button type="button" id="emailValidationBtn" class="email-validation-btn" onclick="validatePartnerEmail()" title="E-Mail validieren">
                        <i class="fas fa-check"></i>
                        <span>Freischalten</span>
                    </button>
                    <div id="emailValidationStatus" class="validation-status hidden">
                        <i class="fas fa-check-circle"></i>
                        <span>E-Mail freigeschaltet</span>
                    </div>
                </div>
                <div id="emailRequiredMessage" class="email-required-message" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Bitte validieren Sie zuerst Ihre Partner-E-Mail-Adresse</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Spotlight Section -->
    <section class="spotlight-section">
        <div class="container">
            <div class="spotlight-header">
                <div class="spotlight-badge">
                    <i class="fas fa-fire"></i>
                    <span>Diese Woche</span>
                </div>
                <h2 class="section-title">
                    <span class="gradient-text">Top Provisionen</span> dieser Woche
                </h2>
                <p class="section-subtitle">
                    Unsere aktuell besten Angebote mit den hÃ¶chsten Provisionen fÃ¼r Sie
                </p>
            </div>
            
            <div class="spotlight-grid">
                <!-- 1. TOP PROVISION - O2 Unlimited Max 2026 -->
                <div class="spotlight-card premium-card" onclick="selectTariff('diese-woche', 'o2-unlimited-max-2026', '99,99', '510,00', 'freenet-o2')">
                    <div class="card-badge premium">
                        <i class="fas fa-gem"></i>
                        Top Provision
                    </div>
                    <div class="card-provider freenet">Freenet O2</div>
                    <h3 class="card-title">O2 Unlimited Max 2026</h3>
                    <p class="card-desc">Unlimitiert 500 Mbit/s 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">99,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge premium">
                            <span>510,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 2. PREMIUM - Magenta Mobil XL Unlimited -->
                <div class="spotlight-card gold-card" onclick="selectTariff('diese-woche', 'magenta-mobil-xl-unlimited', '94,95', '425,00', 'freenet-telekom')">
                    <div class="card-badge gold">
                        <i class="fas fa-crown"></i>
                        Premium
                    </div>
                    <div class="card-provider telekom">Freenet Telekom</div>
                    <h3 class="card-title">Magenta Mobil XL</h3>
                    <p class="card-desc">Unlimitiert 5G Highspeed</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">94,95â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge gold">
                            <span>425,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 3. HIGHLIGHT - Vodafone 100 GB -->
                <div class="spotlight-card featured" onclick="selectTariff('diese-woche', 'allnet-flat-100-gb-5g', '64,99', '420,00', 'freenet-vodafone')">
                    <div class="card-badge highlight">
                        <i class="fas fa-star"></i>
                        Highlight
                    </div>
                    <div class="card-provider freenet">Freenet Vodafone</div>
                    <h3 class="card-title">Allnet Flat 100 GB 5G</h3>
                    <p class="card-desc">100 GB + 5G Speed</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">64,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge highlight">
                            <span>420,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 4. BESTSELLER - 1&1 Unlimited 60 GB -->
                <div class="spotlight-card value-card" onclick="selectTariff('diese-woche', '1und1-unlimited-60', '24,99', '85,00', '1und1')">
                    <div class="card-badge value">
                        <i class="fas fa-fire"></i>
                        Bestseller
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">1&amp;1 Unlimited 60 GB</h3>
                    <p class="card-desc">60 GB 5G dauerhaft</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">24,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge value">
                            <span>85,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 5. KLARMOBIL - GigaMobil L -->
                <div class="spotlight-card klarmobil-card" onclick="selectTariff('diese-woche', 'klarmobil-gigamobil-l', '69,99', '320,00', 'klarmobil-vodafone')">
                    <div class="card-badge klarmobil">
                        <i class="fas fa-bolt"></i>
                        Klarmobil
                    </div>
                    <div class="card-provider klarmobil">Klarmobil Vodafone</div>
                    <h3 class="card-title">GigaMobil L</h3>
                    <p class="card-desc">80 GB + 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">69,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge klarmobil">
                            <span>320,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 6. PREIS-HIT - Ay Yildiz Allnet Plus -->
                <div class="spotlight-card budget-card" onclick="selectTariff('diese-woche', 'ayildiz-allnet-plus', '19,99', '120,00', 'ayildiz')">
                    <div class="card-badge budget">
                        <i class="fas fa-heart"></i>
                        Preis-Hit
                    </div>
                    <div class="card-provider ayildiz">Ay Yildiz</div>
                    <h3 class="card-title">AY Allnet Plus</h3>
                    <p class="card-desc">20 GB + TÃ¼rkei-Flat</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">19,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge budget">
                            <span>120,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 1: iPhone 17 Pro Max + 1&1 Unlimited -->
                <div class="spotlight-card smartphone-card-premium" onclick="goToHandyTarif('iPhone 17 Pro Max')">
                    <div class="card-badge premium">
                        <i class="fas fa-gem"></i>
                        ğŸ”¥ TOP 2026
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">iPhone 17 Pro Max + Unlimited</h3>
                    <p class="card-desc">256GB, 36 Mon., Unlimitiert 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">74,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge premium">
                            <span>bis 120â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 2: Samsung Galaxy S25 Ultra + 1&1 -->
                <div class="spotlight-card smartphone-card" onclick="goToHandyTarif('Galaxy S25 Ultra')">
                    <div class="card-badge highlight">
                        <i class="fas fa-star"></i>
                        Flagship
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Galaxy S25 Ultra + All-Net-Flat</h3>
                    <p class="card-desc">256GB, 36 Mon., 60 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">44,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge highlight">
                            <span>bis 100â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 3: Samsung Galaxy Z Fold7 -->
                <div class="spotlight-card smartphone-card-premium" onclick="goToHandyTarif('Galaxy Z Fold7')">
                    <div class="card-badge gold">
                        <i class="fas fa-crown"></i>
                        Premium
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Galaxy Z Fold7 + Unlimited</h3>
                    <p class="card-desc">256GB, 36 Mon., Unlimitiert 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">94,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge gold">
                            <span>bis 120â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 4: Google Pixel 10 Pro -->
                <div class="spotlight-card smartphone-card" onclick="goToHandyTarif('Google Pixel 10 Pro')">
                    <div class="card-badge popular">
                        <i class="fab fa-google"></i>
                        NEU 2026
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Pixel 10 Pro + All-Net-Flat</h3>
                    <p class="card-desc">128GB, 36 Mon., 60 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">42,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge popular">
                            <span>bis 100â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 5: iPhone Air - NEU -->
                <div class="spotlight-card smartphone-card" onclick="goToHandyTarif('iPhone Air')">
                    <div class="card-badge highlight">
                        <i class="fas fa-feather"></i>
                        Ultraleicht
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">iPhone Air + All-Net-Flat</h3>
                    <p class="card-desc">256GB, 36 Mon., 60 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">47,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge highlight">
                            <span>bis 100â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- HANDY+TARIF 6: Samsung Galaxy A56 5G - PREIS-TIPP -->
                <div class="spotlight-card smartphone-card" onclick="goToHandyTarif('Galaxy A56 5G')">
                    <div class="card-badge budget">
                        <i class="fas fa-piggy-bank"></i>
                        Preis-Tipp
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Galaxy A56 5G + All-Net-Flat</h3>
                    <p class="card-desc">128GB, 36 Mon., 30 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">19,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge budget">
                            <span>bis 75â‚¬</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- New Tariffs Section -->
    <section class="new-tariffs-section">
        <div class="container">
            <div class="spotlight-header">
                <div class="spotlight-badge new-badge">
                    <i class="fas fa-sparkles"></i>
                    <span>Neu</span>
                </div>
                <h2 class="section-title">
                    <span class="gradient-text">Neue Tarife</span> im Programm
                </h2>
                <p class="section-subtitle">
                    Frisch hinzugefÃ¼gte Angebote mit attraktiven Konditionen fÃ¼r Ihre Kunden
                </p>
            </div>
            
            <div class="new-tariffs-grid">
                <!-- 1. NEU: O2 Unlimited Smart 5G -->
                <div class="new-tariff-card speed-master-card" onclick="selectTariff('neue-tariffe', 'o2-unlimited-smart-5g', '42,99', '145,00', 'freenet-o2')">
                    <div class="card-badge speed-master">
                        <i class="fas fa-rocket"></i>
                        5G Speed
                    </div>
                    <div class="card-provider freenet">Freenet O2</div>
                    <h3 class="card-title">O2 Unlimited Smart 5G</h3>
                    <p class="card-desc">Unlimited 300 Mbit/s 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">42,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge speed-master">
                            <span>145,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 2. NEU: 1&1 All-Net-Flat 120 GB -->
                <div class="new-tariff-card" onclick="selectTariff('neue-tariffe', '1und1-anf-120', '24,99', '100,00', '1und1')">
                    <div class="card-badge highlight">
                        <i class="fas fa-star"></i>
                        NEU
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">All-Net-Flat 120 GB</h3>
                    <p class="card-desc">120 GB 5G + Allnet Flat</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">24,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge highlight">
                            <span>100,00â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 3. NEU: Klarmobil Telekom 40 GB -->
                <div class="new-tariff-card" onclick="selectTariff('neue-tariffe', 'klarmobil-telekom-40gb', '59,99', '172,50', 'klarmobil-telekom')">
                    <div class="card-badge gold">
                        <i class="fas fa-crown"></i>
                        D1-Netz
                    </div>
                    <div class="card-provider telekom">Klarmobil Telekom</div>
                    <h3 class="card-title">Allnet Flat 40 GB LTE</h3>
                    <p class="card-desc">40 GB im Telekom-Netz</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">59,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge gold">
                            <span>172,50â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 4. NEU: Samsung Galaxy Z Flip7 + 1&1 -->
                <div class="new-tariff-card smartphone-card" onclick="goToHandyTarif('Galaxy Z Flip7')">
                    <div class="card-badge popular">
                        <i class="fas fa-mobile-alt"></i>
                        Foldable
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Galaxy Z Flip7 + All-Net-Flat</h3>
                    <p class="card-desc">256GB, 36 Mon., 60 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">47,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge popular">
                            <span>bis 100â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 5. NEU: iPhone 16e + 1&1 (Preis-Tipp) -->
                <div class="new-tariff-card smartphone-card" onclick="goToHandyTarif('iPhone 16e')">
                    <div class="card-badge budget">
                        <i class="fas fa-piggy-bank"></i>
                        Preis-Tipp
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">iPhone 16e + All-Net-Flat</h3>
                    <p class="card-desc">128GB, 36 Mon., 30 GB 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">27,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge budget">
                            <span>bis 75â‚¬</span>
                        </div>
                    </div>
                </div>

                <!-- 6. NEU: Google Pixel 10 Pro XL -->
                <div class="new-tariff-card smartphone-card" onclick="goToHandyTarif('Google Pixel 10 Pro XL')">
                    <div class="card-badge highlight">
                        <i class="fab fa-google"></i>
                        Pixel Pro
                    </div>
                    <div class="card-provider ondeone">1&amp;1</div>
                    <h3 class="card-title">Pixel 10 Pro XL + Unlimited</h3>
                    <p class="card-desc">256GB, 36 Mon., Unlimitiert 5G</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">ab</span>
                            <span class="price-value">67,99â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge highlight">
                            <span>bis 120â‚¬</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="container">
            <h2 class="section-title">Alle Kategorien</h2>
            <div class="category-tabs">
                <button class="category-tab" data-category="all" onclick="showCategory('all')">
                    <i class="fas fa-search"></i>
                    <span>Alle Tarife</span>
                </button>
                <button class="category-tab active" data-category="sim-only" onclick="showCategory('sim-only')">
                    <i class="fas fa-sim-card"></i>
                    <span>SIM Only</span>
                </button>
                <button class="category-tab" data-category="handy-tarif" onclick="showCategory('handy-tarif')">
                    <i class="fas fa-mobile-alt"></i>
                    <span>Handy + Tarif</span>
                </button>
                <button class="category-tab" data-category="internet" onclick="showCategory('internet')">
                    <i class="fas fa-wifi"></i>
                    <span>Internet</span>
                </button>
                <button class="category-tab" data-category="strom" onclick="showCategory('strom')">
                    <i class="fas fa-bolt"></i>
                    <span>Strom</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Global Filter Section -->
    <section id="category-all" class="category-content">
        <div class="container">
            <!-- Compact Filter System -->
            <div class="compact-filter-bar">
                <div class="search-filter-row">
                    <div class="search-wrapper">
                        <input type="text" id="global-search" class="compact-search" placeholder="Suche Tarife..." onkeyup="performGlobalSearch()">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="filter-chips">
                        <div class="chip-group">
                            <span class="chip-label">Kategorie:</span>
                            <button class="chip active" data-filter="category" data-value="all" onclick="setGlobalFilter('category', 'all')">Alle</button>
                            <button class="chip" data-filter="category" data-value="sim-only" onclick="setGlobalFilter('category', 'sim-only')">SIM</button>
                        </div>
                        
                        <div class="chip-group">
                            <span class="chip-label">Preis:</span>
                            <button class="chip active" data-filter="price" data-value="all" onclick="setGlobalFilter('price', 'all')">Alle</button>
                            <button class="chip" data-filter="price" data-value="0-15" onclick="setGlobalFilter('price', '0-15')">0-15â‚¬</button>
                            <button class="chip" data-filter="price" data-value="15-30" onclick="setGlobalFilter('price', '15-30')">15-30â‚¬</button>
                            <button class="chip" data-filter="price" data-value="30+" onclick="setGlobalFilter('price', '30+')">30â‚¬+</button>
                        </div>
                        
                        <div class="chip-group">
                            <span class="chip-label">Daten:</span>
                            <button class="chip active" data-filter="data" data-value="all" onclick="setGlobalFilter('data', 'all')">Alle</button>
                            <button class="chip" data-filter="data" data-value="5-20" onclick="setGlobalFilter('data', '5-20')">5-20GB</button>
                            <button class="chip" data-filter="data" data-value="21-50" onclick="setGlobalFilter('data', '21-50')">21-50GB</button>
                            <button class="chip" data-filter="data" data-value="51+" onclick="setGlobalFilter('data', '51+')">51GB+</button>
                            <button class="chip" data-filter="data" data-value="unlimited" onclick="setGlobalFilter('data', 'unlimited')">Unlimited</button>
                        </div>
                        
                        <div class="chip-group">
                            <span class="chip-label">Provision:</span>
                            <button class="chip active" data-filter="provision" data-value="all" onclick="setGlobalFilter('provision', 'all')">Alle</button>
                            <button class="chip" data-filter="provision" data-value="50+" onclick="setGlobalFilter('provision', '50+')">50â‚¬+</button>
                            <button class="chip" data-filter="provision" data-value="100+" onclick="setGlobalFilter('provision', '100+')">100â‚¬+</button>
                            <button class="chip" data-filter="provision" data-value="200+" onclick="setGlobalFilter('provision', '200+')">200â‚¬+</button>
                        </div>
                    </div>
                    
                    <div class="filter-actions-horizontal">
                        <div class="quick-filter-buttons-horizontal">
                            <button class="quick-btn-with-text" onclick="globalQuickFilter('best-provision')" title="Beste Provision">
                                <i class="fas fa-trophy"></i>
                                <span>Top Provision</span>
                            </button>
                            <button class="quick-btn-with-text" onclick="globalQuickFilter('best-price')" title="Bester Preis">
                                <i class="fas fa-tag"></i>
                                <span>GÃ¼nstigste</span>
                            </button>
                            <button class="quick-btn-with-text" onclick="globalQuickFilter('high-data')" title="Viel Daten">
                                <i class="fas fa-database"></i>
                                <span>Viel Daten</span>
                            </button>
                            <button class="quick-btn-with-text" onclick="globalQuickFilter('unlimited')" title="Unlimited">
                                <i class="fas fa-infinity"></i>
                                <span>Unlimited</span>
                            </button>
                            <button class="reset-btn" onclick="clearGlobalFilters()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="filter-results-row">
                    <span class="results-text" id="global-results-count">0 Tarife</span>
                    <div class="active-filters-compact" id="active-global-filters"></div>
                </div>
            </div>

            <!-- Global Results Grid -->
            <div class="global-results-section">
                <div id="global-results-grid" class="global-tariffs-grid"></div>
            </div>
        </div>
    </section>

    <!-- SIM Only Category -->
    <section id="category-sim-only" class="category-content">
        <div class="container">
            <!-- Provider Selection -->
            <div class="provider-section">
                <h3 class="subsection-title">
                    <i class="fas fa-building"></i>
                    Anbieter wÃ¤hlen
                </h3>
                <div class="provider-grid">
                    <button class="provider-btn active" data-provider="o2" onclick="showProvider('sim-only', 'o2')">
                        <div class="provider-icon o2">O2</div>
                    </button>
                    <button class="provider-btn" data-provider="freenet" onclick="showProvider('sim-only', 'freenet')">
                        <div class="provider-icon freenet">Freenet</div>
                    </button>
                    <button class="provider-btn" data-provider="ayildiz" onclick="showProvider('sim-only', 'ayildiz')">
                        <div class="provider-icon ayildiz">Ay Yildiz</div>
                    </button>
                    <button class="provider-btn" data-provider="1und1" onclick="showProvider('sim-only', '1und1')">
                        <div class="provider-icon ondeone">1&amp;1</div>
                    </button>
                    <button class="provider-btn" data-provider="yourfone" onclick="showProvider('sim-only', 'yourfone')">
                        <div class="provider-icon yourfone">Yourfone</div>
                    </button>
                    <button class="provider-btn" data-provider="klarmobil" onclick="showProvider('sim-only', 'klarmobil')">
                        <div class="provider-icon klarmobil">Klarmobil</div>
                    </button>
                </div>
            </div>

            <!-- Freenet Sub Providers -->
            <div id="freenet-sub-providers" class="provider-section hidden">
                <h3 class="subsection-title">
                    <i class="fas fa-network-wired"></i>
                    Freenet Netz wÃ¤hlen
                </h3>
                <div class="provider-grid">
                    <button class="provider-btn active" data-provider="o2" onclick="showFreenetProvider('o2')">
                        <div class="provider-icon o2">Freenet O2</div>
                    </button>
                    <button class="provider-btn" data-provider="vodafone" onclick="showFreenetProvider('vodafone')">
                        <div class="provider-icon vodafone">Freenet Vodafone</div>
                    </button>
                    <button class="provider-btn" data-provider="telekom" onclick="showFreenetProvider('telekom')">
                        <div class="provider-icon telekom">Freenet Telekom</div>
                    </button>
                </div>
            </div>

            <!-- Klarmobil Sub Providers -->
            <div id="klarmobil-sub-providers" class="provider-section hidden">
                <h3 class="subsection-title">
                    <i class="fas fa-network-wired"></i>
                    Klarmobil Netz wÃ¤hlen
                </h3>
                <div class="provider-grid">
                    <button class="provider-btn active" data-provider="vodafone" onclick="showKlarmobilProvider('vodafone')">
                        <div class="provider-icon vodafone">Klarmobil Vodafone</div>
                    </button>
                    <button class="provider-btn" data-provider="o2" onclick="showKlarmobilProvider('o2')">
                        <div class="provider-icon o2">Klarmobil O2</div>
                    </button>
                    <button class="provider-btn" data-provider="telekom" onclick="showKlarmobilProvider('telekom')">
                        <div class="provider-icon telekom">Klarmobil Telekom</div>
                    </button>
                </div>
            </div>


            <!-- Tariffs Grid -->
            <div class="tariffs-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 class="subsection-title" id="provider-title-sim-only" style="margin: 0;">
                        <i class="fas fa-sim-card"></i>
                        O2 SIM Only Tarife
                    </h3>
                    
                    <!-- Kleine Schnellfilter fÃ¼r Provider -->
                    <div class="provider-quick-filters" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                        <button class="provider-quick-btn" onclick="localQuickFilter('best-provision')">
                            <i class="fas fa-trophy"></i>
                            <span>Top Provision</span>
                        </button>
                        <button class="provider-quick-btn" onclick="localQuickFilter('best-price')">
                            <i class="fas fa-tag"></i>
                            <span>GÃ¼nstigste</span>
                        </button>
                        <button class="provider-quick-btn" onclick="localQuickFilter('high-data')">
                            <i class="fas fa-database"></i>
                            <span>Viel Daten</span>
                        </button>
                        <button class="provider-quick-btn" onclick="localQuickFilter('unlimited')">
                            <i class="fas fa-infinity"></i>
                            <span>Unlimited</span>
                        </button>
                        <button class="provider-reset-btn" onclick="localQuickFilter('all')">
                            <i class="fas fa-list"></i>
                            <span>Alle zeigen</span>
                        </button>
                    </div>
                </div>
                
                <div id="tariffs-sim-only" class="tariffs-grid"></div>
            </div>
        </div>
    </section>

    <!-- Handy + Tarif Category - NEUES 1&1 SYSTEM 2026 -->
    <section id="category-handy-tarif" class="category-content hidden">
        <div class="container">
            <!-- Provider Selection - Nur 1&1 -->
            <div class="provider-section">
                <h3 class="subsection-title">
                    <i class="fas fa-building"></i>
                    Anbieter
                </h3>
                <div class="provider-grid">
                    <button class="provider-btn active" data-provider="1und1" onclick="showProvider('handy-tarif', '1und1')">
                        <div class="provider-icon ondeone">1&amp;1</div>
                    </button>
                </div>
            </div>

            <!-- Step 1: Smartphone Kategorie -->
            <div id="handy-categories" class="device-categories">
                <h3 class="subsection-title">
                    <i class="fas fa-mobile-alt"></i>
                    1. GerÃ¤tekategorie wÃ¤hlen
                </h3>
                <div class="category-cards">
                    <div class="category-card" onclick="showHandyCategory('Apple')">
                        <div class="category-icon apple">
                            <i class="fab fa-apple"></i>
                        </div>
                        <h4>Apple</h4>
                        <p>iPhone 17, 16, 15, Air</p>
                    </div>
                    <div class="category-card" onclick="showHandyCategory('Samsung')">
                        <div class="category-icon samsung">
                            <i class="fas fa-mobile-screen-button"></i>
                        </div>
                        <h4>Samsung</h4>
                        <p>Galaxy S25, Z Fold7, Z Flip7, A-Serie</p>
                    </div>
                    <div class="category-card" onclick="showHandyCategory('Xiaomi')">
                        <div class="category-icon xiaomi">
                            <i class="fas fa-fire"></i>
                        </div>
                        <h4>Xiaomi</h4>
                        <p>REDMI Note 15, 15T Pro, 15C 5G</p>
                    </div>
                    <div class="category-card" onclick="showHandyCategory('Google')">
                        <div class="category-icon google">
                            <i class="fab fa-google"></i>
                        </div>
                        <h4>Google</h4>
                        <p>Pixel 10 Pro, 10, 9a, Fold</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Smartphone wÃ¤hlen -->
            <div id="handy-devices" class="selection-step hidden">
                <div class="step-header">
                    <button class="back-btn" onclick="showHandyCategories()">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck
                    </button>
                    <h3 class="subsection-title" id="handy-device-title">2. Smartphone wÃ¤hlen</h3>
                </div>
                <div id="handy-devices-grid" class="selection-grid"></div>
            </div>

            <!-- Step 3: Speicher wÃ¤hlen -->
            <div id="handy-storage" class="selection-step hidden">
                <div class="step-header">
                    <button class="back-btn" onclick="backToHandyDevices()">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck
                    </button>
                    <h3 class="subsection-title" id="handy-storage-title">3. Speicher wÃ¤hlen</h3>
                </div>
                <div id="handy-storage-grid" class="selection-grid"></div>
            </div>

            <!-- Step 4: Farbe wÃ¤hlen -->
            <div id="handy-colors" class="selection-step hidden">
                <div class="step-header">
                    <button class="back-btn" onclick="backToHandyStorage()">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck
                    </button>
                    <h3 class="subsection-title" id="handy-color-title">4. Farbe wÃ¤hlen</h3>
                </div>
                <div id="handy-colors-grid" class="selection-grid"></div>
            </div>

            <!-- Step 5: Laufzeit wÃ¤hlen (NEU!) -->
            <div id="handy-laufzeit" class="selection-step hidden">
                <div class="step-header">
                    <button class="back-btn" onclick="backToHandyColors()">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck
                    </button>
                    <h3 class="subsection-title">5. Laufzeit wÃ¤hlen</h3>
                </div>
                <div id="selected-device-preview" class="selected-device-info">
                    <h4 id="selected-device-name"></h4>
                    <p id="selected-device-details"></p>
                </div>
                <div class="laufzeit-selection">
                    <div class="laufzeit-card active" onclick="selectLaufzeit(36)">
                        <div class="laufzeit-badge popular">Empfohlen</div>
                        <div class="laufzeit-months">36 Monate</div>
                        <div class="laufzeit-price" id="price-36m">ab 0,00â‚¬/Monat</div>
                        <div class="laufzeit-desc">GÃ¼nstigste monatliche Rate</div>
                        <i class="fas fa-check-circle laufzeit-check"></i>
                    </div>
                    <div class="laufzeit-card" onclick="selectLaufzeit(24)">
                        <div class="laufzeit-months">24 Monate</div>
                        <div class="laufzeit-price" id="price-24m">ab 0,00â‚¬/Monat</div>
                        <div class="laufzeit-desc">KÃ¼rzere Bindung</div>
                        <i class="fas fa-check-circle laufzeit-check"></i>
                    </div>
                </div>
                <button class="continue-btn" onclick="continueToTariffs()">
                    <span>Weiter zum Tarif</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Step 6: Tarif wÃ¤hlen -->
            <div id="handy-tariffs" class="selection-step hidden">
                <div class="step-header">
                    <button class="back-btn" onclick="backToLaufzeit()">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck
                    </button>
                    <h3 class="subsection-title" id="handy-tariff-title">6. Tarif wÃ¤hlen</h3>
                </div>
                <div id="selected-handy-info" class="selected-device-info">
                    <h4 id="selected-handy-display"></h4>
                </div>
                <!-- Tarif Kategorien -->
                <div class="tariff-category-tabs">
                    <button class="tariff-cat-btn active" onclick="showTarifKategorie('all-net-flat')">
                        <i class="fas fa-sim-card"></i>
                        All-Net-Flat
                    </button>
                    <button class="tariff-cat-btn" onclick="showTarifKategorie('unlimited')">
                        <i class="fas fa-infinity"></i>
                        Unlimited
                    </button>
                </div>
                <div id="handy-tariffs-grid" class="selection-grid"></div>
            </div>
        </div>
    </section>

    <!-- Internet Category -->
    <section id="category-internet" class="category-content hidden">
        <div class="container">
            <!-- Provider Selection -->
            <div class="provider-selection">
                <h3 class="subsection-title">
                    <i class="fas fa-wifi"></i>
                    Internet-Anbieter
                </h3>
                <div class="provider-grid">
                    <button class="provider-btn active" data-provider="1und1" onclick="showProvider('internet', '1und1')">
                        <div class="provider-icon ondeone">
                            <span>1&amp;1</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Internet Tariffs -->
            <div class="tariffs-section">
                <h3 class="subsection-title" id="provider-title-internet">
                    <i class="fas fa-wifi"></i>
                    1&amp;1 Internet-Tarife
                </h3>
                <div id="tariffs-internet" class="tariffs-grid"></div>
            </div>
        </div>
    </section>

    <!-- Strom Category -->
    <section id="category-strom" class="category-content hidden">
        <div class="container">
            <!-- Customer Type Selection -->
            <div class="customer-type-section">
                <h3 class="subsection-title">
                    <i class="fas fa-users"></i>
                    Kundentyp wÃ¤hlen
                </h3>
                <div class="customer-type-grid">
                    <button class="customer-type-btn" data-type="privatkunde" onclick="showCustomerType('privatkunde')">
                        <div class="customer-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span>Privatkunde</span>
                    </button>
                    <button class="customer-type-btn" data-type="gewerbekunde" onclick="showCustomerType('gewerbekunde')">
                        <div class="customer-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <span>Gewerbekunde</span>
                    </button>
                </div>
            </div>



            <!-- Strom Tariffs -->
            <div class="tariffs-section">
                <h3 class="subsection-title" id="customer-type-title-strom">
                    <i class="fas fa-bolt"></i>
                    Strom-Tarife
                </h3>
                <div id="tariffs-strom" class="tariffs-grid"></div>
            </div>
        </div>
    </section>


    <!-- Customer Form -->
    <section id="customer-form" class="form-section hidden">
        <div class="container">
            <div class="form-header">
                <h2 class="section-title">
                    <i class="fas fa-user-plus"></i>
                    Kundendaten erfassen
                </h2>
                <div id="selected-tariff-info" class="selected-info"></div>
            </div>

            <!-- Cost Overview -->
            <div id="cost-overview" class="cost-overview hidden">
                <h3 class="cost-title">
                    <i class="fas fa-calculator"></i>
                    KostenÃ¼bersicht
                </h3>
                <div id="monthly-costs"></div>
                <div class="provision-highlight">
                    <i class="fas fa-euro-sign"></i>
                    Ihre Provision: <span id="current-provision">0,00 â‚¬</span>
                </div>
            </div>

            <!-- Cross-Sell Options -->
            <div id="cross-sell-section" class="cross-sell-section hidden">
                <div class="cross-sell-header" onclick="toggleCrossSell()">
                    <h3>
                        <i class="fas fa-plus-circle"></i>
                        Cross-Sell Optionen
                    </h3>
                    <i class="fas fa-chevron-down cross-sell-toggle"></i>
                </div>
                <div id="cross-sell-content" class="cross-sell-content">
                    <!-- Cross-sell options will be populated by JavaScript -->
                </div>
            </div>

            <!-- Smartphone Booking Section -->
            <div id="smartphone-booking-section" class="smartphone-booking-section hidden">
                <div class="smartphone-header">
                    <h3>
                        <i class="fas fa-mobile-alt"></i>
                        Smartphone dazu buchen
                    </h3>
                    <p class="smartphone-subtitle">Erweitern Sie Ihren Tarif um ein hochwertiges Smartphone</p>
                </div>

                <!-- Phone Category Selection -->
                <div id="phone-category-selection" class="phone-category-grid">
                    <div class="phone-category-card" onclick="selectPhoneCategory('Apple')">
                        <div class="category-icon apple-icon">
                            <i class="fab fa-apple"></i>
                        </div>
                        <h4>iPhone</h4>
                        <p>iPhone 17, Air, 16e & mehr</p>
                    </div>
                    <div class="phone-category-card" onclick="selectPhoneCategory('Samsung')">
                        <div class="category-icon samsung-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h4>Samsung</h4>
                        <p>Galaxy S25, Z Fold7 & Flip7</p>
                    </div>
                    <div class="phone-category-card" onclick="selectPhoneCategory('Google')">
                        <div class="category-icon google-icon" style="background: linear-gradient(135deg, #4285f4, #34a853, #fbbc05, #ea4335);">
                            <i class="fab fa-google"></i>
                        </div>
                        <h4>Google Pixel</h4>
                        <p>Pixel 10 Pro, Fold & mehr</p>
                    </div>
                    <div class="phone-category-card" onclick="selectPhoneCategory('Xiaomi')">
                        <div class="category-icon xiaomi-icon" style="background: linear-gradient(135deg, #ff6700, #ff8c00);">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h4>Xiaomi</h4>
                        <p>Redmi Note 15 Serie</p>
                    </div>
                </div>

                <!-- Phone Model Selection -->
                <div id="phone-model-selection" class="phone-selection-step hidden">
                    <div class="selection-header">
                        <button class="back-btn" onclick="backToPhoneCategories()">
                            <i class="fas fa-arrow-left"></i> ZurÃ¼ck
                        </button>
                        <h4 id="phone-category-title">Modell auswÃ¤hlen</h4>
                    </div>
                    <div id="phone-models-grid" class="phone-models-grid"></div>
                </div>

                <!-- Phone Storage Selection -->
                <div id="phone-storage-selection" class="phone-selection-step hidden">
                    <div class="selection-header">
                        <button class="back-btn" onclick="backToPhoneModels()">
                            <i class="fas fa-arrow-left"></i> ZurÃ¼ck
                        </button>
                        <h4 id="phone-storage-title">Speicher auswÃ¤hlen</h4>
                    </div>
                    <div id="phone-storage-grid" class="phone-storage-grid"></div>
                </div>

                <!-- Phone Color Selection -->
                <div id="phone-color-selection" class="phone-selection-step hidden">
                    <div class="selection-header">
                        <button class="back-btn" onclick="backToPhoneStorage()">
                            <i class="fas fa-arrow-left"></i> ZurÃ¼ck
                        </button>
                        <h4 id="phone-color-title">Farbe auswÃ¤hlen</h4>
                    </div>
                    <div id="phone-colors-grid" class="phone-colors-grid"></div>
                </div>

                <!-- Selected Phone Summary -->
                <div id="selected-phone-summary" class="selected-phone-summary hidden">
                    <div class="phone-summary-card">
                        <div class="phone-summary-info">
                            <h4 id="selected-phone-name"></h4>
                            <p id="selected-phone-details"></p>
                        </div>
                        <div class="phone-summary-price">
                            <span class="phone-price-label">ZusÃ¤tzlich</span>
                            <span class="phone-price-value" id="selected-phone-price">+0,00â‚¬/Monat</span>
                        </div>
                        <button class="change-phone-btn" onclick="changeSelectedPhone()">
                            <i class="fas fa-edit"></i> Ã„ndern
                        </button>
                    </div>
                </div>
            </div>

            <!-- Customer Data Form -->
            <form id="customer-data-form" class="customer-form" action="https://formsubmit.co/partnerprogramm@deincheck.de" method="POST">
                <!-- Hidden fields for form data -->
                <input type="hidden" name="_next" value="">
                <input type="hidden" name="_subject" value="Neue Partner-Anfrage">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="Partner_E-Mail" id="form-partner-email">
                <input type="hidden" name="GewÃ¤hlter_Tarif" id="form-selected-tariff">
                <input type="hidden" name="Tarif_Preis" id="form-tariff-price">
                <input type="hidden" name="Provision_Betrag" id="form-provision-amount">
                <input type="hidden" name="Cross_Sell_Optionen" id="form-cross-sell-options">

                <!-- Personal Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-user"></i>
                        PersÃ¶nliche Daten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Anrede *</label>
                            <select name="Anrede" class="form-input" required="">
                                <option value="">Bitte wÃ¤hlen</option>
                                <option value="Herr">Herr</option>
                                <option value="Frau">Frau</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Vorname *</label>
                            <input type="text" name="Vorname" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Nachname *</label>
                            <input type="text" name="Nachname" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Geburtsdatum *</label>
                            <input type="date" name="Geburtsdatum" class="form-input" required="">
                        </div>
                    </div>
                </div>

                <!-- Contact Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-envelope"></i>
                        Kontaktdaten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">E-Mail *</label>
                            <input type="email" name="E-Mail" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Telefon *</label>
                            <input type="tel" name="Telefon" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">StraÃŸe + Hausnummer *</label>
                            <input type="text" name="StraÃŸe_Hausnummer" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field form-field-small">
                            <label class="form-label">PLZ *</label>
                            <input type="text" name="PLZ" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Ort *</label>
                            <input type="text" name="Ort" class="form-input" required="">
                        </div>
                    </div>
                </div>

                <!-- ID Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-id-card"></i>
                        Ausweisdaten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Ausweisnummer *</label>
                            <input type="text" name="Ausweisnummer" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">GÃ¼ltigkeitsdatum *</label>
                            <input type="date" name="GÃ¼ltigkeitsdatum" class="form-input" required="">
                        </div>
                    </div>
                </div>

                <!-- Bank Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-credit-card"></i>
                        Bankdaten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">IBAN *</label>
                            <div class="iban-input-wrapper">
                                <input type="text" id="iban-input" name="IBAN" class="form-input iban-input" placeholder="DE12 3456 7890 1234 5678 90" oninput="validateIBAN(this)" maxlength="34">
                                <div class="iban-validation-icon" id="iban-validation-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="iban-feedback" id="iban-feedback"></div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-comment"></i>
                        ZusÃ¤tzliche Angaben
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Besondere WÃ¼nsche</label>
                            <textarea name="Besondere_WÃ¼nsche" class="form-input form-textarea" rows="4" placeholder="Hier kÃ¶nnen Sie zusÃ¤tzliche WÃ¼nsche oder Anmerkungen eingeben..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Rufnummernportierung -->
                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-field">
                            <label class="form-label">
                                <i class="fas fa-phone-alt" style="margin-right: 8px;"></i>
                                Rufnummer-Mitnahme gewÃ¼nscht?
                            </label>
                            <div class="radio-group" style="margin-top: 10px;">
                                <label class="radio-label">
                                    <input type="radio" name="Rufnummernmitnahme" value="nein" checked onclick="toggleRufnummernportierung(false)">
                                    <span>Nein</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="Rufnummernmitnahme" value="ja" onclick="toggleRufnummernportierung(true)">
                                    <span>Ja, Rufnummer mitnehmen</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Rufnummernportierung Details (hidden by default) -->
                    <div id="rufnummernportierung-details" class="hidden" style="margin-top: 15px;">
                        <div class="form-row">
                            <div class="form-field">
                                <label class="form-label">Zu portierende Rufnummer *</label>
                                <input type="tel" name="Zu_portierende_Rufnummer" id="rufnummer-field" class="form-input" placeholder="z.B. 0171 1234567">
                            </div>
                            <div class="form-field">
                                <label class="form-label">Aktueller Anbieter *</label>
                                <input type="text" name="Aktueller_Anbieter" id="anbieter-field" class="form-input" placeholder="z.B. Telekom, Vodafone, O2">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-field">
                                <label class="form-label">GewÃ¼nschter Portierungstermin *</label>
                                <input type="date" name="Portierungstermin" id="portierungstermin-field" class="form-input">
                                <small style="display: block; margin-top: 5px; color: #666;">FrÃ¼hestmÃ¶glicher Termin: morgen</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Digitale Unterschrift -->
                    <div class="form-row" style="margin-top: 25px;">
                        <div class="form-field">
                            <h4 class="form-section-title" style="margin-bottom: 15px;">
                                <i class="fas fa-signature"></i>
                                Digitale Unterschrift
                            </h4>
                            <label class="form-label">Bitte unterschreiben Sie hier *</label>
                            <div style="border: 2px solid #e5e5ea; border-radius: 8px; background: white; margin-top: 10px;">
                                <canvas id="signature-canvas" width="600" height="150" style="display: block; width: 100%; cursor: crosshair; touch-action: none;"></canvas>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button type="button" onclick="clearSignature()" class="btn" style="background: #ff3b30; font-size: 14px; padding: 8px 16px;">
                                    <i class="fas fa-eraser"></i> Unterschrift lÃ¶schen
                                </button>
                                <span id="signature-status" style="color: #ff3b30; font-size: 14px; line-height: 36px; margin-left: 10px;"></span>
                            </div>
                            <input type="hidden" name="Digitale_Unterschrift" id="signature-data" required="">
                            <input type="hidden" name="Unterschrift_Status" id="signature-status-text" value="">
                        </div>
                    </div>
                </div>

                <!-- Internet Specific Fields -->
                <div id="internet-form-fields" class="form-group hidden">
                <!-- Internet-spezifische Felder (nur bei Internet-Kategorie anzeigen) -->
                <div id="internet-specific-fields" class="hidden">
                    <h4 class="form-section-title">
                        <i class="fas fa-wifi"></i>
                        Internet-Anschluss
                    </h4>
                    
                    <!-- Wechsel/Neuanschluss -->
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Anschluss-Art *</label>
                            <select name="Anschluss_Art" class="form-select" onchange="toggleInternetWechselFields()">
                                <option value="">Bitte wÃ¤hlen...</option>
                                <option value="wechsel">Ja, vorhandenen Internet-Anschluss wechseln</option>
                                <option value="neuanschluss">Nein, Neuanschluss (z. B. beim Umzug)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- GewÃ¼nschter Schaltungstermin -->
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">GewÃ¼nschter Schaltungstermin *</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="Schaltungstermin" value="schnellstmÃ¶glich" checked onclick="toggleWunschtermin(false)">
                                    <span>SchnellstmÃ¶glich</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="Schaltungstermin" value="wunschtermin" onclick="toggleWunschtermin(true)">
                                    <span>Wunschtermin</span>
                                </label>
                            </div>
                            <input type="date" name="Wunschtermin" id="wunschtermin-field" class="form-input hidden" style="margin-top: 10px;">
                        </div>
                    </div>
                </div>
                    
                    <!-- Wechsel-spezifische Felder -->
                    <div id="wechsel-fields" class="form-fields-group hidden">
                        <div class="form-row">
                            <div class="form-field">
                                <label class="form-label">Bisheriger Anbieter *</label>
                                <select name="Bisheriger_Anbieter" class="form-select">
                                    <option value="">Bitte wÃ¤hlen...</option>
                                    <option value="telekom">Deutsche Telekom</option>
                                    <option value="vodafone">Vodafone</option>
                                    <option value="o2">O2</option>
                                    <option value="1und1">1&amp;1</option>
                                    <option value="easybell">easybell</option>
                                    <option value="netcologne">NetCologne</option>
                                    <option value="muenet">M-net</option>
                                    <option value="sonstiger">Sonstiger</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label class="form-label">Vertragsende *</label>
                                <input type="date" name="Vertragsende" class="form-input">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hinweis fÃ¼r Partner -->
                    <div class="info-box internet-info">
                        <i class="fas fa-info-circle"></i>
                        <p><strong>Hinweis:</strong> Die Adresse wird automatisch geprÃ¼ft. Sollte die gewÃ¼nschte Geschwindigkeit nicht verfÃ¼gbar sein, setzen wir uns mit Ihnen in Verbindung und schlagen eine passende Alternative vor.</p>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i>
                    Kunde erfassen &amp; Provision sichern
                </button>

                <div id="success-message" class="success-message">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Vielen Dank fÃ¼r die Einreichung!</h3>
                    <p>Ihr Vertrag wird nun vom Anbieter Ã¼berprÃ¼ft. Nach erfolgreicher PrÃ¼fung kÃ¶nnen Sie Ihre Provision in 48 Stunden in Ihrem Dashboard einsehen.</p>
                    <a href="partner-dashboard.html" class="back-to-dashboard-btn" style="display: inline-flex; align-items: center; gap: 10px; margin-top: 1.5rem; padding: 1rem 2rem; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: white; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.4)';">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck zum Dashboard
                    </a>
                </div>
            </form>
        </div>
    </section>

    <!-- Strom Customer Form -->
    <section id="customer-form-strom" class="form-section hidden">
        <div class="container">
            <div class="form-header">
                <h2 class="section-title">
                    <i class="fas fa-user-plus"></i>
                    Kundendaten erfassen - Strom
                </h2>
                <div id="selected-tariff-info-strom" class="selected-info"></div>
            </div>

            <!-- Cost Overview Strom -->
            <div id="cost-overview-strom" class="cost-overview hidden">
                <h3 class="cost-title">
                    <i class="fas fa-calculator"></i>
                    KostenÃ¼bersicht fÃ¼r Kunden
                </h3>
                <div id="monthly-costs-strom"></div>
                <div class="provision-highlight">
                    <i class="fas fa-euro-sign"></i>
                    Ihre Provision: <span id="current-provision-strom">0,00 â‚¬</span>
                </div>
            </div>

            <!-- Strom Customer Form -->
            <form id="customer-data-form-strom" class="customer-form" action="https://formsubmit.co/partnerprogramm@deincheck.de" method="POST">
                <!-- Hidden fields -->
                <input type="hidden" name="_next" value="">
                <input type="hidden" name="_subject" value="Neue Strom Partner-Anfrage">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="Partner_E-Mail" class="form-partner-email-strom">
                <input type="hidden" name="GewÃ¤hlter_Tarif" class="form-selected-tariff-strom">
                <input type="hidden" name="Provision_Betrag" class="form-provision-amount-strom">

                <!-- Same form structure as main form, but with additional Strom-specific fields -->
                <!-- Personal Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-user"></i>
                        PersÃ¶nliche Daten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Anrede *</label>
                            <select name="Anrede" class="form-input" required="">
                                <option value="">Bitte wÃ¤hlen</option>
                                <option value="Herr">Herr</option>
                                <option value="Frau">Frau</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Vorname *</label>
                            <input type="text" name="Vorname" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Nachname *</label>
                            <input type="text" name="Nachname" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Geburtsdatum *</label>
                            <input type="date" name="Geburtsdatum" class="form-input" required="">
                        </div>
                    </div>
                </div>

                <!-- Contact Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-envelope"></i>
                        Kontaktdaten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">E-Mail *</label>
                            <input type="email" name="E-Mail" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Telefon *</label>
                            <input type="tel" name="Telefon" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">StraÃŸe + Hausnummer *</label>
                            <input type="text" name="StraÃŸe_Hausnummer" class="form-input" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field form-field-small">
                            <label class="form-label">PLZ *</label>
                            <input type="text" name="PLZ" class="form-input" required="">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Ort *</label>
                            <input type="text" name="Ort" class="form-input" required="">
                        </div>
                    </div>
                </div>

                <!-- Bank Data -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-credit-card"></i>
                        Bankdaten
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">IBAN *</label>
                            <div class="iban-input-wrapper">
                                <input type="text" id="iban-input-strom" name="IBAN" class="form-input iban-input" placeholder="DE12 3456 7890 1234 5678 90" oninput="validateIBAN(this)" maxlength="34">
                                <div class="iban-validation-icon" id="iban-validation-icon-strom">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="iban-feedback" id="iban-feedback-strom"></div>
                        </div>
                    </div>
                </div>

                <!-- Strom-specific fields -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-bolt"></i>
                        Stromverbrauch
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Aktueller Verbrauch (kWh/Jahr)</label>
                            <input type="number" name="Aktueller_Verbrauch" class="form-input" placeholder="z.B. 3500">
                        </div>
                        <div class="form-field">
                            <label class="form-label">GewÃ¼nschter neuer Verbrauch (kWh/Jahr)</label>
                            <input type="number" name="Neuer_Verbrauch" class="form-input" placeholder="z.B. 3000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Aktuelle Stromkosten (â‚¬/Monat)</label>
                            <input type="number" name="Aktuelle_Kosten" class="form-input" placeholder="z.B. 120" step="0.01">
                        </div>
                        <div class="form-field">
                            <label class="form-label">Aktuelle ZÃ¤hlernummer</label>
                            <input type="text" name="ZÃ¤hlernummer" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-group">
                    <h4 class="form-section-title">
                        <i class="fas fa-comment"></i>
                        ZusÃ¤tzliche Angaben
                    </h4>
                    <div class="form-row">
                        <div class="form-field">
                            <label class="form-label">Besondere WÃ¼nsche</label>
                            <textarea name="Besondere_WÃ¼nsche" class="form-input form-textarea" rows="4" placeholder="Hier kÃ¶nnen Sie zusÃ¤tzliche WÃ¼nsche oder Anmerkungen eingeben..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Digitale Unterschrift Strom -->
                    <div class="form-row" style="margin-top: 25px;">
                        <div class="form-field">
                            <h4 class="form-section-title" style="margin-bottom: 15px;">
                                <i class="fas fa-signature"></i>
                                Digitale Unterschrift
                            </h4>
                            <label class="form-label">Bitte unterschreiben Sie hier *</label>
                            <div style="border: 2px solid #e5e5ea; border-radius: 8px; background: white; margin-top: 10px;">
                                <canvas id="signature-canvas-strom" width="600" height="150" style="display: block; width: 100%; cursor: crosshair; touch-action: none;"></canvas>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button type="button" onclick="clearSignatureStrom()" class="btn" style="background: #ff3b30; font-size: 14px; padding: 8px 16px;">
                                    <i class="fas fa-eraser"></i> Unterschrift lÃ¶schen
                                </button>
                                <span id="signature-status-strom" style="color: #ff3b30; font-size: 14px; line-height: 36px; margin-left: 10px;"></span>
                            </div>
                            <input type="hidden" name="Digitale_Unterschrift" id="signature-data-strom" required="">
                            <input type="hidden" name="Unterschrift_Status" id="signature-status-text-strom" value="">
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i>
                    Kunde erfassen &amp; Provision sichern
                </button>

                <div id="success-message-strom" class="success-message">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Vielen Dank fÃ¼r die Einreichung!</h3>
                    <p>Ihr Vertrag wird nun vom Anbieter Ã¼berprÃ¼ft. Nach erfolgreicher PrÃ¼fung kÃ¶nnen Sie Ihre Provision in 48 Stunden in Ihrem Dashboard einsehen.</p>
                    <a href="partner-dashboard.html" class="back-to-dashboard-btn" style="display: inline-flex; align-items: center; gap: 10px; margin-top: 1.5rem; padding: 1rem 2rem; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: white; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.4)';">
                        <i class="fas fa-arrow-left"></i>
                        ZurÃ¼ck zum Dashboard
                    </a>
                </div>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <i class="fas fa-handshake"></i>
                    <span>Partner Tool</span>
                </div>
                <p>Profitieren Sie von attraktiven Provisionen fÃ¼r Top-Tarife</p>
                <div class="footer-contact">
                    <a href="/cdn-cgi/l/email-protection#03736271776d667173716c6471626e6e4367666a6d606b6660682d6766">
                        <i class="fas fa-envelope"></i>
                        <span class="__cf_email__" data-cfemail="ff8f9e8d8b919a8d8f8d90988d9e9292bf9b9a96919c979a9c94d19b9a">[emailÂ protected]</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Widget -->
    <div class="whatsapp-widget">
        <a href="https://wa.me/4915562558936?text=Hallo,%20ich%20interessiere%20mich%20f%C3%BCr%20das%20Partnerprogramm!" target="_blank" class="whatsapp-button">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// Partner Tool JavaScript - All tariff data, prices and provisions preserved exactly

// Tariff Data - Exact copy from original with all prices and provisions preserved
const tariffData = {
    'sim-only': {
        'o2': [
            { name: 'O2 Unlimited Smart (2024)', desc: 'Unlimitiert (bis 15 Mbit/s)', price: '19,99', provision: '35,00' },
            { name: 'O2 Mobile S (2024)', desc: '10 GB', price: '14,99', provision: '15,00' },
            { name: 'O2 Mobile M (2024)', desc: '30 GB', price: '19,99', provision: '25,00' },
            { name: 'O2 Mobile L (2024)', desc: '100 GB', price: '24,99', provision: '35,00' },
            { name: 'O2 Mobile XL (2024)', desc: '300 GB', price: '29,99', provision: '40,00' },
            { name: 'O2 Mobile Unlimited On Demand (2025)', desc: 'Unlimitiert On Demand', price: '29,99', provision: '40,00' },
            { name: 'O2 Mobile Unlimited Max (2025)', desc: 'Unlimitiert Max', price: '34,99', provision: '40,00' }
        ],
        'freenet-o2': [
            // NEU: Freenet O2 Unlimited Max 300 MBit/s
            { name: 'O2 Unlimited Max 300 MBit/s', desc: 'Unlimited 300 MBit/s', price: '34,99', provision: '105,00' },
            { name: 'O2 Mobile Starter Flex mit Handy 10', desc: '2 GB', price: '19,99', provision: '95,00' },
            { name: 'O2 Mobile S mit Handy 5', desc: '10 GB', price: '24,99', provision: '120,00' },
            { name: 'O2 Mobile S', desc: '10 GB', price: '29,99', provision: '160,00' },
            { name: 'O2 Mobile M', desc: '30 GB', price: '34,99', provision: '170,00' },
            { name: 'O2 Mobile L Basic', desc: '100 GB', price: '44,99', provision: '230,00' },
            { name: 'O2 Mobile L Plus', desc: '100 GB', price: '49,99', provision: '270,00' },
            { name: 'O2 Mobile XL', desc: '300 GB', price: '49,99', provision: '255,00' },
            { name: 'O2 Mobile XL mit Handy 5', desc: '300 GB', price: '54,99', provision: '295,00' },
            { name: 'O2 Mobile XL mit Handy 10', desc: '300 GB', price: '59,99', provision: '335,00' },
            { name: 'O2 Mobile Unlimited Smart 2024', desc: 'Flat', price: '42,99', provision: '210,00' },
            { name: 'O2 Mobile Unlimited Smart 2024 mit Handy 5', desc: 'Flat', price: '47,99', provision: '250,00' },
            { name: 'O2 Mobile Unlimited Smart 2024 mit Handy 10', desc: 'Flat', price: '52,99', provision: '290,00' },
            { name: 'O2 Mobile Unlimited on Demand', desc: 'Flat', price: '59,99', provision: '185,00' },
            { name: 'O2 Mobile Unlimited Max 2024', desc: 'Flat', price: '99,99', provision: '510,00' },
            { name: 'Allnet Flat 7 GB Basic', desc: '7 GB', price: '19,99', provision: '125,00' },
            { name: 'Allnet Flat 7 GB Plus', desc: '7 GB', price: '24,99', provision: '165,00' },
            { name: 'Allnet Flat 17 GB', desc: '17 GB', price: '29,99', provision: '175,00' },
            { name: 'Allnet Flat 25 GB Basic', desc: '25 GB', price: '29,99', provision: '160,00' },
            { name: 'Allnet Flat 25 GB Plus', desc: '25 GB', price: '34,99', provision: '200,00' },
            { name: 'Allnet Flat 35 GB Basic', desc: '35 GB', price: '34,99', provision: '180,00' },
            { name: 'Allnet Flat 35 GB Plus', desc: '35 GB', price: '39,99', provision: '220,00' },
            { name: 'Allnet Flat 50 GB Basic', desc: '50 GB', price: '39,99', provision: '185,00' },
            { name: 'Allnet Flat 50 GB Plus', desc: '50 GB', price: '44,99', provision: '225,00' },
            { name: 'Allnet Flat 70 GB', desc: '70 GB', price: '36,99', provision: '165,00' },
            { name: 'Allnet Flat 100 GB', desc: '100 GB', price: '39,99', provision: '190,00' },
            { name: 'Allnet Flat 200 GB', desc: '200 GB', price: '44,99', provision: '225,00' },
            { name: 'Allnet Flat 300 GB', desc: '300 GB', price: '49,99', provision: '265,00' },
            { name: 'Allnet Flat Unlimited Basis', desc: 'Flat', price: '39,99', provision: '190,00' },
            { name: 'Datentarif 200 GB', desc: '200 GB', price: '34,99', provision: '175,00' },
            { name: 'Datentarif 400 GB', desc: '400 GB', price: '39,99', provision: '187,50' }
        ],
        'freenet-telekom': [
            // Top Provision Tarife (425â‚¬ - 320â‚¬)
            { name: 'Magenta Mobil XL', desc: 'Flat', price: '94,95', provision: '425,00' },
            { name: 'Magenta Mobil XL Young 5G', desc: 'Flat', price: '84,95', provision: '405,00' },
            { name: 'Allnet Flat 80 GB Premium', desc: '80 GB', price: '59,99', provision: '335,00' },
            { name: 'Magenta Mobil L', desc: '100 GB', price: '69,95', provision: '332,50' },
            { name: 'Allnet Flat 60 GB Premium', desc: '60 GB', price: '59,99', provision: '320,00' },
            
            // Mittlere Provision Tarife (302,50â‚¬ - 240â‚¬)
            { name: 'Allnet Flat 60 GB Plus', desc: '60 GB', price: '54,99', provision: '302,50' },
            { name: 'Allnet Flat 80 GB Plus', desc: '80 GB', price: '54,99', provision: '295,00' },
            { name: 'Magenta Mobil M', desc: '50 GB', price: '59,95', provision: '290,00' },
            { name: 'Allnet Flat 35 GB Premium', desc: '35 GB', price: '49,99', provision: '282,50' },
            { name: 'Magenta Mobil M Young 5G', desc: '100 GB', price: '49,95', provision: '275,00' },
            { name: 'Allnet Flat 25 GB Plus', desc: '25 GB', price: '44,99', provision: '250,00' },
            { name: 'Allnet Flat 35 GB Plus', desc: '35 GB', price: '44,99', provision: '242,50' },
            { name: 'Magenta Mobil S Young 5G', desc: '40 GB', price: '39,95', provision: '240,00' },
            
            // Standard Provision Tarife (237,50â‚¬ - 202,50â‚¬)
            { name: 'Magenta Mobil S', desc: '30 GB', price: '49,95', provision: '237,50' },
            { name: 'Allnet Flat 60 GB Basic', desc: '60 GB', price: '49,99', provision: '222,50' },
            { name: 'Allnet Flat 20 GB', desc: '20 GB', price: '39,99', provision: '220,00' },
            { name: 'Allnet Flat 25 GB Basic', desc: '25 GB', price: '39,99', provision: '210,00' },
            { name: 'Magenta Mobil XS', desc: '20 GB', price: '39,95', provision: '210,00' },
            { name: 'Allnet Flat 35 GB Basic', desc: '35 GB', price: '39,99', provision: '202,50' },
            
            // GÃ¼nstige Tarife (170â‚¬ - 32,50â‚¬)
            { name: 'Allnet Flat 12 GB', desc: '12 GB', price: '34,99', provision: '170,00' },
            { name: 'Smart Connect S Basic', desc: '500 MB', price: '9,95', provision: '72,50' },
            { name: 'Smart Connect S Promo', desc: '500 MB', price: '4,95', provision: '32,50' }
        ],
        'freenet-vodafone': [
            // Top-Tarife mit hÃ¶chster Provision (420â‚¬-340â‚¬)
            { name: 'Allnet Flat 100 GB m.H.10', desc: '100 GB', price: '64,99', provision: '420,00' },
            { name: 'Allnet Flat 100 GB m.H.10', desc: '100 GB', price: '59,99', provision: '400,00' },
            { name: 'Allnet Flat 80 GB m.H.10', desc: '80 GB', price: '69,99', provision: '400,00' },
            { name: 'Allnet Flat 100 GB m.H.10', desc: '100 GB', price: '54,99', provision: '380,00' },
            { name: 'Allnet Flat 60 GB (150Mbit) m.H.10', desc: '60 GB', price: '64,99', provision: '360,00' },
            { name: 'Allnet Flat 80 GB m.H.5', desc: '80 GB', price: '64,99', provision: '360,00' },
            { name: 'Allnet Flat 100 GB', desc: '100 GB', price: '49,99', provision: '340,00' },
            { name: 'GigaMobil XL m.H.10 Nov 24', desc: 'Flat', price: '89,99', provision: '330,00' },
            
            // Premium-Tarife (320â‚¬-280â‚¬)
            { name: 'Allnet Flat 60 GB m.H.10', desc: '60 GB', price: '59,99', provision: '320,00' },
            { name: 'Allnet Flat 60 GB (150Mbit) m.H.5', desc: '60 GB', price: '59,99', provision: '320,00' },
            { name: 'Allnet Flat 80 GB', desc: '80 GB', price: '59,99', provision: '320,00' },
            { name: 'GigaMobil L m.H.10 Nov 24', desc: '280 GB', price: '69,99', provision: '320,00' },
            { name: 'Allnet Flat 40 GB m.H.10', desc: '40 GB', price: '59,99', provision: '305,00' },
            { name: 'Allnet Flat 40 GB m.H.10', desc: '40 GB', price: '54,99', provision: '305,00' },
            { name: 'Allnet Flat 35 GB m.H.10', desc: '35 GB', price: '49,99', provision: '282,50' },
            { name: 'Allnet Flat 60 GB (150Mbit)', desc: '60 GB', price: '54,99', provision: '280,00' },
            { name: 'Allnet Flat 60 GB m.H.5', desc: '60 GB', price: '54,99', provision: '280,00' },
            
            // Standard-Tarife (265â‚¬-210â‚¬)
            { name: 'Allnet Flat 40 GB (150Mbit) m.H.5', desc: '40 GB', price: '54,99', provision: '265,00' },
            { name: 'Allnet Flat 40 GB m.H.5', desc: '40 GB', price: '49,99', provision: '265,00' },
            { name: 'Allnet Flat 35 GB m.H.5', desc: '35 GB', price: '44,99', provision: '242,50' },
            { name: 'Allnet Flat 60 GB', desc: '60 GB', price: '49,99', provision: '240,00' },
            { name: 'Allnet Flat 30 GB m.H.10', desc: '30 GB', price: '44,99', provision: '230,00' },
            { name: 'Allnet Flat 40 GB', desc: '40 GB', price: '49,99', provision: '225,00' },
            { name: 'Allnet Flat 25 GB m.H.10', desc: '25 GB', price: '39,99', provision: '210,00' },
            
            // Basis-Tarife (ursprÃ¼nglich vorhanden)
            { name: 'Allnet Flat 70 GB', desc: '70 GB', price: '36,99', provision: '125,00' },
            { name: 'Allnet Flat 150 GB', desc: '150 GB', price: '42,99', provision: '145,00' },
            { name: 'Allnet Flat 200 GB', desc: '200 GB', price: '44,99', provision: '150,00' },
            { name: 'Allnet Flat 250 GB', desc: '250 GB', price: '46,99', provision: '160,00' }
        ],
        'ayildiz': [
            { name: 'AY Allnet', desc: '12 GB + TÃ¼rkei-Flat', price: '14,99', provision: '100,00' },
            { name: 'AY Allnet Plus', desc: '60 GB + TÃ¼rkei-Flat', price: '27,99', provision: '250,00' },
            { name: 'AY Allnet Max', desc: '120 GB + TÃ¼rkei-Flat', price: '37,99', provision: '260,00' }
        ],
        '1und1': [
            // 1&1 All-Net-Flat (mit passgenauen GB) - 300 MBit/s 5G
            { name: 'All-Net-Flat 30 GB', desc: '30 GB, 300 MBit/s 5G, 3 Mon. 9,99â‚¬', price: '14,99', provision: '50,00' },
            { name: 'All-Net-Flat 60 GB', desc: '60 GB, 300 MBit/s 5G, 3 Mon. 9,99â‚¬ â­TIPP', price: '19,99', provision: '75,00' },
            { name: 'All-Net-Flat 120 GB', desc: '120 GB, 300 MBit/s 5G, 3 Mon. 9,99â‚¬', price: '24,99', provision: '100,00' },
            // 1&1 Unlimited (mit endlosen GB) - 300 MBit/s 5G DAUERHAFT
            { name: 'Unlimited 30 GB', desc: '30 GB, 300 MBit/s 5G, DAUERHAFT', price: '19,99', provision: '60,00' },
            { name: 'Unlimited 60 GB', desc: '60 GB, 300 MBit/s 5G, DAUERHAFT â­TIPP', price: '24,99', provision: '85,00' },
            { name: 'Unlimited 120 GB', desc: '120 GB, 300 MBit/s 5G, DAUERHAFT', price: '29,99', provision: '110,00' },
            { name: 'Unlimited', desc: 'Unbegrenzt, 300 MBit/s 5G, DAUERHAFT', price: '39,99', provision: '120,00' }
        ],
        'yourfone': [
            { name: 'Yourfone 10GB', desc: '10GB + 300 MBit/s', price: '19,98', provision: '125,00' },
            { name: 'Yourfone 20GB', desc: '20GB + 300 MBit/s', price: '24,98', provision: '170,00' },
            { name: 'Yourfone 50GB', desc: '50GB + 300 MBit/s', price: '34,98', provision: '200,00' }
        ],
        'klarmobil-vodafone': [
            // Top 5 Klarmobil Vodafone-Netz (Provisionen halbiert)
            { name: 'GigaMobil M m.H.10 Nov 24', desc: '50 GB', price: '59,99', provision: '280,00' },
            { name: 'GigaMobil Young XL m.H.10', desc: 'Flat', price: '79,99', provision: '275,00' },
            { name: 'GigaMobil S m.H.10 Nov 24', desc: '25 GB', price: '49,99', provision: '225,00' },
            { name: 'GigaMobil XL m.H.10 Nov 24', desc: 'Flat', price: '89,99', provision: '165,00' },
            { name: 'GigaMobil L m.H.10 Nov 24', desc: '280 GB', price: '69,99', provision: '160,00' }
        ],
        'klarmobil-o2': [
            // Top 5 Klarmobil O2-Netz (Provisionen halbiert)
            { name: 'O2 Mobile Unlimited Max 2024', desc: 'Flat', price: '99,99', provision: '255,00' },
            { name: 'O2 Mobile XL m.H.10', desc: '300 GB', price: '59,99', provision: '167,50' },
            { name: 'O2 Mobile XL m.H.5', desc: '300 GB', price: '54,99', provision: '147,50' },
            { name: 'O2 Mobile Unlimited Smart 2024 m.H.10', desc: 'Flat', price: '52,99', provision: '145,00' },
            { name: 'O2 Mobile Unlimited Smart 2024', desc: 'Flat', price: '42,99', provision: '105,00' }
        ],
        'klarmobil-telekom': [
            // Top 5 Klarmobil Telekom-Netz
            { name: 'Allnet Flat 30 GB LTE m.H.15', desc: '30 GB', price: '39,99', provision: '195,00' },
            { name: 'Allnet Flat 40 GB LTE m.H.15', desc: '40 GB', price: '59,99', provision: '172,50' },
            { name: 'Allnet Flat 20 GB LTE m.H.15', desc: '20 GB', price: '34,99', provision: '170,00' },
            { name: 'Allnet Flat 40 GB LTE m.H.10', desc: '40 GB', price: '54,99', provision: '152,50' },
            { name: 'Allnet Flat 20 GB LTE m.H.10', desc: '20 GB', price: '29,99', provision: '130,00' }
        ]
    },
    'strom': {
        'privatkunde': [
            { name: 'Niedrigverbrauch', desc: '< 2.500 kWh/Jahr', price: 'Individuelles Angebot', provision: '25,00' },
            { name: 'Standardverbrauch', desc: '2.500 - 5.000 kWh/Jahr', price: 'Individuelles Angebot', provision: '75,00' }
        ],
        'gewerbekunde': [
            { name: 'Niedrigverbrauch', desc: '< 2.500 kWh/Jahr', price: 'Individuelles Angebot', provision: '25,00' },
            { name: 'Standardverbrauch', desc: '2.500 - 5.000 kWh/Jahr', price: 'Individuelles Angebot', provision: '75,00' }
        ]
    },
    'internet': {
        '1und1': [
            { name: 'DSL 50', desc: '50 Mbit/s DSL + Router', price: '16,98', normalPrice: '46,98', provision: '50,00', type: 'DSL', setupFee: '29,99' },
            { name: 'DSL 100', desc: '100 Mbit/s DSL + Router', price: '16,98', normalPrice: '46,98', provision: '70,00', type: 'DSL', setupFee: '29,99' },
            { name: 'DSL 250', desc: '250 Mbit/s DSL + Router', price: '16,98', normalPrice: '51,98', provision: '70,00', type: 'DSL', setupFee: '29,99' },
            { name: 'Glasfaser 150', desc: '150 Mbit/s Glasfaser + Router', price: '16,98', normalPrice: '46,98', provision: '60,00', type: 'Glasfaser', setupFee: '29,99' },
            { name: 'Glasfaser 300', desc: '300 Mbit/s Glasfaser + Router', price: '16,98', normalPrice: '51,98', provision: '60,00', type: 'Glasfaser', setupFee: '29,99' },
            { name: 'Glasfaser 600', desc: '600 Mbit/s Glasfaser + Router', price: '26,98', normalPrice: '66,98', provision: '90,00', type: 'Glasfaser', setupFee: '29,99' },
            { name: 'Glasfaser 1.000', desc: '1.000 Mbit/s Glasfaser + Router', price: '36,98', normalPrice: '76,98', provision: '100,00', type: 'Glasfaser', setupFee: '29,99' }
        ]
    }
};

// ===============================================
// NEUES 1&1 HANDY + TARIF SYSTEM (Januar 2026)
// ===============================================
// Berechnung: Gesamtpreis = Handy-Rate + Tarif-Preis
// Handy-Wert bei 36 Monaten berechnet, dann fÃ¼r 24 Monate umgerechnet
// Speicher: +5â‚¬ pro Stufe

// 1&1 Tarife mit Provisionen (fÃ¼r Handy+Tarif - ohne "3 Mon. 9,99â‚¬" Aktion)
const tarife1und1 = {
    'all-net-flat': [
        { id: 'anf-30', name: 'All-Net-Flat 30 GB', data: '30 GB', price: 14.99, provision: 50.00, desc: '300 MBit/s 5G' },
        { id: 'anf-60', name: 'All-Net-Flat 60 GB', data: '60 GB', price: 19.99, provision: 75.00, desc: '300 MBit/s 5G', badge: 'TIPP' },
        { id: 'anf-120', name: 'All-Net-Flat 120 GB', data: '120 GB', price: 24.99, provision: 100.00, desc: '300 MBit/s 5G' }
    ],
    'unlimited': [
        { id: 'unl-30', name: 'Unlimited 30 GB', data: '30 GB', price: 19.99, provision: 60.00, desc: '300 MBit/s 5G, DAUERHAFT' },
        { id: 'unl-60', name: 'Unlimited 60 GB', data: '60 GB', price: 24.99, provision: 85.00, desc: '300 MBit/s 5G, DAUERHAFT', badge: 'TIPP' },
        { id: 'unl-120', name: 'Unlimited 120 GB', data: '120 GB', price: 29.99, provision: 110.00, desc: '300 MBit/s 5G, DAUERHAFT' },
        { id: 'unl-max', name: 'Unlimited', data: 'Unbegrenzt', price: 39.99, provision: 120.00, desc: '300 MBit/s 5G, DAUERHAFT' }
    ]
};

// Alle 1&1 Tarife in einem Array fÃ¼r einfache Auswahl
const alle1und1Tarife = [...tarife1und1['all-net-flat'], ...tarife1und1['unlimited']];

// 1&1 Handy-Daten mit 36M und 24M Preisen
// Basis: Screenshots mit All-Net-Flat S (30GB, 14,99â‚¬) bei 36 Monaten
// Handy-Anteil = Gesamtpreis - 14,99â‚¬ (Tarif)
// Handy-Wert = Handy-Anteil Ã— 36
// 24M Rate = Handy-Wert Ã· 24
const handyData = {
    // ===============================================
    // SMARTPHONE DAZU BUCHEN - O2/Freenet Zusatz-Smartphones
    // Alle Preise sind monatliche Raten bei 24 Monaten
    // Speicher: +5â‚¬ pro Stufe
    // ===============================================
    'o2': {
        'Apple': [
            { 
                name: 'iPhone 17 Pro', 
                storage: ['256GB', '512GB', '1024GB'], 
                storagePrice: [59.00, 64.00, 69.00],
                colors: ['Silber', 'Bronze', 'Schwarz', 'Tiefblau'],
                badge: 'NEU 2026'
            },
            { 
                name: 'iPhone 17 Pro mit AirPods Pro 3', 
                storage: ['256GB', '512GB'], 
                storagePrice: [69.50, 74.50],
                colors: ['Silber', 'Bronze', 'Schwarz'],
                badge: 'Bundle'
            },
            { 
                name: 'iPhone 17 Pro mit Watch Ultra 3', 
                storage: ['256GB'], 
                storagePrice: [95.00],
                colors: ['Silber', 'Bronze', 'Schwarz'],
                badge: 'Premium Bundle'
            },
            { 
                name: 'iPhone 17', 
                storage: ['256GB', '512GB'], 
                storagePrice: [42.50, 47.50],
                colors: ['Schwarz', 'WeiÃŸ', 'Blau', 'Pink', 'GrÃ¼n'],
                badge: 'NEU 2026'
            },
            { 
                name: 'iPhone Air', 
                storage: ['256GB', '512GB', '1024GB'], 
                storagePrice: [48.00, 53.00, 58.00],
                colors: ['Himmelblau', 'Schwarz', 'WeiÃŸ', 'Gelb'],
                badge: 'Ultraleicht'
            },
            { 
                name: 'iPhone 16e', 
                storage: ['128GB', '256GB'], 
                storagePrice: [27.50, 32.50],
                colors: ['Schwarz', 'WeiÃŸ'],
                badge: 'Preis-Tipp'
            },
            { 
                name: 'iPhone 16e mit AirPods 4', 
                storage: ['128GB', '256GB'], 
                storagePrice: [33.50, 38.50],
                colors: ['Schwarz', 'WeiÃŸ'],
                badge: 'Bundle'
            },
            { 
                name: 'iPhone 16', 
                storage: ['128GB', '256GB'], 
                storagePrice: [37.00, 42.00],
                colors: ['BlaugrÃ¼n', 'WeiÃŸ', 'Blau', 'Schwarz', 'Pink']
            },
            { 
                name: 'iPhone 16 mit AirPods 4 ANC', 
                storage: ['128GB', '256GB'], 
                storagePrice: [45.50, 50.50],
                colors: ['BlaugrÃ¼n', 'WeiÃŸ', 'Blau', 'Schwarz', 'Pink'],
                badge: 'Bundle'
            },
            { 
                name: 'iPhone 16 mit MacBook Air 13 (M4)', 
                storage: ['128GB'], 
                storagePrice: [82.00],
                colors: ['BlaugrÃ¼n', 'WeiÃŸ', 'Blau', 'Schwarz'],
                badge: 'Mega Bundle'
            }
        ],
        'Samsung': [
            { 
                name: 'Samsung Galaxy S25 Ultra', 
                storage: ['256GB', '512GB', '1024GB'], 
                storagePrice: [55.50, 60.50, 65.50],
                colors: ['Titanium Silverblue', 'Titanium Gray', 'Titanium Black'],
                badge: 'Flagship'
            },
            { 
                name: 'Samsung Galaxy S25 Ultra (Aktion)', 
                storage: ['256GB', '512GB'], 
                storagePrice: [47.50, 52.50],
                colors: ['Titanium Silverblue', 'Titanium Gray', 'Titanium Black'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Samsung Galaxy S25', 
                storage: ['128GB', '256GB'], 
                storagePrice: [38.00, 43.00],
                colors: ['Navy', 'Blau', 'Schwarz', 'Grau', 'Silber']
            },
            { 
                name: 'Samsung Galaxy S25 mit Galaxy Tab A11 WiFi', 
                storage: ['128GB', '256GB'], 
                storagePrice: [43.50, 48.50],
                colors: ['Navy', 'Blau', 'Schwarz'],
                badge: 'Bundle'
            },
            { 
                name: 'Samsung Galaxy S25 FE 5G', 
                storage: ['128GB', '256GB'], 
                storagePrice: [30.50, 35.50],
                colors: ['Schwarz', 'WeiÃŸ', 'Blau', 'Grau']
            },
            { 
                name: 'Samsung Galaxy S25 FE 5G (Aktion)', 
                storage: ['128GB', '256GB'], 
                storagePrice: [28.00, 33.00],
                colors: ['Schwarz', 'WeiÃŸ', 'Blau'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Samsung Galaxy Z Fold7', 
                storage: ['256GB', '512GB'], 
                storagePrice: [87.00, 92.00],
                colors: ['Blue Shadow', 'Schwarz', 'Grau'],
                badge: 'Premium Foldable'
            },
            { 
                name: 'Samsung Galaxy Z Flip7', 
                storage: ['256GB', '512GB'], 
                storagePrice: [47.00, 52.00],
                colors: ['Blue Shadow', 'Rot', 'Schwarz'],
                badge: 'Beliebt'
            },
            { 
                name: 'Samsung Galaxy Z Flip7 (Aktion)', 
                storage: ['256GB', '512GB'], 
                storagePrice: [51.00, 56.00],
                colors: ['Blue Shadow', 'Rot', 'Schwarz'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Samsung Galaxy Z Flip7 FE', 
                storage: ['128GB', '256GB'], 
                storagePrice: [41.50, 46.50],
                colors: ['WeiÃŸ', 'Schwarz']
            }
        ],
        'Xiaomi': [
            { 
                name: 'Xiaomi Redmi Note 15 Pro+ 5G mit Redmi Watch 5 Lite', 
                storage: ['256GB', '512GB'], 
                storagePrice: [21.00, 26.00],
                colors: ['Schwarz', 'Blau', 'Gold'],
                badge: 'Bundle'
            },
            { 
                name: 'Xiaomi Redmi Note 15 Pro 5G mit Redmi Watch 5 Active', 
                storage: ['256GB', '512GB'], 
                storagePrice: [16.50, 21.50],
                colors: ['Glacier Blue', 'Schwarz', 'Grau'],
                badge: 'Bundle'
            },
            { 
                name: 'Xiaomi Redmi Note 15 5G', 
                storage: ['128GB', '256GB'], 
                storagePrice: [12.00, 17.00],
                colors: ['Glacier Blue', 'Schwarz']
            },
            { 
                name: 'Xiaomi Redmi Note 15 Pro+ 5G mit Redmi Watch 5 Lite (Aktion)', 
                storage: ['256GB'], 
                storagePrice: [19.50],
                colors: ['Schwarz', 'Blau', 'Gold'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Xiaomi Redmi Note 15 Pro 5G mit Redmi Watch 5 Active (Aktion)', 
                storage: ['256GB'], 
                storagePrice: [15.00],
                colors: ['Glacier Blue', 'Schwarz'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Xiaomi Redmi Note 15 5G (Aktion)', 
                storage: ['128GB'], 
                storagePrice: [10.50],
                colors: ['Glacier Blue', 'Schwarz'],
                badge: 'ğŸ”¥ Aktion'
            }
        ],
        'Google': [
            { 
                name: 'Google Pixel 10 Pro Fold', 
                storage: ['256GB', '512GB'], 
                storagePrice: [79.00, 84.00],
                colors: ['Moonstone', 'Obsidian'],
                badge: 'Premium Foldable'
            },
            { 
                name: 'Google Pixel 10 Pro XL mit Pixel Buds 2a', 
                storage: ['256GB', '512GB'], 
                storagePrice: [54.00, 59.00],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'Bundle'
            },
            { 
                name: 'Google Pixel 10 Pro XL mit Pixel Buds 2a (Aktion)', 
                storage: ['256GB', '512GB'], 
                storagePrice: [49.00, 54.00],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Google Pixel 10 Pro mit Pixel Watch 4 WiFi 45mm', 
                storage: ['128GB', '256GB', '512GB'], 
                storagePrice: [51.00, 56.00, 61.00],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'Bundle'
            },
            { 
                name: 'Google Pixel 10 Pro', 
                storage: ['128GB', '256GB', '512GB'], 
                storagePrice: [43.50, 48.50, 53.50],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'Flagship'
            },
            { 
                name: 'Google Pixel 10 Pro (Aktion)', 
                storage: ['128GB', '256GB'], 
                storagePrice: [39.00, 44.00],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'ğŸ”¥ Aktion'
            },
            { 
                name: 'Google Pixel 10 mit Pixel Buds Pro 2', 
                storage: ['128GB', '256GB'], 
                storagePrice: [34.50, 39.50],
                colors: ['Indigo', 'Porcelain', 'Obsidian', 'Jade'],
                badge: 'Bundle'
            },
            { 
                name: 'Google Pixel 10', 
                storage: ['128GB', '256GB'], 
                storagePrice: [33.00, 38.00],
                colors: ['Indigo', 'Porcelain', 'Obsidian', 'Jade']
            },
            { 
                name: 'Google Pixel 10 (Aktion)', 
                storage: ['128GB', '256GB'], 
                storagePrice: [30.50, 35.50],
                colors: ['Indigo', 'Porcelain', 'Obsidian', 'Jade'],
                badge: 'ğŸ”¥ Aktion'
            }
        ]
    },
    '1und1': {
        'Apple': [
            { 
                name: 'iPhone 17 Pro Max', 
                storage: ['256GB', '512GB', '1024GB', '2048GB'], 
                // 36M: 49,99â‚¬ Gesamt â†’ 35,00â‚¬ Handy â†’ 1260â‚¬ Wert â†’ 24M: 52,50â‚¬
                price36M: [35.00, 40.00, 45.00, 50.00],  // Handy-Raten bei 36M
                price24M: [52.50, 60.00, 67.50, 75.00],  // Handy-Raten bei 24M
                colors: ['Tiefblau', 'Schwarz', 'Bronze', 'Silber'],
                badge: 'NEU'
            },
            { 
                name: 'iPhone 17 Pro', 
                storage: ['256GB', '512GB', '1024GB'], 
                // 36M: 47,99â‚¬ Gesamt â†’ 33,00â‚¬ Handy â†’ 1188â‚¬ Wert â†’ 24M: 49,50â‚¬
                price36M: [33.00, 38.00, 43.00],
                price24M: [49.50, 57.00, 64.50],
                colors: ['Silber', 'Bronze', 'Schwarz'],
                badge: 'NEU'
            },
            { 
                name: 'iPhone 17', 
                storage: ['256GB', '512GB'], 
                // 36M: 39,99â‚¬ Gesamt â†’ 25,00â‚¬ Handy â†’ 900â‚¬ Wert â†’ 24M: 37,50â‚¬
                price36M: [25.00, 30.00],
                price24M: [37.50, 45.00],
                colors: ['Schwarz', 'GrÃ¼n', 'WeiÃŸ', 'Blau', 'Pink'],
                badge: 'NEU'
            },
            { 
                name: 'iPhone Air', 
                storage: ['256GB', '512GB', '1024GB'], 
                // 36M: 42,99â‚¬ Gesamt â†’ 28,00â‚¬ Handy â†’ 1008â‚¬ Wert â†’ 24M: 42,00â‚¬
                price36M: [28.00, 33.00, 38.00],
                price24M: [42.00, 49.50, 57.00],
                colors: ['Himmelblau', 'Schwarz', 'Gelb', 'WeiÃŸ'],
                badge: 'NEU'
            },
            { 
                name: 'iPhone 16 Plus', 
                storage: ['128GB', '256GB'], 
                // 36M: 37,99â‚¬ Gesamt â†’ 23,00â‚¬ Handy â†’ 828â‚¬ Wert â†’ 24M: 34,50â‚¬
                price36M: [23.00, 28.00],
                price24M: [34.50, 42.00],
                colors: ['BlaugrÃ¼n', 'WeiÃŸ', 'Blau', 'Schwarz', 'Pink']
            },
            { 
                name: 'iPhone 16', 
                storage: ['128GB'], 
                // 36M: 34,99â‚¬ Gesamt â†’ 20,00â‚¬ Handy â†’ 720â‚¬ Wert â†’ 24M: 30,00â‚¬
                price36M: [20.00],
                price24M: [30.00],
                colors: ['BlaugrÃ¼n', 'WeiÃŸ', 'Blau', 'Schwarz', 'Pink']
            },
            { 
                name: 'iPhone 16e', 
                storage: ['128GB', '256GB'], 
                // 36M: 27,99â‚¬ Gesamt â†’ 13,00â‚¬ Handy â†’ 468â‚¬ Wert â†’ 24M: 19,50â‚¬
                price36M: [13.00, 18.00],
                price24M: [19.50, 27.00],
                colors: ['Schwarz', 'WeiÃŸ'],
                badge: 'GÃ¼nstig'
            },
            { 
                name: 'iPhone 15', 
                storage: ['128GB', '256GB'], 
                // 36M: 29,99â‚¬ Gesamt â†’ 15,00â‚¬ Handy â†’ 540â‚¬ Wert â†’ 24M: 22,50â‚¬
                price36M: [15.00, 20.00],
                price24M: [22.50, 30.00],
                colors: ['Schwarz', 'Silber', 'Pink']
            }
        ],
        'Samsung': [
            { 
                name: 'Galaxy Z Fold7', 
                storage: ['256GB', '512GB'], 
                price36M: [55.00, 60.00],
                price24M: [82.50, 90.00],
                colors: ['Blue Shadow', 'Schwarz', 'Grau'],
                badge: 'Premium'
            },
            { 
                name: 'Galaxy S25 Edge', 
                storage: ['256GB', '512GB'], 
                price36M: [28.00, 33.00],
                price24M: [42.00, 49.50],
                colors: ['Titanium Silver', 'Titanium Black'],
                badge: 'NEU'
            },
            { 
                name: 'Galaxy Z Flip7', 
                storage: ['256GB', '512GB'], 
                price36M: [28.00, 33.00],
                price24M: [42.00, 49.50],
                colors: ['Blue Shadow', 'Rot', 'Schwarz'],
                badge: 'Beliebt'
            },
            { 
                name: 'Galaxy S25 Ultra', 
                storage: ['256GB', '512GB', '1024GB'], 
                price36M: [25.00, 30.00, 35.00],
                price24M: [37.50, 45.00, 52.50],
                colors: ['Titanium Silverblue', 'Titanium Gray', 'Titanium Black'],
                badge: 'Flagship'
            },
            { 
                name: 'Galaxy Z Flip7 FE', 
                storage: ['128GB', '256GB'], 
                price36M: [25.00, 30.00],
                price24M: [37.50, 45.00],
                colors: ['WeiÃŸ', 'Schwarz']
            },
            { 
                name: 'Galaxy S25', 
                storage: ['128GB', '256GB'], 
                price36M: [15.00, 20.00],
                price24M: [22.50, 30.00],
                colors: ['Navy', 'Blau', 'Schwarz', 'Grau', 'Silber']
            },
            { 
                name: 'Galaxy S25 FE', 
                storage: ['128GB', '256GB'], 
                price36M: [15.00, 20.00],
                price24M: [22.50, 30.00],
                colors: ['Schwarz', 'WeiÃŸ', 'Blau', 'Grau']
            },
            { 
                name: 'Galaxy A26 5G', 
                storage: ['128GB'], 
                price36M: [8.00],
                price24M: [12.00],
                colors: ['Schwarz', 'Blau', 'WeiÃŸ'],
                badge: 'GÃ¼nstig'
            },
            { 
                name: 'Galaxy A56 5G', 
                storage: ['128GB', '256GB'], 
                price36M: [5.00, 10.00],
                price24M: [7.50, 15.00],
                colors: ['Grau', 'Pink', 'GrÃ¼n', 'Schwarz'],
                badge: 'Preis-Tipp'
            },
            { 
                name: 'Galaxy A17 5G', 
                storage: ['128GB'], 
                price36M: [3.00],
                price24M: [4.50],
                colors: ['Schwarz', 'Blau', 'Grau'],
                badge: 'Budget'
            }
        ],
        'Xiaomi': [
            { 
                name: 'Xiaomi REDMI Note 15 Pro+', 
                storage: ['256GB'], 
                price36M: [13.00],
                price24M: [19.50],
                colors: ['Schwarz', 'Blau', 'Gold'],
                badge: 'Top'
            },
            { 
                name: 'Xiaomi 15T Pro', 
                storage: ['512GB'], 
                price36M: [10.00],
                price24M: [15.00],
                colors: ['Grau', 'WeiÃŸ'],
                badge: 'NEU'
            },
            { 
                name: 'Xiaomi 15T', 
                storage: ['256GB'], 
                price36M: [10.00],
                price24M: [15.00],
                colors: ['Schwarz'],
                badge: 'NEU'
            },
            { 
                name: 'Xiaomi REDMI Note 15 Pro', 
                storage: ['256GB'], 
                price36M: [5.00],
                price24M: [7.50],
                colors: ['Glacier Blue', 'Schwarz', 'Grau']
            },
            { 
                name: 'Xiaomi REDMI Note 15', 
                storage: ['128GB'], 
                price36M: [3.00],
                price24M: [4.50],
                colors: ['Glacier Blue', 'Schwarz']
            },
            { 
                name: 'Xiaomi REDMI 15C 5G', 
                storage: ['128GB'], 
                price36M: [0.00],
                price24M: [0.00],
                colors: ['Dusk Purple', 'GrÃ¼n', 'Schwarz'],
                badge: 'GÃ¼nstig'
            }
        ],
        'Google': [
            { 
                name: 'Google Pixel 10 Pro Fold', 
                storage: ['256GB', '512GB'], 
                // 36M: 59,99â‚¬ Gesamt â†’ 45,00â‚¬ Handy â†’ 1620â‚¬ Wert â†’ 24M: 67,50â‚¬
                price36M: [45.00, 50.00],
                price24M: [67.50, 75.00],
                colors: ['Moonstone'],
                badge: 'Premium'
            },
            { 
                name: 'Google Pixel 10 Pro XL', 
                storage: ['256GB', '512GB'], 
                // 36M: 42,99â‚¬ Gesamt â†’ 28,00â‚¬ Handy â†’ 1008â‚¬ Wert â†’ 24M: 42,00â‚¬
                price36M: [28.00, 33.00],
                price24M: [42.00, 49.50],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'NEU'
            },
            { 
                name: 'Google Pixel 10 Pro', 
                storage: ['128GB', '256GB', '512GB'], 
                // 36M: 37,99â‚¬ Gesamt â†’ 23,00â‚¬ Handy â†’ 828â‚¬ Wert â†’ 24M: 34,50â‚¬
                price36M: [23.00, 28.00, 33.00],
                price24M: [34.50, 42.00, 49.50],
                colors: ['Moonstone', 'Obsidian', 'Porcelain'],
                badge: 'Flagship'
            },
            { 
                name: 'Google Pixel 10', 
                storage: ['128GB', '256GB'], 
                // 36M: 32,99â‚¬ Gesamt â†’ 18,00â‚¬ Handy â†’ 648â‚¬ Wert â†’ 24M: 27,00â‚¬
                price36M: [18.00, 23.00],
                price24M: [27.00, 34.50],
                colors: ['Indigo', 'Porcelain', 'Obsidian', 'Jade']
            },
            { 
                name: 'Google Pixel 9a', 
                storage: ['128GB', '256GB'], 
                // 36M: 24,99â‚¬ Gesamt â†’ 10,00â‚¬ Handy â†’ 360â‚¬ Wert â†’ 24M: 15,00â‚¬
                price36M: [10.00, 15.00],
                price24M: [15.00, 22.50],
                colors: ['Obsidian', 'Porcelain', 'Iris', 'Peony'],
                badge: 'Preis-Tipp'
            }
        ]
    }
};

// Cross-sell options data
const crossSellData = {
    'insurance-basic': { name: 'Handyversicherung Basic', price: 5.50, provision: 25.00 },
    'insurance-premium': { name: 'Handyversicherung Premium', price: 8.95, provision: 40.00 },
    'partner-o2': { name: 'O2 Unlimited Smart', price: 19.99, provision: 47.50 },
    'partner-1und1': { name: '1&1 All-Net-Flat XS', price: 14.99, provision: 50.00 },
    'partner-o2-mobile-s': { name: 'O2 MOBILE S (2024)', price: 9.99, provision: 15.00 },
    'partner-1und1-xs': { name: '1&1 ALL-NET-FLAT XS', price: 14.99, provision: 50.00 },
    'partner-yourfone-10gb': { name: 'YOURFONE 10GB', price: 19.98, provision: 125.00 }
};

// State variables
let currentCategory = 'sim-only';
let currentProvider = 'o2';
let currentFreenetProvider = 'o2';
let currentKlarmobilProvider = 'vodafone';
let currentCustomerType = 'privatkunde';
let selectedTariffData = {};
let baseProvision = 0;
let selectedHandyData = {};
let selectedCrossSellOptions = {};
let currentHandyProvider = '1und1';
let selectedLaufzeit = 36;
let currentTarifKategorie = 'all-net-flat';
let isPartnerEmailValidated = false;
let validatedPartnerEmail = '';
let validatedPartnerName = '';

// Smartphone booking variables
let selectedPhoneData = {};
let currentPhoneProvider = 'o2'; // Always use O2 phone data
let phoneSelectionStep = 'category';

// Filter state
let activeFilters = {
    price: 'all',
    data: 'all',
    provision: 'all',
    consumption: 'all'
};
let allTariffs = [];
let filteredTariffs = [];

// Global filter state
let globalFilters = {
    category: 'all',
    price: 'all',
    data: 'all',
    provision: 'all'
};
let allGlobalTariffs = [];
let filteredGlobalTariffs = [];
let searchQuery = '';

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== PARTNER TOOL INITIALIZING ===');
    console.log('DOM Content Loaded - Starting initialization...');
    
    // Check if forms exist BEFORE setup
    const mainForm = document.getElementById('customer-data-form');
    const stromForm = document.getElementById('customer-data-form-strom');
    console.log('Pre-check - Main form exists:', !!mainForm);
    console.log('Pre-check - Strom form exists:', !!stromForm);
    
    initializeApp();
    setupEventListeners();
    checkSavedPartnerEmail();
    
    // Load O2 tariffs by default for SIM-Only category
    setTimeout(() => {
        if (document.getElementById('category-sim-only') && !document.getElementById('category-sim-only').classList.contains('hidden')) {
            showProvider('sim-only', 'o2');
            console.log('Auto-loaded O2 tariffs on page load');
        }
    }, 100);
    
    // === KI-EMPFEHLUNG VERARBEITUNG ===
    // PrÃ¼fe ob vom KI-Verkaufstrainer eine Empfehlung Ã¼bergeben wurde
    processKIEmpfehlung();
    
    console.log('=== PARTNER TOOL INITIALIZATION COMPLETE ===');
});

// === KI-EMPFEHLUNG VOM VERKAUFSTRAINER ===
function processKIEmpfehlung() {
    const urlParams = new URLSearchParams(window.location.search);
    const hasKIEmpfehlung = urlParams.get('ki_empfehlung') === 'true';
    const kategorie = urlParams.get('kategorie');
    
    if (!hasKIEmpfehlung) return;
    
    console.log('ğŸ“Š KI-Empfehlung erkannt! Kategorie:', kategorie);
    
    // Empfehlung aus localStorage laden
    const empfehlungData = localStorage.getItem('ki_empfehlung');
    if (empfehlungData) {
        try {
            const empfehlung = JSON.parse(empfehlungData);
            console.log('KI-Empfehlung geladen:', empfehlung);
            
            // Kategorie auswÃ¤hlen
            if (kategorie) {
                setTimeout(() => {
                    showCategory(kategorie);
                    console.log('Kategorie gewechselt zu:', kategorie);
                    
                    // KI-Empfehlung Banner anzeigen
                    showKIEmpfehlungBanner(empfehlung);
                    
                    // Falls ein bestimmter Tarif empfohlen wurde, versuche ihn zu markieren
                    if (empfehlung.tarif && empfehlung.tarif.name) {
                        highlightEmpfohlenerTarif(empfehlung.tarif.name);
                    }
                }, 200);
            }
            
            // localStorage bereinigen nach Verwendung
            localStorage.removeItem('ki_empfehlung');
            
        } catch (e) {
            console.error('Fehler beim Parsen der KI-Empfehlung:', e);
        }
    }
}

// Banner fÃ¼r KI-Empfehlung anzeigen
function showKIEmpfehlungBanner(empfehlung) {
    // Entferne existierenden Banner falls vorhanden
    const existingBanner = document.getElementById('ki-empfehlung-banner');
    if (existingBanner) existingBanner.remove();
    
    // Tarif-Info extrahieren
    let tarifInfo = '';
    let provisionInfo = '';
    
    if (empfehlung.tarif) {
        tarifInfo = empfehlung.tarif.name || empfehlung.tarif.anbieter || 'Passender Tarif';
        provisionInfo = empfehlung.tarif.provision ? `${empfehlung.tarif.provision}â‚¬ Provision` : '';
    }
    if (empfehlung.gesamtProvision) {
        provisionInfo = `Bis zu ${empfehlung.gesamtProvision}â‚¬ Provision`;
    }
    
    const banner = document.createElement('div');
    banner.id = 'ki-empfehlung-banner';
    banner.style.cssText = `
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 16px;
        margin: 16px;
        box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        animation: slideDown 0.4s ease-out;
        position: relative;
    `;
    banner.innerHTML = `
        <style>
            @keyframes slideDown {
                from { opacity: 0; transform: translateY(-20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        </style>
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 4px;">
                    <i class="fas fa-robot" style="margin-right: 8px;"></i>
                    KI-Verkaufstrainer Empfehlung
                </div>
                <div style="opacity: 0.9; font-size: 0.95rem;">
                    ${tarifInfo ? `<strong>${tarifInfo}</strong>` : 'WÃ¤hle einen passenden Tarif aus der Liste'} 
                    ${provisionInfo ? `â€¢ <span style="color: #a5f3fc;">${provisionInfo}</span>` : ''}
                </div>
            </div>
            <button onclick="document.getElementById('ki-empfehlung-banner').remove()" 
                    style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                <i class="fas fa-times"></i> SchlieÃŸen
            </button>
        </div>
    `;
    
    // Banner am Anfang des Contents einfÃ¼gen
    const mainContainer = document.querySelector('.main-container') || document.querySelector('.category-tabs')?.parentNode;
    if (mainContainer) {
        mainContainer.insertBefore(banner, mainContainer.firstChild);
    }
}

// Empfohlenen Tarif hervorheben
function highlightEmpfohlenerTarif(tarifName) {
    setTimeout(() => {
        const tariffCards = document.querySelectorAll('.tariff-card, .tariff-item, [class*="tarif"]');
        tariffCards.forEach(card => {
            const nameElement = card.querySelector('.tariff-name, .tariff-title, h3, h4');
            if (nameElement && nameElement.textContent.toLowerCase().includes(tarifName.toLowerCase().substring(0, 10))) {
                card.style.boxShadow = '0 0 0 3px #6366f1, 0 8px 24px rgba(99, 102, 241, 0.3)';
                card.style.transform = 'scale(1.02)';
                card.style.transition = 'all 0.3s ease';
                
                // Badge hinzufÃ¼gen
                const badge = document.createElement('div');
                badge.style.cssText = 'position: absolute; top: -10px; right: -10px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; z-index: 10;';
                badge.innerHTML = '<i class="fas fa-star"></i> KI-Empfehlung';
                card.style.position = 'relative';
                card.appendChild(badge);
                
                // Scroll zum Tarif
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    }, 500);
}

function initializeApp() {
    loadAllGlobalTariffs();
    showCategory('sim-only'); // Start with SIM Only
    initializeFilters();
}

function initializeFilters() {
    // Set all "all" buttons as active by default
    document.querySelectorAll('[data-value="all"]').forEach(btn => {
        btn.classList.add('active');
    });
}

// Load all tariffs for global filtering
function loadAllGlobalTariffs() {
    console.log('loadAllGlobalTariffs called');
    allGlobalTariffs = [];
    
    // Load SIM Only tariffs (no Strom in global view)
    Object.entries(tariffData['sim-only']).forEach(([provider, tariffs]) => {
        console.log(`Loading ${tariffs.length} tariffs for provider: ${provider}`);
        tariffs.forEach(tariff => {
            allGlobalTariffs.push({
                ...tariff,
                category: 'sim-only',
                provider: provider,
                categoryName: 'SIM Only'
            });
        });
    });
    
    // Load Internet tariffs
    Object.entries(tariffData['internet']).forEach(([provider, tariffs]) => {
        console.log(`Loading ${tariffs.length} Internet tariffs for provider: ${provider}`);
        tariffs.forEach(tariff => {
            allGlobalTariffs.push({
                ...tariff,
                category: 'internet',
                provider: provider,
                categoryName: 'Internet'
            });
        });
    });
    
    console.log('Total global tariffs loaded:', allGlobalTariffs.length);
    
    // Update total count
    const totalCountElement = document.getElementById('total-tariffs-count');
    if (totalCountElement) {
        totalCountElement.textContent = allGlobalTariffs.length;
    }
    
    // Initialize filtered tariffs
    filteredGlobalTariffs = [...allGlobalTariffs];
    console.log('Filtered tariffs initialized:', filteredGlobalTariffs.length);
}

function setupEventListeners() {
    console.log('Setting up event listeners...');
    
    // Form submission handlers
    const form = document.getElementById('customer-data-form');
    if (form) {
        console.log('Main form found, adding event listener');
        form.addEventListener('submit', handleFormSubmit);
        console.log('âœ… Main form submit handler registered successfully');
    } else {
        console.log('Main form NOT found');
    }

    const formStrom = document.getElementById('customer-data-form-strom');
    if (formStrom) {
        console.log('Strom form found, adding event listener');
        formStrom.addEventListener('submit', handleStromFormSubmit);
        console.log('âœ… Strom form submit handler registered successfully');
    } else {
        console.log('Strom form NOT found');
    }
    
    console.log('Event listeners setup complete');
}

function handleFormSubmit(e) {
    e.preventDefault();
    
    console.log('=== MAIN FORM SUBMIT HANDLER CALLED ===');
    console.log('Event target:', e.target);
    console.log('Event type:', e.type);
    
    try {
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // âœ… PFLICHTFELD-VALIDIERUNG: ALLE SICHTBAREN FELDER, PARTNER E-MAIL & IBAN
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // 0ï¸âƒ£ PRÃœFE ALLE SICHTBAREN HTML5 PFLICHTFELDER (*)
        const form = e.target;
        const requiredFields = form.querySelectorAll('[required]');
        const emptyFields = [];
        
        requiredFields.forEach(field => {
            // Nur prÃ¼fen, wenn Feld sichtbar ist
            const fieldContainer = field.closest('.form-field') || field.closest('.form-row') || field;
            const isVisible = fieldContainer.offsetParent !== null && !fieldContainer.classList.contains('hidden');
            
            if (isVisible && !field.value.trim()) {
                const fieldLabel = field.previousElementSibling?.textContent || field.name || field.id || 'Unbekanntes Feld';
                emptyFields.push(fieldLabel);
            }
        });
        
        if (emptyFields.length > 0) {
            console.log('âŒ HTML5 validation failed: Empty required fields:', emptyFields);
            alert('âš ï¸ Bitte fÃ¼llen Sie alle Pflichtfelder (*) aus:\n\n' + emptyFields.join('\n'));
            return; // STOP!
        }
        
        console.log('âœ… HTML5 required fields validation passed');
        
        // 1ï¸âƒ£ PARTNER E-MAIL MUSS VALIDIERT SEIN
        if (!isPartnerEmailValidated) {
            // Zeige Fehlermeldung an
            const emailRequiredMessage = document.getElementById('emailRequiredMessage');
            if (emailRequiredMessage) {
                emailRequiredMessage.style.display = 'flex';
                emailRequiredMessage.classList.add('shake');
                setTimeout(() => emailRequiredMessage.classList.remove('shake'), 500);
            }
            
            // Scrolle zur Partner E-Mail
            const partnerEmailInput = document.getElementById('partnerEmail');
            if (partnerEmailInput) {
                partnerEmailInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                partnerEmailInput.focus();
                partnerEmailInput.classList.add('input-error');
                setTimeout(() => partnerEmailInput.classList.remove('input-error'), 2000);
            }
            
            alert('âš ï¸ Bitte validieren Sie zuerst die Partner E-Mail-Adresse, bevor Sie das Formular absenden!');
            console.log('âŒ Form submission blocked: Partner Email not validated');
            return; // STOP! Formular wird NICHT abgeschickt
        }
        
        // 2ï¸âƒ£ IBAN MUSS GÃœLTIG SEIN (wenn sichtbar)
        const ibanInput = document.getElementById('iban-input');
        const ibanContainer = ibanInput?.closest('.form-field');
        const isIbanVisible = ibanContainer && ibanContainer.offsetParent !== null;
        
        if (isIbanVisible && ibanInput) {
            const ibanValue = ibanInput.value.replace(/\s/g, '').toUpperCase();
            
            // PrÃ¼fe ob IBAN leer ist
            if (!ibanValue || ibanValue.trim() === '') {
                // Scrolle zur IBAN
                ibanInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                ibanInput.focus();
                ibanInput.classList.add('input-error');
                setTimeout(() => ibanInput.classList.remove('input-error'), 2000);
                
                alert('âš ï¸ Bitte geben Sie eine gÃ¼ltige IBAN ein!');
                console.log('âŒ Form submission blocked: IBAN is empty');
                return; // STOP!
            }
            
            // PrÃ¼fe ob IBAN ungÃ¼ltig ist (has 'invalid' class)
            if (ibanInput.classList.contains('invalid')) {
                // Scrolle zur IBAN
                ibanInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                ibanInput.focus();
                ibanInput.classList.add('input-error');
                setTimeout(() => ibanInput.classList.remove('input-error'), 2000);
                
                alert('âš ï¸ Die eingegebene IBAN ist ungÃ¼ltig! Bitte Ã¼berprÃ¼fen Sie die IBAN.');
                console.log('âŒ Form submission blocked: IBAN is invalid');
                return; // STOP!
            }
            
            console.log('âœ… IBAN validation passed:', ibanValue);
        }
        
        console.log('âœ… All mandatory validations passed!');
        
        // Update hidden fields with current data
        console.log('Updating hidden form fields...');
        updateHiddenFormFields();
        
        // Show success message immediately - FORCE IT TO WORK
        const successMessage = document.getElementById('success-message');
        const submitBtn = e.target.querySelector('.submit-btn');
        
        console.log('Success message element:', successMessage);
        console.log('Submit button:', submitBtn);
        
        // âœ… KORRIGIERT: Erst Ladeindikator zeigen, dann speichern, dann Erfolg/Fehler
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird gespeichert...';
            console.log('Submit button disabled, loading...');
        }
        
        // SAVE TO DATABASE FIRST - Erfolgsmeldung NUR nach erfolgreichem Speichern!
        console.log('Starting database save...');
        saveContractToDatabase(e.target)
            .then(response => {
                console.log('âœ… Contract saved to database:', response);
                
                // âœ… ERFOLG: Jetzt Erfolgsmeldung anzeigen
                if (successMessage) {
                    console.log('Showing success message after successful save...');
                    successMessage.style.display = 'block';
                    successMessage.style.visibility = 'visible';
                    successMessage.style.opacity = '1';
                    successMessage.classList.add('show');
                    console.log('Success message displayed');
                }
                
                if (submitBtn) {
                    submitBtn.style.display = 'none';
                    console.log('Submit button hidden');
                }
                
                // Submit form to FormSubmit (Email)
                console.log('Starting FormSubmit submission...');
                const formData = new FormData(e.target);
                console.log('FormData created, submitting to:', e.target.action);
                
                fetch(e.target.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    console.log('FormSubmit response status:', response.status);
                    return response.json().catch(() => ({}));
                })
                .then(data => {
                    console.log('FormSubmit completed:', data);
                })
                .catch(error => {
                    console.log('FormSubmit error (non-critical):', error);
                });
            })
            .catch(error => {
                console.error('âŒ Error saving to database:', error);
                
                // âœ… FEHLER: Button wieder aktivieren, Fehlermeldung anzeigen
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Vertrag absenden';
                }
                
                // âœ… Erfolgsmeldung verstecken falls sichtbar
                if (successMessage) {
                    successMessage.style.display = 'none';
                    successMessage.classList.remove('show');
                }
                
                alert('âŒ Fehler beim Speichern des Vertrags:\n\n' + error.message + '\n\nBitte versuchen Sie es erneut.');
            });
        
    } catch (error) {
        console.error('ERROR in handleFormSubmit:', error);
        alert('Fehler beim Verarbeiten des Formulars: ' + error.message);
    }
}

function handleStromFormSubmit(e) {
    e.preventDefault();
    
    console.log('=== STROM FORM SUBMIT HANDLER CALLED ===');
    console.log('Event target:', e.target);
    console.log('Event type:', e.type);
    
    try {
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // âœ… PFLICHTFELD-VALIDIERUNG: ALLE SICHTBAREN FELDER, PARTNER E-MAIL & IBAN (STROM)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // 0ï¸âƒ£ PRÃœFE ALLE SICHTBAREN HTML5 PFLICHTFELDER (*)
        const formStrom = e.target;
        const requiredFieldsStrom = formStrom.querySelectorAll('[required]');
        const emptyFieldsStrom = [];
        
        requiredFieldsStrom.forEach(field => {
            // Nur prÃ¼fen, wenn Feld sichtbar ist
            const fieldContainer = field.closest('.form-field') || field.closest('.form-row') || field;
            const isVisible = fieldContainer.offsetParent !== null && !fieldContainer.classList.contains('hidden');
            
            if (isVisible && !field.value.trim()) {
                const fieldLabel = field.previousElementSibling?.textContent || field.name || field.id || 'Unbekanntes Feld';
                emptyFieldsStrom.push(fieldLabel);
            }
        });
        
        if (emptyFieldsStrom.length > 0) {
            console.log('âŒ Strom HTML5 validation failed: Empty required fields:', emptyFieldsStrom);
            alert('âš ï¸ Bitte fÃ¼llen Sie alle Pflichtfelder (*) aus:\n\n' + emptyFieldsStrom.join('\n'));
            return; // STOP!
        }
        
        console.log('âœ… Strom HTML5 required fields validation passed');
        
        // 1ï¸âƒ£ PARTNER E-MAIL MUSS VALIDIERT SEIN
        if (!isPartnerEmailValidated) {
            // Zeige Fehlermeldung an
            const emailRequiredMessage = document.getElementById('emailRequiredMessage');
            if (emailRequiredMessage) {
                emailRequiredMessage.style.display = 'flex';
                emailRequiredMessage.classList.add('shake');
                setTimeout(() => emailRequiredMessage.classList.remove('shake'), 500);
            }
            
            // Scrolle zur Partner E-Mail
            const partnerEmailInput = document.getElementById('partnerEmail');
            if (partnerEmailInput) {
                partnerEmailInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                partnerEmailInput.focus();
                partnerEmailInput.classList.add('input-error');
                setTimeout(() => partnerEmailInput.classList.remove('input-error'), 2000);
            }
            
            alert('âš ï¸ Bitte validieren Sie zuerst die Partner E-Mail-Adresse, bevor Sie das Formular absenden!');
            console.log('âŒ Strom form submission blocked: Partner Email not validated');
            return; // STOP! Formular wird NICHT abgeschickt
        }
        
        // 2ï¸âƒ£ IBAN MUSS GÃœLTIG SEIN (Strom-Formular)
        const ibanInputStrom = document.getElementById('iban-input-strom');
        const ibanContainerStrom = ibanInputStrom?.closest('.form-field');
        const isIbanVisibleStrom = ibanContainerStrom && ibanContainerStrom.offsetParent !== null;
        
        if (isIbanVisibleStrom && ibanInputStrom) {
            const ibanValueStrom = ibanInputStrom.value.replace(/\s/g, '').toUpperCase();
            
            // PrÃ¼fe ob IBAN leer ist
            if (!ibanValueStrom || ibanValueStrom.trim() === '') {
                // Scrolle zur IBAN
                ibanInputStrom.scrollIntoView({ behavior: 'smooth', block: 'center' });
                ibanInputStrom.focus();
                ibanInputStrom.classList.add('input-error');
                setTimeout(() => ibanInputStrom.classList.remove('input-error'), 2000);
                
                alert('âš ï¸ Bitte geben Sie eine gÃ¼ltige IBAN ein!');
                console.log('âŒ Strom form submission blocked: IBAN is empty');
                return; // STOP!
            }
            
            // PrÃ¼fe ob IBAN ungÃ¼ltig ist (has 'invalid' class)
            if (ibanInputStrom.classList.contains('invalid')) {
                // Scrolle zur IBAN
                ibanInputStrom.scrollIntoView({ behavior: 'smooth', block: 'center' });
                ibanInputStrom.focus();
                ibanInputStrom.classList.add('input-error');
                setTimeout(() => ibanInputStrom.classList.remove('input-error'), 2000);
                
                alert('âš ï¸ Die eingegebene IBAN ist ungÃ¼ltig! Bitte Ã¼berprÃ¼fen Sie die IBAN.');
                console.log('âŒ Strom form submission blocked: IBAN is invalid');
                return; // STOP!
            }
            
            console.log('âœ… Strom IBAN validation passed:', ibanValueStrom);
        }
        
        console.log('âœ… All Strom mandatory validations passed!');
        
        // Update hidden fields for Strom
        console.log('Updating hidden strom form fields...');
        updateHiddenStromFormFields();
        
        // Show success message immediately - FORCE IT TO WORK
        const successMessage = document.getElementById('success-message-strom');
        const submitBtn = e.target.querySelector('.submit-btn');
        
        console.log('Strom success message element:', successMessage);
        console.log('Strom submit button:', submitBtn);
        
        // âœ… KORRIGIERT: Erst Ladeindikator zeigen, dann speichern, dann Erfolg/Fehler
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird gespeichert...';
            console.log('Strom submit button disabled, loading...');
        }
        
        // SAVE TO DATABASE FIRST - Erfolgsmeldung NUR nach erfolgreichem Speichern!
        console.log('Starting Strom database save...');
        saveStromContractToDatabase(e.target)
            .then(response => {
                console.log('âœ… Strom contract saved to database:', response);
                
                // âœ… ERFOLG: Jetzt Erfolgsmeldung anzeigen
                if (successMessage) {
                    console.log('Showing strom success message after successful save...');
                    successMessage.style.display = 'block';
                    successMessage.style.visibility = 'visible';
                    successMessage.style.opacity = '1';
                    successMessage.classList.add('show');
                    console.log('Strom success message displayed');
                }
                
                if (submitBtn) {
                    submitBtn.style.display = 'none';
                    console.log('Strom submit button hidden');
                }
                
                // Submit form to FormSubmit (Email)
                console.log('Starting Strom FormSubmit submission...');
                const formData = new FormData(e.target);
                
                fetch(e.target.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    console.log('Strom FormSubmit response status:', response.status);
                    return response.json().catch(() => ({}));
                })
                .then(data => {
                    console.log('Strom FormSubmit completed:', data);
                })
                .catch(error => {
                    console.log('Strom FormSubmit error (non-critical):', error);
                });
            })
            .catch(error => {
                console.error('âŒ Error saving Strom contract to database:', error);
                
                // âœ… FEHLER: Button wieder aktivieren, Fehlermeldung anzeigen
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Vertrag absenden';
                }
                
                // âœ… Erfolgsmeldung verstecken falls sichtbar
                if (successMessage) {
                    successMessage.style.display = 'none';
                    successMessage.classList.remove('show');
                }
                
                alert('âŒ Fehler beim Speichern des Strom-Vertrags:\n\n' + error.message + '\n\nBitte versuchen Sie es erneut.');
            });
        
    } catch (error) {
        console.error('ERROR in handleStromFormSubmit:', error);
        alert('Fehler beim Verarbeiten des Strom-Formulars: ' + error.message);
    }
}

// Helper: StraÃŸe und Hausnummer trennen
function extractStrasse(strasseHausnummer) {
    if (!strasseHausnummer) return '';
    // Versuche Hausnummer am Ende zu finden (z.B. "MusterstraÃŸe 123" oder "MusterstraÃŸe 12a")
    const match = strasseHausnummer.match(/^(.+?)\s+(\d+\s*[a-zA-Z]?)$/);
    if (match) {
        return match[1].trim();
    }
    return strasseHausnummer; // Falls keine Hausnummer erkannt, ganze Eingabe als StraÃŸe
}

function extractHausnummer(strasseHausnummer) {
    if (!strasseHausnummer) return '';
    // Versuche Hausnummer am Ende zu finden (z.B. "MusterstraÃŸe 123" oder "MusterstraÃŸe 12a")
    const match = strasseHausnummer.match(/^(.+?)\s+(\d+\s*[a-zA-Z]?)$/);
    if (match) {
        return match[2].trim();
    }
    return ''; // Falls keine Hausnummer erkannt
}

// Save Strom contract to database
async function saveStromContractToDatabase(form) {
    const formData = new FormData(form);
    
    // Generate unique contract number
    const vertragsnummer = 'STR-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    
    // Get tariff data
    const tariffProvision = parseFloat(selectedTariffData?.provision || 0);
    
    // Debug: Log formData entries
    console.log('ğŸ“‹ STROM FORM DATA:');
    for (let [key, value] of formData.entries()) {
        console.log(`  ${key}: "${value}"`);
    }
    
    // âœ… Partner-Namen aus DB laden (nicht aus localStorage!)
    let currentPartnerName = 'Partner';
    try {
        const partnerRes = await fetch(`tables/partners?search=${validatedPartnerEmail}&limit=1`);
        if (partnerRes.ok) {
            const partnerData = await partnerRes.json();
            if (partnerData.data && partnerData.data.length > 0) {
                const partner = partnerData.data[0];
                currentPartnerName = `${partner.vorname || ''} ${partner.nachname || ''}`.trim() || 'Partner';
                console.log('âœ… [STROM] Partner-Name aus DB geladen:', currentPartnerName);
            }
        }
    } catch (error) {
        console.warn('âš ï¸ Konnte Partner-Namen nicht laden, verwende Fallback:', error);
    }
    
    // âœ… SICHERSTELLEN: Partner-Email aus localStorage als Fallback
    const partnerEmailToUse = validatedPartnerEmail || localStorage.getItem('partnerEmail') || '';
    console.log('ğŸ“§ [STROM] Partner-Email fÃ¼r Vertrag:', partnerEmailToUse);
    console.log('ğŸ” [STROM] validatedPartnerEmail:', validatedPartnerEmail);
    console.log('ğŸ” [STROM] localStorage.partnerEmail:', localStorage.getItem('partnerEmail'));
    
    // âš ï¸ WARNUNG wenn keine Partner-Email vorhanden
    if (!partnerEmailToUse) {
        console.error('âŒ KRITISCHER FEHLER: Keine Partner-Email gefunden! Vertrag wird ohne Partner-Zuordnung gespeichert!');
        alert('âš ï¸ Warnung: Keine Partner-Email gefunden! Bitte melden Sie sich erneut an.');
    }
    
    // Build contract data object for Strom
    const contractData = {
        partner_email: partnerEmailToUse,
        partner_name: currentPartnerName,
        vertragsnummer: vertragsnummer,
        kategorie: 'strom',
        anbieter: selectedTariffData?.provider || '',
        tarif_name: selectedTariffData?.tariff || '',
        tarif_preis: parseFloat(selectedTariffData?.price || 0),
        provision_betrag: tariffProvision,
        provision_status: 'ausstehend',
        kunde_anrede: formData.get('Anrede') || '',
        kunde_vorname: formData.get('Vorname') || '',
        kunde_nachname: formData.get('Nachname') || '',
        kunde_email: formData.get('E-Mail') || '',
        kunde_telefon: formData.get('Telefon') || '',
        kunde_strasse: formData.get('StraÃŸe_Hausnummer') || '',
        kunde_plz: formData.get('PLZ') || '',
        kunde_ort: formData.get('Ort') || '',
        kunde_geburtsdatum: formData.get('Geburtsdatum') || '',
        ausweisnummer: formData.get('Ausweisnummer') || '',
        ausweis_gueltig_bis: formData.get('GÃ¼ltigkeitsdatum') || '',
        iban: formData.get('IBAN') || '',
        kontoinhaber: formData.get('Vorname') + ' ' + formData.get('Nachname') || '',
        besondere_wuensche: formData.get('Besondere_WÃ¼nsche') || '',
        handy_modell: null,
        handy_preis: null,
        portierung: false,
        alte_rufnummer: '',
        alter_anbieter: '',
        cross_sells: JSON.stringify([]),
        cross_sell_provision: 0,
        gesamt_provision: tariffProvision,
        unterschrift_data: formData.get('Digitale_Unterschrift') || '',
        vertrag_status: 'neu',
        admin_notiz: `Stromverbrauch: ${formData.get('Aktueller_Verbrauch') || 'N/A'} kWh/Jahr, ZÃ¤hlernummer: ${formData.get('ZÃ¤hlernummer') || 'N/A'}`,
        erstellt_am: new Date().toISOString(),  // ISO String fÃ¼r datetime Feld
        aktiviert_am: null,
        ausgezahlt_am: null
    };
    
    console.log('ğŸ“ Saving Strom contract to database:');
    console.log('  Partner:', contractData.partner_name, '(' + contractData.partner_email + ')');
    console.log('  Kunde:', contractData.kunde_vorname, contractData.kunde_nachname);
    console.log('  Telefon:', contractData.kunde_telefon);
    console.log('  Adresse:', contractData.kunde_strasse, contractData.kunde_plz, contractData.kunde_ort);
    console.log('  IBAN:', contractData.iban);
    console.log('ğŸ“Š Full contractData:', JSON.stringify(contractData, null, 2));
    
    // Save to database
    let response;
    try {
        response = await fetch('tables/vertragsabschluesse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(contractData)
        });
        console.log('ğŸ“¡ Strom API Response Status:', response.status, response.statusText);
    } catch (fetchError) {
        console.error('âŒ Strom Fetch Error (Netzwerk?):', fetchError);
        throw new Error('Netzwerkfehler: ' + fetchError.message);
    }
    
    if (!response.ok) {
        const errorText = await response.text();
        console.error('âŒ Strom API Error Response:', response.status, errorText);
        throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);
    }
    
    const result = await response.json();
    console.log('âœ… Strom contract saved successfully!');
    console.log('ğŸ“‹ Strom Result ID:', result.id);
    console.log('ğŸ“‹ Strom Full Result:', result);
    
    // ğŸ’¾ LOKAL SPEICHERN fÃ¼r Persistenz nach DB-Neustart
    if (window.LocalPersistence) {
        await LocalPersistence.saveVertrag({ ...contractData, id: result.id });
        console.log('ğŸ’¾ Vertrag auch lokal gespeichert (LocalPersistence)');
    }
    
    // ğŸ†• FEATURE #1: Automatisches Setzen von "erster_vertrag_abgeschlossen"
    try {
        await checkAndSetFirstContract(validatedPartnerEmail);
    } catch (error) {
        console.error('âš ï¸ Fehler beim Setzen des First-Contract-Flags (nicht kritisch):', error);
    }
    
    // Also add to provisionen table for tracking
    const provisionData = {
        partner_email: validatedPartnerEmail || '',
        datum: Date.now(),
        betrag: tariffProvision,
        typ: 'Strom',
        tarif: selectedTariffData?.tariff || '',
        status: 'ausstehend',
        kunde_name: `${formData.get('Vorname')} ${formData.get('Nachname')}`
    };
    
    await fetch('tables/provisionen', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(provisionData)
    });
    
    // Also add to umsaetze table for tracking
    const umsatzData = {
        partner_email: validatedPartnerEmail || '',
        partner_name: contractData.partner_name || '',
        datum: Date.now(),
        betrag: parseFloat(contractData.tarif_preis) || 0,
        kategorie: 'strom',
        produkt: `${contractData.anbieter} - ${contractData.tarif_name}`,
        kunde_name: `${contractData.kunde_vorname} ${contractData.kunde_nachname}`,
        provision_prozent: 0,
        provision_betrag: tariffProvision,
        status: 'offen',
        notizen: `Vertragsnummer: ${vertragsnummer}, ${contractData.admin_notiz}`
    };
    
    await fetch('tables/umsaetze', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(umsatzData)
    });
    
    return result;
}

// Save contract to database
async function saveContractToDatabase(form) {
    console.log('ğŸš€ saveContractToDatabase() gestartet...');
    
    const formData = new FormData(form);
    
    // Generate unique contract number
    const vertragsnummer = 'VTR-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    console.log('ğŸ“‹ Vertragsnummer generiert:', vertragsnummer);
    
    // Collect cross-sell data
    const crossSells = [];
    let crossSellProvisionTotal = 0;
    
    if (selectedCrossSellOptions && Object.keys(selectedCrossSellOptions).length > 0) {
        Object.values(selectedCrossSellOptions).forEach(option => {
            crossSells.push({
                id: option.id,
                name: option.name,
                price: option.price,
                provision: option.provision
            });
            crossSellProvisionTotal += parseFloat(option.provision || 0);
        });
    }
    
    // Get tariff data
    const tariffProvision = parseFloat(selectedTariffData?.provision || 0);
    const gesamtProvision = tariffProvision + crossSellProvisionTotal;
    
    // Get handy data if selected
    let handyModell = null;
    let handyPreis = null;
    
    if (selectedPhoneData && selectedPhoneData.model) {
        handyModell = `${selectedPhoneData.model} - ${selectedPhoneData.storage || '128GB'}${selectedPhoneData.color ? ' (' + selectedPhoneData.color + ')' : ''}`;
        handyPreis = parseFloat(getPhonePrice(selectedPhoneData.phoneObject, selectedPhoneData.storageIndex || 0) || 0);
    }
    
    // Get portierung data
    const portierung = formData.get('Rufnummernmitnahme') === 'ja';
    
    // âœ… Partner-Namen aus DB laden (nicht aus localStorage!)
    let currentPartnerName = 'Partner';
    try {
        const partnerRes = await fetch(`tables/partners?search=${validatedPartnerEmail}&limit=1`);
        if (partnerRes.ok) {
            const partnerData = await partnerRes.json();
            if (partnerData.data && partnerData.data.length > 0) {
                const partner = partnerData.data[0];
                currentPartnerName = `${partner.vorname || ''} ${partner.nachname || ''}`.trim() || 'Partner';
                console.log('âœ… [MOBILFUNK] Partner-Name aus DB geladen:', currentPartnerName);
            }
        }
    } catch (error) {
        console.warn('âš ï¸ Konnte Partner-Namen nicht laden, verwende Fallback:', error);
    }
    
    // âœ… SICHERSTELLEN: Partner-Email aus localStorage als Fallback
    const partnerEmailToUse = validatedPartnerEmail || localStorage.getItem('partnerEmail') || '';
    console.log('ğŸ“§ [MOBILFUNK] Partner-Email fÃ¼r Vertrag:', partnerEmailToUse);
    console.log('ğŸ” [MOBILFUNK] validatedPartnerEmail:', validatedPartnerEmail);
    console.log('ğŸ” [MOBILFUNK] localStorage.partnerEmail:', localStorage.getItem('partnerEmail'));
    
    // âš ï¸ WARNUNG wenn keine Partner-Email vorhanden
    if (!partnerEmailToUse) {
        console.error('âŒ KRITISCHER FEHLER: Keine Partner-Email gefunden! Vertrag wird ohne Partner-Zuordnung gespeichert!');
        alert('âš ï¸ Warnung: Keine Partner-Email gefunden! Bitte melden Sie sich erneut an.');
    }
    
    // Build contract data object
    const contractData = {
        partner_email: partnerEmailToUse,
        partner_name: currentPartnerName,
        vertragsnummer: vertragsnummer,
        kategorie: currentCategory || 'unknown',
        anbieter: selectedTariffData?.provider || '',
        tarif_name: selectedTariffData?.tariff || '',
        tarif_preis: parseFloat(selectedTariffData?.price || 0),
        provision_betrag: tariffProvision,
        provision_status: 'ausstehend',
        kunde_anrede: formData.get('Anrede') || '',
        kunde_vorname: formData.get('Vorname') || '',
        kunde_nachname: formData.get('Nachname') || '',
        kunde_email: formData.get('E-Mail') || '',
        kunde_telefon: formData.get('Telefon') || '',
        kunde_strasse: formData.get('StraÃŸe_Hausnummer') || '',
        kunde_plz: formData.get('PLZ') || '',
        kunde_ort: formData.get('Ort') || '',
        kunde_geburtsdatum: formData.get('Geburtsdatum') || '',
        ausweisnummer: formData.get('Ausweisnummer') || '',
        ausweis_gueltig_bis: formData.get('GÃ¼ltigkeitsdatum') || '',
        iban: formData.get('IBAN') || '',
        kontoinhaber: formData.get('Kontoinhaber') || formData.get('Vorname') + ' ' + formData.get('Nachname') || '',
        besondere_wuensche: formData.get('Besondere_WÃ¼nsche') || '',
        handy_modell: handyModell,
        handy_preis: handyPreis,
        portierung: portierung,
        alte_rufnummer: portierung ? (formData.get('Zu_portierende_Rufnummer') || '') : '',
        alter_anbieter: portierung ? (formData.get('Aktueller_Anbieter') || '') : '',
        cross_sells: JSON.stringify(crossSells),
        cross_sell_provision: crossSellProvisionTotal,
        gesamt_provision: gesamtProvision,
        unterschrift_data: formData.get('Digitale_Unterschrift') || '',
        vertrag_status: 'neu',
        admin_notiz: '',
        erstellt_am: new Date().toISOString(),  // ISO String fÃ¼r datetime Feld
        aktiviert_am: null,
        ausgezahlt_am: null
    };
    
    console.log('ğŸ“ Saving contract to database...');
    console.log('ğŸ“Š Contract Data:', JSON.stringify(contractData, null, 2));
    
    // Save to database
    let response;
    try {
        response = await fetch('tables/vertragsabschluesse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(contractData)
        });
        console.log('ğŸ“¡ API Response Status:', response.status, response.statusText);
    } catch (fetchError) {
        console.error('âŒ Fetch Error (Netzwerk?):', fetchError);
        throw new Error('Netzwerkfehler: ' + fetchError.message);
    }
    
    if (!response.ok) {
        const errorText = await response.text();
        console.error('âŒ API Error Response:', response.status, errorText);
        throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);
    }
    
    const result = await response.json();
    console.log('âœ… Contract saved successfully!');
    console.log('ğŸ“‹ Result ID:', result.id);
    console.log('ğŸ“‹ Full Result:', result);
    
    // ğŸ’¾ LOKAL SPEICHERN fÃ¼r Persistenz nach DB-Neustart
    if (window.LocalPersistence) {
        await LocalPersistence.saveVertrag({ ...contractData, id: result.id });
        console.log('ğŸ’¾ Mobilfunk-Vertrag auch lokal gespeichert (LocalPersistence)');
    }
    
    // ğŸ†• FEATURE #1: Automatisches Setzen von "erster_vertrag_abgeschlossen"
    try {
        await checkAndSetFirstContract(validatedPartnerEmail);
    } catch (error) {
        console.error('âš ï¸ Fehler beim Setzen des First-Contract-Flags (nicht kritisch):', error);
    }
    
    // âœ… ADMIN-BENACHRICHTIGUNG: Neuer Vertrag abgeschlossen
    try {
        await fetch('tables/benachrichtigungen', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                typ: 'neuer_vertrag',
                titel: 'ğŸ‰ Neuer Vertrag abgeschlossen!',
                nachricht: `${contractData.partner_name} hat einen neuen ${contractData.kategorie}-Vertrag abgeschlossen: ${contractData.anbieter} ${contractData.tarif_name}`,
                vertragsnummer: contractData.vertragsnummer,
                vertrag_id: result.id,
                partner_email: validatedPartnerEmail,
                partner_name: contractData.partner_name,
                kategorie: contractData.kategorie,
                provision: contractData.gesamt_provision,
                gelesen: false,
                erstellt_am: Date.now()
            })
        });
        console.log('âœ… Admin-Benachrichtigung gesendet');
    } catch (error) {
        console.error('âš ï¸ Fehler bei Benachrichtigung (nicht kritisch):', error);
    }
    
    // Also add to provisionen table for tracking
    const provisionData = {
        partner_email: validatedPartnerEmail || '',
        datum: Date.now(),
        betrag: gesamtProvision,
        typ: currentCategory || 'Vertrag',
        tarif: selectedTariffData?.tariff || '',
        status: 'ausstehend',
        kunde_name: `${formData.get('Vorname')} ${formData.get('Nachname')}`
    };
    
    await fetch('tables/provisionen', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(provisionData)
    });
    
    // Also add to umsaetze table for tracking
    const kategorieMap = {
        'sim-only': 'mobilfunk',
        'internet': 'dsl',
        'strom': 'strom'
    };
    
    const umsatzData = {
        partner_email: validatedPartnerEmail || '',
        partner_name: contractData.partner_name || '',
        datum: Date.now(),
        betrag: parseFloat(contractData.tarif_preis) || 0,
        kategorie: kategorieMap[currentCategory] || 'mobilfunk',
        produkt: `${contractData.anbieter} - ${contractData.tarif_name}`,
        kunde_name: `${contractData.kunde_vorname} ${contractData.kunde_nachname}`,
        provision_prozent: 0,
        provision_betrag: gesamtProvision,
        status: 'offen',
        notizen: `Vertragsnummer: ${vertragsnummer}`
    };
    
    await fetch('tables/umsaetze', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(umsatzData)
    });
    
    return result;
}

function updateHiddenFormFields() {
    try {
        const partnerEmail = document.getElementById('partnerEmail')?.value || '';
        const crossSellNames = selectedCrossSellOptions ? Object.values(selectedCrossSellOptions).map(option => option.name) : [];
        
        const formPartnerEmail = document.getElementById('form-partner-email');
        if (formPartnerEmail) formPartnerEmail.value = partnerEmail;
        
        const formSelectedTariff = document.getElementById('form-selected-tariff');
        if (formSelectedTariff) formSelectedTariff.value = selectedTariffData?.tariff || '';
        
        const formTariffPrice = document.getElementById('form-tariff-price');
        if (formTariffPrice) formTariffPrice.value = selectedTariffData?.price || '';
        
        // Einfache Provision wie frÃ¼her (FUNKTIONIERT!)
        const formProvisionAmount = document.getElementById('form-provision-amount');
        if (formProvisionAmount) formProvisionAmount.value = selectedTariffData?.provision || '';
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“§ APPLE-STYLE E-MAIL - VORSICHTIG IMPLEMENTIERT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // 1ï¸âƒ£ KATEGORIE & UNTERKATEGORIE
        const categoryNames = {
            'sim-only': 'ğŸ“± SIM-Only Tarif',
            'internet': 'ğŸŒ Internet-Tarif', 
            'strom': 'âš¡ Strom-Tarif'
        };
        const categoryDisplay = categoryNames[currentCategory] || currentCategory;
        
        // 2ï¸âƒ£ HAUPTTARIF & PROVISION
        const mainTariff = selectedTariffData?.tariff || 'Nicht ausgewÃ¤hlt';
        const mainPrice = selectedTariffData?.price || '0';
        const mainProvision = parseFloat(selectedTariffData?.provision || 0);
        
        // 3ï¸âƒ£ CROSSSELL ANALYSE (Smartphone Extra + Weitere)
        const smartphones = [];
        const otherCrossSells = [];
        let crossSellProvision = 0;
        
        // âœ… ECHTE SMARTPHONE-DATEN AUS selectedPhoneData HINZUFÃœGEN
        if (selectedPhoneData.phoneObject && selectedPhoneData.model) {
            const phonePrice = getPhonePrice(selectedPhoneData.phoneObject, selectedPhoneData.storageIndex || 0);
            const phoneProvision = 0; // Smartphones bringen 0â‚¬ Provision!
            crossSellProvision += phoneProvision;
            
            const colorInfo = selectedPhoneData.color ? `, ${selectedPhoneData.color}` : '';
            const smartphoneText = `${selectedPhoneData.model} (${selectedPhoneData.storage || '128GB'}${colorInfo}): ${phonePrice.toFixed(2)}â‚¬/Monat â†’ Provision: ${phoneProvision}â‚¬`;
            smartphones.push(smartphoneText);
            
            console.log('ğŸ“± Smartphone zu Email hinzugefÃ¼gt:', smartphoneText);
        }
        
        // CrossSell-Optionen (Versicherungen, Partner-Tarife, etc. - KEINE Smartphones!)
        if (selectedCrossSellOptions && Object.keys(selectedCrossSellOptions).length > 0) {
            Object.values(selectedCrossSellOptions).forEach(option => {
                const provision = parseFloat(option.provision || 0);
                const price = parseFloat(option.price || 0);
                crossSellProvision += provision;
                
                const optionText = `${option.name}: ${price}â‚¬/Monat â†’ Provision: ${provision}â‚¬`;
                
                // Diese sind ALLE zusÃ¤tzliche Services (Versicherungen, Partner-Tarife)
                // KEINE Smartphones, da diese separat Ã¼ber selectedPhoneData laufen!
                otherCrossSells.push(optionText);
            });
        }
        
        // 4ï¸âƒ£ GESAMTPROVISION
        const totalProvision = mainProvision + crossSellProvision;
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // APPLE-STYLE PROFESSIONAL EMAIL FORMAT - CLEAN & STRUKTURIERT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let emailStructure = '';
        
        // ğŸ¨ OPTION 3: CLEAN LIST FORMAT
        emailStructure += `\n`;
        emailStructure += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
        emailStructure += `ğŸ¦ TARIF BESTELLUNG - ${categoryDisplay.toUpperCase()}\n`;
        emailStructure += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
        
        // HAUPTTARIF - Clean List Style
        emailStructure += `â–¶ HAUPTTARIF\n`;
        emailStructure += `  â€¢ Tarif: ${mainTariff}\n`;
        emailStructure += `  â€¢ Preis: ${mainPrice}â‚¬/Monat\n`;
        emailStructure += `  â€¢ Provision: ${mainProvision}â‚¬\n\n`;
        
        // SMARTPHONE - Clean List Style falls vorhanden
        if (smartphones.length > 0) {
            emailStructure += `â–¶ SMARTPHONE\n`;
            smartphones.forEach(phone => {
                const phoneClean = phone.replace(' â†’ Provision: 0â‚¬', '');
                const [phoneName, phonePrice] = phoneClean.split(': ');
                emailStructure += `  â€¢ GerÃ¤t: ${phoneName}\n`;
                emailStructure += `  â€¢ Preis: ${phonePrice}\n`;
                emailStructure += `  â€¢ Provision: 0â‚¬\n\n`;
            });
        }
        
        // ZUSÃ„TZLICHE SERVICES - Clean List Style falls vorhanden
        if (otherCrossSells.length > 0) {
            emailStructure += `â–¶ ZUSÃ„TZLICHE SERVICES\n`;
            otherCrossSells.forEach(extra => {
                emailStructure += `  â€¢ ${extra}\n`;
            });
            emailStructure += `\n`;
        }
        
        // INTERNET DETAILS - Clean List Style nur bei Internet-Kategorie
        if (currentCategory === 'internet') {
            const anschlussArt = document.querySelector('select[name="Anschluss_Art"]')?.value || '';
            const schaltungstermin = document.querySelector('input[name="Schaltungstermin"]')?.value || '';
            const wunschtermin = document.querySelector('input[name="Wunschtermin"]')?.value || '';
            const bisherigerAnbieter = document.querySelector('select[name="Bisheriger_Anbieter"]')?.value || '';
            const vertragsende = document.querySelector('input[name="Vertragsende"]')?.value || '';
            
            const internetDetails = [];
            if (anschlussArt) internetDetails.push(`Anschluss-Art: ${anschlussArt}`);
            if (schaltungstermin) internetDetails.push(`Schaltungstermin: ${schaltungstermin}`);  
            if (wunschtermin) internetDetails.push(`Wunschtermin: ${wunschtermin}`);
            if (bisherigerAnbieter) internetDetails.push(`Bisheriger Anbieter: ${bisherigerAnbieter}`);
            if (vertragsende) internetDetails.push(`Vertragsende: ${vertragsende}`);
            
            if (internetDetails.length > 0) {
                emailStructure += `â–¶ INTERNET DETAILS\n`;
                internetDetails.forEach(detail => {
                    emailStructure += `  â€¢ ${detail}\n`;
                });
                emailStructure += `\n`;
            }
        }
        
        // PROVISIONS-SUMMARY - Clean One-Line Style
        emailStructure += `â–¶ PROVISIONS-SUMMARY\n`;
        const summaryParts = [`Haupttarif: ${mainProvision}â‚¬`];
        if (crossSellProvision > 0) {
            summaryParts.push(`Extras: ${crossSellProvision}â‚¬`);
        }
        summaryParts.push(`GESAMT: ${totalProvision}â‚¬`);
        emailStructure += `  ${summaryParts.join(' | ')}\n`;
        
        // 6ï¸âƒ£ IN FORMSUBMIT EINSETZEN
        const formCrossSellOptions = document.getElementById('form-cross-sell-options');
        if (formCrossSellOptions) {
            formCrossSellOptions.value = emailStructure;
        }
        
        console.log('âœ… Hidden form fields updated successfully');
        console.log('ğŸ“Š Provision breakdown:', provisionBreakdown);
        console.log('ğŸ“‚ Category:', currentCategory);
    } catch (error) {
        console.log('âš ï¸ Error updating hidden form fields (continuing anyway):', error);
    }
}

function updateHiddenStromFormFields() {
    try {
        const partnerEmail = document.getElementById('partnerEmail')?.value || '';
        
        const partnerEmailFields = document.querySelectorAll('.form-partner-email-strom');
        partnerEmailFields.forEach(field => {
            if (field) field.value = partnerEmail;
        });
        
        const tariffFields = document.querySelectorAll('.form-selected-tariff-strom');
        tariffFields.forEach(field => {
            if (field) field.value = selectedTariffData?.tariff || '';
        });
        
        const provisionFields = document.querySelectorAll('.form-provision-amount-strom');
        provisionFields.forEach(field => {
            if (field) field.value = selectedTariffData?.provision || '';
        });
        
        console.log('âœ… Hidden strom form fields updated successfully');
    } catch (error) {
        console.log('âš ï¸ Error updating hidden strom form fields (continuing anyway):', error);
    }
}

// Category Management
function showCategory(category) {
    currentCategory = category;
    
    // Hide all category contents
    document.querySelectorAll('.category-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Update tab states
    document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected category
    const selectedTab = document.querySelector(`[data-category="${category}"]`);
    if (selectedTab) {
        selectedTab.classList.add('active');
    }
    
    const selectedCategory = document.getElementById('category-' + category);
    if (selectedCategory) {
        selectedCategory.classList.remove('hidden');
    }
    
    // Hide forms
    hideAllForms();
    
    // Reset state
    resetSelectionState();
    
    // Update required fields based on category
    updateRequiredFieldsByCategory(category);
    
    // Show/hide Internet-specific fields based on category
    updateInternetFieldsVisibility(category);
    
    // âœ… UPDATE SMARTPHONE BOOKING VISIBILITY NACH KATEGORIE-WECHSEL
    updateSmartphoneBookingVisibility();
    
    // Initialize category-specific content
    if (category === 'all') {
        // Simple working version for "Alle Tariffe"
        showAllTariffsContent();
    } else {
        // Reset category-specific filters
        clearAllFilters();
        
        if (category === 'sim-only') {
            showProvider('sim-only', 'o2');
        } else if (category === 'handy-tarif') {
            showProvider('handy-tarif', 'o2');
            showHandyCategories();
        } else if (category === 'internet') {
            console.log('ğŸŒ Internet category selected, showing 1und1 provider');
            showProvider('internet', '1und1');
        } else if (category === 'strom') {
            showCustomerType('privatkunde');
        }
    }
}

function hideAllForms() {
    const customerForm = document.getElementById('customer-form');
    const customerFormStrom = document.getElementById('customer-form-strom');
    
    if (customerForm) customerForm.classList.add('hidden');
    if (customerFormStrom) customerFormStrom.classList.add('hidden');
}

function resetSelectionState() {
    selectedTariffData = {};
    selectedHandyData = {};
    selectedCrossSellOptions = {};
    baseProvision = 0;
}

// Provider Management
function showProvider(category, provider) {
    currentProvider = provider;
    if (category === 'handy-tarif') {
        currentHandyProvider = provider;
    }
    
    // Update provider button states
    const providerButtons = document.querySelectorAll(`#category-${category} .provider-btn`);
    providerButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedBtn = document.querySelector(`#category-${category} [data-provider="${provider}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }

    // Handle Freenet special case
    if (provider === 'freenet' && category === 'sim-only') {
        const freenetSub = document.getElementById('freenet-sub-providers');
        if (freenetSub) {
            freenetSub.classList.remove('hidden');
        }
        const klarmobilSub = document.getElementById('klarmobil-sub-providers');
        if (klarmobilSub) {
            klarmobilSub.classList.add('hidden');
        }
        showFreenetProvider('o2');
    } else if (provider === 'klarmobil' && category === 'sim-only') {
        const klarmobilSub = document.getElementById('klarmobil-sub-providers');
        if (klarmobilSub) {
            klarmobilSub.classList.remove('hidden');
        }
        const freenetSub = document.getElementById('freenet-sub-providers');
        if (freenetSub) {
            freenetSub.classList.add('hidden');
        }
        showKlarmobilProvider('vodafone');
    } else {
        const freenetSub = document.getElementById('freenet-sub-providers');
        if (freenetSub) {
            freenetSub.classList.add('hidden');
        }
        const klarmobilSub = document.getElementById('klarmobil-sub-providers');
        if (klarmobilSub) {
            klarmobilSub.classList.add('hidden');
        }
        loadTariffs(category, provider);
    }
}

function showFreenetProvider(network) {
    currentFreenetProvider = network;
    
    // Update Freenet provider states
    document.querySelectorAll('#freenet-sub-providers .provider-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedBtn = document.querySelector(`#freenet-sub-providers [data-provider="${network}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
    
    loadTariffs('sim-only', 'freenet-' + network);
}

function showKlarmobilProvider(network) {
    currentKlarmobilProvider = network;
    
    // Update Klarmobil provider states
    document.querySelectorAll('#klarmobil-sub-providers .provider-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedBtn = document.querySelector(`#klarmobil-sub-providers [data-provider="${network}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
    
    loadTariffs('sim-only', 'klarmobil-' + network);
}

// Tariff Management
function loadTariffs(category, providerKey) {
    // Use the enhanced function with filter integration
    loadTariffsWithFilters(category, providerKey);
}

function loadTariffsWithFilters(category, providerKey) {
    currentCategory = category;
    currentProvider = providerKey;
    
    // Load tariff data and add provider information
    let tariffs = tariffData[category] && tariffData[category][providerKey] ? tariffData[category][providerKey] : [];
    
    // Internet tariffs are already in correct order in data
    
    // Add provider information to each tariff for filtering
    allTariffs = tariffs.map(tariff => ({
        ...tariff,
        provider: providerKey,
        category: category
    }));
    
    // Display tariffs in the container
    displayTariffs(category, providerKey, tariffs);
    
    // Apply current filters
    applyFilters();
}

function displayTariffs(category, providerKey, tariffs) {
    console.log(`ğŸ” displayTariffs called: category=${category}, provider=${providerKey}, tariffs=${tariffs.length}`);
    
    const container = document.getElementById(`tariffs-${category}`);
    if (!container) {
        console.error(`âŒ Container not found: tariffs-${category}`);
        return;
    }
    
    if (tariffs.length === 0) {
        console.log('âš ï¸ No tariffs found');
        container.innerHTML = `
            <div class="no-tariffs">
                <i class="fas fa-info-circle"></i>
                <p>Keine Tarife fÃ¼r diesen Anbieter verfÃ¼gbar.</p>
            </div>
        `;
        return;
    }
    
    // CSS Order handles Internet tariff ordering now - no JavaScript sorting needed
    console.log('ğŸŒ INTERNET TARIFFS: Using CSS order for correct display:', tariffs.map(t => t.name));
    
    // Generate HTML for all tariffs (no provider badge for specific provider views)
    const tariffsHTML = tariffs.map(tariff => createTariffCardHTML(tariff, category, providerKey, false)).join('');
    container.innerHTML = tariffsHTML;
    console.log(`âœ… HTML inserted: ${orderedTariffs.length} tariffs`);
    
    // Update count
    updateResultsCount();
}

function updateResultsCount() {
    const countElement = document.getElementById('results-count');
    if (countElement && filteredTariffs) {
        const total = allTariffs ? allTariffs.length : 0;
        const filtered = filteredTariffs.length;
        
        // Special message for smart filter
        if (activeFilters.provision === 'best-smart') {
            countElement.textContent = `${filtered} Top-Tarife ausgewÃ¤hlt`;
        } else {
            countElement.textContent = `${filtered} von ${total} Tarifen`;
        }
    }
}

function getProviderDisplayName(providerKey) {
    const providerNames = {
        'o2': 'O2',
        'freenet-o2': 'Freenet O2',
        'freenet-vodafone': 'Freenet Vodafone',
        'freenet-telekom': 'Freenet Telekom',
        'ayildiz': 'Ay Yildiz',
        '1und1': '1&1',
        'yourfone': 'Yourfone'
    };
    return providerNames[providerKey] || providerKey;
}

// Clean tariff names by removing technical suffixes  
function cleanTariffName(name) {
    return name
        // Remove "mit Handy" patterns
        .replace(/\s+mit\s+handy\s*\d*$/i, '')
        .replace(/\s+mit\s+handy\s+\d+$/i, '')
        
        // Remove m.H. patterns (all variations)
        .replace(/\s+m\.h\.?\s*\d*$/i, '')
        .replace(/\s+m\.h\s+\d+$/i, '')
        
        // Remove handy patterns
        .replace(/\s+m\.handy$/i, '')
        .replace(/\s+handy\s*\d*$/i, '')
        .replace(/\s+handy\s+\d+$/i, '')
        
        // Remove date patterns
        .replace(/\s+nov\s+24$/i, '')
        .replace(/\s+2024$/i, '')
        .replace(/\s+2025$/i, '')
        
        // Remove plus patterns
        .replace(/\s*\+\s*handy\s*\d*$/i, '')
        .replace(/\s*\+\s*handy\s+\d+$/i, '')
        .replace(/\s*\+\s*\d+$/i, '')
        
        // Remove generic "mit" patterns
        .replace(/\s+mit\s*\d+$/i, '')
        
        .trim();
}

function createTariffCardHTML(tariff, category, providerKey, showProviderBadge = false) {
    const tariffId = tariff.name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
    
    if (category === 'strom') {
        return createStromTariffHTML(tariff);
    }
    
    if (category === 'internet') {
        return createInternetTariffHTML(tariff, tariffId);
    }
    
    // Create provider badge only if showProviderBadge is true
    let providerBadgeHTML = '';
    if (showProviderBadge) {
        const providerClass = getProviderClass(providerKey);
        const providerName = getShortProviderName(providerKey);
        providerBadgeHTML = `<div class="card-provider ${providerClass}">${providerName}</div>`;
    }
    
    // For "Alle Tariffe" view, add provider prefix to tariff name and clean it
    let displayName = cleanTariffName(tariff.name);
    if (category === 'all' || showProviderBadge) {
        const providerPrefix = getProviderDisplayName(providerKey);
        displayName = `${providerPrefix}: ${displayName}`;
    }
    
    // ğŸ” DEBUG LOGGING FÃœR FILTERSYSTEM-PROVIDER
    console.log('ğŸ¨ Creating tariff card:', {
        tariffName: tariff.name,
        category: category,
        providerKey: providerKey,
        tariffProvider: tariff.provider
    });
    
    return `
        <div class="tariff-card" onclick="selectTariff('${category}', '${tariffId}', '${tariff.price}', '${tariff.provision}', '${providerKey}')">
            ${providerBadgeHTML}
            <h3 class="card-title">${cleanTariffName(displayName)}</h3>
            <p class="card-desc">${tariff.desc}</p>
            <div class="card-pricing">
                <div class="customer-price">
                    <span class="price-label">Kunde zahlt</span>
                    <span class="price-value">${tariff.price}â‚¬<span class="price-period">/Monat</span></span>
                </div>
                <div class="provision-badge">
                    <span>${tariff.provision}â‚¬</span>
                </div>
            </div>
        </div>`;
}

function createInternetTariffHTML(tariff, tariffId) {
    const typeClass = tariff.type.toLowerCase();
    const typeIcon = tariff.type === 'Glasfaser' ? 'fas fa-bolt' : 'fas fa-ethernet';
    
    // DIRECT ORDERING FIX: CSS order based on tariff name
    let cssOrder = 99; // default fallback
    switch(tariff.name) {
        case 'DSL 50': cssOrder = 1; break;
        case 'DSL 100': cssOrder = 2; break;
        case 'DSL 250': cssOrder = 3; break;
        case 'Glasfaser 150': cssOrder = 4; break;
        case 'Glasfaser 300': cssOrder = 5; break;
        case 'Glasfaser 600': cssOrder = 6; break;
        case 'Glasfaser 1.000': cssOrder = 7; break;
    }
    
    return `
        <div class="tariff-card internet-card" style="order: ${cssOrder};" onclick="selectInternetTariff('${tariffId}', '${tariff.name}', '${tariff.price}', '${tariff.normalPrice}', '${tariff.provision}')">
            <div class="card-badge ${typeClass}">
                <i class="${typeIcon}"></i>
                ${tariff.type}
            </div>
            <div class="card-provider ondeone">1&1</div>
            <h3 class="card-title">${cleanTariffName(tariff.name)}</h3>
            <p class="card-desc">${tariff.desc}</p>
            <div class="card-pricing internet-pricing">
                <div class="customer-price">
                    <span class="price-label">Aktion (1.-10. Monat)</span>
                    <span class="price-value">${tariff.price}â‚¬<span class="price-period">/Monat</span></span>
                    <span class="normal-price">danach ${tariff.normalPrice}â‚¬/Monat</span>
                </div>
                <div class="provision-badge">
                    <span>${tariff.provision}â‚¬</span>
                </div>
            </div>
            <div class="setup-fee">
                <i class="fas fa-tools"></i>
                Einmalig: ${tariff.setupFee}â‚¬ (Router inklusive)
            </div>
        </div>`;
}

function createStromTariffHTML(tariff) {
    return `
        <div class="tariff-card" onclick="selectStromTariff('${tariff.name}', '${tariff.desc}', '${tariff.provision}')">
            <div class="card-provider" style="background: var(--warning);">Strom</div>
            <h3 class="card-title">${cleanTariffName(tariff.name)}</h3>
            <p class="card-desc">${tariff.desc}</p>
            <div class="card-pricing">
                <div class="customer-price">
                    <span class="price-label">Angebot</span>
                    <span class="price-value" style="font-size: 1rem;">${tariff.price}</span>
                </div>
                <div class="provision-badge">
                    <span>${tariff.provision}â‚¬</span>
                </div>
            </div>
        </div>`;
}

function getProviderClass(providerKey) {
    if (providerKey.startsWith('freenet-o2')) return 'freenet';
    if (providerKey.startsWith('freenet-vodafone')) return 'vodafone';
    if (providerKey.startsWith('freenet-telekom')) return 'telekom';
    if (providerKey === 'ayildiz') return 'ayildiz';
    if (providerKey === '1und1') return 'ondeone';
    if (providerKey === 'yourfone') return 'yourfone';
    return 'o2';
}

function getShortProviderName(providerKey) {
    const names = {
        'o2': 'O2',
        'freenet-o2': 'Freenet',
        'freenet-vodafone': 'Freenet',
        'freenet-telekom': 'Freenet',
        'klarmobil-vodafone': 'Klarmobil (Vodafone)',  // FIX: VollstÃ¤ndiger Name fÃ¼r Klarmobil!
        'ayildiz': 'Ay Yildiz',
        '1und1': '1&1',
        'yourfone': 'Yourfone'
    };
    return names[providerKey] || 'O2';
}

// Tariff Selection
function selectTariff(category, tariff, price, provision, providerKey = null) {
    // Check if partner email is validated
    if (!isPartnerEmailValidated) {
        // Show warning message
        const emailSection = document.querySelector('.partner-email-section');
        const messageDiv = document.getElementById('emailRequiredMessage');
        if (messageDiv) {
            messageDiv.style.display = 'flex';
            emailSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Highlight email input
            const emailInput = document.getElementById('partnerEmail');
            emailInput.style.borderColor = '#ffc107';
            emailInput.focus();
            
            setTimeout(() => {
                emailInput.style.borderColor = '';
            }, 3000);
        }
        return; // Prevent tariff selection
    }

    // ğŸ” CRITICAL DEBUG LOGGING
    console.log('ğŸ“± SELECTTARIFF DEBUG:', {
        category: category,
        tariff: tariff,
        providerKey: providerKey,
        currentCategory: currentCategory
    });
    
    // If we're in "Alle Tariffe" view, set category to 'all' to ensure smartphone booking works
    if (currentCategory === 'all') {
        category = 'all';
    }
    
    selectedTariffData = { category, tariff, price, provision, provider: providerKey };
    baseProvision = parseFloat(provision.replace(',', '.'));
    
    // âœ… SET CURRENT PROVIDER FÃœR "ALLE TARIFE" KORREKT
    if (providerKey) {
        currentProvider = providerKey;
        console.log('ğŸ”„ Provider gesetzt fÃ¼r Smartphone Booking:', currentProvider);
    } else {
        console.log('âš ï¸ WARNUNG: Kein providerKey Ã¼bergeben!', { tariff, category });
    }
    
    // Reset phone selection when new tariff is selected
    resetPhoneSelection();

    // Show customer form
    const customerForm = document.getElementById('customer-form');
    if (customerForm) {
        customerForm.classList.remove('hidden');
        updateSelectedTariffInfo();
        
        // âœ… UPDATE SMARTPHONE BOOKING VISIBILITY NACH TARIFF-AUSWAHL
        updateSmartphoneBookingVisibility();
        
        updateCostOverview();
        customerForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function selectStromTariff(tariff, desc, provision) {
    // Check if partner email is validated
    if (!isPartnerEmailValidated) {
        // Show warning message
        const emailSection = document.querySelector('.partner-email-section');
        const messageDiv = document.getElementById('emailRequiredMessage');
        if (messageDiv) {
            messageDiv.style.display = 'flex';
            emailSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Highlight email input
            const emailInput = document.getElementById('partnerEmail');
            emailInput.style.borderColor = '#ffc107';
            emailInput.focus();
            
            setTimeout(() => {
                emailInput.style.borderColor = '';
            }, 3000);
        }
        return; // Prevent tariff selection
    }

    selectedTariffData = { category: 'strom', tariff, desc, provision };
    baseProvision = parseFloat(provision.replace(',', '.'));

    // Show Strom customer form
    const customerFormStrom = document.getElementById('customer-form-strom');
    if (customerFormStrom) {
        customerFormStrom.classList.remove('hidden');
        updateSelectedTariffInfoStrom();
        updateCostOverviewStrom();
        customerFormStrom.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function selectInternetTariff(tariffId, tariffName, actionPrice, normalPrice, provision) {
    selectedTariffData = { 
        category: 'internet', 
        tariff: tariffId, 
        tariffName: tariffName,
        price: actionPrice,
        normalPrice: normalPrice, 
        provision: provision 
    };
    baseProvision = parseFloat(provision.replace(',', '.'));
    
    // Show internet customer form
    const customerForm = document.getElementById('customer-form');
    if (customerForm) {
        customerForm.classList.remove('hidden');
        updateSelectedTariffInfoInternet();
        updateCostOverviewInternet();
        
        // Hide smartphone booking for internet tariffs
        const smartphoneSection = document.getElementById('smartphone-booking-section');
        if (smartphoneSection) {
            smartphoneSection.classList.add('hidden');
        }
        
        // Show internet-specific form fields
        showInternetFormFields();
        
        customerForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Handy/Device Management
function showHandyCategories() {
    document.getElementById('handy-categories').classList.remove('hidden');
    document.getElementById('handy-devices').classList.add('hidden');
    document.getElementById('handy-storage').classList.add('hidden');
    document.getElementById('handy-colors').classList.add('hidden');
    document.getElementById('handy-tariffs').classList.add('hidden');
}

// ===============================================
// NEUES 1&1 HANDY + TARIF SYSTEM (Januar 2026)
// ===============================================

// State fÃ¼r Handy-Auswahl - Variablen werden oben bei den State-Variables deklariert

// Farben-Mapping fÃ¼r Color Swatches (Apple + Samsung + Xiaomi + Google)
const colorMap = {
    // Apple Farben
    'Tiefblau': '#1a237e',
    'Schwarz': '#1c1c1e',
    'Bronze': '#cd7f32',
    'Silber': '#c0c0c0',
    'GrÃ¼n': '#2e7d32',
    'WeiÃŸ': '#fafafa',
    'Blau': '#1976d2',
    'Pink': '#e91e63',
    'Himmelblau': '#81d4fa',
    'Gelb': '#fdd835',
    'BlaugrÃ¼n': '#00838f',
    // Samsung Farben
    'Blue Shadow': '#1a237e',
    'Navy': '#0d1b2a',
    'Titanium Silver': '#b0b0b0',
    'Titanium Silverblue': '#8fa3b0',
    'Titanium Gray': '#5c5c5c',
    'Titanium Black': '#2c2c2c',
    'Grau': '#9e9e9e',
    'Rot': '#c62828',
    // Xiaomi Farben
    'Glacier Blue': '#b3e5fc',
    'Dusk Purple': '#9575cd',
    'Gold': '#ffd54f',
    // Google Pixel Farben
    'Obsidian': '#1c1c1e',
    'Porcelain': '#f5f5f0',
    'Moonstone': '#a8b5c4',
    'Indigo': '#3f51b5',
    'Jade': '#00897b',
    'Iris': '#7e57c2',
    'Peony': '#f48fb1'
};

// Step 1: Kategorie wÃ¤hlen (Apple, Samsung, Xiaomi)
function showHandyCategory(category) {
    console.log('ğŸ“± showHandyCategory aufgerufen mit:', category);
    selectedHandyData = { category, provider: '1und1' };
    
    document.getElementById('handy-categories').classList.add('hidden');
    document.getElementById('handy-devices').classList.remove('hidden');
    document.getElementById('handy-device-title').textContent = `2. ${category} Smartphone wÃ¤hlen`;
    
    const devices = handyData['1und1']?.[category] || [];
    console.log('ğŸ“± Gefundene GerÃ¤te fÃ¼r', category, ':', devices.length);
    
    if (devices.length === 0) {
        console.error('âŒ KEINE GERÃ„TE gefunden fÃ¼r Kategorie:', category);
        console.log('ğŸ“± VerfÃ¼gbare Kategorien:', Object.keys(handyData['1und1'] || {}));
    }
    
    const grid = document.getElementById('handy-devices-grid');
    
    // Icon je nach Kategorie
    const getIcon = (cat) => {
        if (cat === 'Apple') return 'fab fa-apple';
        if (cat === 'Samsung') return 'fas fa-mobile-screen-button'; // Samsung Style
        if (cat === 'Xiaomi') return 'fas fa-fire'; // Xiaomi Style (Fire = Mi Logo Ã¤hnlich)
        if (cat === 'Google') return 'fab fa-google'; // Google Logo
        return 'fas fa-mobile-alt';
    };
    
    grid.innerHTML = devices.map(device => {
        const basePrice36 = device.price36M[0];
        const baseTarif = 14.99; // All-Net-Flat S
        const totalPrice = (basePrice36 + baseTarif).toFixed(2);
        
        return `
            <div class="device-card" onclick="selectHandyDevice('${device.name}')">
                ${device.badge ? `<div class="device-badge">${device.badge}</div>` : ''}
                <div class="device-icon"><i class="${getIcon(category)}"></i></div>
                <div class="device-name">${device.name}</div>
                <div class="device-price">ab ${totalPrice}â‚¬/Monat</div>
            </div>
        `;
    }).join('');
}

// Step 2: GerÃ¤t auswÃ¤hlen
function selectHandyDevice(deviceName) {
    selectedHandyData.device = deviceName;
    
    // Dynamische Kategorie verwenden (Apple, Samsung, Xiaomi)
    const category = selectedHandyData.category || 'Apple';
    const device = handyData['1und1']?.[category]?.find(d => d.name === deviceName);
    if (!device) {
        console.error('âŒ GerÃ¤t nicht gefunden:', deviceName, 'in Kategorie:', category);
        return;
    }
    console.log('âœ… GerÃ¤t ausgewÃ¤hlt:', deviceName, 'Kategorie:', category);
    
    document.getElementById('handy-devices').classList.add('hidden');
    document.getElementById('handy-storage').classList.remove('hidden');
    document.getElementById('handy-storage-title').textContent = `3. Speicher fÃ¼r ${deviceName}`;
    
    const grid = document.getElementById('handy-storage-grid');
    grid.innerHTML = device.storage.map((storage, index) => {
        const priceAdd = index * 5; // +5â‚¬ pro Stufe
        return `
            <div class="option-card" onclick="selectHandyStorage('${storage}', ${index})">
                <div class="option-value">${storage}</div>
                <div class="option-price">${index === 0 ? 'Basis' : `+${priceAdd}â‚¬/Monat`}</div>
            </div>
        `;
    }).join('');
}

// Step 3: Speicher auswÃ¤hlen
function selectHandyStorage(storage, index) {
    selectedHandyData.storage = storage;
    selectedHandyData.storageIndex = index;
    
    const category = selectedHandyData.category || 'Apple';
    const device = handyData['1und1']?.[category]?.find(d => d.name === selectedHandyData.device);
    if (!device) return;
    
    document.getElementById('handy-storage').classList.add('hidden');
    document.getElementById('handy-colors').classList.remove('hidden');
    document.getElementById('handy-color-title').textContent = `4. Farbe fÃ¼r ${selectedHandyData.device}`;
    
    const grid = document.getElementById('handy-colors-grid');
    grid.innerHTML = device.colors.map(color => {
        const bgColor = colorMap[color] || '#888';
        return `
            <div class="option-card" onclick="selectHandyColor('${color}')">
                <div class="color-swatch" style="background: ${bgColor};"></div>
                <div class="option-value">${color}</div>
            </div>
        `;
    }).join('');
}

// Step 4: Farbe auswÃ¤hlen â†’ Laufzeit-Seite
function selectHandyColor(color) {
    selectedHandyData.color = color;
    
    const category = selectedHandyData.category || 'Apple';
    const device = handyData['1und1']?.[category]?.find(d => d.name === selectedHandyData.device);
    if (!device) return;
    
    const storageIdx = selectedHandyData.storageIndex;
    const baseTarif = 14.99; // All-Net-Flat S als Basis
    
    // Preise berechnen
    const handy36 = device.price36M[storageIdx];
    const handy24 = device.price24M[storageIdx];
    const total36 = (handy36 + baseTarif).toFixed(2);
    const total24 = (handy24 + baseTarif).toFixed(2);
    
    // UI aktualisieren
    document.getElementById('handy-colors').classList.add('hidden');
    document.getElementById('handy-laufzeit').classList.remove('hidden');
    
    document.getElementById('selected-device-name').textContent = `${selectedHandyData.device}`;
    document.getElementById('selected-device-details').textContent = `${selectedHandyData.storage}, ${selectedHandyData.color}`;
    
    document.getElementById('price-36m').textContent = `ab ${total36}â‚¬/Monat`;
    document.getElementById('price-24m').textContent = `ab ${total24}â‚¬/Monat`;
    
    // Default: 36 Monate
    selectLaufzeit(36);
}

// Step 5: Laufzeit auswÃ¤hlen
function selectLaufzeit(months) {
    selectedLaufzeit = months;
    
    document.querySelectorAll('.laufzeit-card').forEach(card => {
        card.classList.remove('active');
    });
    
    event.currentTarget?.classList.add('active') || 
        document.querySelector(`.laufzeit-card:${months === 36 ? 'first-child' : 'last-child'}`)?.classList.add('active');
}

// Weiter zu Tarifen
function continueToTariffs() {
    document.getElementById('handy-laufzeit').classList.add('hidden');
    document.getElementById('handy-tariffs').classList.remove('hidden');
    document.getElementById('handy-tariff-title').textContent = `6. Tarif wÃ¤hlen`;
    document.getElementById('selected-handy-display').textContent = 
        `${selectedHandyData.device} (${selectedHandyData.storage}, ${selectedHandyData.color}) - ${selectedLaufzeit} Monate`;
    
    showTarifKategorie('all-net-flat');
}

// Tarif-Kategorie wechseln
function showTarifKategorie(kategorie) {
    currentTarifKategorie = kategorie;
    
    document.querySelectorAll('.tariff-cat-btn').forEach(btn => btn.classList.remove('active'));
    event.currentTarget?.classList.add('active');
    
    const tarife = tarife1und1[kategorie] || [];
    const category = selectedHandyData.category || 'Apple';
    const device = handyData['1und1']?.[category]?.find(d => d.name === selectedHandyData.device);
    const storageIdx = selectedHandyData.storageIndex;
    const handyRate = selectedLaufzeit === 36 ? device.price36M[storageIdx] : device.price24M[storageIdx];
    
    const grid = document.getElementById('handy-tariffs-grid');
    grid.innerHTML = tarife.map(tarif => {
        const totalPrice = (handyRate + tarif.price).toFixed(2);
        return `
            <div class="handy-tariff-card" onclick="selectHandyTariff('${tarif.id}', '${tarif.name}', ${tarif.price}, ${tarif.provision})">
                ${tarif.badge ? `<div class="tariff-badge">${tarif.badge}</div>` : ''}
                <div class="tariff-name">${tarif.name}</div>
                <div class="tariff-data">${tarif.data}</div>
                <div class="tariff-desc">${tarif.desc}</div>
                <div class="price-row">
                    <div class="total-price">
                        Gesamt
                        <span>${totalPrice}â‚¬</span>
                    </div>
                    <div class="provision-box">
                        <div class="prov-label">Provision</div>
                        <div class="prov-value">${tarif.provision.toFixed(2)}â‚¬</div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// Step 6: Tarif auswÃ¤hlen â†’ Formular
function selectHandyTariff(tarifId, tarifName, tarifPrice, provision) {
    const category = selectedHandyData.category || 'Apple';
    const device = handyData['1und1']?.[category]?.find(d => d.name === selectedHandyData.device);
    const storageIdx = selectedHandyData.storageIndex;
    const handyRate = selectedLaufzeit === 36 ? device.price36M[storageIdx] : device.price24M[storageIdx];
    const totalPrice = (handyRate + tarifPrice).toFixed(2);
    
    const fullName = `${selectedHandyData.device} (${selectedHandyData.storage}, ${selectedHandyData.color}) + ${tarifName} - ${selectedLaufzeit} Monate`;
    
    selectedTariffData = { 
        category: 'handy-tarif',
        tariff: fullName,
        device: selectedHandyData.device,
        storage: selectedHandyData.storage,
        color: selectedHandyData.color,
        laufzeit: selectedLaufzeit,
        tarifName: tarifName,
        handyRate: handyRate,
        tarifPrice: tarifPrice,
        price: totalPrice,
        provision: provision.toFixed(2)
    };
    baseProvision = provision;

    // Formular anzeigen
    document.getElementById('handy-tariffs').classList.add('hidden');
    const customerForm = document.getElementById('customer-form');
    if (customerForm) {
        customerForm.classList.remove('hidden');
        updateSelectedTariffInfo();
        updateCostOverview();
        customerForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// Navigation functions
function backToHandyDevices() {
    document.getElementById('handy-storage').classList.add('hidden');
    document.getElementById('handy-devices').classList.remove('hidden');
}

function backToHandyStorage() {
    document.getElementById('handy-colors').classList.add('hidden');
    document.getElementById('handy-storage').classList.remove('hidden');
}

function backToHandyColors() {
    document.getElementById('handy-laufzeit').classList.add('hidden');
    document.getElementById('handy-colors').classList.remove('hidden');
}

function backToLaufzeit() {
    document.getElementById('handy-tariffs').classList.add('hidden');
    document.getElementById('handy-laufzeit').classList.remove('hidden');
}

// Customer Type Management (Strom)
function showCustomerType(customerType) {
    currentCustomerType = customerType;
    
    // Update customer type button states
    document.querySelectorAll('.customer-type-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedBtn = document.querySelector(`[data-type="${customerType}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
    
    // Update title
    const title = document.getElementById('customer-type-title-strom');
    if (title) {
        const typeText = customerType === 'privatkunde' ? 'Privatkunde' : 'Gewerbekunde';
        title.innerHTML = `<i class="fas fa-bolt"></i> Strom-Tarife ${typeText}`;
    }
    
    loadTariffs('strom', customerType);
}

// Cost Overview Management
function updateSelectedTariffInfo() {
    const tariffInfo = document.getElementById('selected-tariff-info');
    if (tariffInfo && selectedTariffData.tariff) {
        // Smart tariff name formatting for ALL tariffs
        let displayName = selectedTariffData.tariff;
        
        // Auto-format based on tariff ID patterns
        if (displayName.includes('freenet-vodafone')) {
            displayName = displayName.replace('freenet-vodafone-', 'Freenet (Vodafone) - ').replace(/-/g, ' ');
        } else if (displayName.includes('freenet-telekom')) {
            displayName = displayName.replace('freenet-telekom-', 'Freenet (Telekom) - ').replace(/-/g, ' ');
        } else if (displayName.includes('freenet-o2')) {
            displayName = displayName.replace('freenet-o2-', 'Freenet (O2) - ').replace(/-/g, ' ');
        } else if (displayName.includes('klarmobil-vodafone')) {
            displayName = displayName.replace('klarmobil-vodafone-', 'Klarmobil (Vodafone) - ').replace(/-/g, ' ');
        } else if (displayName.includes('klarmobil-telekom')) {
            displayName = displayName.replace('klarmobil-telekom-', 'Klarmobil (Telekom) - ').replace(/-/g, ' ');
        } else if (displayName.includes('klarmobil-o2')) {
            displayName = displayName.replace('klarmobil-o2-', 'Klarmobil (O2) - ').replace(/-/g, ' ');
        } else if (displayName.includes('o2-')) {
            displayName = displayName.replace('o2-', 'O2 - ').replace(/-/g, ' ');
        } else if (displayName.includes('ayildiz')) {
            displayName = displayName.replace('ayildiz-', 'Ay Yildiz - ').replace(/-/g, ' ');
        } else {
            // Fallback: just replace dashes with spaces and capitalize
            displayName = displayName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // Remove "mit Handy" and similar endings - COMPREHENSIVE PATTERNS
        displayName = displayName
            // Main "mit Handy" patterns
            .replace(/\s+mit\s+handy\s*\d*$/i, '')                // "mit Handy 10", "mit Handy 5", "mit handy"
            .replace(/\s+mit\s+handy\s+\d+$/i, '')                // "mit Handy 10" (with space before number)
            
            // m.H. patterns (all variations)
            .replace(/\s+m\.h\.?\s*\d*$/i, '')                    // "m.H.10", "m.H.5", "m.H.15", "m.h.10"
            .replace(/\s+m\.h\s+\d+$/i, '')                       // "m.H 10" (space before number)
            
            // Direct "handy" patterns
            .replace(/\s+m\.handy$/i, '')                         // "m.handy"
            .replace(/\s+handy\s*\d*$/i, '')                     // "handy", "handy 10", "handy 5"
            .replace(/\s+handy\s+\d+$/i, '')                     // "handy 10" (with space before number)
            
            // Plus patterns
            .replace(/\s*\+\s*handy\s*\d*$/i, '')               // "+ handy", "+handy", "+ handy 10"
            .replace(/\s*\+\s*handy\s+\d+$/i, '')               // "+ handy 10" (with space before number)
            
            // LTE special case (preserve LTE but remove handy suffix)
            .replace(/\s+LTE\s+m\.h\.?\s*\d*$/i, ' LTE')        // "40 GB LTE m.H.15" â†’ "40 GB LTE"
            .replace(/\s+LTE\s+mit\s+handy\s*\d*$/i, ' LTE')    // "40 GB LTE mit Handy 10" â†’ "40 GB LTE"
            
            // Edge cases and cleanup
            .replace(/\s+mit\s*\d+$/i, '')                       // Just "mit 10" or "mit10"
            .replace(/\s*\+\s*\d+$/i, '')                        // Just "+ 10" or "+10" at the end
            .trim();
        
        // Extract provider information
        let providerName = '';
        let dataVolume = '';
        
        // Determine provider from current provider, selectedTariffData.provider, or tariff name
        const providerToUse = currentProvider || selectedTariffData?.provider;
        
        if (providerToUse) {
            if (providerToUse === 'o2') providerName = 'O2';
            else if (providerToUse === 'ayildiz') providerName = 'Ay Yildiz';
            else if (providerToUse === '1und1') providerName = '1&1';
            else if (providerToUse === 'yourfone') providerName = 'Yourfone';
            else if (providerToUse.startsWith('freenet-')) {
                const network = providerToUse.split('-')[1];
                providerName = `Freenet (${network.charAt(0).toUpperCase() + network.slice(1)})`;
            }
            else if (providerToUse.startsWith('klarmobil-')) {
                const network = providerToUse.split('-')[1];
                providerName = `Klarmobil (${network.charAt(0).toUpperCase() + network.slice(1)})`;
            }
        } else {
            // Fallback: extract from tariff name
            // Spezielle Behandlung fÃ¼r bekannte Klarmobil-Tarife
            if (displayName.includes('Geburtstagsaktion')) providerName = 'Klarmobil (Vodafone)';
            else if (displayName.includes('Freenet')) providerName = displayName.split(' - ')[0];
            else if (displayName.includes('Klarmobil')) providerName = displayName.split(' - ')[0];
            else if (displayName.includes('O2')) providerName = 'O2';
            else if (displayName.includes('Ay Yildiz')) providerName = 'Ay Yildiz';
            else if (displayName.includes('1&1')) providerName = '1&1';
            else if (displayName.includes('Yourfone')) providerName = 'Yourfone';
        }
        
        // Extract data volume - EINFACHE LÃ–SUNG: Nutze direkt die desc vom Provider
        const providerForData = providerToUse;
        if (providerForData && selectedTariffData.category && tariffData[selectedTariffData.category]?.[providerForData]) {
            const tariffs = tariffData[selectedTariffData.category][providerForData];
            
            // Finde den passenden Tarif und nutze seine desc direkt
            for (let tariff of tariffs) {
                const tariffId = tariff.name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
                if (selectedTariffData.tariff.includes(tariffId) && tariff.desc) {
                    // Nehme die desc direkt als dataVolume (enthÃ¤lt bereits GB/MB/Flat etc.)
                    dataVolume = tariff.desc;
                    break;
                }
            }
        }
        
        // FÃ¼r "Alle Tarife", "diese-woche" und "neue-tariffe" - durchsuche alle Provider nach dem Tarif
        if (!dataVolume && (selectedTariffData.category === 'all' || selectedTariffData.category === 'diese-woche' || selectedTariffData.category === 'neue-tariffe')) {
            for (let category of ['sim-only']) {
                if (!tariffData[category]) continue;
                for (let provider of Object.keys(tariffData[category])) {
                    const tariffs = tariffData[category][provider];
                    for (let tariff of tariffs) {
                        const tariffId = tariff.name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
                        if (selectedTariffData.tariff.includes(tariffId) && tariff.desc) {
                            dataVolume = tariff.desc;
                            break;
                        }
                    }
                    if (dataVolume) break;
                }
                if (dataVolume) break;
            }
        }
        
        // Fallback: Versuche es aus displayName zu extrahieren
        if (!dataVolume) {
            const gbMatches = displayName.match(/(\d+)\s*GB/i) || displayName.match(/(\d+)GB/i);
            if (gbMatches) {
                dataVolume = `${gbMatches[1]} GB`;
            } else if (displayName.toLowerCase().includes('unlimited') || displayName.toLowerCase().includes('flat')) {
                dataVolume = 'Unlimited';
            } else {
                dataVolume = 'k.A.';
            }
        }
        
        // Clean tariff name (remove provider prefix if already extracted)
        let cleanTariffName = displayName;
        if (providerName && displayName.includes(providerName)) {
            cleanTariffName = displayName.replace(providerName + ' - ', '').replace(providerName + ' ', '').trim();
        }
        
        tariffInfo.innerHTML = `
            <div class="selected-tariff-card">
                <div class="tariff-badge mobile">
                    <i class="fas fa-sim-card"></i>
                    Mobile
                </div>
                <h3>${cleanTariffName}</h3>
                <div class="tariff-details">
                    <span class="data-volume"><i class="fas fa-database"></i> ${dataVolume}</span>
                    <span class="provider-name"><i class="fas fa-building"></i> ${providerName}</span>
                </div>
                <div class="pricing-info">
                    <span class="price">${selectedTariffData.price}â‚¬/Monat</span>
                    <span class="provision">Provision: ${selectedTariffData.provision}â‚¬</span>
                </div>
            </div>
        `;
    }
}

function updateSelectedTariffInfoStrom() {
    const tariffInfo = document.getElementById('selected-tariff-info-strom');
    if (tariffInfo && selectedTariffData.tariff) {
        const typeText = currentCustomerType === 'privatkunde' ? 'Privatkunde' : 'Gewerbekunde';
        tariffInfo.innerHTML = `
            <h3>GewÃ¤hlter Tarif: ${selectedTariffData.tariff}</h3>
            <p style="color: var(--gray-600);">Kundentyp: ${typeText}</p>
        `;
    }
}

function updateCostOverview() {
    const costOverview = document.getElementById('cost-overview');
    if (!costOverview || !selectedTariffData.tariff) {
        if (costOverview) costOverview.classList.add('hidden');
        return;
    }
    
    costOverview.classList.remove('hidden');

    let totalMonthly = 0;
    let totalProvision = baseProvision;

    const tariffPrice = parseFloat(selectedTariffData.price.replace(',', '.'));
    if (!isNaN(tariffPrice)) {
        totalMonthly += tariffPrice;
    }

    // Add phone costs
    let phonePrice = 0;
    let phoneHTML = '';
    if (selectedPhoneData.phoneObject && selectedPhoneData.storageIndex !== undefined) {
        phonePrice = getPhonePrice(selectedPhoneData.phoneObject, selectedPhoneData.storageIndex);
        totalMonthly += phonePrice;
        
        phoneHTML = `
            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-200);">
                <span>${selectedPhoneData.model} (${selectedPhoneData.storage})</span>
                <span>${phonePrice.toFixed(2).replace('.', ',')} â‚¬</span>
            </div>`;
    }

    // Add cross-sell costs
    Object.values(selectedCrossSellOptions).forEach(option => {
        totalMonthly += option.price;
        totalProvision += option.provision;
    });

    // Update monthly costs display
    const monthlyCostsContainer = document.getElementById('monthly-costs');
    if (monthlyCostsContainer) {
        let crossSellHTML = '';
        Object.values(selectedCrossSellOptions).forEach(option => {
            crossSellHTML += `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-200);">
                    <span>${option.name}</span>
                    <span>${option.price.toFixed(2).replace('.', ',')} â‚¬</span>
                </div>`;
        });

        monthlyCostsContainer.innerHTML = `
            <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--gray-200);">
                <h4 style="margin-bottom: 16px; color: var(--gray-800); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-calendar-alt" style="color: var(--primary);"></i>
                    Monatliche Kosten
                </h4>
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-200);">
                    <span>Tarif</span>
                    <span>${tariffPrice.toFixed(2).replace('.', ',')} â‚¬</span>
                </div>
                ${phoneHTML}
                ${crossSellHTML}
                <div style="display: flex; justify-content: space-between; padding: 16px 0; font-weight: 700; font-size: 1.125rem; color: var(--gray-900); border-top: 2px solid var(--gray-200); margin-top: 12px;">
                    <span>Gesamt</span>
                    <span>${totalMonthly.toFixed(2).replace('.', ',')} â‚¬/Monat</span>
                </div>
            </div>
            
            <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--gray-200); margin-top: 16px;">
                <h4 style="margin-bottom: 16px; color: var(--gray-800); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-receipt" style="color: var(--primary);"></i>
                    Einmalige Kosten
                </h4>
                <div style="display: flex; justify-content: space-between; padding: 16px 0; font-weight: 700; font-size: 1.125rem; color: var(--gray-900);">
                    <span>AnschlussgebÃ¼hr (einmalig)</span>
                    <span>39,99 â‚¬</span>
                </div>
            </div>
        `;
    }
    
    // Update provision display
    const currentProvisionElement = document.getElementById('current-provision');
    if (currentProvisionElement) {
        currentProvisionElement.textContent = `${totalProvision.toFixed(2).replace('.', ',')} â‚¬`;
    }

    // Show cross-sell section
    const crossSellSection = document.getElementById('cross-sell-section');
    if (crossSellSection) {
        crossSellSection.classList.remove('hidden');
        setupCrossSellContent();
    }
}

function updateCostOverviewStrom() {
    const costOverview = document.getElementById('cost-overview-strom');
    if (!costOverview) return;
    
    costOverview.classList.remove('hidden');

    const monthlyCostsContainer = document.getElementById('monthly-costs-strom');
    if (monthlyCostsContainer) {
        monthlyCostsContainer.innerHTML = `
            <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--gray-200);">
                <h4 style="margin-bottom: 16px; color: var(--gray-800); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                    Tarif-Information
                </h4>
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-200);">
                    <span>Tarif</span>
                    <span>${selectedTariffData.tariff}</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 12px 0;">
                    <span>Verbrauchsklasse</span>
                    <span>${selectedTariffData.desc}</span>
                </div>
                <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; margin-top: 12px;">
                    <p style="margin: 0; text-align: center; color: var(--gray-600);">
                        Individuelles Angebot basierend auf Verbrauchsdaten
                    </p>
                </div>
            </div>
        `;
    }
    
    const currentProvisionElement = document.getElementById('current-provision-strom');
    if (currentProvisionElement) {
        currentProvisionElement.textContent = `${baseProvision.toFixed(2).replace('.', ',')} â‚¬`;
    }
}

// Cross-Sell Management
function setupCrossSellContent() {
    const crossSellContent = document.getElementById('cross-sell-content');
    if (!crossSellContent) return;

    crossSellContent.innerHTML = `
        <div style="border-bottom: 1px solid var(--gray-200);">
            <div style="background: var(--gray-100); padding: 16px 20px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-shield-alt" style="color: var(--primary);"></i>
                <h4 style="margin: 0; font-size: 0.875rem; font-weight: 700; color: var(--gray-700); letter-spacing: 0.05em;">HANDYVERSICHERUNG</h4>
            </div>
            <div class="cross-sell-option" onclick="toggleCrossSellOption('insurance-basic')">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <div>
                        <h5 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: var(--gray-800);">HANDYVERSICHERUNG BASIC</h5>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; color: var(--gray-600);">Grundschutz gegen Displaybruch und WasserschÃ¤den</p>
                        <p style="margin: 0; font-weight: 600; color: var(--gray-700);">Kunde zahlt: 5,50 â‚¬/Monat</p>
                    </div>
                    <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">+25,00 â‚¬ Provision</div>
                </div>
            </div>
            <div class="cross-sell-option" onclick="toggleCrossSellOption('insurance-premium')">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <div>
                        <h5 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: var(--gray-800);">HANDYVERSICHERUNG PREMIUM</h5>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; color: var(--gray-600);">Komplettschutz inkl. Diebstahl und technische SchÃ¤den</p>
                        <p style="margin: 0; font-weight: 600; color: var(--gray-700);">Kunde zahlt: 8,95 â‚¬/Monat</p>
                    </div>
                    <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">+40,00 â‚¬ Provision</div>
                </div>
            </div>
        </div>

        <div>
            <div style="background: var(--gray-100); padding: 16px 20px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-users" style="color: var(--primary);"></i>
                <h4 style="margin: 0; font-size: 0.875rem; font-weight: 700; color: var(--gray-700); letter-spacing: 0.05em;">PARTNERKARTE</h4>
            </div>
            <div class="cross-sell-option" onclick="toggleCrossSellOption('partner-o2-mobile-s')">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <div>
                        <h5 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: var(--gray-800);">O2 MOBILE S (2024)</h5>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; color: var(--gray-600);">10 GB â€¢ Allnet-Flat</p>
                        <p style="margin: 0; font-weight: 600; color: var(--gray-700);">Kunde zahlt: 9,99 â‚¬/Monat</p>
                    </div>
                    <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">+15,00 â‚¬ Provision</div>
                </div>
            </div>
            <div class="cross-sell-option" onclick="toggleCrossSellOption('partner-1und1-xs')">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <div>
                        <h5 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: var(--gray-800);">1&1 ALL-NET-FLAT XS</h5>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; color: var(--gray-600);">5 GB (erste 3 Monate gÃ¼nstiger)</p>
                        <p style="margin: 0; font-weight: 600; color: var(--gray-700);">Kunde zahlt: 4,99 â‚¬/Monat (3 Mon.) dann 14,99 â‚¬</p>
                    </div>
                    <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">+50,00 â‚¬ Provision</div>
                </div>
            </div>
            <div class="cross-sell-option" onclick="toggleCrossSellOption('partner-yourfone-10gb')">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <div>
                        <h5 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: var(--gray-800);">YOURFONE 10GB</h5>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; color: var(--gray-600);">10GB + 300 MBit/s</p>
                        <p style="margin: 0; font-weight: 600; color: var(--gray-700);">Kunde zahlt: 19,98 â‚¬/Monat</p>
                    </div>
                    <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">+125,00 â‚¬ Provision</div>
                </div>
            </div>
        </div>
    `;
}

function toggleCrossSell() {
    const content = document.getElementById('cross-sell-content');
    const toggle = document.querySelector('.cross-sell-toggle');
    
    if (content && toggle) {
        content.classList.toggle('open');
        const isOpen = content.classList.contains('open');
        toggle.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
    }
}

function toggleCrossSellOption(optionId) {
    const option = event.currentTarget;
    const isSelected = selectedCrossSellOptions[optionId];
    
    if (isSelected) {
        delete selectedCrossSellOptions[optionId];
        option.classList.remove('selected');
        option.style.background = '';
        option.style.borderLeft = '';
    } else {
        const optionData = crossSellData[optionId];
        if (optionData) {
            selectedCrossSellOptions[optionId] = optionData;
            option.classList.add('selected');
            option.style.background = 'rgba(0, 122, 255, 0.05)';
            option.style.borderLeft = '4px solid var(--primary)';
        }
    }
    
    updateCostOverview();
}

// Filter System Functions
function toggleFilters() {
    const panel = document.getElementById('filter-panel');
    const toggleBtn = document.querySelector('.filter-toggle-btn');
    const toggleText = toggleBtn.querySelector('.filter-text');
    
    if (panel.classList.contains('show')) {
        panel.classList.remove('show');
        panel.classList.add('hidden');
        toggleBtn.classList.remove('active');
        toggleText.textContent = 'Filter anzeigen';
    } else {
        panel.classList.remove('hidden');
        panel.classList.add('show');
        toggleBtn.classList.add('active');
        toggleText.textContent = 'Filter ausblenden';
    }
}

function setFilter(filterType, value) {
    // Update active filter state
    activeFilters[filterType] = value;
    
    // Update UI - remove active class from all buttons of this type
    document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to selected button
    const selectedBtn = document.querySelector(`[data-filter="${filterType}"][data-value="${value}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
    
    // Apply filters
    applyFilters();
    
    // Update active filters display
    updateActiveFiltersDisplay();
}

function applyBestProvisionFilter() {
    // Set smart filter flag
    activeFilters.provision = 'best-smart';
    
    // Update UI
    document.querySelectorAll('[data-filter="provision"]').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Mark best-provision button as active if exists
    const bestBtn = document.querySelector('.quick-filter-btn[onclick*="best-provision"]');
    if (bestBtn) {
        bestBtn.classList.add('active');
    }
    
    // Apply the smart filter
    applyFilters();
    
    // Update active filters display
    updateActiveFiltersDisplay();
}

function getBestProvisionTariffs() {
    if (currentCategory !== 'sim-only') {
        return allTariffs; // Only apply smart filtering to SIM-only
    }
    
    // Group tariffs by provider
    const providerGroups = {};
    
    allTariffs.forEach(tariff => {
        const provider = tariff.provider || getCurrentProvider();
        if (!providerGroups[provider]) {
            providerGroups[provider] = [];
        }
        providerGroups[provider].push(tariff);
    });
    
    // Get top 3-5 tariffs per provider, sorted by provision
    const bestTariffs = [];
    
    Object.keys(providerGroups).forEach(provider => {
        const providerTariffs = providerGroups[provider];
        
        // Sort by provision (highest first)
        const sortedTariffs = providerTariffs.sort((a, b) => {
            const provisionA = parseFloat(a.provision.replace(',', '.'));
            const provisionB = parseFloat(b.provision.replace(',', '.'));
            return provisionB - provisionA;
        });
        
        // Take top 3-5 tariffs depending on provider size
        const topCount = getTopTariffCount(provider, sortedTariffs.length);
        const topTariffs = sortedTariffs.slice(0, topCount);
        
        bestTariffs.push(...topTariffs);
    });
    
    // Sort all best tariffs by provision (global ranking)
    return bestTariffs.sort((a, b) => {
        const provisionA = parseFloat(a.provision.replace(',', '.'));
        const provisionB = parseFloat(b.provision.replace(',', '.'));
        return provisionB - provisionA;
    });
}

function getTopTariffCount(provider, totalTariffs) {
    // Define how many top tariffs to show per provider
    const providerLimits = {
        'freenet-o2': 5,      // Largest portfolio - show top 5
        'freenet-telekom': 5, // Large portfolio - show top 5
        'freenet-vodafone': 3, // Medium portfolio - show top 3
        'o2': 3,             // Medium portfolio - show top 3
        '1und1': 3,          // Medium portfolio - show top 3
        'yourfone': 2,       // Small portfolio - show top 2
        'ayildiz': 2         // Small portfolio - show top 2
    };
    
    const maxForProvider = providerLimits[provider] || 3;
    return Math.min(maxForProvider, totalTariffs);
}

function getCurrentProvider() {
    // Helper to get current provider context
    if (currentProvider === 'freenet' && currentFreenetProvider) {
        return 'freenet-' + currentFreenetProvider;
    }
    return currentProvider || 'unknown';
}

function quickFilter(type) {
    switch (type) {
        case 'best-provision':
            // Smart filter: Show only top tariffs per provider, sorted by provision
            applyBestProvisionFilter();
            break;
        case 'best-price':
            setFilter('price', '0-15');
            break;
        case 'unlimited':
            setFilter('data', 'unlimited');
            break;
    }
}

function clearAllFilters() {
    // Reset all filters
    activeFilters = {
        price: 'all',
        data: 'all',
        provision: 'all',
        consumption: 'all'
    };
    
    // Reset UI
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Activate "all" buttons
    document.querySelectorAll('[data-value="all"]').forEach(btn => {
        btn.classList.add('active');
    });
    
    // Apply filters
    applyFilters();
    
    // Update display
    updateActiveFiltersDisplay();
}

function applyFilters() {
    if (allTariffs.length === 0) return;
    
    // Check if any filters are active
    const hasActiveFilters = Object.values(activeFilters).some(value => value !== 'all');
    
    if (!hasActiveFilters) {
        // No filters active - show all tariffs
        filteredTariffs = [...allTariffs];
    } else if (activeFilters.provision === 'best-smart') {
        // Best provision filter is active
        filteredTariffs = getBestProvisionTariffs();
    } else {
        // Other filters are active
        filteredTariffs = allTariffs.filter(tariff => {
            return matchesFilters(tariff);
        });
    }
    
    // Update tariff display
    updateTariffDisplay();
    
    // Update results count
    updateResultsCount();
}

function matchesFilters(tariff) {
    // Price filter
    if (activeFilters.price !== 'all') {
        if (!matchesPriceFilter(tariff, activeFilters.price)) return false;
    }
    
    // Data volume filter
    if (activeFilters.data !== 'all') {
        if (!matchesDataFilter(tariff, activeFilters.data)) return false;
    }
    
    // Provision filter
    if (activeFilters.provision !== 'all') {
        if (!matchesProvisionFilter(tariff, activeFilters.provision)) return false;
    }
    
    // Consumption filter (for Strom category)
    if (activeFilters.consumption !== 'all' && tariff.category === 'strom') {
        if (!matchesConsumptionFilter(tariff, activeFilters.consumption)) return false;
    }
    
    return true;
}

// ===== NEUES FILTER-SYSTEM =====

// Filter-Typen definieren
const FILTER_TYPES = {
    BEST_PROVISION: 'best-provision',
    BEST_PRICE: 'best-price', 
    HIGH_DATA: 'high-data',
    UNLIMITED: 'unlimited'
};

// Helper-Funktionen fÃ¼r Daten-Extraktion
function getNumericPrice(tariff) {
    // Handle complex price strings like "9,99 â‚¬ (3 Mon.) dann 14,99" or "14,99"
    let priceStr = tariff.price;
    
    // Remove currency symbols and extra text, find all numbers with comma decimals
    const prices = priceStr.match(/(\d+,\d+|\d+\.\d+|\d+)/g);
    if (!prices || prices.length === 0) {
        return 999; // Return high value for unparseable prices
    }
    
    // If multiple prices, take the last one (regular price after promotion)
    let finalPrice = prices[prices.length - 1];
    
    // Handle both comma and dot decimals
    if (finalPrice.includes(',')) {
        finalPrice = finalPrice.replace(',', '.');
    }
    
    const result = parseFloat(finalPrice);
    return result || 999; // Return 999 if parsing fails
}

function getNumericProvision(tariff) {
    return parseFloat(tariff.provision.replace(',', '.'));
}

function getDataVolume(tariff) {
    // Extract GB amount from description
    const gbMatch = tariff.desc.match(/(\d+)\s*GB/i);
    if (gbMatch) {
        return parseInt(gbMatch[1]);
    }
    
    // Check for unlimited indicators
    if (tariff.desc.toLowerCase().includes('unlimited') || 
        tariff.desc.toLowerCase().includes('unlimitiert') ||
        tariff.desc.toLowerCase().includes('flat')) {
        return 999; // Special value for unlimited
    }
    
    return 0;
}

// Haupt-Sortier-Funktion (immer nach Provision sortieren)
function sortTariffsByProvision(tariffs, descending = true) {
    return [...tariffs].sort((a, b) => {
        const provisionA = getNumericProvision(a);
        const provisionB = getNumericProvision(b);
        return descending ? provisionB - provisionA : provisionA - provisionB;
    });
}

// Filter-Funktionen fÃ¼r spezielle Buttons
function getTopTariffsByProvision(tariffs, limit = 10) {
    const sorted = sortTariffsByProvision(tariffs, true); // HÃ¶chste zuerst
    return sorted.slice(0, limit);
}

function getTopTariffsByPrice(tariffs, limit = 10) {
    // Sortiere nach Preis: Niedrigster Preis zuerst (beste Preise oben)
    const sorted = [...tariffs].sort((a, b) => {
        const priceA = getNumericPrice(a);
        const priceB = getNumericPrice(b);
        return priceA - priceB; // Niedrigste zuerst = beste zuerst
    });
    return sorted.slice(0, limit);
}

function getTopHighDataTariffs(tariffs, limit = 10) {
    // Filter: Mindestens 51GB, dann sortiere nach Datenvolumen (hÃ¶chstes zuerst)
    const highData = tariffs.filter(tariff => getDataVolume(tariff) >= 51);
    const sorted = [...highData].sort((a, b) => {
        const dataA = getDataVolume(a);
        const dataB = getDataVolume(b);
        return dataB - dataA; // HÃ¶chstes Datenvolumen zuerst
    });
    return sorted.slice(0, limit);
}

function getTopUnlimitedTariffs(tariffs, limit = 10) {
    // Filter: Unlimited/Flat Tarife, sortiere nach Preis (niedrigster zuerst)
    const unlimited = tariffs.filter(tariff => getDataVolume(tariff) >= 999);
    const sorted = [...unlimited].sort((a, b) => {
        const priceA = getNumericPrice(a);
        const priceB = getNumericPrice(b);
        return priceA - priceB; // Niedrigster Preis zuerst bei Unlimited
    });
    return sorted.slice(0, limit);
}

// Legacy-Funktionen fÃ¼r KompatibilitÃ¤t (vereinfacht)
function matchesPriceFilter(tariff, filterValue) {
    return true; // Wird durch neues System ersetzt
}

function matchesDataFilter(tariff, filterValue) {
    return true; // Wird durch neues System ersetzt  
}

function matchesProvisionFilter(tariff, filterValue) {
    return true; // Wird durch neues System ersetzt
}

function extractNumericPrice(priceString) {
    // Handle complex price strings like "9,99 â‚¬ (3 Mon.) dann 14,99"
    const prices = priceString.match(/(\d+,\d+|\d+)/g);
    if (!prices) return null;
    
    // Take the last price (final price after promotional period)
    const lastPrice = prices[prices.length - 1];
    return parseFloat(lastPrice.replace(',', '.'));
}

function extractDataVolume(description) {
    // Extract GB amount from description
    const gbMatch = description.match(/(\d+)\s*GB/i);
    if (gbMatch) {
        return parseInt(gbMatch[1]);
    }
    
    // Check for unlimited indicators
    if (description.toLowerCase().includes('unlimited') || 
        description.toLowerCase().includes('unlimitiert')) {
        return 999; // Special value for unlimited
    }
    
    return 0; // Default if no data volume found
}

function matchesConsumptionFilter(tariff, filterValue) {
    const name = tariff.name.toLowerCase();
    const desc = tariff.desc.toLowerCase();
    
    switch (filterValue) {
        case 'low': 
            return name.includes('niedrigverbrauch') || desc.includes('< 2.500');
        case 'standard': 
            return name.includes('standardverbrauch') || desc.includes('2.500 - 5.000');
        default: 
            return true;
    }
}

function updateTariffDisplay() {
    const container = document.getElementById('tariffs-' + currentCategory);
    if (!container) return;
    
    const allCards = container.querySelectorAll('.tariff-card');
    
    // Check if any filters are active (not 'all')
    const hasActiveFilters = Object.values(activeFilters).some(value => value !== 'all');
    
    if (!hasActiveFilters) {
        // No filters active - show all tariffs sorted by provision (default)
        const sortedByProvision = sortTariffsByProvision(allTariffs, true);
        
        // Re-create HTML with provision-sorted order
        container.innerHTML = sortedByProvision.map(tariff => createTariffCardHTML(tariff, currentCategory, currentProvider, false)).join('');
        
        const newCards = container.querySelectorAll('.tariff-card');
        newCards.forEach(card => {
            card.classList.remove('filtered-out');
            card.classList.add('filtered-in');
            card.classList.remove('highlight');
        });
        hideNoResults(container);
        return;
    }
    
    // Filters are active - apply filtering
    if (filteredTariffs.length === 0) {
        // Hide all cards if no results
        allCards.forEach(card => {
            card.classList.add('filtered-out');
            card.classList.remove('filtered-in', 'highlight');
        });
        showNoResults(container);
    } else {
        hideNoResults(container);
        
        // Re-create HTML with filtered and correctly sorted tariffs
        container.innerHTML = filteredTariffs.map(tariff => createTariffCardHTML(tariff, currentCategory, currentProvider, false)).join('');
        
        // Apply styles to new cards
        const newCards = container.querySelectorAll('.tariff-card');
        newCards.forEach((card, index) => {
            card.classList.remove('filtered-out');
            card.classList.add('filtered-in');
            
            // Add highlight animation with delay
            setTimeout(() => {
                card.classList.add('highlight');
                setTimeout(() => {
                    card.classList.remove('highlight');
                }, 2000);
            }, index * 100);
        });
    }
}

function showNoResults(container) {
    let noResultsDiv = container.querySelector('.no-results');
    if (!noResultsDiv) {
        noResultsDiv = document.createElement('div');
        noResultsDiv.className = 'no-results';
        noResultsDiv.innerHTML = `
            <div class="no-results-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3>Keine Tarife gefunden</h3>
            <p>Mit den aktuellen Filtern wurden keine passenden Tarife gefunden. Versuchen Sie andere Filtereinstellungen.</p>
            <button onclick="clearAllFilters()">
                <i class="fas fa-refresh"></i>
                Filter zurÃ¼cksetzen
            </button>
        `;
        container.appendChild(noResultsDiv);
    }
    noResultsDiv.style.display = 'block';
}

function hideNoResults(container) {
    const noResultsDiv = container.querySelector('.no-results');
    if (noResultsDiv) {
        noResultsDiv.style.display = 'none';
    }
}

function updateResultsCount() {
    const countElement = document.getElementById('filter-results-count');
    if (countElement) {
        const count = filteredTariffs.length;
        countElement.textContent = `${count} ${count === 1 ? 'Tarif' : 'Tarife'}`;
    }
}

function updateActiveFiltersDisplay() {
    const activeFiltersContainer = document.getElementById('active-filters');
    if (!activeFiltersContainer) return;
    
    activeFiltersContainer.innerHTML = '';
    
    Object.entries(activeFilters).forEach(([filterType, value]) => {
        if (value !== 'all') {
            const filterTag = createActiveFilterTag(filterType, value);
            activeFiltersContainer.appendChild(filterTag);
        }
    });
}

function createActiveFilterTag(filterType, value) {
    const tag = document.createElement('div');
    tag.className = 'active-filter-tag';
    
    const filterNames = {
        price: 'Preis',
        data: 'Daten',
        provision: 'Provision',
        consumption: 'Verbrauch'
    };
    
    const valueNames = {
        '0-15': '0-15â‚¬',
        '15-30': '15-30â‚¬',
        '30-50': '30-50â‚¬',
        '50+': '50â‚¬+',
        '5-20': '5-20 GB',
        '21-50': '21-50 GB',
        '51-150': '51-150 GB',
        'unlimited': 'Unlimited',
        '15-50': '15-50â‚¬',
        '51-100': '51-100â‚¬',
        '101-200': '101-200â‚¬',
        '200+': '200â‚¬+',
        'low': 'Niedrig',
        'standard': 'Standard'
    };
    
    tag.innerHTML = `
        ${filterNames[filterType]}: ${valueNames[value] || value}
        <button onclick="removeFilter('${filterType}')">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    return tag;
}

function removeFilter(filterType) {
    setFilter(filterType, 'all');
}

// Enhanced loadTariffs function with filter integration
function loadTariffsWithFilters(category, providerKey) {
    currentCategory = category;
    currentProvider = providerKey;
    
    const container = document.getElementById('tariffs-' + category);
    if (!container) return;

    const data = tariffData[category]?.[providerKey];
    if (data) {
        // Store all tariffs for filtering
        allTariffs = data.map(tariff => ({
            ...tariff,
            provider: providerKey,
            category: category
        }));
        
        // Keine automatische Sortierung - Filter bestimmen die Reihenfolge
        filteredTariffs = [...allTariffs];
        
        // Create HTML for all tariffs
        container.innerHTML = allTariffs.map(tariff => createTariffCardHTML(tariff, category, providerKey, false)).join('');
        
        // Apply filter display (this will show all tariffs if no filters are active)
        updateTariffDisplay();
        updateResultsCount();
        
        // Update provider title - keep it simple and generic
        const titleElement = document.getElementById('provider-title-' + category);
        if (titleElement) {
            if (category === 'sim-only') {
                titleElement.innerHTML = `<i class="fas fa-sim-card"></i> SIM Only Tarife`;
            } else if (category === 'strom') {
                titleElement.innerHTML = `<i class="fas fa-bolt"></i> Strom Tarife`;
            } else if (category === 'handy-tarif') {
                titleElement.innerHTML = `<i class="fas fa-mobile-alt"></i> Handy + Tarif`;
            }
        }
    } else {
        container.innerHTML = '<div class="coming-soon"><h3>Keine Tarife verfÃ¼gbar</h3><p>FÃ¼r diesen Anbieter sind aktuell keine Tarife verfÃ¼gbar.</p></div>';
        allTariffs = [];
        filteredTariffs = [];
        updateResultsCount();
    }
}

// Debugging function to check tariff display
function debugTariffDisplay() {
    console.log('=== Tariff Debug Info ===');
    console.log('Current Category:', currentCategory);
    console.log('Current Provider:', currentProvider);
    console.log('Active Filters:', activeFilters);
    console.log('All Tariffs Count:', allTariffs.length);
    console.log('Filtered Tariffs Count:', filteredTariffs.length);
    
    const container = document.getElementById('tariffs-' + currentCategory);
    if (container) {
        const allCards = container.querySelectorAll('.tariff-card');
        const visibleCards = container.querySelectorAll('.tariff-card.filtered-in');
        const hiddenCards = container.querySelectorAll('.tariff-card.filtered-out');
        
        console.log('Total Cards:', allCards.length);
        console.log('Visible Cards:', visibleCards.length);
        console.log('Hidden Cards:', hiddenCards.length);
    }
    console.log('========================');
}

// Global function exports for onclick handlers
window.showCategory = showCategory;
window.showProvider = showProvider;
window.showFreenetProvider = showFreenetProvider;
window.selectTariff = selectTariff;
window.selectStromTariff = selectStromTariff;
window.showHandyCategories = showHandyCategories;
window.showHandyCategory = showHandyCategory;
window.selectHandyDevice = selectHandyDevice;
window.selectHandyStorage = selectHandyStorage;
window.selectHandyColor = selectHandyColor;
window.selectHandyTariff = selectHandyTariff;
window.backToHandyDevices = backToHandyDevices;
window.backToHandyStorage = backToHandyStorage;
window.backToHandyColors = backToHandyColors;
window.showCustomerType = showCustomerType;
window.toggleCrossSell = toggleCrossSell;
window.toggleCrossSellOption = toggleCrossSellOption;
window.debugTariffDisplay = debugTariffDisplay;
window.localQuickFilter = localQuickFilter;
window.globalQuickFilter = globalQuickFilter;

// Smartphone booking functions
window.selectPhoneCategory = selectPhoneCategory;
window.backToPhoneCategories = backToPhoneCategories;
window.selectPhoneModel = selectPhoneModel;
window.backToPhoneModels = backToPhoneModels;
window.selectPhoneStorage = selectPhoneStorage;
window.backToPhoneStorage = backToPhoneStorage;
window.selectPhoneColor = selectPhoneColor;
window.changeSelectedPhone = changeSelectedPhone;
window.toggleProviderSection = toggleProviderSection;
window.setGlobalFilter = setGlobalFilter;
window.performGlobalSearch = performGlobalSearch;

// === GLOBAL FILTERS AND DISPLAY FUNCTIONS ===

function clearGlobalFilters() {
    // Reset global filters
    globalFilters = {
        category: 'all',
        price: 'all', 
        data: 'all',
        provision: 'all'
    };
    
    // Reset UI
    document.querySelectorAll('#category-all .filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Activate "all" buttons
    document.querySelectorAll('#category-all [data-value="all"]').forEach(btn => {
        btn.classList.add('active');
    });
}

function applyGlobalFilters() {
    if (allGlobalTariffs.length === 0) return;
    
    // Check if any filters are active
    const hasActiveFilters = Object.values(globalFilters).some(value => value !== 'all');
    
    if (!hasActiveFilters) {
        // No filters active - show all tariffs
        filteredGlobalTariffs = [...allGlobalTariffs];
    } else {
        // Apply filters
        filteredGlobalTariffs = allGlobalTariffs.filter(tariff => {
            return matchesGlobalFilters(tariff);
        });
    }
}

function matchesGlobalFilters(tariff) {
    // Price filter
    if (globalFilters.price !== 'all') {
        if (!matchesPriceFilter(tariff, globalFilters.price)) return false;
    }
    
    // Data volume filter  
    if (globalFilters.data !== 'all') {
        if (!matchesDataFilter(tariff, globalFilters.data)) return false;
    }
    
    // Provision filter
    if (globalFilters.provision !== 'all') {
        if (!matchesProvisionFilter(tariff, globalFilters.provision)) return false;
    }
    
    return true;
}

function displayGlobalResults() {
    console.log('displayGlobalResults called');
    
    const container = document.getElementById('global-results-grid');
    if (!container) {
        console.error('Container global-results-grid not found!');
        return;
    }
    
    // Force load data if empty
    if (allGlobalTariffs.length === 0) {
        console.log('No global tariffs loaded, loading now...');
        loadAllGlobalTariffs();
    }
    
    if (filteredGlobalTariffs.length === 0) {
        console.log('No filtered tariffs available');
        container.innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <i class="fas fa-info-circle" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                <h3>Keine Tariffe gefunden</h3>
                <p>Versuchen Sie andere Filtereinstellungen.</p>
                <p><small>Debug: ${allGlobalTariffs.length} Tariffe geladen</small></p>
            </div>
        `;
        return;
    }
    
    console.log('Displaying', filteredGlobalTariffs.length, 'tariffs');
    
    // Group tariffs by provider
    const groupedTariffs = {};
    filteredGlobalTariffs.forEach(tariff => {
        if (!groupedTariffs[tariff.provider]) {
            groupedTariffs[tariff.provider] = [];
        }
        groupedTariffs[tariff.provider].push(tariff);
    });
    
    // Generate collapsible sections for each provider
    let html = '';
    Object.entries(groupedTariffs).forEach(([providerKey, tariffs]) => {
        const providerName = getProviderDisplayName(providerKey);
        const tariffCount = tariffs.length;
        const providerClass = getProviderClass(providerKey);
        
        // Create tariff cards with 'all' category to show provider labels
        const tariffsHTML = tariffs.map(tariff => 
            createTariffCardHTML({...tariff, category: 'all'}, 'all', tariff.provider, false)
        ).join('');
        
        html += `
            <div class="provider-section">
                <div class="provider-header ${providerClass}" onclick="toggleProviderSection('${providerKey}')">
                    <div class="provider-info">
                        <i class="fas fa-chevron-down provider-toggle" id="toggle-${providerKey}"></i>
                        <span class="provider-name">${providerName}</span>
                        <span class="provider-count">(${tariffCount} ${tariffCount === 1 ? 'Tarif' : 'Tarife'})</span>
                    </div>
                </div>
                <div class="provider-tariffs" id="tariffs-${providerKey}">
                    <div class="tariffs-grid">
                        ${tariffsHTML}
                    </div>
                </div>
            </div>
        `;
    });
    
    console.log('Generated HTML length:', html.length);
    container.innerHTML = html;
    
    // Update count
    updateGlobalResultsCount();
}

function globalQuickFilter(type) {
    console.log('Global Quick Filter:', type, 'with', allGlobalTariffs.length, 'available tariffs');
    
    if (allGlobalTariffs.length === 0) {
        console.log('No global tariffs available! Loading...');
        loadAllGlobalTariffs();
        return;
    }
    
    let resultTariffs = [];
    
    switch (type) {
        case 'best-provision':
            resultTariffs = getTopTariffsByProvision(allGlobalTariffs, 10);
            break;
        case 'best-price':
            resultTariffs = getTopTariffsByPrice(allGlobalTariffs, 10);
            break;
        case 'high-data':
            resultTariffs = getTopHighDataTariffs(allGlobalTariffs, 10);
            break;
        case 'unlimited':
            resultTariffs = getTopUnlimitedTariffs(allGlobalTariffs, 10);
            break;
        default:
            resultTariffs = [...allGlobalTariffs];
    }
    
    // Set filtered results and display
    filteredGlobalTariffs = resultTariffs;
    displayGlobalResults();
    updateGlobalResultsCount();
}

function updateGlobalFilterUI() {
    // Update filter button states for global view
    Object.entries(globalFilters).forEach(([filterType, value]) => {
        // Reset all buttons for this filter type
        document.querySelectorAll(`#category-all [data-filter="${filterType}"]`).forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Activate the selected button
        const activeBtn = document.querySelector(`#category-all [data-filter="${filterType}"][data-value="${value}"]`);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
    });
}

function toggleProviderSection(providerKey) {
    const tariffsSection = document.getElementById(`tariffs-${providerKey}`);
    const toggleIcon = document.getElementById(`toggle-${providerKey}`);
    
    if (!tariffsSection || !toggleIcon) return;
    
    if (tariffsSection.style.display === 'none') {
        tariffsSection.style.display = 'block';
        toggleIcon.style.transform = 'rotate(0deg)';
    } else {
        tariffsSection.style.display = 'none';
        toggleIcon.style.transform = 'rotate(-90deg)';
    }
}

function setGlobalFilter(filterType, value) {
    // Update global filter
    globalFilters[filterType] = value;
    
    // Update UI - reset all buttons for this filter type
    document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Activate selected button
    const activeBtn = document.querySelector(`[data-filter="${filterType}"][data-value="${value}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }
    
    // Apply filters and update display
    applyGlobalFilters();
    displayGlobalResults();
    updateGlobalResultsCount();
}

function performGlobalSearch() {
    const searchInput = document.getElementById('global-search');
    if (!searchInput) return;
    
    searchQuery = searchInput.value.toLowerCase().trim();
    
    // Apply search filter to global tariffs
    if (searchQuery === '') {
        applyGlobalFilters();
    } else {
        const searchFiltered = allGlobalTariffs.filter(tariff => {
            return tariff.name.toLowerCase().includes(searchQuery) ||
                   tariff.desc.toLowerCase().includes(searchQuery) ||
                   getProviderDisplayName(tariff.provider).toLowerCase().includes(searchQuery);
        });
        
        // Then apply other filters to search results
        filteredGlobalTariffs = searchFiltered.filter(tariff => matchesGlobalFilters(tariff));
    }
    
    displayGlobalResults();
    updateGlobalResultsCount();
}

function updateGlobalResultsCount() {
    const countElement = document.getElementById('global-results-count');
    if (countElement) {
        countElement.textContent = `${filteredGlobalTariffs.length} Tarife`;
    }
}

// Helper functions for provider display
function getProviderDisplayName(providerKey) {
    // Handle composite provider keys (e.g. freenet-o2, klarmobil-vodafone)
    const providerNames = {
        'o2': 'O2',
        'freenet-o2': 'Freenet O2',
        'freenet-telekom': 'Freenet Telekom', 
        'freenet-vodafone': 'Freenet Vodafone',
        'vodafone': 'Vodafone',
        'telekom': 'Telekom',
        'ayildiz': 'Ay Yildiz',
        '1und1': '1&1',
        'yourfone': 'Yourfone',
        'klarmobil-vodafone': 'Klarmobil Vodafone',
        'klarmobil-o2': 'Klarmobil O2',
        'klarmobil-telekom': 'Klarmobil Telekom'
    };
    return providerNames[providerKey] || providerKey;
}

function getProviderClass(providerKey) {
    // Return the CSS class name for the provider
    // Map composite keys to their main provider color
    const providerClasses = {
        'o2': 'o2',
        'freenet-o2': 'freenet',
        'freenet-telekom': 'freenet',
        'freenet-vodafone': 'freenet',
        'vodafone': 'vodafone',
        'telekom': 'telekom',
        'ayildiz': 'ayildiz',
        '1und1': 'ondeone',
        'yourfone': 'yourfone',
        'klarmobil-vodafone': 'klarmobil',  // Use Klarmobil's own color
        'klarmobil-o2': 'klarmobil',        // Use Klarmobil's own color
        'klarmobil-telekom': 'klarmobil'    // Use Klarmobil's own color
    };
    return providerClasses[providerKey] || 'o2'; // Default to O2 color
}

// Clean grouped list for "Alle Tariffe" - with provider headers
function showAllTariffsContent() {
    const container = document.getElementById('global-results-grid');
    if (!container) return;
    
    // Remove any existing grid classes and reset
    container.className = 'provider-groups-container';
    
    let html = '';
    let totalTariffs = 0;
    
    // Go through each SIM-only provider and create sections
    Object.entries(tariffData['sim-only']).forEach(([providerKey, tariffs]) => {
        const providerName = getProviderDisplayName(providerKey);
        const providerClass = getProviderClass(providerKey);
        totalTariffs += tariffs.length;
        
        // Create tariff cards for this provider (maintain original order)
        const tariffsHtml = tariffs.map((tariff, index) => {
            const tariffId = tariff.name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
            
            return `
                <div class="simple-tariff-card" onclick="selectTariff('all', '${tariffId}', '${tariff.price}', '${tariff.provision}', '${providerKey}')">
                    <h3 class="card-title">${cleanTariffName(tariff.name)}</h3>
                    <p class="card-desc">${tariff.desc}</p>
                    <div class="card-pricing">
                        <div class="customer-price">
                            <span class="price-label">Kunde zahlt</span>
                            <span class="price-value">${tariff.price}â‚¬<span class="price-period">/Monat</span></span>
                        </div>
                        <div class="provision-badge">
                            <span>${tariff.provision}â‚¬</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        // Create provider section
        html += `
            <div class="provider-group">
                <h3 class="provider-header-simple ${providerClass}">${providerName}</h3>
                <div class="provider-tariffs-grid">
                    ${tariffsHtml}
                </div>
            </div>
        `;
    });
    
    // Go through Internet providers and create sections
    Object.entries(tariffData['internet']).forEach(([providerKey, tariffs]) => {
        const providerName = getProviderDisplayName(providerKey);
        const providerClass = getProviderClass(providerKey);
        totalTariffs += tariffs.length;
        
        // Create internet tariff cards with special pricing display
        const tariffsHtml = tariffs.map((tariff, index) => {
            const tariffId = tariff.name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
            const typeClass = tariff.type.toLowerCase();
            const typeIcon = tariff.type === 'Glasfaser' ? 'fas fa-bolt' : 'fas fa-ethernet';
            
            return `
                <div class="simple-tariff-card internet-card" onclick="selectInternetTariff('${tariffId}', '${tariff.name}', '${tariff.price}', '${tariff.normalPrice}', '${tariff.provision}')">
                    <div class="card-badge ${typeClass}">
                        <i class="${typeIcon}"></i>
                        ${tariff.type}
                    </div>
                    <h3 class="card-title">${cleanTariffName(tariff.name)}</h3>
                    <p class="card-desc">${tariff.desc}</p>
                    <div class="card-pricing internet-pricing">
                        <div class="customer-price">
                            <span class="price-label">Aktion (1.-10. Monat)</span>
                            <span class="price-value">${tariff.price}â‚¬<span class="price-period">/Monat</span></span>
                            <span class="normal-price">danach ${tariff.normalPrice}â‚¬/Monat</span>
                        </div>
                        <div class="provision-badge">
                            <span>${tariff.provision}â‚¬</span>
                        </div>
                    </div>
                    <div class="setup-fee">
                        <i class="fas fa-tools"></i>
                        Einmalig: ${tariff.setupFee}â‚¬ (Router inklusive)
                    </div>
                </div>
            `;
        }).join('');
        
        // Create provider section
        html += `
            <div class="provider-group">
                <h3 class="provider-header-simple ${providerClass}">${providerName} Internet</h3>
                <div class="provider-tariffs-grid">
                    ${tariffsHtml}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
    
    // Update count
    const countElement = document.getElementById('global-results-count');
    if (countElement) {
        countElement.textContent = `${totalTariffs} Tarife`;
    }
}

// Smartphone Booking Functions
function shouldShowSmartphoneBooking() {
    // Show smartphone booking ONLY for specific providers: ayildiz, freenet, klarmobil
    if (!selectedTariffData.tariff) return false;
    
    // Check if current provider is one of the supported ones
    if (currentProvider === 'ayildiz') {
        return true;
    }
    
    if (currentProvider && (currentProvider.startsWith('freenet-') || currentProvider.startsWith('klarmobil-'))) {
        return true;
    }
    
    // For sim-only category, check if it's from supported providers
    if (selectedTariffData.category === 'sim-only') {
        return currentProvider === 'ayildiz' || 
               (currentProvider && (currentProvider.startsWith('freenet-') || currentProvider.startsWith('klarmobil-')));
    }
    
    // NEW: FÃ¼r "diese-woche" (Highlights), "neue-tariffe" (Neu) UND "alle-tariffe" - prÃ¼fe ob es Freenet/Klarmobil/Ayildiz ist
    if (selectedTariffData.category === 'diese-woche' || 
        selectedTariffData.category === 'neue-tariffe' ||
        selectedTariffData.category === 'alle-tariffe' ||
        selectedTariffData.category === 'all' ||
        currentCategory === 'alle-tariffe' ||
        currentCategory === 'all') {
        
        // âœ… KORREKTE PROVIDER-ERKENNUNG FÃœR "ALLE TARIFE"
        const providerToCheck = selectedTariffData.provider || currentProvider;
        
        console.log('ğŸ” Smartphone Booking Check - Alle Tarife:', {
            category: selectedTariffData.category,
            currentCategory: currentCategory,
            provider: providerToCheck,
            tariffId: selectedTariffData.tariff
        });
        
        // Provider-basierte Erkennung (HAUPTLOGIK)
        if (providerToCheck === 'ayildiz' || 
            (providerToCheck && (providerToCheck.startsWith('freenet-') || providerToCheck.startsWith('klarmobil-')))) {
            console.log('âœ… Smartphone Booking ERLAUBT - Provider Match:', providerToCheck);
            return true;
        }
        
        // Fallback: Tariff-ID basierte Erkennung
        const tariffId = selectedTariffData.tariff || '';
        if (tariffId.includes('freenet-') || 
            tariffId.includes('klarmobil-') || 
            tariffId.includes('ayildiz') ||
            tariffId.includes('geburtstagsaktion') ||
            tariffId.includes('o2-unlimited-max')) {
            console.log('âœ… Smartphone Booking ERLAUBT - Tariff ID Match:', tariffId);
            return true;
        }
        
        console.log('âŒ Smartphone Booking NICHT ERLAUBT - Kein Match gefunden');
    }
    
    return false;
}

// âœ… ZENTRALE SMARTPHONE BOOKING VISIBILITY UPDATE FUNKTION
// Diese Funktion wird IMMER aufgerufen nach Kategorie-Wechsel UND Tarif-Auswahl
function updateSmartphoneBookingVisibility() {
    const smartphoneSection = document.getElementById('smartphone-booking-section');
    
    if (!smartphoneSection) {
        console.log('âš ï¸ Smartphone section not found');
        return;
    }
    
    const showSmartphoneBooking = shouldShowSmartphoneBooking();
    
    console.log('ğŸ“± Smartphone booking check:', {
        currentCategory: currentCategory,
        selectedTariffData: selectedTariffData,
        currentProvider: currentProvider,
        shouldShow: showSmartphoneBooking
    });
    
    if (showSmartphoneBooking) {
        smartphoneSection.classList.remove('hidden');
        resetSmartphoneBookingUI();
        console.log('âœ… Smartphone booking section SHOWN');
    } else {
        smartphoneSection.classList.add('hidden');
        console.log('âŒ Smartphone booking section HIDDEN');
    }
}

// NEU: Direkt zum Handy+Tarif Flow navigieren (fÃ¼r Spotlight-Cards)
function goToHandyTarif(deviceName) {
    // Zur Handy+Tarif Kategorie wechseln
    showCategory('handy-tarif');
    
    // Kurze VerzÃ¶gerung damit die Kategorie geladen ist
    setTimeout(() => {
        // Apple Kategorie auswÃ¤hlen
        showHandyCategory('Apple');
        
        // Kurze VerzÃ¶gerung, dann GerÃ¤t auswÃ¤hlen
        setTimeout(() => {
            selectHandyDevice(deviceName);
        }, 100);
    }, 100);
    
    // Zur Kategorie scrollen
    document.getElementById('category-handy-tarif')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Smartphone Highlight Selection (Legacy - fÃ¼r alte Cards)
function selectSmartphoneHighlight(provider, deviceModel, tariffName, tariffDesc, basePrice, provision) {
    // Store smartphone highlight data
    window.smartphoneHighlightData = {
        provider: provider,
        deviceModel: deviceModel,
        tariffName: tariffName,
        tariffDesc: tariffDesc,
        basePrice: parseFloat(basePrice),
        provision: provision
    };
    
    // Show smartphone configuration modal
    showSmartphoneConfigModal();
}

function showSmartphoneConfigModal() {
    const data = window.smartphoneHighlightData;
    
    // Create modal HTML
    const modalHTML = `
        <div id="smartphone-config-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${data.deviceModel} + ${data.provider.toUpperCase()} ${data.tariffName}</h3>
                    <button onclick="closeSmartphoneConfigModal()" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="config-section">
                        <h4>Farbe wÃ¤hlen:</h4>
                        <div class="color-options">
                            <label><input type="radio" name="color" value="Schwarz" checked> Schwarz</label>
                            <label><input type="radio" name="color" value="WeiÃŸ"> WeiÃŸ</label>
                            <label><input type="radio" name="color" value="Blau"> Blau</label>
                            <label><input type="radio" name="color" value="Rosa"> Rosa</label>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h4>Speicher wÃ¤hlen:</h4>
                        <div class="storage-options">
                            <label><input type="radio" name="storage" value="128" data-price="0" checked> 128 GB (+0â‚¬)</label>
                            <label><input type="radio" name="storage" value="256" data-price="5"> 256 GB (+5â‚¬/Monat)</label>
                            <label><input type="radio" name="storage" value="512" data-price="10"> 512 GB (+10â‚¬/Monat)</label>
                        </div>
                    </div>
                    
                    <div class="price-summary">
                        <div class="base-price">Grundpreis: ${data.basePrice}â‚¬/Monat</div>
                        <div class="total-price">Gesamtpreis: <span id="total-price">${data.basePrice}â‚¬/Monat</span></div>
                        <div class="provision-info">Provision: ${data.provision}â‚¬</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="confirmSmartphoneSelection()" class="btn-primary">Zur KundenÃ¼bersicht</button>
                    <button onclick="closeSmartphoneConfigModal()" class="btn-secondary">Abbrechen</button>
                </div>
            </div>
        </div>
    `;
    
    // Insert modal into page
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Add event listeners for price calculation
    document.querySelectorAll('input[name="storage"]').forEach(input => {
        input.addEventListener('change', updateSmartphonePrice);
    });
}

function updateSmartphonePrice() {
    const data = window.smartphoneHighlightData;
    const storagePrice = parseFloat(document.querySelector('input[name="storage"]:checked').dataset.price);
    const totalPrice = data.basePrice + storagePrice;
    document.getElementById('total-price').textContent = `${totalPrice}â‚¬/Monat`;
}

function confirmSmartphoneSelection() {
    const data = window.smartphoneHighlightData;
    const color = document.querySelector('input[name="color"]:checked').value;
    const storage = document.querySelector('input[name="storage"]:checked').value;
    const storagePrice = parseFloat(document.querySelector('input[name="storage"]:checked').dataset.price);
    const totalPrice = data.basePrice + storagePrice;
    
    // Create tariff name with selected options
    const fullTariffName = `${data.deviceModel} ${storage}GB ${color} + ${data.provider.toUpperCase()} ${data.tariffName}`;
    
    // Close modal
    closeSmartphoneConfigModal();
    
    // Select tariff with final configuration
    selectTariff('diese-woche', fullTariffName.toLowerCase().replace(/\s+/g, '-'), totalPrice.toString(), data.provision);
}

function closeSmartphoneConfigModal() {
    const modal = document.getElementById('smartphone-config-modal');
    if (modal) {
        modal.remove();
    }
}

function resetPhoneSelection() {
    selectedPhoneData = {};
    phoneSelectionStep = 'category';
}

function resetSmartphoneBookingUI() {
    // Hide all selection steps
    document.getElementById('phone-model-selection')?.classList.add('hidden');
    document.getElementById('phone-storage-selection')?.classList.add('hidden');
    document.getElementById('phone-color-selection')?.classList.add('hidden');
    document.getElementById('selected-phone-summary')?.classList.add('hidden');
    
    // Show category selection
    document.getElementById('phone-category-selection')?.classList.remove('hidden');
    
    phoneSelectionStep = 'category';
}

function selectPhoneCategory(category) {
    selectedPhoneData.category = category;
    phoneSelectionStep = 'model';
    
    // Hide category selection, show model selection
    document.getElementById('phone-category-selection').classList.add('hidden');
    document.getElementById('phone-model-selection').classList.remove('hidden');
    
    // Update title
    document.getElementById('phone-category-title').textContent = `${category} Modell auswÃ¤hlen`;
    
    // Load phone models
    loadPhoneModels(category);
}

function loadPhoneModels(category) {
    const phones = handyData[currentPhoneProvider]?.[category] || [];
    const grid = document.getElementById('phone-models-grid');
    
    grid.innerHTML = phones.map(phone => `
        <div class="phone-model-card" onclick="selectPhoneModel('${phone.name}')">
            <h5>${phone.name}</h5>
            <p>${phone.storage.join(', ')} verfÃ¼gbar</p>
            ${phone.badge ? `<span class="phone-badge">${phone.badge}</span>` : ''}
        </div>
    `).join('');
}

function backToPhoneCategories() {
    document.getElementById('phone-model-selection').classList.add('hidden');
    document.getElementById('phone-category-selection').classList.remove('hidden');
    phoneSelectionStep = 'category';
    selectedPhoneData = {};
}

function selectPhoneModel(modelName) {
    selectedPhoneData.model = modelName;
    phoneSelectionStep = 'storage';
    
    const category = selectedPhoneData.category;
    const phone = handyData[currentPhoneProvider]?.[category]?.find(p => p.name === modelName);
    selectedPhoneData.phoneObject = phone;
    
    // Hide model selection, show storage selection
    document.getElementById('phone-model-selection').classList.add('hidden');
    document.getElementById('phone-storage-selection').classList.remove('hidden');
    
    // Update title
    document.getElementById('phone-storage-title').textContent = `${modelName} - Speicher auswÃ¤hlen`;
    
    // Load storage options
    loadStorageOptions(phone);
}

function loadStorageOptions(phone) {
    const grid = document.getElementById('phone-storage-grid');
    
    grid.innerHTML = phone.storage.map((storage, index) => {
        const price = getPhonePrice(phone, index);
        return `
            <div class="storage-option" onclick="selectPhoneStorage('${storage}', ${index})">
                <div class="storage-size">${storage}</div>
                <div class="storage-price">+${price.toFixed(2)}â‚¬/Monat</div>
            </div>
        `;
    }).join('');
}

function getPhonePrice(phone, storageIndex) {
    if (!phone.storagePrice || !phone.storagePrice[storageIndex]) {
        return 0;
    }
    
    const priceData = phone.storagePrice[storageIndex];
    
    // Handle different price formats
    if (Array.isArray(priceData)) {
        // Use first price if it's an array (legacy format)
        return parseFloat(priceData[0]) || 0;
    }
    
    // Handle simple number format (current format)
    return parseFloat(priceData) || 0;
}

function backToPhoneModels() {
    document.getElementById('phone-storage-selection').classList.add('hidden');
    document.getElementById('phone-model-selection').classList.remove('hidden');
    phoneSelectionStep = 'model';
    delete selectedPhoneData.storage;
    delete selectedPhoneData.storageIndex;
}

function selectPhoneStorage(storage, storageIndex) {
    selectedPhoneData.storage = storage;
    selectedPhoneData.storageIndex = storageIndex;
    phoneSelectionStep = 'color';
    
    // Hide storage selection, show color selection
    document.getElementById('phone-storage-selection').classList.add('hidden');
    document.getElementById('phone-color-selection').classList.remove('hidden');
    
    // Update title
    document.getElementById('phone-color-title').textContent = `${selectedPhoneData.model} ${storage} - Farbe auswÃ¤hlen`;
    
    // Load color options
    loadColorOptions();
}

function loadColorOptions() {
    const phone = selectedPhoneData.phoneObject;
    const grid = document.getElementById('phone-colors-grid');
    
    grid.innerHTML = phone.colors.map(color => `
        <div class="color-option" onclick="selectPhoneColor('${color}')">
            <div class="color-name">${color}</div>
        </div>
    `).join('');
}

function backToPhoneStorage() {
    document.getElementById('phone-color-selection').classList.add('hidden');
    document.getElementById('phone-storage-selection').classList.remove('hidden');
    phoneSelectionStep = 'storage';
    delete selectedPhoneData.color;
}

function selectPhoneColor(color) {
    selectedPhoneData.color = color;
    phoneSelectionStep = 'complete';
    
    // Hide color selection, show summary
    document.getElementById('phone-color-selection').classList.add('hidden');
    document.getElementById('selected-phone-summary').classList.remove('hidden');
    
    // Update summary
    updatePhoneSummary();
    
    // Update cost overview with phone price
    updateCostOverview();
}

function updatePhoneSummary() {
    const phone = selectedPhoneData.phoneObject;
    const price = getPhonePrice(phone, selectedPhoneData.storageIndex);
    
    document.getElementById('selected-phone-name').textContent = selectedPhoneData.model;
    document.getElementById('selected-phone-details').textContent = 
        `${selectedPhoneData.storage}, ${selectedPhoneData.color}`;
    document.getElementById('selected-phone-price').textContent = 
        `+${price.toFixed(2).replace('.', ',')}â‚¬/Monat`;
}

function changeSelectedPhone() {
    // Reset to category selection
    resetSmartphoneBookingUI();
    selectedPhoneData = {};
    
    // Update cost overview without phone
    updateCostOverview();
}

// This initialization is now handled in the main DOMContentLoaded event above

// Global Filter Functions
function setGlobalFilter(filterType, value) {
    // Update global filter state
    globalFilters[filterType] = value;
    
    // Update UI - remove active class from all buttons of this type
    document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to selected button
    const selectedBtn = document.querySelector(`[data-filter="${filterType}"][data-value="${value}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
    
    // Apply global filters
    applyGlobalFilters();
    
    // Update active filters display
    updateGlobalActiveFiltersDisplay();
    
    // Update quick filter buttons
    updateQuickFilterButtons();
}

function performGlobalSearch() {
    const searchInput = document.getElementById('global-search');
    searchQuery = searchInput ? searchInput.value.toLowerCase() : '';
    
    applyGlobalFilters();
}

// ===== NEUE FILTER-FUNKTIONEN =====

// Globale Quick-Filter (fÃ¼r "Alle Tarife" Ansicht)
function globalQuickFilter(type) {
    console.log('Global Quick Filter:', type);
    
    // Filter zurÃ¼cksetzen
    clearGlobalFilters();
    
    // Alle verfÃ¼gbaren Tarife aus allGlobalTariffs nehmen
    let resultTariffs = [];
    
    switch (type) {
        case 'best-provision':
            resultTariffs = getTopTariffsByProvision(allGlobalTariffs, 10);
            console.log('Top 10 by provision:', resultTariffs.length);
            break;
        case 'best-price':
            resultTariffs = getTopTariffsByPrice(allGlobalTariffs, 10);
            console.log('Top 10 by price:', resultTariffs.length);
            break;
        case 'high-data':
            resultTariffs = getTopHighDataTariffs(allGlobalTariffs, 10);
            console.log('Top 10 high data:', resultTariffs.length);
            break;
        case 'unlimited':
            resultTariffs = getTopUnlimitedTariffs(allGlobalTariffs, 10);
            console.log('Top 10 unlimited:', resultTariffs.length);
            break;
    }
    
    // Ergebnisse setzen und anzeigen
    filteredGlobalTariffs = resultTariffs;
    displayGlobalResults();
    updateGlobalResultsCount();
    
    // Update visueller Zustand der Quick-Filter Buttons
    updateQuickFilterButtons(type);
}

// Lokale Quick-Filter (fÃ¼r einzelne Provider wie O2, Freenet etc.)
function localQuickFilter(type) {
    console.log('Local Quick Filter:', type, 'with', allTariffs.length, 'available tariffs');
    console.log('DEBUG: allTariffs sample:', allTariffs.slice(0, 3).map(t => t.name));
    
    if (allTariffs.length === 0) {
        console.log('ERROR: No allTariffs available! Try selecting a provider first.');
        return;
    }
    
    let resultTariffs = [];
    
    switch (type) {
        case 'best-provision':
            resultTariffs = getTopTariffsByProvision(allTariffs, 10);
            activeFilters = { category: 'best-provision' }; // Set active filter state
            break;
        case 'best-price':
            resultTariffs = getTopTariffsByPrice(allTariffs, 10);
            activeFilters = { category: 'best-price' }; // Set active filter state
            break;
        case 'high-data':
            resultTariffs = getTopHighDataTariffs(allTariffs, 10);
            activeFilters = { category: 'high-data' }; // Set active filter state
            break;
        case 'unlimited':
            resultTariffs = getTopUnlimitedTariffs(allTariffs, 10);
            activeFilters = { category: 'unlimited' }; // Set active filter state
            break;
        default:
        case 'all':
            // Keine Filter - alle anzeigen (sortiert nach Provision)
            resultTariffs = sortTariffsByProvision(allTariffs, true);
            activeFilters = { category: 'all' }; // Reset filter state
    }
    
    // Ergebnisse setzen und anzeigen
    filteredTariffs = resultTariffs;
    
    console.log('Filtering result:', {
        type: type,
        resultCount: filteredTariffs.length,
        activeFilters: activeFilters,
        sampleTariffs: filteredTariffs.slice(0, 3).map(t => t.name)
    });
    
    updateTariffDisplay();
    updateResultsCount();
    
    // Update provider quick filter button states
    updateProviderQuickFilterButtons(type);
}

function updateProviderQuickFilterButtons(activeType) {
    // Reset all provider quick filter buttons
    document.querySelectorAll('.provider-quick-btn, .provider-reset-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Set active button based on type
    if (activeType !== 'all') {
        const filterTypeMapping = {
            'best-provision': 'best-provision',
            'best-price': 'best-price', 
            'high-data': 'high-data',
            'unlimited': 'unlimited'
        };
        
        const mappedType = filterTypeMapping[activeType];
        if (mappedType) {
            const activeBtn = document.querySelector(`[onclick="localQuickFilter('${mappedType}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }
    } else {
        // 'all' case - activate reset button
        const resetBtn = document.querySelector(`[onclick="localQuickFilter('all')"]`);
        if (resetBtn) {
            resetBtn.classList.add('active');
        }
    }
}

function updateQuickFilterButtons(activeType) {
    // Alle Quick-Filter Buttons zurÃ¼cksetzen
    document.querySelectorAll('.quick-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Aktiven Button markieren basierend auf aktuellen Filtern
    const quickFilterMappings = {
        'best-provision': () => globalFilters.provision === '200+',
        'best-price': () => globalFilters.price === '0-15',
        'high-data': () => globalFilters.data === '51-150',
        'unlimited': () => globalFilters.data === 'unlimited'
    };
    
    // ÃœberprÃ¼fen welcher Quick-Filter aktiv ist
    Object.entries(quickFilterMappings).forEach(([type, checkFn]) => {
        if (checkFn()) {
            const btn = document.querySelector(`[onclick="globalQuickFilter('${type}')"]`);
            if (btn) btn.classList.add('active');
        }
    });
}

function clearGlobalFilters() {
    // Reset all global filters
    globalFilters = {
        category: 'all',
        price: 'all',
        data: 'all',
        provision: 'all'
    };
    
    searchQuery = '';
    
    // Reset search input
    const searchInput = document.getElementById('global-search');
    if (searchInput) {
        searchInput.value = '';
    }
    
    // Reset UI - Chips
    document.querySelectorAll('.chip').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Activate "all" chips  
    document.querySelectorAll('[data-value="all"]').forEach(btn => {
        btn.classList.add('active');
    });
    
    // Reset Quick-Filter buttons
    document.querySelectorAll('.quick-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Apply filters
    applyGlobalFilters();
    
    // Update display
    updateGlobalActiveFiltersDisplay();
}

function applyGlobalFilters() {
    if (allGlobalTariffs.length === 0) return;
    
    // Erst nach Suchbegriff filtern
    let searchFiltered = allGlobalTariffs.filter(tariff => matchesSearchQuery(tariff));
    
    // Dann nach Chip-Filtern filtern  
    filteredGlobalTariffs = searchFiltered.filter(tariff => {
        return matchesGlobalFilters(tariff);
    });
    
    // WICHTIG: Immer nach Provision sortieren (hÃ¶chste zuerst)
    filteredGlobalTariffs = sortTariffsByProvision(filteredGlobalTariffs, true);
    
    // Display filtered results
    displayGlobalResults();
    
    // Update results count
    updateGlobalResultsCount();
}

function matchesGlobalFilters(tariff) {
    // Category filter (SIM-Only focus)
    if (globalFilters.category !== 'all') {
        if (tariff.category !== globalFilters.category) return false;
    }
    
    // Price filter - NEUE IMPLEMENTIERUNG
    if (globalFilters.price !== 'all') {
        const price = getNumericPrice(tariff);
        switch (globalFilters.price) {
            case '0-15': 
                if (price > 15) return false;
                break;
            case '15-30': 
                if (price <= 15 || price > 30) return false;
                break;
            case '30+': 
                if (price <= 30) return false;
                break;
        }
    }
    
    // Data filter - NEU HINZUGEFÃœGT
    if (globalFilters.data !== 'all') {
        const dataGB = getDataVolume(tariff);
        switch (globalFilters.data) {
            case '5-20': 
                if (dataGB < 5 || dataGB > 20) return false;
                break;
            case '21-50': 
                if (dataGB < 21 || dataGB > 50) return false;
                break;
            case '51+': 
                if (dataGB < 51 && dataGB < 999) return false; // 51GB+ oder Unlimited
                break;
            case 'unlimited': 
                if (dataGB < 999) return false; // Nur Unlimited/Flat
                break;
        }
    }
    
    // Provision filter - NEUE IMPLEMENTIERUNG
    if (globalFilters.provision !== 'all') {
        const provision = getNumericProvision(tariff);
        switch (globalFilters.provision) {
            case '50+': 
                if (provision < 50) return false;
                break;
            case '100+': 
                if (provision < 100) return false;
                break;
            case '200+': 
                if (provision < 200) return false;
                break;
        }
    }
    
    return true;
}

function matchesSearchQuery(tariff) {
    if (!searchQuery) return true;
    
    const searchFields = [
        tariff.name,
        tariff.desc,
        tariff.provider,
        tariff.categoryName
    ].join(' ').toLowerCase();
    
    return searchFields.includes(searchQuery);
}

function displayGlobalResults() {
    const container = document.getElementById('global-results-grid');
    if (!container) return;
    
    if (filteredGlobalTariffs.length === 0) {
        showGlobalEmptyState(container);
    } else {
        hideGlobalEmptyState(container);
        container.innerHTML = filteredGlobalTariffs.map(tariff => createGlobalTariffCard(tariff)).join('');
        
        // Add event listeners to all tariff cards
        const tariffCards = container.querySelectorAll('.global-tariff-card');
        tariffCards.forEach(card => {
            card.addEventListener('click', function() {
                const category = this.dataset.category;
                const name = this.dataset.name;
                const price = this.dataset.price;
                const provision = this.dataset.provision;
                
                console.log('Tariff clicked:', category, name, price, provision);
                selectGlobalTariff(category, name, price, provision);
            });
        });
    }
}

function createGlobalTariffCard(tariff) {
    const providerClass = getProviderClass(tariff.provider);
    const providerName = getGlobalProviderName(tariff.provider);
    
    return `
        <div class="global-tariff-card" data-category="${tariff.category}" data-name="${tariff.name}" data-price="${tariff.price}" data-provision="${tariff.provision}">
            <div class="provider-info">
                <div class="provider-badge ${providerClass}">${providerName}</div>
            </div>
            
            <h3 class="tariff-name">${cleanTariffName(tariff.name)}</h3>
            <p class="tariff-description">${tariff.desc}</p>
            
            <div class="tariff-footer">
                <div class="price-info">
                    <span class="price-label">${tariff.category === 'strom' ? 'Angebot' : 'Monatlich'}</span>
                    <span class="price-value">${tariff.category === 'strom' ? tariff.price : tariff.price + 'â‚¬'}</span>
                </div>
                <div class="provision-info">
                    <span>${tariff.provision}â‚¬</span>
                </div>
            </div>
        </div>
    `;
}

function getGlobalProviderName(provider) {
    const providerNames = {
        'o2': 'O2',
        'freenet-o2': 'Freenet O2',
        'freenet-vodafone': 'Freenet Vodafone',
        'freenet-telekom': 'Freenet Telekom',
        'ayildiz': 'Ay Yildiz',
        '1und1': '1&1',
        'yourfone': 'Yourfone',
        'privatkunde': 'Privat',
        'gewerbekunde': 'Gewerbe'
    };
    return providerNames[provider] || provider;
}

function selectGlobalTariff(category, tariffName, price, provision) {
    console.log('selectGlobalTariff called:', category, tariffName, price, provision);
    
    // Store tariff data
    selectedTariffData = { 
        category: category, 
        tariff: tariffName, 
        price: price, 
        provision: provision 
    };
    baseProvision = parseFloat(provision.replace(',', '.'));
    
    // Show customer form directly
    const customerForm = document.getElementById('customer-form');
    const customerFormStrom = document.getElementById('customer-form-strom');
    
    // Hide all forms first
    if (customerForm) customerForm.classList.add('hidden');
    if (customerFormStrom) customerFormStrom.classList.add('hidden');
    
    if (category === 'strom') {
        if (customerFormStrom) {
            customerFormStrom.classList.remove('hidden');
            updateSelectedTariffInfoStrom();
            updateCostOverviewStrom();
            customerFormStrom.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    } else {
        if (customerForm) {
            customerForm.classList.remove('hidden');
            updateSelectedTariffInfo();
            updateCostOverview();
            customerForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}

function showGlobalEmptyState(container) {
    let emptyStateDiv = container.querySelector('.global-empty-state');
    if (!emptyStateDiv) {
        emptyStateDiv = document.createElement('div');
        emptyStateDiv.className = 'global-empty-state';
        emptyStateDiv.innerHTML = `
            <div class="global-empty-state-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3>Keine Tarife gefunden</h3>
            <p>Mit den aktuellen Filtern wurden keine passenden Tarife gefunden. Versuchen Sie andere Filtereinstellungen oder lÃ¶schen Sie die Suche.</p>
            <button class="quick-action-btn" onclick="clearGlobalFilters()">
                <i class="fas fa-refresh"></i>
                Filter zurÃ¼cksetzen
            </button>
        `;
        container.appendChild(emptyStateDiv);
    }
    emptyStateDiv.style.display = 'block';
}

function hideGlobalEmptyState(container) {
    const emptyStateDiv = container.querySelector('.global-empty-state');
    if (emptyStateDiv) {
        emptyStateDiv.style.display = 'none';
    }
}

function updateGlobalResultsCount() {
    const countElement = document.getElementById('global-results-count');
    if (countElement) {
        const count = filteredGlobalTariffs.length;
        countElement.textContent = `${count} ${count === 1 ? 'Tarif' : 'Tarife'}`;
    }
}

function updateGlobalActiveFiltersDisplay() {
    const activeFiltersContainer = document.getElementById('active-global-filters');
    if (!activeFiltersContainer) return;
    
    activeFiltersContainer.innerHTML = '';
    
    // Add search query as filter tag
    if (searchQuery) {
        const searchTag = createGlobalActiveFilterTag('search', searchQuery);
        activeFiltersContainer.appendChild(searchTag);
    }
    
    // Add other filters
    Object.entries(globalFilters).forEach(([filterType, value]) => {
        if (value !== 'all') {
            const filterTag = createGlobalActiveFilterTag(filterType, value);
            activeFiltersContainer.appendChild(filterTag);
        }
    });
}

function createGlobalActiveFilterTag(filterType, value) {
    const tag = document.createElement('div');
    tag.className = 'filter-tag';
    
    const filterNames = {
        category: 'Kategorie',
        price: 'Preis',
        data: 'Daten',
        provision: 'Provision',
        search: 'Suche'
    };
    
    const valueNames = {
        'sim-only': 'SIM Only',
        'strom': 'Strom',
        '0-15': '0-15â‚¬',
        '15-30': '15-30â‚¬',
        '30-50': '30-50â‚¬',
        '50+': '50â‚¬+',
        '5-20': '5-20 GB',
        '21-50': '21-50 GB',
        '51-150': '51-150 GB',
        'unlimited': 'Unlimited',
        '15-50': '15-50â‚¬',
        '51-100': '51-100â‚¬',
        '101-200': '101-200â‚¬',
        '200+': '200â‚¬+'
    };
    
    const displayValue = filterType === 'search' ? `"${value}"` : (valueNames[value] || value);
    
    tag.innerHTML = `
        ${filterNames[filterType]}: ${displayValue}
        <span class="remove" onclick="removeGlobalFilter('${filterType}')">
            <i class="fas fa-times"></i>
        </span>
    `;
    
    return tag;
}

function removeGlobalFilter(filterType) {
    if (filterType === 'search') {
        const searchInput = document.getElementById('global-search');
        if (searchInput) {
            searchInput.value = '';
        }
        performGlobalSearch();
    } else {
        setGlobalFilter(filterType, 'all');
    }
}

// Filter function exports
window.toggleFilters = toggleFilters;
window.setFilter = setFilter;
window.quickFilter = quickFilter;
window.clearAllFilters = clearAllFilters;
window.removeFilter = removeFilter;

// Provider utility functions
window.getProviderDisplayName = getProviderDisplayName;

// Global filter function exports
window.setGlobalFilter = setGlobalFilter;
window.performGlobalSearch = performGlobalSearch;
window.globalQuickFilter = globalQuickFilter;
window.clearGlobalFilters = clearGlobalFilters;
window.removeGlobalFilter = removeGlobalFilter;
window.selectGlobalTariff = selectGlobalTariff;
window.updateQuickFilterButtons = updateQuickFilterButtons;

// Email validation functions
window.validatePartnerEmail = validatePartnerEmail;
window.handleEmailKeyup = handleEmailKeyup;

// ğŸ WHAT'S NEW - Scroll to Tariffs
window.scrollToTariffs = scrollToTariffs;
window.dismissWhatsNew = dismissWhatsNew;

function scrollToTariffs() {
    const tariffsSection = document.querySelector('.spotlight-section') || document.querySelector('.tariffs-section');
    if (tariffsSection) {
        tariffsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function dismissWhatsNew() {
    const banner = document.getElementById('whatsNewBanner');
    if (banner) {
        banner.style.animation = 'fadeOutUp 0.5s ease forwards';
        setTimeout(() => {
            banner.style.display = 'none';
            localStorage.setItem('whatsNewDismissed', new Date().toISOString());
        }, 500);
    }
}

// Check if What's New was dismissed today
document.addEventListener('DOMContentLoaded', function() {
    const dismissed = localStorage.getItem('whatsNewDismissed');
    if (dismissed) {
        const dismissedDate = new Date(dismissed);
        const today = new Date();
        // Show again after 7 days
        if ((today - dismissedDate) < (7 * 24 * 60 * 60 * 1000)) {
            const banner = document.getElementById('whatsNewBanner');
            if (banner) banner.style.display = 'none';
        }
    }
});

// Email Validation System
async function validatePartnerEmail() {
    const emailInput = document.getElementById('partnerEmail');
    const validationBtn = document.getElementById('emailValidationBtn');
    const validationStatus = document.getElementById('emailValidationStatus');
    
    if (!emailInput || !validationBtn || !validationStatus) return;
    
    const email = emailInput.value.trim();
    
    // Basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (!email) {
        showValidationError('Bitte geben Sie eine E-Mail-Adresse ein');
        return;
    }
    
    if (!emailRegex.test(email)) {
        showValidationError('Bitte geben Sie eine gÃ¼ltige E-Mail-Adresse ein');
        return;
    }
    
    // Validate with database
    validationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>PrÃ¼fen...</span>';
    validationBtn.disabled = true;
    
    try {
        // Check if partner exists in database
        const response = await fetch(`tables/partners?email=${encodeURIComponent(email)}&limit=1`);
        
        if (response.ok) {
            const result = await response.json();
            
            if (result.data && result.data.length > 0) {
                const partner = result.data[0];
                validatedPartnerName = `${partner.vorname || ''} ${partner.nachname || ''}`.trim();
                
                // Success - partner found
                showValidationSuccess(email);
                
                // Store email for later use
                localStorage.setItem('partnerEmail', email);
                localStorage.setItem('partnerName', validatedPartnerName);
                
                // Update all forms with this email
                updateFormsWithPartnerEmail(email);
            } else {
                // Partner not found - still allow for demo purposes
                showValidationSuccess(email);
                validatedPartnerName = 'Partner';
                
                localStorage.setItem('partnerEmail', email);
                updateFormsWithPartnerEmail(email);
            }
        } else {
            // API error - still allow for demo purposes
            showValidationSuccess(email);
            validatedPartnerName = 'Partner';
            
            localStorage.setItem('partnerEmail', email);
            updateFormsWithPartnerEmail(email);
        }
    } catch (error) {
        console.error('Error validating partner email:', error);
        // Still allow for demo purposes
        showValidationSuccess(email);
        validatedPartnerName = 'Partner';
        
        localStorage.setItem('partnerEmail', email);
        updateFormsWithPartnerEmail(email);
    }
}

function handleEmailKeyup(event) {
    if (event.key === 'Enter') {
        validatePartnerEmail();
    }
    
    // Reset validation state when user types
    const validationBtn = document.getElementById('emailValidationBtn');
    const validationStatus = document.getElementById('emailValidationStatus');
    
    if (validationBtn && validationStatus) {
        validationBtn.style.display = 'flex';
        validationStatus.classList.add('hidden');
        validationBtn.innerHTML = '<i class="fas fa-check"></i><span>Freischalten</span>';
        validationBtn.disabled = false;
        validationBtn.classList.remove('success');
    }
}

function showValidationSuccess(email) {
    const validationBtn = document.getElementById('emailValidationBtn');
    const validationStatus = document.getElementById('emailValidationStatus');
    const messageDiv = document.getElementById('emailRequiredMessage');
    
    // Hide button and show success status
    validationBtn.style.display = 'none';
    validationStatus.classList.remove('hidden', 'error');
    validationStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>E-Mail freigeschaltet</span>';
    
    // Hide warning message
    if (messageDiv) {
        messageDiv.style.display = 'none';
    }
    
    // Mark as validated
    isPartnerEmailValidated = true;
    validatedPartnerEmail = email;
    
    // Show success notification
    showNotification('E-Mail erfolgreich freigeschaltet! Sie kÃ¶nnen jetzt Tarife auswÃ¤hlen.', 'success');
}

function showValidationError(message) {
    const validationBtn = document.getElementById('emailValidationBtn');
    const validationStatus = document.getElementById('emailValidationStatus');
    
    // Show error status
    validationBtn.style.display = 'none';
    validationStatus.classList.remove('hidden');
    validationStatus.classList.add('error');
    validationStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Fehler</span>';
    
    // Show error notification
    showNotification(message, 'error');
    
    // Reset after 3 seconds
    setTimeout(() => {
        validationBtn.style.display = 'flex';
        validationStatus.classList.add('hidden');
        validationBtn.innerHTML = '<i class="fas fa-check"></i><span>Freischalten</span>';
        validationBtn.disabled = false;
    }, 3000);
}

function updateFormsWithPartnerEmail(email) {
    // Update all partner email fields in forms
    const partnerEmailFields = document.querySelectorAll('[name="Partner_E-Mail"], .form-partner-email-strom');
    partnerEmailFields.forEach(field => {
        field.value = email;
    });
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        <span>${message}</span>
    `;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Remove after 4 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => document.body.removeChild(notification), 300);
    }, 4000);
}

// ==================== IBAN VALIDATION ====================

/**
 * IBAN Validation Function
 * Validates IBAN using ISO 13616 standard (Mod-97 algorithm)
 * Supports all SEPA countries
 */
function validateIBAN(input) {
    const value = input.value.replace(/\s/g, '').toUpperCase();
    const feedbackId = input.id === 'iban-input-strom' ? 'iban-feedback-strom' : 'iban-feedback';
    const iconId = input.id === 'iban-input-strom' ? 'iban-validation-icon-strom' : 'iban-validation-icon';
    const feedbackDiv = document.getElementById(feedbackId);
    const iconDiv = document.getElementById(iconId);
    
    // Auto-format: Add spaces every 4 characters
    if (value.length > 0) {
        const formatted = value.match(/.{1,4}/g)?.join(' ') || value;
        if (input.value !== formatted) {
            const cursorPos = input.selectionStart;
            input.value = formatted;
            // Adjust cursor position after formatting
            const oldLength = value.length;
            const newLength = formatted.replace(/\s/g, '').length;
            if (oldLength === newLength) {
                input.setSelectionRange(cursorPos + (formatted.length - value.length), cursorPos + (formatted.length - value.length));
            }
        }
    }
    
    // Clear validation if empty
    if (value.length === 0) {
        input.classList.remove('valid', 'invalid');
        iconDiv.classList.remove('valid', 'invalid');
        feedbackDiv.classList.remove('valid', 'invalid');
        feedbackDiv.style.display = 'none';
        return;
    }
    
    // Validate IBAN
    const isValid = validateIBANChecksum(value);
    const ibanInfo = getIBANInfo(value);
    
    if (isValid && ibanInfo.isValidLength) {
        // Valid IBAN
        input.classList.remove('invalid');
        input.classList.add('valid');
        iconDiv.classList.remove('invalid');
        iconDiv.classList.add('valid');
        feedbackDiv.classList.remove('invalid');
        feedbackDiv.classList.add('valid');
        feedbackDiv.innerHTML = `<i class="fas fa-check-circle"></i> GÃ¼ltige ${ibanInfo.country} IBAN (${ibanInfo.countryName})`;
        feedbackDiv.style.display = 'block';
    } else {
        // Invalid IBAN
        input.classList.remove('valid');
        input.classList.add('invalid');
        iconDiv.classList.remove('valid');
        iconDiv.classList.add('invalid');
        feedbackDiv.classList.remove('valid');
        feedbackDiv.classList.add('invalid');
        
        if (!ibanInfo.isValidLength && value.length >= 2) {
            feedbackDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> UngÃ¼ltige LÃ¤nge fÃ¼r ${ibanInfo.country} IBAN (erwartet: ${ibanInfo.expectedLength} Zeichen)`;
        } else if (value.length >= 15) {
            feedbackDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> UngÃ¼ltige IBAN - PrÃ¼fsumme stimmt nicht';
        } else {
            feedbackDiv.innerHTML = '<i class="fas fa-info-circle"></i> Bitte vollstÃ¤ndige IBAN eingeben';
        }
        feedbackDiv.style.display = 'block';
    }
}

/**
 * Validates IBAN checksum using Mod-97 algorithm
 */
function validateIBANChecksum(iban) {
    const trimmedIban = iban.replace(/\s/g, '').toUpperCase();
    
    // Check basic format (at least 15 characters, starts with 2 letters)
    if (!/^[A-Z]{2}\d{2}[A-Z0-9]+$/.test(trimmedIban) || trimmedIban.length < 15) {
        return false;
    }
    
    // Move first 4 characters to end
    const rearranged = trimmedIban.slice(4) + trimmedIban.slice(0, 4);
    
    // Replace letters with numbers (A=10, B=11, ..., Z=35)
    const numericString = rearranged.replace(/[A-Z]/g, (char) => char.charCodeAt(0) - 55);
    
    // Calculate mod 97
    let remainder = '';
    for (let i = 0; i < numericString.length; i++) {
        remainder += numericString[i];
        if (remainder.length >= 9) {
            remainder = (parseInt(remainder, 10) % 97).toString();
        }
    }
    
    return parseInt(remainder, 10) % 97 === 1;
}

/**
 * Get IBAN country info and validate length
 */
function getIBANInfo(iban) {
    const countryCode = iban.substring(0, 2).toUpperCase();
    const ibanLengths = {
        'AD': 24, 'AE': 23, 'AL': 28, 'AT': 20, 'AZ': 28, 'BA': 20, 'BE': 16,
        'BG': 22, 'BH': 22, 'BR': 29, 'BY': 28, 'CH': 21, 'CR': 22, 'CY': 28,
        'CZ': 24, 'DE': 22, 'DK': 18, 'DO': 28, 'EE': 20, 'EG': 29, 'ES': 24,
        'FI': 18, 'FO': 18, 'FR': 27, 'GB': 22, 'GE': 22, 'GI': 23, 'GL': 18,
        'GR': 27, 'GT': 28, 'HR': 21, 'HU': 28, 'IE': 22, 'IL': 23, 'IS': 26,
        'IT': 27, 'JO': 30, 'KW': 30, 'KZ': 20, 'LB': 28, 'LC': 32, 'LI': 21,
        'LT': 20, 'LU': 20, 'LV': 21, 'MC': 27, 'MD': 24, 'ME': 22, 'MK': 19,
        'MR': 27, 'MT': 31, 'MU': 30, 'NL': 18, 'NO': 15, 'PK': 24, 'PL': 28,
        'PS': 29, 'PT': 25, 'QA': 29, 'RO': 24, 'RS': 22, 'SA': 24, 'SE': 24,
        'SI': 19, 'SK': 24, 'SM': 27, 'TN': 24, 'TR': 26, 'UA': 29, 'VA': 22,
        'VG': 24, 'XK': 20
    };
    
    const countryNames = {
        'DE': 'Deutschland', 'AT': 'Ã–sterreich', 'CH': 'Schweiz', 'FR': 'Frankreich',
        'IT': 'Italien', 'ES': 'Spanien', 'NL': 'Niederlande', 'BE': 'Belgien',
        'LU': 'Luxemburg', 'GB': 'GroÃŸbritannien', 'IE': 'Irland', 'PL': 'Polen',
        'CZ': 'Tschechien', 'DK': 'DÃ¤nemark', 'SE': 'Schweden', 'NO': 'Norwegen'
    };
    
    const expectedLength = ibanLengths[countryCode] || 0;
    const currentLength = iban.replace(/\s/g, '').length;
    
    return {
        country: countryCode,
        countryName: countryNames[countryCode] || countryCode,
        expectedLength: expectedLength,
        currentLength: currentLength,
        isValidLength: expectedLength > 0 && currentLength === expectedLength
    };
}

// ==================== END IBAN VALIDATION ====================

function checkSavedPartnerEmail() {
    const savedEmail = localStorage.getItem('partnerEmail');
    const savedName = localStorage.getItem('partnerName');
    
    console.log('ğŸ” checkSavedPartnerEmail:', savedEmail, savedName);
    
    if (savedEmail) {
        const emailInput = document.getElementById('partnerEmail');
        if (emailInput) {
            emailInput.value = savedEmail;
        }
        
        // âœ… SOFORT setzen - nicht warten!
        validatedPartnerEmail = savedEmail;
        validatedPartnerName = savedName || 'Partner';
        isPartnerEmailValidated = true;
        
        console.log('âœ… Partner-Email aus localStorage geladen:', validatedPartnerEmail);
        console.log('ğŸ”‘ validatedPartnerEmail ist jetzt:', validatedPartnerEmail);
        
        // UI Update nach kurzer VerzÃ¶gerung
        setTimeout(() => showValidationSuccess(savedEmail), 500);
    } else {
        console.warn('âš ï¸ WARNUNG: Keine Partner-Email in localStorage gefunden!');
        console.log('ğŸ“Œ localStorage Keys:', Object.keys(localStorage));
    }
}

// ğŸ†• Hilfsfunktion: Aktuelle Partner-Email abrufen (mit Fallbacks)
function getPartnerEmail() {
    const email = validatedPartnerEmail || localStorage.getItem('partnerEmail') || '';
    console.log('ğŸ“§ getPartnerEmail() aufgerufen:', email);
    return email;
}

// Contact Menu Functions
function toggleContactMenu() {
    const menu = document.getElementById('contactMenu');
    menu.classList.toggle('active');
    
    // Close when clicking outside
    setTimeout(() => {
        document.addEventListener('click', closeContactOnOutsideClick);
    }, 100);
}

function closeContactOnOutsideClick(event) {
    const menu = document.getElementById('contactMenu');
    const dropdown = document.querySelector('.contact-dropdown');
    
    if (!dropdown.contains(event.target)) {
        menu.classList.remove('active');
        document.removeEventListener('click', closeContactOnOutsideClick);
    }
}

// Internet Tariff Functions
function updateSelectedTariffInfoInternet() {
    const element = document.getElementById('selected-tariff-info');
    if (element && selectedTariffData) {
        element.innerHTML = `
            <div class="selected-tariff-card">
                <div class="tariff-badge internet">
                    <i class="fas fa-wifi"></i>
                    Internet
                </div>
                <h3>${selectedTariffData.tariffName}</h3>
                <p>Aktion: ${selectedTariffData.price}â‚¬/Monat (1.-10. Monat)</p>
                <p>Danach: ${selectedTariffData.normalPrice}â‚¬/Monat</p>
            </div>
        `;
    }
}

function updateCostOverviewInternet() {
    const monthlyCosts = document.getElementById('monthly-costs');
    const currentProvision = document.getElementById('current-provision');
    
    if (monthlyCosts && selectedTariffData) {
        monthlyCosts.innerHTML = `
            <div class="cost-item">
                <span class="cost-label">Aktionspreis (1.-10. Monat):</span>
                <span class="cost-value">${selectedTariffData.price}â‚¬</span>
            </div>
            <div class="cost-item">
                <span class="cost-label">RegulÃ¤rer Preis (ab 11. Monat):</span>
                <span class="cost-value">${selectedTariffData.normalPrice}â‚¬</span>
            </div>
            <div class="cost-item setup">
                <span class="cost-label">Einmalige Kosten (Router inkl.):</span>
                <span class="cost-value">29,99â‚¬</span>
            </div>
        `;
    }
    
    if (currentProvision && selectedTariffData) {
        const provision = parseFloat(selectedTariffData.provision.replace(',', '.'));
        currentProvision.textContent = `${provision.toFixed(2).replace('.', ',')} â‚¬`;
    }
    
    // Show cost overview
    const costOverview = document.getElementById('cost-overview');
    if (costOverview) {
        costOverview.classList.remove('hidden');
    }
}

function showInternetFormFields() {
    const internetFields = document.getElementById('internet-form-fields');
    if (internetFields) {
        internetFields.classList.remove('hidden');
    }
}

function updateRequiredFieldsByCategory(category) {
    // Remove required from ALL form fields first
    document.querySelectorAll('#customer-data-form [required], #customer-data-form-strom [required]').forEach(field => {
        field.removeAttribute('required');
    });
    
    // Set required for basic fields that are always needed
    const basicFields = [
        'select[name="Anrede"]',
        'input[name="Vorname"]', 
        'input[name="Nachname"]',
        'input[name="Email"]',
        'input[name="Telefon"]',
        'input[name="Strasse"]',
        'input[name="PLZ"]',
        'input[name="Ort"]'
    ];
    
    basicFields.forEach(selector => {
        const field = document.querySelector(selector);
        if (field) field.setAttribute('required', 'true');
    });
    
    // Category specific required fields
    if (category === 'internet') {
        const internetField = document.querySelector('select[name="Anschluss_Art"]');
        if (internetField) internetField.setAttribute('required', 'true');
    }
    
    console.log('Updated required fields for category:', category);
}

function updateInternetFieldsVisibility(category) {
    const internetFields = document.getElementById('internet-specific-fields');
    if (internetFields) {
        if (category === 'internet') {
            internetFields.classList.remove('hidden');
            console.log('Internet fields shown for Internet category');
        } else {
            internetFields.classList.add('hidden');
            // Reset Internet field values when hidden
            const anschlussArt = document.querySelector('select[name="Anschluss_Art"]');
            if (anschlussArt) anschlussArt.value = '';
            
            const schaltungsterminRadios = document.querySelectorAll('input[name="Schaltungstermin"]');
            schaltungsterminRadios.forEach(radio => radio.checked = false);
            
            const wunschterminField = document.getElementById('wunschtermin-field');
            if (wunschterminField) wunschterminField.value = '';
            
            console.log('Internet fields hidden for non-Internet category:', category);
        }
    }
}

function toggleInternetWechselFields() {
    const anschlussArt = document.querySelector('select[name="Anschluss_Art"]').value;
    const wechselFields = document.getElementById('wechsel-fields');
    
    if (wechselFields) {
        if (anschlussArt === 'wechsel') {
            wechselFields.classList.remove('hidden');
            // Make fields required
            const requiredFields = wechselFields.querySelectorAll('select[name="Bisheriger_Anbieter"], input[name="Vertragsende"]');
            requiredFields.forEach(field => field.required = true);
        } else {
            wechselFields.classList.add('hidden');
            // Remove required attribute
            const fields = wechselFields.querySelectorAll('select, input');
            fields.forEach(field => {
                field.required = false;
                field.value = '';
            });
        }
    }
}

function toggleWunschtermin(showWunschtermin) {
    const wunschterminField = document.getElementById('wunschtermin-field');
    if (wunschterminField) {
        if (showWunschtermin) {
            wunschterminField.classList.remove('hidden');
            wunschterminField.required = true;
        } else {
            wunschterminField.classList.add('hidden');
            wunschterminField.required = false;
            wunschterminField.value = '';
        }
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ RUFNUMMERNPORTIERUNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function toggleRufnummernportierung(showPortierung) {
    const portierungDetails = document.getElementById('rufnummernportierung-details');
    const rufnummerField = document.getElementById('rufnummer-field');
    const anbieterField = document.getElementById('anbieter-field');
    const portierungsterminField = document.getElementById('portierungstermin-field');
    
    if (portierungDetails) {
        if (showPortierung) {
            portierungDetails.classList.remove('hidden');
            if (rufnummerField) rufnummerField.required = true;
            if (anbieterField) anbieterField.required = true;
            if (portierungsterminField) {
                portierungsterminField.required = true;
                // Set minimum date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const minDate = tomorrow.toISOString().split('T')[0];
                portierungsterminField.setAttribute('min', minDate);
            }
        } else {
            portierungDetails.classList.add('hidden');
            if (rufnummerField) {
                rufnummerField.required = false;
                rufnummerField.value = '';
            }
            if (anbieterField) {
                anbieterField.required = false;
                anbieterField.value = '';
            }
            if (portierungsterminField) {
                portierungsterminField.required = false;
                portierungsterminField.value = '';
            }
        }
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœï¸ DIGITALE UNTERSCHRIFT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let signatureCanvas, signatureCanvasStrom;
let signatureCtx, signatureCtxStrom;
let isDrawing = false;
let isDrawingStrom = false;

// Initialize signature canvases when DOM is loaded
window.addEventListener('DOMContentLoaded', () => {
    // Mobilfunk signature canvas
    signatureCanvas = document.getElementById('signature-canvas');
    if (signatureCanvas) {
        signatureCtx = signatureCanvas.getContext('2d');
        signatureCtx.strokeStyle = '#000000';
        signatureCtx.lineWidth = 2;
        signatureCtx.lineCap = 'round';
        signatureCtx.lineJoin = 'round';
        
        // Mouse events
        signatureCanvas.addEventListener('mousedown', startDrawing);
        signatureCanvas.addEventListener('mousemove', draw);
        signatureCanvas.addEventListener('mouseup', stopDrawing);
        signatureCanvas.addEventListener('mouseleave', stopDrawing);
        
        // Touch events for mobile
        signatureCanvas.addEventListener('touchstart', handleTouchStart);
        signatureCanvas.addEventListener('touchmove', handleTouchMove);
        signatureCanvas.addEventListener('touchend', stopDrawing);
    }
    
    // Strom signature canvas
    signatureCanvasStrom = document.getElementById('signature-canvas-strom');
    if (signatureCanvasStrom) {
        signatureCtxStrom = signatureCanvasStrom.getContext('2d');
        signatureCtxStrom.strokeStyle = '#000000';
        signatureCtxStrom.lineWidth = 2;
        signatureCtxStrom.lineCap = 'round';
        signatureCtxStrom.lineJoin = 'round';
        
        // Mouse events
        signatureCanvasStrom.addEventListener('mousedown', startDrawingStrom);
        signatureCanvasStrom.addEventListener('mousemove', drawStrom);
        signatureCanvasStrom.addEventListener('mouseup', stopDrawingStrom);
        signatureCanvasStrom.addEventListener('mouseleave', stopDrawingStrom);
        
        // Touch events for mobile
        signatureCanvasStrom.addEventListener('touchstart', handleTouchStartStrom);
        signatureCanvasStrom.addEventListener('touchmove', handleTouchMoveStrom);
        signatureCanvasStrom.addEventListener('touchend', stopDrawingStrom);
    }
});

// Mobilfunk signature functions
function startDrawing(e) {
    isDrawing = true;
    const rect = signatureCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    signatureCtx.beginPath();
    signatureCtx.moveTo(x, y);
}

function draw(e) {
    if (!isDrawing) return;
    const rect = signatureCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    signatureCtx.lineTo(x, y);
    signatureCtx.stroke();
    updateSignatureData();
}

function stopDrawing() {
    if (isDrawing) {
        isDrawing = false;
        updateSignatureData();
    }
}

function handleTouchStart(e) {
    e.preventDefault();
    const touch = e.touches[0];
    const mouseEvent = new MouseEvent('mousedown', {
        clientX: touch.clientX,
        clientY: touch.clientY
    });
    signatureCanvas.dispatchEvent(mouseEvent);
}

function handleTouchMove(e) {
    e.preventDefault();
    const touch = e.touches[0];
    const mouseEvent = new MouseEvent('mousemove', {
        clientX: touch.clientX,
        clientY: touch.clientY
    });
    signatureCanvas.dispatchEvent(mouseEvent);
}

function updateSignatureData() {
    const signatureData = signatureCanvas.toDataURL('image/png');
    document.getElementById('signature-data').value = signatureData;
    document.getElementById('signature-status-text').value = 'âœ… Digitale Unterschrift wurde erfasst und validiert | Status: Vom Kunden digital signiert | Die Unterschrift liegt im System vor';
    document.getElementById('signature-status').textContent = 'âœ“ Unterschrift vorhanden';
    document.getElementById('signature-status').style.color = '#34c759';
}

function clearSignature() {
    signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    document.getElementById('signature-data').value = '';
    document.getElementById('signature-status-text').value = '';
    document.getElementById('signature-status').textContent = 'âš  Bitte unterschreiben Sie';
    document.getElementById('signature-status').style.color = '#ff3b30';
}

// Strom signature functions
function startDrawingStrom(e) {
    isDrawingStrom = true;
    const rect = signatureCanvasStrom.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    signatureCtxStrom.beginPath();
    signatureCtxStrom.moveTo(x, y);
}

function drawStrom(e) {
    if (!isDrawingStrom) return;
    const rect = signatureCanvasStrom.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    signatureCtxStrom.lineTo(x, y);
    signatureCtxStrom.stroke();
    updateSignatureDataStrom();
}

function stopDrawingStrom() {
    if (isDrawingStrom) {
        isDrawingStrom = false;
        updateSignatureDataStrom();
    }
}

function handleTouchStartStrom(e) {
    e.preventDefault();
    const touch = e.touches[0];
    const mouseEvent = new MouseEvent('mousedown', {
        clientX: touch.clientX,
        clientY: touch.clientY
    });
    signatureCanvasStrom.dispatchEvent(mouseEvent);
}

function handleTouchMoveStrom(e) {
    e.preventDefault();
    const touch = e.touches[0];
    const mouseEvent = new MouseEvent('mousemove', {
        clientX: touch.clientX,
        clientY: touch.clientY
    });
    signatureCanvasStrom.dispatchEvent(mouseEvent);
}

function updateSignatureDataStrom() {
    const signatureData = signatureCanvasStrom.toDataURL('image/png');
    document.getElementById('signature-data-strom').value = signatureData;
    document.getElementById('signature-status-text-strom').value = 'âœ… Digitale Unterschrift wurde erfasst und validiert | Status: Vom Kunden digital signiert | Die Unterschrift liegt im System vor';
    document.getElementById('signature-status-strom').textContent = 'âœ“ Unterschrift vorhanden';
    document.getElementById('signature-status-strom').style.color = '#34c759';
}

function clearSignatureStrom() {
    signatureCtxStrom.clearRect(0, 0, signatureCanvasStrom.width, signatureCanvasStrom.height);
    document.getElementById('signature-data-strom').value = '';
    document.getElementById('signature-status-text-strom').value = '';
    document.getElementById('signature-status-strom').textContent = 'âš  Bitte unterschreiben Sie';
    document.getElementById('signature-status-strom').style.color = '#ff3b30';
}

// ====================================
// ğŸ†• FEATURE #1: Automatisches Setzen "erster_vertrag_abgeschlossen"
// ====================================

/**
 * PrÃ¼ft ob dies der erste Vertrag des Partners ist und setzt entsprechendes Flag
 * @param {string} partnerEmail - E-Mail des Partners
 */
async function checkAndSetFirstContract(partnerEmail) {
    if (!partnerEmail) {
        console.log('âš ï¸ Keine Partner-E-Mail vorhanden, Ã¼berspringe First-Contract-Check');
        return;
    }
    
    try {
        console.log('ğŸ” PrÃ¼fe ob erster Vertrag fÃ¼r:', partnerEmail);
        
        // 1. Alle VertrÃ¤ge dieses Partners holen
        const vertraegeRes = await fetch('tables/vertragsabschluesse?limit=1000');
        const vertraegeData = await vertraegeRes.json();
        
        if (!vertraegeData || !vertraegeData.data) {
            console.log('âš ï¸ Keine Vertrags-Daten verfÃ¼gbar');
            return;
        }
        
        // Nur VertrÃ¤ge dieses Partners zÃ¤hlen
        const meineVertraege = vertraegeData.data.filter(v => 
            v.partner_email && 
            v.partner_email.toLowerCase() === partnerEmail.toLowerCase()
        );
        
        console.log(`ğŸ“Š Anzahl VertrÃ¤ge von ${partnerEmail}:`, meineVertraege.length);
        
        // 2. Wenn das der ERSTE Vertrag ist ODER Partner hat noch kein onboarding_abschluss
        if (meineVertraege.length >= 1) {
            console.log('ğŸ‰ Partner hat Vertrag(e) - prÃ¼fe Onboarding-Status:', meineVertraege.length, 'Vertrag(e)');
            
            // 3. Partner-Daten holen um ID zu bekommen
            const partnersRes = await fetch('tables/partners?limit=100');
            const partnersData = await partnersRes.json();
            
            if (!partnersData || !partnersData.data) {
                console.log('âš ï¸ Keine Partner-Daten verfÃ¼gbar');
                return;
            }
            
            const partner = partnersData.data.find(p => 
                p.email && p.email.toLowerCase() === partnerEmail.toLowerCase()
            );
            
            if (!partner) {
                console.log('âš ï¸ Partner nicht in Datenbank gefunden:', partnerEmail);
                return;
            }
            
            // PrÃ¼fen ob BEIDE Flags schon gesetzt sind
            if (partner.erster_vertrag_abgeschlossen === true && partner.onboarding_abschluss === true) {
                console.log('âœ… Beide Flags bereits gesetzt, keine Aktion nÃ¶tig');
                return;
            }
            
            console.log('ğŸ”„ Partner hat Vertrag aber Flags fehlen noch:', {
                erster_vertrag_abgeschlossen: partner.erster_vertrag_abgeschlossen,
                onboarding_abschluss: partner.onboarding_abschluss
            });
            
            // 4. Flag setzen in Datenbank (âœ… PUT statt PATCH!)
            console.log('ğŸ”„ Setze Flag "erster_vertrag_abgeschlossen" fÃ¼r Partner:', partner.id);
            
            // âœ… VollstÃ¤ndige Partner-Daten mit Ã„nderungen
            const partnerData = {
                ...partner,
                erster_vertrag_abgeschlossen: true,
                onboarding_abschluss: true
            };
            delete partnerData.id;
            delete partnerData.gs_project_id;
            delete partnerData.gs_table_name;
            delete partnerData.created_at;
            delete partnerData.updated_at;
            
            const updateRes = await fetch(`tables/partners/${partner.id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(partnerData)
            });
            
            if (updateRes.ok) {
                console.log('âœ… Flag "erster_vertrag_abgeschlossen" erfolgreich gesetzt!');
                
                // 5. Optional: Benachrichtigung an Partner senden
                try {
                    await fetch('tables/partner_benachrichtigungen', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            partner_email: partnerEmail,
                            typ: 'system_nachricht',
                            titel: 'ğŸ‰ Erster Vertragsabschluss!',
                            nachricht: 'Herzlichen GlÃ¼ckwunsch! Du hast deinen ersten Kundenvertrag erfolgreich abgeschlossen. Dein Onboarding-Fortschritt wurde aktualisiert.',
                            gelesen: false,
                            erstellt_am: Date.now()
                        })
                    });
                    console.log('âœ… GlÃ¼ckwunsch-Benachrichtigung an Partner gesendet');
                } catch (notifError) {
                    console.log('âš ï¸ Benachrichtigung konnte nicht gesendet werden (nicht kritisch):', notifError);
                }
            } else {
                console.error('âŒ Fehler beim Setzen des Flags:', await updateRes.text());
            }
            
        } else if (meineVertraege.length > 1) {
            console.log(`âœ… Partner hat bereits ${meineVertraege.length} VertrÃ¤ge, kein First-Contract`);
        } else {
            console.log('âš ï¸ Keine VertrÃ¤ge gefunden (sollte nicht passieren nach Save)');
        }
        
    } catch (error) {
        console.error('âŒ Fehler in checkAndSetFirstContract:', error);
    }
}


    </script>
    
    </div> <!-- End partner-tool-fullscreen -->
</body>
</html>