<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3b82f6">
    <title>Partner Dashboard - DeinCheck Partnerprogramm</title>
    <link rel="icon" type="image/png" href="images/favicon-partner.png">
    <link rel="apple-touch-icon" href="images/favicon-partner.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/mobile-app.css">
    <script src="js/local-persistence.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #5568d3;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;
            --text: #2d3748;
            --text-light: #718096;
            --bg: #f7fafc;
            --white: #ffffff;
            --border: #e2e8f0;
            --sidebar-width: 280px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Collapsed Sidebar */
        .sidebar.collapsed {
            transform: translateX(calc(-1 * var(--sidebar-width)));
        }
        
        .sidebar.collapsed ~ .main-content {
            margin-left: 0;
        }
        
        /* Sidebar Toggle Button */
        .sidebar-toggle {
            position: fixed;
            left: calc(var(--sidebar-width) - 20px);
            top: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-toggle:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }
        
        .sidebar.collapsed ~ .sidebar-toggle {
            left: 20px;
        }
        
        .sidebar-toggle i {
            transition: transform 0.3s;
        }
        
        .sidebar.collapsed ~ .sidebar-toggle i {
            transform: rotate(180deg);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
        }

        .sidebar-logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), #60a5fa);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-light);
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg);
            color: var(--primary);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), #60a5fa);
            color: white;
            font-weight: 600;
        }

        .nav-item i {
            font-size: 1.1rem;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Top Bar */
        .topbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .topbar-left h1 {
            font-size: 1.75rem;
            color: var(--text);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #60a5fa);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .topbar-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .btn-refresh {
            background: var(--bg);
            color: var(--text);
        }

        .btn-refresh:hover {
            background: var(--border);
        }

        .btn-logout {
            background: var(--danger);
            color: white;
        }

        .btn-logout:hover {
            background: #dc2626;
        }

        /* Content Area */
        .content {
            padding: 2rem;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
            /* âœ… Normal scroll - kein max-height nÃ¶tig */
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ğŸ“Š STATS GRID - PREMIUM LAYOUT 2026 */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.25rem;
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 24px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        
        /* Responsive: Auf kleinen Screens anpassen */
        @media (max-width: 1400px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
                padding: 1rem;
            }
        }
        
        /* ğŸ“± MOBILE-Ansicht (< 600px): Kompaktes Layout */
        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem;
                padding: 0.75rem;
                border-radius: 16px;
            }
            
            /* Stat-Cards: Kompakter auf Mobile */
            .stat-card {
                min-height: auto;
                padding: 1rem !important;
                border-radius: 14px;
            }
            
            .stat-card-value {
                font-size: 1.5rem !important;
            }
            
            .stat-card-title {
                font-size: 0.65rem !important;
            }
            
            .stat-card-change {
                font-size: 0.7rem !important;
            }
            
            .stat-card-icon {
                width: 36px !important;
                height: 36px !important;
                font-size: 1rem !important;
                border-radius: 10px !important;
            }
        }
        
        /* ğŸ“± SEHR KLEINE SCREENS (< 400px): 1 Spalte */
        @media (max-width: 400px) {
            .stats-grid {
                grid-template-columns: 1fr !important;
            }
            
            /* Stat-Cards: GrÃ¶ÃŸere Touch-Targets */
            .stat-card {
                min-height: 90px;
                padding: 1.25rem !important;
            }
            
            /* Buttons: GrÃ¶ÃŸere Touch-Targets */
            .btn {
                min-height: 44px;
                padding: 12px 20px !important;
                font-size: 14px !important;
            }
            
            /* Inputs & Selects: GrÃ¶ÃŸer auf Mobile */
            input, select, textarea {
                min-height: 44px !important;
                font-size: 16px !important; /* Verhindert Zoom auf iOS */
            }
            
            /* ğŸ“± FILTER KOMPAKT AUF MOBILE */
            .form-group {
                margin-bottom: 12px !important;
            }
        }
        
        /* ğŸ“Š CHARTS RESPONSIVE */
        @media (max-width: 1200px) {
            /* Quick Stats auf 2 Spalten */
            #quick-stats-row {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            /* Charts Grid auf 1 Spalte */
            #page-dashboard [style*="grid-template-columns: repeat(2, 1fr)"] {
                grid-template-columns: 1fr !important;
            }
        }
        
        @media (max-width: 900px) {
            /* Charts Grid auf 1 Spalte */
            #page-dashboard [style*="grid-template-columns: repeat(auto-fit, minmax(380px"] {
                grid-template-columns: 1fr !important;
            }
            
            /* Status-Chart volle Breite */
            #page-dashboard [style*="grid-column: 1 / -1"] {
                grid-column: auto !important;
            }
        }
        
        @media (max-width: 600px) {
            /* Quick Stats auf 2 Spalten auf Mobile */
            #quick-stats-row {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
            }
            
            #quick-stats-row > div {
                padding: 1rem !important;
            }
            
            #quick-stats-row [style*="font-size: 2.5rem"] {
                font-size: 1.75rem !important;
            }
            
            /* Anbieter Grid auf 2 Spalten */
            #anbieter-performance-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        @media (max-width: 500px) {
            /* Charts kleiner auf Mobile */
            #page-dashboard canvas {
                max-height: 200px !important;
            }
            
            /* Chart-Container kompakter */
            #page-dashboard [style*="border-radius: 24px"] {
                padding: 1rem !important;
                border-radius: 16px !important;
            }
            
            .form-group label {
                font-size: 12px !important;
                margin-bottom: 4px !important;
            }
            
            .card {
                padding: 15px !important;
                margin-bottom: 15px !important;
            }
            
            /* Tables kompakter */
            .data-table th,
            .data-table td {
                padding: 8px 4px !important;
                font-size: 12px !important;
            }
            
        }
        
        /* ğŸ“± KUNDEN-VERTRÃ„GE RESPONSIVE FIX */
        #kunden-vertraege-container {
            overflow-x: hidden;
            max-width: 100%;
        }
        
        #kunden-vertraege-container > div {
            max-width: 100%;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            #kunden-vertraege-container table {
                font-size: 11px !important;
            }
            
            #kunden-vertraege-container th,
            #kunden-vertraege-container td {
                padding: 8px 6px !important;
            }
        }
        
        @media (max-width: 768px) {
            
            /* AKADEMIE: Mobile Optimierung */
            #page-akademie h1 {
                font-size: 1.5rem !important;
            }
            
            #page-akademie p {
                font-size: 0.95rem !important;
            }
            
            /* Akademie-Module: Auf Mobile stapeln */
            #page-akademie [onclick^="openModul"] {
                padding: 1.5rem !important;
            }
            
            #page-akademie [onclick^="openModul"] > div {
                flex-direction: column !important;
                gap: 1rem !important;
            }
            
            #page-akademie [onclick^="openModul"] h3 {
                font-size: 1.2rem !important;
            }
            
            /* Modul-Icon kleiner auf Mobile */
            #page-akademie [onclick^="openModul"] > div > div:first-child > div:first-child {
                width: 60px !important;
                height: 60px !important;
                min-width: 60px !important;
                font-size: 2rem !important;
            }
            
            /* Button auf Mobile volle Breite */
            #page-akademie [onclick^="openModul"] > div > div:last-child {
                width: 100% !important;
                text-align: center !important;
                min-width: auto !important;
            }
            
            /* Fortschritts-Karten auf Mobile: 1 Spalte */
            #page-akademie > div:nth-child(3) > div:last-child {
                grid-template-columns: 1fr !important;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ğŸ¨ APPLE-STYLE STATISTIK KARTEN - PREMIUM DESIGN 2026 */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .stat-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }
        
        /* Glasmorphism-Effekt */
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12), 0 8px 16px rgba(0,0,0,0.08);
        }
        
        /* Farbige Varianten fÃ¼r die Karten */
        .stat-card.card-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stat-card.card-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .stat-card.card-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .stat-card.card-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .stat-card.card-gold {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            color: white;
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }

        .stat-card-title {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Farbige Karten haben weiÃŸe Titel */
        .stat-card.card-primary .stat-card-title,
        .stat-card.card-success .stat-card-title,
        .stat-card.card-warning .stat-card-title,
        .stat-card.card-info .stat-card-title,
        .stat-card.card-gold .stat-card-title {
            color: rgba(255,255,255,0.85);
        }

        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
            z-index: 1;
        }
        
        /* Farbige Karten haben weiÃŸe, halbtransparente Icons */
        .stat-card.card-primary .stat-card-icon,
        .stat-card.card-success .stat-card-icon,
        .stat-card.card-warning .stat-card-icon,
        .stat-card.card-info .stat-card-icon,
        .stat-card.card-gold .stat-card-icon {
            background: rgba(255,255,255,0.25) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .icon-primary { background: linear-gradient(135deg, #667eea, #764ba2); }
        .icon-success { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .icon-warning { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .icon-info { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .icon-gold { background: linear-gradient(135deg, #f7971e, #ffd200); }

        .stat-card-value {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--text);
            line-height: 1.1;
            position: relative;
            z-index: 1;
            margin-bottom: 0.25rem;
        }
        
        /* Farbige Karten haben weiÃŸe Werte */
        .stat-card.card-primary .stat-card-value,
        .stat-card.card-success .stat-card-value,
        .stat-card.card-warning .stat-card-value,
        .stat-card.card-info .stat-card-value,
        .stat-card.card-gold .stat-card-value {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card-change {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        /* Farbige Karten haben hellere Subtexte */
        .stat-card.card-primary .stat-card-change,
        .stat-card.card-success .stat-card-change,
        .stat-card.card-warning .stat-card-change,
        .stat-card.card-info .stat-card-change,
        .stat-card.card-gold .stat-card-change {
            color: rgba(255,255,255,0.8);
        }
        
        /* Trend-Indikator fÃ¼r Statistiken */
        .stat-trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 20px;
            margin-top: 0.5rem;
        }
        
        .stat-trend.up {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }
        
        .stat-trend.down {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .stat-trend.neutral {
            background: rgba(100, 116, 139, 0.15);
            color: #64748b;
        }

        /* Data Cards */
        .data-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .data-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg);
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        tbody tr:hover {
            background: var(--bg);
        }

        /* Badges */
        .badge {
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        /* Action Buttons */
        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #60a5fa);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #e53e3e);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
        }

        .btn-sm {
            padding: 0.35rem 0.75rem;
            font-size: 0.8rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state p {
            font-size: 1rem;
            font-weight: 600;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #60a5fa);
            border-radius: 10px;
            transition: width 0.5s;
        }

        /* ğŸ“± MOBILE - Alle Styles in mobile-app.css */
        .mobile-header {
            display: none;
        }
        .sidebar-overlay {
            display: none;
        }
        
        /* Pulse Animation fÃ¼r Onboarding-Buttons */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        /* Status Badges fÃ¼r VertrÃ¤ge */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }
        .badge-aktiviert {
            background: #c6f6d5;
            color: #22543d;
        }
        .badge-in-pruefung {
            background: #feebc8;
            color: #7c2d12;
        }
        .badge-neu {
            background: #bee3f8;
            color: #2c5282;
        }
        .badge-abgelehnt {
            background: #fed7d7;
            color: #742a2a;
        }
        .badge-storniert {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“± KRITISCHE MOBILE SCROLL FIXES - 07.01.2026
           Behebt: Onboarding-Widget nicht scrollbar, Content abgeschnitten
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media screen and (max-width: 968px) {
            /* KRITISCH: HTML & Body mÃ¼ssen scrollen kÃ¶nnen */
            html, body {
                overflow-y: auto !important;
                overflow-x: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                height: auto !important;
                min-height: 100vh !important;
                min-height: 100dvh !important;
            }

            /* Main Content Container - Scrollbar */
            .main-content {
                overflow-y: auto !important;
                overflow-x: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                height: auto !important;
                min-height: 100vh !important;
                padding-bottom: 120px !important;
            }

            /* Content Area - Scrollbar */
            .content {
                overflow-y: auto !important;
                overflow-x: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                height: auto !important;
                padding-bottom: 100px !important;
            }

            /* Page Sections - Scrollbar & nicht abgeschnitten */
            .page-section, [id^="page-"] {
                overflow-y: auto !important;
                overflow-x: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                max-height: none !important;
                height: auto !important;
            }

            /* KRITISCH: Onboarding Widget - Flexibel, nicht abgeschnitten */
            #onboarding-widget {
                overflow: visible !important;
                max-height: none !important;
            }

            /* Onboarding Steps Grid - auf Mobile untereinander */
            #onboarding-steps,
            #onboarding-widget [style*="grid-template-columns"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 12px !important;
            }

            #onboarding-steps > div {
                width: 100% !important;
                min-width: 100% !important;
            }

            /* Data Cards - nicht abschneiden */
            .data-card {
                overflow: visible !important;
                max-height: none !important;
            }

            /* Akademie Seite - Scrollbar */
            #page-akademie {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                padding-bottom: 100px !important;
            }

            /* Provisionen Seite - Scrollbar */
            #page-provisionen {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                padding-bottom: 100px !important;
            }

            /* Meine VertrÃ¤ge Seite - Scrollbar */
            #page-meine-vertraege {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                padding-bottom: 100px !important;
            }

            /* Einstellungen Seite - Scrollbar */
            #page-einstellungen {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                padding-bottom: 100px !important;
            }

            /* Sidebar Navigation - Nur Safe-Area fÃ¼r iOS */
            .sidebar-nav, .sidebar .tabs {
                padding-bottom: env(safe-area-inset-bottom, 20px) !important;
            }

            /* Entdecken Widget Cards */
            #entdecken-widget [style*="grid-template-columns"] {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }

            #entdecken-widget [style*="font-size: 2.5rem"] {
                font-size: 1.5rem !important;
            }

            #entdecken-widget h3 {
                font-size: 0.9rem !important;
            }

            #entdecken-widget p {
                font-size: 0.75rem !important;
            }

            /* Modals - Scrollbar */
            .modal-body, .modal-content {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                max-height: 85vh !important;
            }

            /* Inputs - Touch-freundlich & kein iOS Zoom */
            input, select, textarea {
                font-size: 16px !important;
                min-height: 44px !important;
            }

            /* Buttons - Touch-freundlich */
            button, .btn {
                min-height: 44px !important;
            }
        }

        /* Extra kleine Phones - 1 Spalte fÃ¼r Entdecken */
        @media screen and (max-width: 400px) {
            #entdecken-widget [style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
    
    <!-- ğŸ“± MOBILE APP CSS - MUSS AM ENDE SEIN um inline styles zu Ã¼berschreiben -->
    <link rel="stylesheet" href="css/mobile-app.css">
    
    <!-- jsPDF fÃ¼r PDF-Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- ğŸ“± MOBILE FUNKTIONEN - MUSS IM HEAD SEIN! -->
    <script>
    window.isMobile = function() { return window.innerWidth <= 968; };
    
    window.toggleMobileSidebar = function() {
        var sidebar = document.getElementById('sidebar');
        var overlay = document.getElementById('sidebar-overlay');
        var icon = document.getElementById('mobile-menu-icon');
        if (!sidebar) return;
        
        if (sidebar.classList.contains('mobile-open')) {
            window.closeMobileSidebar();
        } else {
            sidebar.classList.add('mobile-open');
            if (overlay) overlay.classList.add('active');
            if (icon) { icon.classList.remove('fa-bars'); icon.classList.add('fa-times'); }
            document.body.style.overflow = 'hidden';
        }
    };
    
    window.closeMobileSidebar = function() {
        var sidebar = document.getElementById('sidebar');
        var overlay = document.getElementById('sidebar-overlay');
        var icon = document.getElementById('mobile-menu-icon');
        if (sidebar) sidebar.classList.remove('mobile-open');
        if (overlay) overlay.classList.remove('active');
        if (icon) { icon.classList.remove('fa-times'); icon.classList.add('fa-bars'); }
        document.body.style.overflow = '';
    };
    
    window.setupMobileUI = function() {
        // CSS steuert den Header via @media - hier nur Sidebar schlieÃŸen auf Desktop
        if (!window.isMobile()) {
            window.closeMobileSidebar();
        }
    };
    
    document.addEventListener('DOMContentLoaded', window.setupMobileUI);
    window.addEventListener('resize', window.setupMobileUI);
    </script>
</head>
<body>
    <!-- ğŸ“± MOBILE HEADER -->
    <div class="mobile-header" id="mobile-header">
        <button class="mobile-menu-btn" onclick="window.toggleMobileSidebar()">
            <i class="fas fa-bars" id="mobile-menu-icon"></i>
        </button>
        <div class="mobile-header-center">
            <div class="mobile-header-title">Partner Portal</div>
            <div class="mobile-header-user" id="mobile-user-name" style="font-size: 12px; opacity: 0.9;"></div>
        </div>
        <button class="mobile-logout-btn" onclick="logout()" title="Abmelden">
            <i class="fas fa-sign-out-alt"></i>
        </button>
    </div>
    
    <!-- ğŸ“± MOBILE OVERLAY -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="window.closeMobileSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <i class="fas fa-handshake"></i>
                </div>
                <span>Partner Portal</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <!-- Dashboard -->
            <div class="nav-section">
                <div class="nav-section-title">Ãœbersicht</div>
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
            </div>

            <!-- Verkauf -->
            <div class="nav-section">
                <div class="nav-section-title">Verkauf & VertrÃ¤ge</div>
                <div class="nav-item" onclick="showPage('partner-tool')">
                    <i class="fas fa-plus-circle"></i>
                    <span>Partner-Tool</span>
                </div>
                <div class="nav-item" onclick="showPage('meine-vertraege')">
                    <i class="fas fa-file-contract"></i>
                    <span>Meine VertrÃ¤ge</span>
                </div>
                <div class="nav-item" onclick="showPage('provisionen', event)">
                    <i class="fas fa-trophy"></i>
                    <span>Bonus & Ziele</span>
                </div>
            </div>

            <!-- Marketing -->
            <div class="nav-section">
                <div class="nav-section-title">Marketing & Tools</div>
                <div class="nav-item" onclick="showPage('qr-codes')">
                    <i class="fas fa-qrcode"></i>
                    <span>QR-Codes</span>
                </div>
                <div class="nav-item" onclick="showPage('empfehlungen')">
                    <i class="fas fa-share-alt"></i>
                    <span>Empfehlungen</span>
                </div>
                <div class="nav-item" onclick="showPage('marketing-material')">
                    <i class="fas fa-images"></i>
                    <span>Marketing Material</span>
                </div>
                <div class="nav-item" onclick="showPage('partner-programm')">
                    <i class="fas fa-users"></i>
                    <span>Partner-Programm</span>
                </div>
            </div>

            <!-- Weiterbildung -->
            <div class="nav-section">
                <div class="nav-section-title">Weiterbildung</div>
                <div class="nav-item" onclick="showPage('akademie')">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Partner Akademie</span>
                </div>
                <div class="nav-item" onclick="showPage('ki-trainer')" style="position: relative;">
                    <i class="fas fa-robot"></i>
                    <span>KI Verkaufstrainer</span>
                    <span style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 700; box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);">
                        Bald
                    </span>
                </div>
            </div>

            <!-- Verwaltung -->
            <div class="nav-section">
                <div class="nav-section-title">Verwaltung</div>
                <div class="nav-item" onclick="showPage('kalender')">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Termine</span>
                </div>
                <div class="nav-item" onclick="showPage('hilfe')">
                    <i class="fas fa-question-circle"></i>
                    <span>Hilfe & FAQ</span>
                </div>
                <div class="nav-item" onclick="showPage('einstellungen')">
                    <i class="fas fa-cog"></i>
                    <span>Einstellungen</span>
                </div>
            </div>
        </nav>
    </div>
    
    <!-- Sidebar Toggle Button (Desktop) -->
    <button class="sidebar-toggle" onclick="toggleSidebarCollapse()" title="MenÃ¼ ein-/ausblenden">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar (VERSTECKT auf Mobile, ersetzt durch mobile-header) -->
        <div class="topbar">
            <div class="topbar-left">
                <h1 id="pageTitle">
                    <span id="greeting-text">Hallo Partner!</span> ğŸ‘‹
                </h1>
            </div>
            <div class="topbar-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">P</div>
                    <div>
                        <div style="font-weight: 600; font-size: 0.9rem;" id="userName">Partner</div>
                        <div style="font-size: 0.75rem; color: var(--text-light);" id="userEmail">partner@example.com</div>
                    </div>
                </div>
                <button class="topbar-btn btn-refresh" onclick="refreshData()">
                    <i class="fas fa-sync"></i>
                    <span>Aktualisieren</span>
                </button>
                <button class="topbar-btn btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div class="page-section active" id="page-dashboard">
                
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- ğŸ“Š STATISTIKEN & ÃœBERSICHT - APPLE-STYLE PREMIUM DESIGN 2026 -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div class="stats-grid">
                    <!-- ğŸ’° HEUTE - GrÃ¼n/TÃ¼rkis Gradient -->
                    <div class="stat-card card-success">
                        <div class="stat-card-header">
                            <span class="stat-card-title">ğŸ’° Heute</span>
                            <div class="stat-card-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="todayProvisionen">0 â‚¬</div>
                        <div class="stat-card-change" id="todayVertraege">0 VertrÃ¤ge heute</div>
                    </div>

                    <!-- ğŸ“… GESTERN - Lila/Violett Gradient -->
                    <div class="stat-card card-primary">
                        <div class="stat-card-header">
                            <span class="stat-card-title">ğŸ“… Gestern</span>
                            <div class="stat-card-icon">
                                <i class="fas fa-history"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="yesterdayProvisionen">0 â‚¬</div>
                        <div class="stat-card-change" id="yesterdayVertraege">0 VertrÃ¤ge</div>
                    </div>

                    <!-- ğŸ“† DIESER MONAT - Blau/Cyan Gradient -->
                    <div class="stat-card card-info">
                        <div class="stat-card-header">
                            <span class="stat-card-title">ğŸ“† Dieser Monat</span>
                            <div class="stat-card-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="monthProvisionen">0 â‚¬</div>
                        <div class="stat-card-change">Provisionen gesamt</div>
                    </div>

                    <!-- â³ AUSSTEHEND - Pink/Rot Gradient -->
                    <div class="stat-card card-warning">
                        <div class="stat-card-header">
                            <span class="stat-card-title">â³ Ausstehend</span>
                            <div class="stat-card-icon">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="pendingProvisionen">0 â‚¬</div>
                        <div class="stat-card-change">Noch nicht ausgezahlt</div>
                    </div>

                    <!-- ğŸ“„ VERTRÃ„GE - Gold/Orange Gradient -->
                    <div class="stat-card card-gold">
                        <div class="stat-card-header">
                            <span class="stat-card-title">ğŸ“„ VertrÃ¤ge</span>
                            <div class="stat-card-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="totalVertraege">0</div>
                        <div class="stat-card-change">Erfolgreich abgeschlossen</div>
                    </div>
                </div>
                
                <!-- ONBOARDING WIDGET -->
                <!-- ğŸ”¥ ONBOARDING-WIDGET (Orange Alert - BLEIBT IM DASHBOARD!) -->
                <div id="onboarding-widget" class="data-card" style="display: none; background: linear-gradient(135deg, #f56565 0%, #ed8936 100%); color: white; margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                        <div>
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: white;">âš ï¸ Onboarding noch nicht abgeschlossen</h2>
                            <p style="opacity: 0.9;">SchlieÃŸen Sie diese Schritte ab, um Vollzugriff zu erhalten</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.25rem;">Fortschritt</div>
                            <div style="font-size: 2rem; font-weight: 700;" id="onboarding-progress">0%</div>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; height: 8px; margin-bottom: 1.5rem; overflow: hidden;">
                        <div id="onboarding-progress-bar" style="background: rgba(255,255,255,0.9); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;" id="onboarding-steps">
                        <!-- Steps will be loaded here -->
                    </div>
                </div>
                
                <!-- PROJEKT-STATUS WIDGET -->
                <div id="projekt-status-widget" class="data-card" style="margin-bottom: 2rem;">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-project-diagram"></i>
                            <span id="projekt-title">Dein Projekt</span>
                        </div>
                    </div>
                    <div style="background: var(--bg); padding: 1.5rem; border-radius: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Fortschritt</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);" id="projekt-progress-text">0%</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Status</div>
                                <div style="font-size: 1rem; font-weight: 600;" id="projekt-status">In Planung</div>
                            </div>
                        </div>
                        <div style="background: white; border-radius: 10px; height: 20px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                            <div id="projekt-progress-bar" style="background: linear-gradient(90deg, var(--primary), var(--success)); height: 100%; width: 0%; transition: width 0.5s;"></div>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; font-size: 0.875rem;">
                                <div>
                                    <span style="color: var(--text-light);">Gestartet:</span> <strong id="projekt-start">-</strong>
                                </div>
                                <div>
                                    <span style="color: var(--text-light);">Wochen:</span> <strong id="projekt-weeks">0 / 0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ“¢ NEWS & INFOS Widget - NACH Projekt! -->
                <div id="news-widget-top" style="margin-bottom: 1.5rem;">
                    <!-- News werden hier dynamisch geladen -->
                </div>

                <!-- NEUES ENTDECKEN WIDGET -->
                <div id="entdecken-widget" class="data-card" style="margin-bottom: 2rem;">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-sparkles"></i>
                            <span>Neues entdecken</span>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; padding: 1rem;">
                        <!-- Card 1: Online-Shop -->
                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border-radius: 10px; padding: 1.5rem; color: white; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'" onclick="alert('ğŸ›’ Online-Shop\n\nErstelle deinen eigenen Online-Shop und verkaufe Produkte direkt an Kunden.\n\nFeature wird bald freigeschaltet!')">
                            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ›’</div>
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">Online-Shop</h3>
                            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Erstelle deinen eigenen Shop</p>
                        </div>
                        
                        <!-- Card 2: Partner werben -->
                        <div style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); border-radius: 10px; padding: 1.5rem; color: white; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(72, 187, 120, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'" onclick="showPage('empfehlungen')">
                            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ¤</div>
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">Partner werben</h3>
                            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Verdiene Bonus fÃ¼r Empfehlungen</p>
                        </div>
                        
                        <!-- Card 3: KI-Tools -->
                        <div style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); border-radius: 10px; padding: 1.5rem; color: white; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(237, 137, 54, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'" onclick="alert('ğŸ¤– KI-Tools\n\nNutze KI-gestÃ¼tzte Tools fÃ¼r:\nâ€¢ Automatische Vertragserfassung\nâ€¢ Chat-Support\nâ€¢ E-Mail Marketing\n\nFeature wird bald freigeschaltet!')">
                            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ¤–</div>
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">KI-Tools</h3>
                            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Automatisiere deine Prozesse</p>
                        </div>
                        
                        <!-- Card 4: Erweiterte Analytics -->
                        <div style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); border-radius: 10px; padding: 1.5rem; color: white; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(66, 153, 225, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'" onclick="alert('ğŸ“Š Erweiterte Analytics\n\nDetaillierte Analysen:\nâ€¢ Verkaufs-Trends\nâ€¢ Kunden-Insights\nâ€¢ Performance-Tracking\n\nFeature wird bald freigeschaltet!')">
                            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ“Š</div>
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">Erweiterte Analytics</h3>
                            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Detaillierte Auswertungen</p>
                        </div>
                    </div>
                </div>

                <!-- âœ… Stats-Grid wurde nach GANZ OBEN verschoben (Ã¼ber Onboarding) -->

                <!-- Quick Actions -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-bolt"></i>
                            Schnellzugriff
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="action-btn btn-success" onclick="showPage('partner-tool')" style="justify-content: center; padding: 1.5rem;">
                            <i class="fas fa-plus-circle"></i>
                            <span>Neuer Vertrag</span>
                        </button>
                        <button class="action-btn btn-primary" onclick="showPage('provisionen')" style="justify-content: center; padding: 1.5rem;">
                            <i class="fas fa-trophy"></i>
                            <span>Bonus & Ziele</span>
                        </button>
                        <button class="action-btn btn-primary" onclick="showPage('akademie')" style="justify-content: center; padding: 1.5rem;">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Akademie</span>
                        </button>
                    </div>
                </div>

                <!-- Recent VertrÃ¤ge -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-file-contract"></i>
                            Neueste VertrÃ¤ge
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="table-recent-vertraege">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Kunde</th>
                                    <th>Kategorie</th>
                                    <th>Provision</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- âœ… NEU: Letzte Auszahlungen -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-money-bill-wave"></i>
                            Letzte Auszahlungen
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="table-recent-auszahlungen">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Tarif</th>
                                    <th>Typ</th>
                                    <th>Betrag</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded -->
                                <tr>
                                    <td colspan="5">
                                        <div class="empty-state">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <p>Keine Auszahlungen</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Bonus-Widget wurde verschoben zur Provisionen-Seite -->
            </div>

            <!-- Partner-Tool Page -->
            <div class="page-section" id="page-partner-tool">
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-plus-circle"></i>
                            Partner-Tool - Neuer Vertrag
                        </div>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-plus-circle"></i>
                        <p>Partner-Tool wird geladen...</p>
                        <small style="color: var(--text-light);">Erstelle neue VertrÃ¤ge direkt hier</small>
                        <br><br>
                        <a href="Partner-Tool.html" class="action-btn btn-primary">
                            <i class="fas fa-external-link-alt"></i>
                            Zum Partner-Tool
                        </a>
                    </div>
                </div>

                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                     ğŸ“‹ PROVISIONSLISTE - Alle Tarife mit Provisionen
                     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div class="data-card" style="margin-top: 20px;">
                    <div class="data-card-header" style="cursor: pointer;" onclick="toggleProvisionsListe()">
                        <div class="data-card-title">
                            <i class="fas fa-list-alt"></i>
                            ğŸ“‹ Provisionsliste - Alle Tarife & Provisionen
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="badge" style="background: linear-gradient(135deg, #10b981, #059669); color: white; font-size: 12px;">128+ Tarife</span>
                            <i class="fas fa-chevron-down" id="provisions-chevron" style="transition: transform 0.3s;"></i>
                        </div>
                    </div>
                    
                    <div id="provisions-liste-content" style="display: none; padding: 20px;">
                        <!-- Filter Bar -->
                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                            <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                                <!-- Suche -->
                                <div style="flex: 1; min-width: 200px; position: relative;">
                                    <input type="text" id="prov-search" placeholder="ğŸ” Tarif suchen..." 
                                           onkeyup="filterProvisionen()"
                                           style="width: 100%; padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; background: var(--bg-primary);">
                                </div>
                                
                                <!-- Anbieter Filter -->
                                <select id="prov-anbieter-filter" onchange="filterProvisionen()" 
                                        style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; min-width: 170px; background: var(--bg-primary);">
                                    <option value="alle">ğŸ¢ Alle Anbieter</option>
                                    <option value="freenet o2">ğŸ”µ Freenet O2</option>
                                    <option value="freenet telekom">ğŸŸ£ Freenet Telekom</option>
                                    <option value="freenet vodafone">ğŸ”´ Freenet Vodafone</option>
                                    <option value="klarmobil">ğŸŸ  Klarmobil</option>
                                    <option value="o2">ğŸ”µ O2 Direkt</option>
                                    <option value="1&1">ğŸŸ¦ 1&1</option>
                                    <option value="ay yildiz">ğŸ”´ Ay Yildiz</option>
                                    <option value="yourfone">ğŸŸ£ Yourfone</option>
                                </select>
                                
                                <!-- Sortierung -->
                                <select id="prov-sort" onchange="sortProvisionen()"
                                        style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; min-width: 170px; background: var(--bg-primary);">
                                    <option value="provision-desc">ğŸ’° HÃ¶chste Provision</option>
                                    <option value="provision-asc">Niedrigste Provision</option>
                                    <option value="preis-asc">ğŸ’² GÃ¼nstigster Preis</option>
                                    <option value="preis-desc">Teuerster Preis</option>
                                    <option value="name-asc">ğŸ“ Name A-Z</option>
                                </select>
                            </div>
                            
                            <!-- Quick Filter Buttons -->
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px;">
                                <button onclick="quickFilterProv('top100')" class="quick-filter-btn" style="padding: 6px 12px; border: 2px solid var(--primary); background: transparent; color: var(--primary); border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;">ğŸ† Top 100â‚¬+</button>
                                <button onclick="quickFilterProv('top200')" class="quick-filter-btn" style="padding: 6px 12px; border: 2px solid #f59e0b; background: transparent; color: #f59e0b; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;">â­ Top 200â‚¬+</button>
                                <button onclick="quickFilterProv('unlimited')" class="quick-filter-btn" style="padding: 6px 12px; border: 2px solid #8b5cf6; background: transparent; color: #8b5cf6; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;">â™¾ï¸ Unlimited</button>
                                <button onclick="quickFilterProv('guenstig')" class="quick-filter-btn" style="padding: 6px 12px; border: 2px solid #10b981; background: transparent; color: #10b981; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;">ğŸ’µ Unter 20â‚¬</button>
                                <button onclick="clearProvFilter()" class="quick-filter-btn" style="padding: 6px 12px; border: 2px solid var(--text-light); background: transparent; color: var(--text-light); border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;">âœ• Reset</button>
                            </div>
                            
                            <div style="margin-top: 12px; font-size: 13px; color: var(--text-light);">
                                <span id="prov-count">126 Tarife</span> gefunden
                            </div>
                        </div>
                        
                        <!-- Tarif-Tabelle -->
                        <div style="overflow-x: auto;">
                            <table id="provisions-tabelle" style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--border);">
                                        <th style="padding: 12px; text-align: left; font-weight: 700;">Anbieter</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 700;">Tarif</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 700;">Daten</th>
                                        <th style="padding: 12px; text-align: right; font-weight: 700;">Preis/Monat</th>
                                        <th style="padding: 12px; text-align: right; font-weight: 700;">Provision</th>
                                    </tr>
                                </thead>
                                <tbody id="provisions-tbody">
                                    <!-- Wird per JavaScript gefÃ¼llt -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Mehr laden Button -->
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="loadMoreProvisionen()" id="load-more-prov" 
                                    style="padding: 12px 30px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                Mehr Tarife laden
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meine VertrÃ¤ge Page - NEU MIT KUNDEN-KARTEN -->
            <div class="page-section" id="page-meine-vertraege">
                
                <!-- ğŸ’° GRÃœNE SUMMEN-BOX -->
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 16px; padding: 30px; margin-bottom: 20px; text-align: center; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);">
                    <div style="font-size: 14px; color: rgba(255,255,255,0.9); font-weight: 600; letter-spacing: 1px; margin-bottom: 8px;">â‚¬ GESAMT-PROVISION</div>
                    <div style="font-size: 48px; font-weight: 800; color: white; margin-bottom: 8px;" id="vertraege-gesamt-provision">0,00 â‚¬</div>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.8);">Basierend auf den aktuellen Filtern</div>
                </div>

                <!-- ğŸ“Š STATISTIK-KARTEN (4 Karten - ohne Gesamt & Dieser Monat, da grÃ¼ner Kasten das zeigt) -->
                <div class="stats-grid" id="vertraege-stats-grid" style="margin-bottom: 20px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                    <div class="stat-card" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white;">
                        <div class="stat-card-title" style="color: rgba(255,255,255,0.9);">âœ… Ausgezahlt</div>
                        <div class="stat-card-value" style="color: white;" id="vertraege-stat-ausgezahlt">0â‚¬</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ed8936, #dd6b20); color: white;">
                        <div class="stat-card-title" style="color: rgba(255,255,255,0.9);">â³ Ausstehend</div>
                        <div class="stat-card-value" style="color: white;" id="vertraege-stat-ausstehend">0â‚¬</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                        <div class="stat-card-title" style="color: rgba(255,255,255,0.9);">ğŸ“ˆ Hochrechnung</div>
                        <div class="stat-card-value" style="color: white;" id="vertraege-stat-hochrechnung">0â‚¬</div>
                        <div class="stat-card-change" style="color: rgba(255,255,255,0.9);">Prognose aktueller Monat</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fc8181, #f56565); color: white;">
                        <div class="stat-card-title" style="color: rgba(255,255,255,0.9);">âŒ Abgelehnt</div>
                        <div class="stat-card-value" style="color: white;" id="vertraege-stat-abgelehnt">0â‚¬</div>
                        <div class="stat-card-change" style="color: rgba(255,255,255,0.9);" id="vertraege-stat-abgelehnt-count">0 VertrÃ¤ge</div>
                    </div>
                </div>

                <!-- ğŸ” FILTER-BEREICH -->
                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; align-items: end;">
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Zeitraum</label>
                            <select id="vertraege-filter-zeitraum" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                <option value="">Alle ZeitrÃ¤ume</option>
                                <option value="heute">Heute</option>
                                <option value="woche">Diese Woche</option>
                                <option value="monat">Dieser Monat</option>
                                <option value="quartal">Dieses Quartal</option>
                                <option value="jahr">Dieses Jahr</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Von Datum</label>
                            <input type="date" id="vertraege-filter-von" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Bis Datum</label>
                            <input type="date" id="vertraege-filter-bis" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Kategorie</label>
                            <select id="vertraege-filter-kategorie" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                <option value="">Alle Kategorien</option>
                                <option value="mobilfunk">ğŸ“± Mobilfunk</option>
                                <option value="sim-only">ğŸ“² SIM-Only</option>
                                <option value="dsl">ğŸŒ DSL/Internet</option>
                                <option value="strom">âš¡ Strom</option>
                                <option value="gas">ğŸ”¥ Gas</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Status</label>
                            <select id="vertraege-filter-status" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                <option value="">Alle Status</option>
                                <option value="aktiviert">âœ… Aktiviert</option>
                                <option value="neu">ğŸ†• Neu</option>
                                <option value="in_pruefung">ğŸ” In PrÃ¼fung</option>
                                <option value="abgelehnt">âŒ Abgelehnt</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Provision Status</label>
                            <select id="vertraege-filter-zahlung" onchange="filterKundenVertraege()" style="width: 100%; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                                <option value="">Alle Zahlungsstatus</option>
                                <option value="ausgezahlt">ğŸ’° Ausgezahlt</option>
                                <option value="ausstehend">â³ Ausstehend</option>
                                <option value="wartend">â¸ï¸ Wartend</option>
                                <option value="storniert">ğŸš« Storniert</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <label style="display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px;">Suche Kunde</label>
                        <input type="text" id="vertraege-filter-suche" onkeyup="filterKundenVertraege()" placeholder="Kunde suchen..." style="width: 100%; max-width: 300px; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <!-- ğŸ‘¥ KUNDEN-VERTRÃ„GE HEADER -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #1e293b;">
                        <i class="fas fa-users" style="margin-right: 8px; color: #3b82f6;"></i>
                        Kunden-VertrÃ¤ge
                    </h3>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <select id="vertraege-sortierung" onchange="sortKundenVertraege()" style="padding: 10px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                            <option value="vertraege-desc">ğŸ“Š Meiste VertrÃ¤ge</option>
                            <option value="provision-desc">ğŸ’° HÃ¶chste Provision</option>
                            <option value="name-asc">ğŸ”¤ Name A-Z</option>
                            <option value="datum-desc">ğŸ“… Neueste zuerst</option>
                        </select>
                        <button onclick="loadKundenVertraege()" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-sync"></i> Aktualisieren
                        </button>
                        <button onclick="exportVertraegeCSV()" style="padding: 10px 20px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-file-csv"></i> CSV Export
                        </button>
                        <button onclick="exportVertraege()" style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-file-pdf"></i> PDF Export
                        </button>
                    </div>
                </div>

                <!-- ğŸ‘¥ KUNDEN-KARTEN LISTE -->
                <div id="kunden-vertraege-liste" style="display: grid; gap: 12px;">
                    <div style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 40px; margin-bottom: 16px;"></i>
                        <p style="margin: 0; font-size: 16px;">Lade Kunden-VertrÃ¤ge...</p>
                    </div>
                </div>

                <!-- ğŸ“‹ ALLE VERTRÃ„GE TABELLE (Aufklappbar) -->
                <div style="margin-top: 30px;">
                    <div onclick="toggleAlleVertraegeTabelle()" style="background: white; border-radius: 12px; padding: 16px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: all 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                        <span style="font-weight: 600; color: #475569;"><i class="fas fa-table" style="margin-right: 8px;"></i>Alle VertrÃ¤ge als Tabelle anzeigen</span>
                        <i class="fas fa-chevron-down" id="alle-vertraege-toggle-icon" style="color: #94a3b8; transition: transform 0.3s;"></i>
                    </div>
                    <div id="alle-vertraege-tabelle-container" style="display: none; margin-top: 12px;">
                        <div class="data-card">
                            <div class="table-container">
                                <table id="table-vertraege">
                                    <thead>
                                        <tr>
                                            <th>Datum</th>
                                            <th>Vertragsnr.</th>
                                            <th>Kunde</th>
                                            <th>Kontakt</th>
                                            <th>Kategorie</th>
                                            <th>Produkt</th>
                                            <th>Provision</th>
                                            <th>Status</th>
                                            <th>Aktionen</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-vertraege">
                                        <tr>
                                            <td colspan="9" style="text-align: center; padding: 2rem; color: var(--text-light);">
                                                <i class="fas fa-spinner fa-spin"></i> Lade...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- ğŸ“Š STATISTIK-DIAGRAMME - APPLE-STYLE PREMIUM DESIGN 2026 -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div style="margin-top: 2.5rem;">
                    <!-- Section Header - PREMIUM 2026 DESIGN -->
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 16px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.3);">
                                <i class="fas fa-analytics" style="color: white; font-size: 24px;"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.6rem; font-weight: 800; color: white; letter-spacing: -0.5px;">Performance Analytics</h3>
                                <p style="margin: 4px 0 0 0; font-size: 0.95rem; color: rgba(255,255,255,0.85);">Dein Erfolg in Echtzeit â€“ alle Kennzahlen im Blick</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="refreshAllStats()" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: white; padding: 10px 18px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                                <i class="fas fa-sync-alt"></i> Aktualisieren
                            </button>
                            <span style="background: rgba(16, 185, 129, 0.9); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);">
                                <span style="width: 8px; height: 8px; background: white; border-radius: 50%; animation: pulse 2s infinite;"></span> Live
                            </span>
                        </div>
                    </div>
                    
                    <!-- ğŸ”¥ QUICK STATS ROW - Sofort sichtbare KPIs -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;" id="quick-stats-row">
                        <!-- KPI 1: GesamtvertrÃ¤ge -->
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%); border-radius: 20px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.15); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05)); border-radius: 50%;"></div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #3b82f6, #60a5fa); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(59, 130, 246, 0.35);">
                                    <i class="fas fa-file-signature" style="color: white; font-size: 18px;"></i>
                                </div>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #64748b;">VertrÃ¤ge Gesamt</span>
                            </div>
                            <div style="font-size: 2.5rem; font-weight: 800; color: #1e293b; letter-spacing: -1px;" id="stat-total-vertraege">0</div>
                            <div style="display: flex; align-items: center; gap: 6px; margin-top: 8px;">
                                <span id="stat-vertraege-trend" style="background: #dcfce7; color: #16a34a; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                    <i class="fas fa-arrow-up"></i> +0 diesen Monat
                                </span>
                            </div>
                        </div>
                        
                        <!-- KPI 2: Provision Gesamt -->
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%); border-radius: 20px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.12); border: 1px solid rgba(16, 185, 129, 0.15); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05)); border-radius: 50%;"></div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #10b981, #34d399); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(16, 185, 129, 0.35);">
                                    <i class="fas fa-euro-sign" style="color: white; font-size: 18px;"></i>
                                </div>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #64748b;">Provision Gesamt</span>
                            </div>
                            <div style="font-size: 2.5rem; font-weight: 800; color: #1e293b; letter-spacing: -1px;" id="stat-total-provision">0 â‚¬</div>
                            <div style="display: flex; align-items: center; gap: 6px; margin-top: 8px;">
                                <span id="stat-provision-trend" style="background: #dcfce7; color: #16a34a; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                    <i class="fas fa-arrow-up"></i> +0 â‚¬ diesen Monat
                                </span>
                            </div>
                        </div>
                        
                        <!-- KPI 3: Erfolgsquote -->
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #fefce8 100%); border-radius: 20px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(234, 179, 8, 0.12); border: 1px solid rgba(234, 179, 8, 0.15); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, rgba(234, 179, 8, 0.1), rgba(234, 179, 8, 0.05)); border-radius: 50%;"></div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #eab308, #fbbf24); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(234, 179, 8, 0.35);">
                                    <i class="fas fa-trophy" style="color: white; font-size: 18px;"></i>
                                </div>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #64748b;">Erfolgsquote</span>
                            </div>
                            <div style="font-size: 2.5rem; font-weight: 800; color: #1e293b; letter-spacing: -1px;" id="stat-erfolgsquote">0%</div>
                            <div style="display: flex; align-items: center; gap: 6px; margin-top: 8px;">
                                <span style="background: #fef3c7; color: #d97706; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                    <i class="fas fa-check-circle"></i> Aktivierte VertrÃ¤ge
                                </span>
                            </div>
                        </div>
                        
                        <!-- KPI 4: Ã˜ Provision pro Vertrag -->
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%); border-radius: 20px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(139, 92, 246, 0.12); border: 1px solid rgba(139, 92, 246, 0.15); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.05)); border-radius: 50%;"></div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #8b5cf6, #a78bfa); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(139, 92, 246, 0.35);">
                                    <i class="fas fa-calculator" style="color: white; font-size: 18px;"></i>
                                </div>
                                <span style="font-size: 0.85rem; font-weight: 600; color: #64748b;">Ã˜ pro Vertrag</span>
                            </div>
                            <div style="font-size: 2.5rem; font-weight: 800; color: #1e293b; letter-spacing: -1px;" id="stat-avg-provision">0 â‚¬</div>
                            <div style="display: flex; align-items: center; gap: 6px; margin-top: 8px;">
                                <span style="background: #f3e8ff; color: #7c3aed; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                    <i class="fas fa-chart-line"></i> Durchschnitt
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Grid - 2x2 Layout -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        
                        <!-- ğŸ“Š CHART 1: Monatliche Entwicklung (Line Chart) -->
                        <div style="background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.9); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%); border-radius: 50%; filter: blur(20px);"></div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; position: relative; z-index: 1;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b; letter-spacing: -0.3px;">ğŸ“ˆ Monatliche Entwicklung</h4>
                                    <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b; font-weight: 500;">VertrÃ¤ge & Provisionen der letzten 6 Monate</p>
                                </div>
                                <div style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.35);">
                                    <i class="fas fa-chart-line" style="color: white; font-size: 18px;"></i>
                                </div>
                            </div>
                            <div style="height: 280px; position: relative; z-index: 1;">
                                <canvas id="chart-monats-trend"></canvas>
                            </div>
                        </div>

                        <!-- ğŸ“Š CHART 2: Top Tarife (Horizontal Bar) -->
                        <div style="background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.9); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%); border-radius: 50%; filter: blur(20px);"></div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; position: relative; z-index: 1;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b; letter-spacing: -0.3px;">ğŸ† Top 5 Tarife</h4>
                                    <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b; font-weight: 500;">Deine meistverkauften Produkte</p>
                                </div>
                                <div style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%); width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.35);">
                                    <i class="fas fa-medal" style="color: white; font-size: 18px;"></i>
                                </div>
                            </div>
                            <div style="height: 280px; position: relative; z-index: 1;">
                                <canvas id="chart-top-tarife"></canvas>
                            </div>
                        </div>

                        <!-- ğŸ“Š CHART 3: Kategorie-Verteilung (Donut) -->
                        <div style="background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.9); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%); border-radius: 50%; filter: blur(20px);"></div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; position: relative; z-index: 1;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b; letter-spacing: -0.3px;">ğŸ“Š Kategorie-Verteilung</h4>
                                    <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b; font-weight: 500;">VertrÃ¤ge nach Produktkategorie</p>
                                </div>
                                <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35);">
                                    <i class="fas fa-chart-pie" style="color: white; font-size: 18px;"></i>
                                </div>
                            </div>
                            <div style="height: 280px; position: relative; z-index: 1;">
                                <canvas id="chart-vertraege-kategorie-partner"></canvas>
                            </div>
                        </div>

                        <!-- ğŸ“Š CHART 4: Status-Ãœbersicht (Stacked Bar) -->
                        <div style="background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.9); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%); border-radius: 50%; filter: blur(20px);"></div>
                            
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; position: relative; z-index: 1;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b; letter-spacing: -0.3px;">ğŸ“‹ Status-Ãœbersicht</h4>
                                    <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b; font-weight: 500;">Aktiviert, In PrÃ¼fung, Storniert</p>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="display: flex; align-items: center; gap: 4px; background: #f0fdf4; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; color: #16a34a;">
                                        <span style="width: 6px; height: 6px; background: #10b981; border-radius: 50%;"></span> Aktiviert
                                    </span>
                                    <span style="display: flex; align-items: center; gap: 4px; background: #fef3c7; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; color: #d97706;">
                                        <span style="width: 6px; height: 6px; background: #f59e0b; border-radius: 50%;"></span> PrÃ¼fung
                                    </span>
                                </div>
                            </div>
                            <div style="height: 280px; position: relative; z-index: 1;">
                                <canvas id="chart-status-partner"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ“Š FULL WIDTH: Provision Timeline -->
                    <div style="margin-top: 1.5rem; background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.9); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -40px; left: 50%; transform: translateX(-50%); width: 200px; height: 100px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(52, 211, 153, 0.08) 100%); border-radius: 50%; filter: blur(30px);"></div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; position: relative; z-index: 1;">
                            <div>
                                <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b; letter-spacing: -0.3px;">ğŸ’° Provisions-Verlauf</h4>
                                <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b; font-weight: 500;">Deine Einnahmen-Entwicklung Ã¼ber Zeit</p>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="provision-timeline-filter" onchange="updateProvisionTimeline()" style="padding: 8px 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.85rem; font-weight: 600; color: #475569; background: white; cursor: pointer;">
                                    <option value="6">Letzte 6 Monate</option>
                                    <option value="12">Letzte 12 Monate</option>
                                    <option value="3">Letzte 3 Monate</option>
                                </select>
                                <div style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%); width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.35);">
                                    <i class="fas fa-chart-area" style="color: white; font-size: 18px;"></i>
                                </div>
                            </div>
                        </div>
                        <div style="height: 250px; position: relative; z-index: 1;">
                            <canvas id="chart-provision-timeline"></canvas>
                        </div>
                    </div>
                    
                    <!-- ğŸ… ANBIETER PERFORMANCE -->
                    <div style="margin-top: 1.5rem; background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 1.75rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06); border: 1px solid rgba(255,255,255,0.9);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                            <div>
                                <h4 style="margin: 0; font-size: 1.1rem; font-weight: 700; color: #1e293b;">ğŸ… Top Anbieter Performance</h4>
                                <p style="margin: 6px 0 0 0; font-size: 0.8rem; color: #64748b;">Deine erfolgreichsten Anbieter nach Provision</p>
                            </div>
                        </div>
                        <div id="anbieter-performance-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <!-- Wird dynamisch gefÃ¼llt -->
                            <div style="text-align: center; padding: 2rem; color: #94a3b8;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                                <p style="margin-top: 10px;">Lade Anbieter-Daten...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ğŸ† BONUS-WIDGET AUF DASHBOARD -->
            <div id="dashboard-bonus-widget" style="display: none; margin-top: 2rem;">
                <!-- Wird durch loadBonusWidget() gefÃ¼llt -->
            </div>

            </div>

            <!-- Bonus & Ziele Page (ehemals Provisionen) -->
            <div class="page-section" id="page-provisionen">
                <!-- ğŸ† NUR NOCH BONUS-WIDGET - Filter & Stats nach "Meine VertrÃ¤ge" verschoben (17.12.2025) -->
                
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <!-- ğŸ† BONUS-ZIELE WIDGET - APPLE STYLE - PREMIUM DESIGN -->
                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                <div id="bonus-widget" class="data-card" style="margin-top: 2rem; background: linear-gradient(135deg, #fafafa 0%, #ffffff 100%); border: 1px solid rgba(0,0,0,0.08); border-radius: 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 0 1px rgba(0,0,0,0.04); overflow: hidden;">
                    <!-- Farbiger Top-Border fÃ¼r visuellen Akzent -->
                    <div style="height: 4px; background: linear-gradient(90deg, #ff9500 0%, #ff6b35 50%, #ff3366 100%);"></div>
                    
                    <div style="padding: 2rem 2.5rem;">
                        <!-- Header Section -->
                        <div style="display: flex; align-items: center; gap: 1.25rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(0,0,0,0.06);">
                            <!-- Icon Badge mit Shadow -->
                            <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #ff9500 0%, #ff5e3a 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 8px 24px rgba(255, 94, 58, 0.35), 0 2px 8px rgba(0,0,0,0.08);">
                                ğŸ†
                            </div>
                            <!-- Title & Description -->
                            <div style="flex: 1;">
                                <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700; color: #1d1d1f; letter-spacing: -0.6px; line-height: 1.2;">Bonus-Ziele</h2>
                                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #6e6e73; font-weight: 400; line-height: 1.4;">Erreiche Meilensteine und sichere dir attraktive PrÃ¤mien</p>
                            </div>
                        </div>
                        
                        <!-- Bonus-Stufen Grid (Apple Card Style) -->
                        <div id="bonus-stufen-container" style="display: grid; gap: 1.25rem; margin-bottom: 2rem;">
                            <!-- Staffel 1: 10 VertrÃ¤ge = 250â‚¬ -->
                            <div style="background: white; border: 1.5px solid rgba(72, 187, 120, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(72, 187, 120, 0.15);">
                                <!-- Header -->
                                <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem;">
                                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 6px 16px rgba(72, 187, 120, 0.35);">
                                        ğŸ¥‰
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 1.4rem; font-weight: 700; color: #1d1d1f; margin-bottom: 0.4rem; letter-spacing: -0.3px;">Staffel 1</div>
                                        <div style="font-size: 1.1rem; font-weight: 600; color: #48bb78; margin-bottom: 0.5rem;">250â‚¬ Bonus-PrÃ¤mie</div>
                                        <div style="font-size: 0.95rem; color: #86868b; line-height: 1.5;">
                                            10 VertrÃ¤ge in beliebigen Kategorien
                                        </div>
                                    </div>
                                    <div style="text-align: center; padding: 0.75rem 1.25rem; background: linear-gradient(135deg, rgba(72, 187, 120, 0.1), rgba(56, 161, 105, 0.15)); border-radius: 12px; border: 1px solid rgba(72, 187, 120, 0.3);">
                                        <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #48bb78; font-weight: 700; margin-bottom: 0.25rem;">Fortschritt</div>
                                        <div style="font-size: 1.3rem; font-weight: 700; color: #48bb78;" id="staffel-1-progress">0/10</div>
                                    </div>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div style="background: #f7f9fc; padding: 1.5rem; border-radius: 12px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span style="font-size: 1.25rem;">ğŸ“„</span>
                                            <span style="font-size: 0.95rem; font-weight: 600; color: #1d1d1f;">VertrÃ¤ge</span>
                                        </div>
                                        <span style="font-size: 0.95rem; font-weight: 700; color: #48bb78; min-width: 45px; text-align: right;" id="staffel-1-prozent">0%</span>
                                    </div>
                                    <div style="background: #e2e8f0; border-radius: 10px; height: 14px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                                        <div id="staffel-1-bar" style="background: linear-gradient(90deg, #48bb78, #38a169); height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(72, 187, 120, 0.5);"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Staffel 2: 30 VertrÃ¤ge (davon 10 DSL + 5 Strom) = 850â‚¬ -->
                            <div style="background: white; border: 1.5px solid rgba(66, 153, 225, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(66, 153, 225, 0.15);">
                                <!-- Header -->
                                <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem;">
                                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 6px 16px rgba(66, 153, 225, 0.35);">
                                        ğŸ¥ˆ
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 1.4rem; font-weight: 700; color: #1d1d1f; margin-bottom: 0.4rem; letter-spacing: -0.3px;">Staffel 2</div>
                                        <div style="font-size: 1.1rem; font-weight: 600; color: #4299e1; margin-bottom: 0.5rem;">850â‚¬ Bonus-PrÃ¤mie</div>
                                        <div style="font-size: 0.95rem; color: #86868b; line-height: 1.5;">
                                            30 VertrÃ¤ge gesamt, davon mindestens 10 DSL und 5 Strom
                                        </div>
                                    </div>
                                    <div style="text-align: center; padding: 0.75rem 1.25rem; background: linear-gradient(135deg, rgba(66, 153, 225, 0.1), rgba(49, 130, 206, 0.15)); border-radius: 12px; border: 1px solid rgba(66, 153, 225, 0.3);">
                                        <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #4299e1; font-weight: 700; margin-bottom: 0.25rem;">Status</div>
                                        <div style="font-size: 1.1rem; font-weight: 700; color: #4299e1;" id="staffel-2-status">Offen</div>
                                    </div>
                                </div>
                                
                                <!-- Progress Bars Grid -->
                                <div style="display: grid; gap: 1.25rem; background: #f7f9fc; padding: 1.5rem; border-radius: 12px;">
                                    <!-- Gesamt-VertrÃ¤ge -->
                                    <div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span style="font-size: 1.25rem;">ğŸ“„</span>
                                                <span style="font-size: 0.95rem; font-weight: 600; color: #1d1d1f;">Gesamt-VertrÃ¤ge</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.9rem; color: #6e6e73;" id="staffel-2-vertraege">0/30</span>
                                                <span style="font-size: 0.95rem; font-weight: 700; color: #4299e1; min-width: 45px; text-align: right;" id="staffel-2-vertraege-prozent">0%</span>
                                            </div>
                                        </div>
                                        <div style="background: #e2e8f0; border-radius: 10px; height: 14px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                                            <div id="staffel-2-vertraege-bar" style="background: linear-gradient(90deg, #4299e1, #3182ce); height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(66, 153, 225, 0.5);"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- DSL-VertrÃ¤ge -->
                                    <div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span style="font-size: 1.25rem;">ğŸŒ</span>
                                                <span style="font-size: 0.95rem; font-weight: 600; color: #1d1d1f;">DSL-VertrÃ¤ge</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.9rem; color: #6e6e73;" id="staffel-2-dsl">0/10</span>
                                                <span style="font-size: 0.95rem; font-weight: 700; color: #10b981; min-width: 45px; text-align: right;" id="staffel-2-dsl-prozent">0%</span>
                                            </div>
                                        </div>
                                        <div style="background: #e2e8f0; border-radius: 10px; height: 14px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                                            <div id="staffel-2-dsl-bar" style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(16, 185, 129, 0.5);"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Strom-VertrÃ¤ge -->
                                    <div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span style="font-size: 1.25rem;">âš¡</span>
                                                <span style="font-size: 0.95rem; font-weight: 600; color: #1d1d1f;">Strom-VertrÃ¤ge</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 0.9rem; color: #6e6e73;" id="staffel-2-strom">0/5</span>
                                                <span style="font-size: 0.95rem; font-weight: 700; color: #f59e0b; min-width: 45px; text-align: right;" id="staffel-2-strom-prozent">0%</span>
                                            </div>
                                        </div>
                                        <div style="background: #e2e8f0; border-radius: 10px; height: 14px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                                            <div id="staffel-2-strom-bar" style="background: linear-gradient(90deg, #f59e0b, #d97706); height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(245, 158, 11, 0.5);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Staffel 3: Individuell -->
                            <div style="background: white; border: 1.5px solid rgba(237, 137, 54, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(237, 137, 54, 0.15);">
                                <div style="display: flex; align-items: center; gap: 1.5rem;">
                                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 6px 16px rgba(237, 137, 54, 0.35);">
                                        ğŸ¥‡
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 1.4rem; font-weight: 700; color: #1d1d1f; margin-bottom: 0.4rem; letter-spacing: -0.3px;">Staffel 3: Individuelles Ziel</div>
                                        <div style="font-size: 1.1rem; font-weight: 600; color: #ed8936; margin-bottom: 0.5rem;">Bonus nach Vereinbarung</div>
                                        <div style="font-size: 0.95rem; color: #86868b; line-height: 1.5;">
                                            Kontaktiere uns fÃ¼r dein persÃ¶nliches Bonus-Ziel mit maÃŸgeschneiderter PrÃ¤mie
                                        </div>
                                    </div>
                                    <button onclick="alert('ğŸ“ Kontakt:\\n\\nSchreibe uns eine E-Mail oder rufe an, um dein individuelles Bonus-Ziel zu besprechen!\\n\\nE-Mail: partner@deincheck.com\\nTelefon: +49 123 456789')" style="padding: 1rem 1.75rem; background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 12px rgba(237, 137, 54, 0.35); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(237, 137, 54, 0.45)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(237, 137, 54, 0.35)'">
                                        <i class="fas fa-envelope"></i> Kontakt aufnehmen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QR-Codes Page -->
            <div class="page-section" id="page-qr-codes">
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-qrcode"></i>
                            Meine QR-Codes
                        </div>
                    </div>
                    <div style="padding: 3rem; text-align: center;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; opacity: 0.9;">
                            <i class="fas fa-qrcode" style="font-size: 45px; color: white;"></i>
                        </div>
                        <h3 style="font-size: 20px; font-weight: 700; color: #2d3748; margin-bottom: 10px;">Bald verfÃ¼gbar</h3>
                        <p style="color: #718096; font-size: 15px;">Erstelle personalisierte QR-Codes fÃ¼r dein Marketing</p>
                    </div>
                </div>
            </div>

            <!-- Empfehlungen Page -->
            <div class="page-section" id="page-empfehlungen">
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-share-alt"></i>
                            Empfehlungen
                        </div>
                    </div>
                    <div style="padding: 3rem; text-align: center;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; opacity: 0.9;">
                            <i class="fas fa-share-alt" style="font-size: 45px; color: white;"></i>
                        </div>
                        <h3 style="font-size: 20px; font-weight: 700; color: #2d3748; margin-bottom: 10px;">Bald verfÃ¼gbar</h3>
                        <p style="color: #718096; font-size: 15px;">Empfehle weitere Partner und verdiene Boni</p>
                    </div>
                </div>
            </div>

            <!-- Marketing Material Page -->
            <div class="page-section" id="page-marketing-material">
                <!-- Header -->
                <div style="margin-bottom: 2.5rem;">
                    <h1 style="font-size: 2.5rem; color: var(--text); margin-bottom: 0.75rem; font-weight: 800;">
                        <i class="fas fa-rocket"></i> Marketing & Partner-Programm
                    </h1>
                    <p style="font-size: 1.1rem; color: var(--text-light);">Wachse gemeinsam mit uns! Partner werben, gemeinsam verdienen.</p>
                </div>

                <!-- Marketing Material (Coming Soon) -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-images"></i>
                            Marketing Material
                        </div>
                    </div>
                    <div style="padding: 2rem; text-align: center;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; opacity: 0.9;">
                            <i class="fas fa-images" style="font-size: 35px; color: white;"></i>
                        </div>
                        <h3 style="font-size: 18px; font-weight: 700; color: #2d3748; margin-bottom: 8px;">Bald verfÃ¼gbar</h3>
                        <p style="color: #718096; font-size: 14px;">Download von Flyern, Logos, Bannern & weiteren Marketing-Materialien</p>
                    </div>
                </div>
            </div>

            <!-- ===== ğŸ¤ PARTNER-PROGRAMM (MLM) ===== -->
            <div class="page-section" id="page-partner-programm">
                <!-- Header -->
                <div style="margin-bottom: 2.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                        <h1 style="font-size: 2.5rem; color: var(--text); margin: 0; font-weight: 800;">
                            <i class="fas fa-users"></i> Partner-Programm
                        </h1>
                        <span style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; letter-spacing: 0.5px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                            ğŸš€ BALD VERFÃœGBAR
                        </span>
                    </div>
                    <p style="font-size: 1.1rem; color: var(--text-light);">Wachse gemeinsam mit uns! Partner werben, gemeinsam verdienen.</p>
                </div>

                <!-- MLM Card -->
                <div class="data-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #10b981; margin-bottom: 2rem;">
                    <div style="padding: 2.5rem;">
                        <div style="display: flex; align-items: flex-start; gap: 2rem;">
                            <!-- Icon -->
                            <div style="width: 80px; height: 80px; min-width: 80px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);">
                                ğŸ¤
                            </div>
                            
                            <!-- Content -->
                            <div style="flex: 1;">
                                <h2 style="margin: 0 0 1rem 0; font-size: 1.8rem; font-weight: 700; color: #065f46;">
                                    Partner werben & langfristig verdienen
                                </h2>
                                <p style="margin: 0 0 1.5rem 0; font-size: 1.1rem; color: #047857; line-height: 1.7;">
                                    <strong>Verdiene mit jedem geworbenen Partner!</strong> Empfehle unser Partnerprogramm weiter und erhalte <strong style="color: #059669;">dauerhaft Provision</strong> auf alle UmsÃ¤tze deiner geworbenen Partner!
                                </p>
                                
                                <!-- Vorteile -->
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                        <div style="width: 40px; height: 40px; background: #d1fae5; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-coins" style="color: #10b981; font-size: 1.2rem;"></i>
                                        </div>
                                        <div>
                                            <div style="font-weight: 700; color: #065f46;">Provision</div>
                                            <div style="font-size: 0.85rem; color: #6b7280;">Auf alle UmsÃ¤tze</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                        <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-infinity" style="color: #3b82f6; font-size: 1.2rem;"></i>
                                        </div>
                                        <div>
                                            <div style="font-weight: 700; color: #065f46;">Langfristig</div>
                                            <div style="font-size: 0.85rem; color: #6b7280;">Dauerhaft verdienen</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem; background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                        <div style="width: 40px; height: 40px; background: #fef3c7; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-users" style="color: #f59e0b; font-size: 1.2rem;"></i>
                                        </div>
                                        <div>
                                            <div style="font-weight: 700; color: #065f46;">Unbegrenzt</div>
                                            <div style="font-size: 0.85rem; color: #6b7280;">Partner werben</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- So funktioniert's -->
                                <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                                    <h3 style="margin: 0 0 1rem 0; font-size: 1.2rem; font-weight: 700; color: #065f46;">
                                        <i class="fas fa-lightbulb"></i> So funktioniert's:
                                    </h3>
                                    <ol style="margin: 0; padding-left: 1.5rem; color: #047857; line-height: 1.8;">
                                        <li><strong>Empfehle</strong> unser Partnerprogramm an Freunde, Bekannte oder GeschÃ¤ftspartner</li>
                                        <li>Dein geworbener Partner registriert sich mit deinem <strong>Referral-Code</strong></li>
                                        <li>Du erhÃ¤ltst automatisch <strong>Provision</strong> auf alle seine VertrÃ¤ge</li>
                                        <li>Die Provision lÃ¤uft <strong>dauerhaft</strong> - solange dein Partner aktiv ist!</li>
                                        <li><strong>Je mehr Partner du wirbst, desto mehr verdienst du!</strong></li>
                                    </ol>
                                </div>
                                
                                <!-- Buttons -->
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                    <button onclick="alert('Dein Referral-Code: ' + (localStorage.getItem('partnerEmail') || 'DEMO123') + '\\n\\nTeile diesen Code mit deinen geworbenen Partnern!')" style="padding: 14px 28px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4); transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 14px rgba(16, 185, 129, 0.4)'">
                                        <i class="fas fa-user-plus"></i> Partner einladen
                                    </button>
                                    <button onclick="alert('Deine geworbenen Partner:\\n\\n- Noch keine Partner geworben\\n\\nTeile deinen Referral-Code um zu starten!')" style="padding: 14px 28px; background: white; color: #10b981; border: 2px solid #10b981; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                        <i class="fas fa-chart-line"></i> Meine Referrals
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== ğŸ“ NEUE PARTNER AKADEMIE ===== -->
            <div class="page-section" id="page-akademie">
                
                <!-- Header -->
                <div style="margin-bottom: 2.5rem; text-align: center;">
                    <div style="display: inline-block; padding: 0.5rem 1.5rem; background: linear-gradient(135deg, #3b82f6, #60a5fa); border-radius: 30px; margin-bottom: 1rem;">
                        <span style="color: white; font-weight: 700; font-size: 0.9rem;"><i class="fas fa-graduation-cap"></i> VERKAUFSTRAINING FÃœR DEIN MOBILFUNK-BUSINESS</span>
                    </div>
                    <h1 style="font-size: 2.5rem; color: var(--text); margin-bottom: 0.75rem; font-weight: 800;">Partner Akademie</h1>
                    <p style="font-size: 1.2rem; color: var(--text-light); max-width: 700px; margin: 0 auto; line-height: 1.8;">Werde zum Verkaufsprofi! Von Grundlagen bis Abschlusstechniken â€“ Alles, was du fÃ¼r maximalen Erfolg brauchst. <strong style="color: var(--primary);">100% praxisnahes Training</strong></p>
                </div>
                
                <!-- Fortschritts-Ãœbersicht -->
                <div style="background: linear-gradient(135deg, #3b82f6, #60a5fa); border-radius: 20px; padding: 2.5rem; margin-bottom: 3rem; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0; font-size: 1.5rem; color: white; font-weight: 700;"><i class="fas fa-chart-line"></i> Dein Fortschritt</h2>
                        <span style="font-size: 2rem; color: white; font-weight: 800;" id="akademie-progress">0%</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); border-radius: 15px; height: 16px; overflow: hidden; backdrop-filter: blur(10px);">
                        <div style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: 0%; transition: width 0.8s ease; border-radius: 15px; box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);" id="akademie-progress-bar"></div>
                    </div>
                    <div style="margin-top: 1.5rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                        <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 1.25rem; text-align: center;">
                            <div style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 0.5rem;" id="akademie-completed">0</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; font-weight: 600;"><i class="fas fa-check-circle"></i> Abgeschlossen</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 1.25rem; text-align: center;">
                            <div style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 0.5rem;" id="akademie-in-progress">0</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; font-weight: 600;"><i class="fas fa-spinner fa-pulse"></i> In Bearbeitung</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; padding: 1.25rem; text-align: center;">
                            <div style="font-size: 2rem; color: white; font-weight: 800; margin-bottom: 0.5rem;" id="akademie-not-started">3</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; font-weight: 600;"><i class="fas fa-hourglass-start"></i> Noch offen</div>
                        </div>
                    </div>
                </div>
                
                <!-- Schulungs-Module -->
                <div style="display: grid; gap: 2rem; padding: 0;">
                    
                    <!-- ğŸ¯ Modul 1: Grundlagen Mobilfunk -->
                    <div class="modul-card" data-modul-id="grundlagen" style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(59, 130, 246, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#3b82f6'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('grundlagen')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #3b82f6, #60a5fa); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);">
                                    ğŸ“š
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Grundlagen Mobilfunk</h3>
                                        <span class="modul-status-badge" data-modul-id="grundlagen" style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">LEVEL 1</span>
                                        <span style="padding: 0.4rem 1rem; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-star" style="color: #f59e0b;"></i> PFLICHT</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Verstehe die Grundlagen des Mobilfunks - Tarife, Netz-Technologien, Vertragsarten und die wichtigsten Anbieter im deutschen Markt. <strong style="color: var(--primary);">Dein Fundament fÃ¼r erfolgreichen Verkauf!</strong></p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #3b82f6; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">12</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #3b82f6; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">90 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #e0e7ff; color: #3730a3; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-signal"></i> Netztechnologie</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e40af; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-euro-sign"></i> Tarifstrukturen</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #d1fae5; color: #065f46; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-file-contract"></i> Vertragsarten</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fee2e2; color: #991b1b; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-building"></i> Provider-Ãœbersicht</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div class="modul-action-button" data-modul-id="grundlagen" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div class="modul-progress-text" data-modul-id="grundlagen" style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 2: Verkaufspsychologie & GesprÃ¤chsfÃ¼hrung -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(16, 185, 129, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#10b981'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('verkaufspsychologie')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);">
                                    ğŸ§ 
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Verkaufspsychologie & GesprÃ¤chsfÃ¼hrung</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">LEVEL 2</span>
                                        <span style="padding: 0.4rem 1rem; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-star" style="color: #f59e0b;"></i> PFLICHT</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Lerne die psychologischen Grundlagen erfolgreicher VerkaufsgesprÃ¤che. Verstehe KundenbedÃ¼rfnisse, baue Vertrauen auf und fÃ¼hre profitable GesprÃ¤che.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #dcfce7; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #10b981; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">15</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #dcfce7; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #10b981; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">120 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-bullseye"></i> Bedarfsanalyse</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-ear-listen"></i> Aktives ZuhÃ¶ren</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #e0e7ff; color: #3730a3; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-question-circle"></i> Fragetechniken</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fce7f3; color: #831843; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-gem"></i> Nutzen-Argumentation</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 3: Einwandbehandlung Masterclass -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(245, 158, 11, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#f59e0b'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('einwandbehandlung')">
                        <div style="position: absolute; top: 20px; right: 20px;"><span style="padding: 0.5rem 1.2rem; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 800; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);"><i class="fas fa-fire"></i> TOP EMPFOHLEN</span></div>
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);">
                                    ğŸ›¡ï¸
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Einwandbehandlung Masterclass</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">LEVEL 3</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Meistere die Kunst der Einwandbehandlung. Von <strong>"Zu teuer"</strong> bis <strong>"Ich muss Ã¼berlegen"</strong> â€“ Du bekommst konkrete Antworten auf <strong style="color: #f59e0b;">ALLE EinwÃ¤nde!</strong></p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fef3c7; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #f59e0b; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">18</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fef3c7; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #f59e0b; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">105 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-euro-sign"></i> "Zu teuer" lÃ¶sen</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e40af; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-clock"></i> "Keine Zeit" meistern</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fee2e2; color: #991b1b; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-lightbulb"></i> "Ich Ã¼berlege" umdrehen</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-check-double"></i> 50+ Real-Beispiele</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 4: Abschlusstechniken & Closing -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(239, 68, 68, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#ef4444'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('abschlusstechniken')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);">
                                    ğŸ¯
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Abschlusstechniken & Closing</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">LEVEL 4</span>
                                        <span style="padding: 0.4rem 1rem; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-star" style="color: #f59e0b;"></i> PFLICHT</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Lerne die effektivsten Abschlusstechniken - von der "Assumptive Close" bis zur "Alternativ-Frage". Mit konkreten Skripten fÃ¼r jeden Kundentyp.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #ef4444; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">14</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #ef4444; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">95 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #fee2e2; color: #7f1d1d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-rocket"></i> Assumptive Close</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-bolt"></i> Alternativ-Frage</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e40af; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-gift"></i> Verknappung</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-scroll"></i> Closing-Skripte</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 5: Produktwissen Komplett -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(99, 102, 241, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#6366f1'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('produktwissen')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #6366f1, #4f46e5); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);">
                                    ğŸ“¦
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Produktwissen Komplett</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">LEVEL 5</span>
                                        <span style="padding: 0.4rem 1rem; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-star" style="color: #f59e0b;"></i> PFLICHT</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Komplettes Produktwissen zu DSL, Mobilfunk, Strom & Versicherungen. Alle Provider, Tarife, Besonderheiten und Verkaufsargumente im Detail.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #6366f1; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">22</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #6366f1; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">180 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e40af; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-signal"></i> Telekom / Vodafone / O2</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #e0e7ff; color: #3730a3; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-globe"></i> DSL / Glasfaser</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-bolt"></i> Strom & Gas</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-shield-alt"></i> Versicherungen</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 6: Kaltakquise & Lead-Generierung -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(168, 85, 247, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#a855f7'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('akquise')">
                        <div style="position: absolute; top: 20px; right: 20px;"><span style="padding: 0.5rem 1.2rem; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 800; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);"><i class="fas fa-fire"></i> TOP EMPFOHLEN</span></div>
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #a855f7, #9333ea); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(168, 85, 247, 0.4);">
                                    ğŸ“
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Kaltakquise & Lead-Generierung</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #a855f7, #9333ea); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);">LEVEL 6</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Baue dir eine eigene Kundenpipeline auf! Lerne Kaltakquise, Networking, Social Selling und wie du jeden Tag neue qualifizierte Leads generierst.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #f3e8ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #a855f7; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">16</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #f3e8ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #a855f7; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">110 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #f3e8ff; color: #581c87; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-phone"></i> Cold Calling Mastery</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e40af; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-handshake"></i> Networking-Strategien</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-mobile-alt"></i> Social Selling</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-filter"></i> Lead-Qualifizierung</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 7: Mindset & Motivation -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(236, 72, 153, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#ec4899'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('mindset')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(236, 72, 153, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(236, 72, 153, 0.4);">
                                    ğŸ’ª
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Mindset & Motivation</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #ec4899, #db2777); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);">LEVEL 7</span>
                                        <span style="padding: 0.4rem 1rem; background: #fee2e2; color: #7f1d1d; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-heart"></i> GAME-CHANGER</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Das richtige Mindset ist 80% deines Erfolgs! Lerne mit Ablehnung umzugehen, bleib motiviert und entwickle die Denkweise eines Top-VerkÃ¤ufers.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fce7f3; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #ec4899; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">10</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #fce7f3; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #ec4899; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">75 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #fce7f3; color: #831843; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-gem"></i> Winner-Mindset</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fee2e2; color: #7f1d1d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-ban"></i> Ablehnung meistern</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-battery-full"></i> Selbstdisziplin</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-bullseye"></i> Zielsetzung</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ğŸ¯ Modul 8: Rechtliche Grundlagen & Compliance -->
                    <div style="background: white; border: 3px solid #e5e7eb; border-radius: 20px; padding: 2.5rem; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 10px 35px rgba(59, 130, 246, 0.25)'; this.style.transform='translateY(-5px)'; this.style.borderColor='#3b82f6'" onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'; this.style.borderColor='#e5e7eb'" onclick="openModul('rechtliches')">
                        <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), transparent); border-radius: 0 0 0 100%;"></div>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem; position: relative; z-index: 1;">
                            <div style="display: flex; align-items: start; gap: 2rem; flex: 1;">
                                <div style="width: 90px; height: 90px; min-width: 90px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);">
                                    âš–ï¸
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <h3 style="margin: 0; font-size: 1.6rem; color: var(--text); font-weight: 800;">Rechtliche Grundlagen & Compliance</h3>
                                        <span style="padding: 0.4rem 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">LEVEL 8</span>
                                        <span style="padding: 0.4rem 1rem; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 0.75rem; font-weight: 700;"><i class="fas fa-star" style="color: #f59e0b;"></i> PFLICHT</span>
                                    </div>
                                    <p style="margin: 0 0 1.5rem 0; font-size: 1.05rem; color: var(--text-light); line-height: 1.7;">Rechtssicher verkaufen! Lerne Datenschutz (DSGVO), Vertragsrecht, Widerrufsbelehrungen und alle Compliance-Anforderungen fÃ¼r legalen Vertrieb.</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-book" style="color: #3b82f6; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Lektionen</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">8</div></div>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-clock" style="color: #3b82f6; font-size: 1.1rem;"></i></div>
                                            <div><div style="font-size: 0.75rem; color: var(--text-light); font-weight: 600;">Dauer</div><div style="font-size: 1rem; font-weight: 800; color: var(--text);">60 Min</div></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                                        <span style="padding: 0.6rem 1.2rem; background: #dbeafe; color: #1e3a8a; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-lock"></i> DSGVO</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #e0e7ff; color: #3730a3; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-file-contract"></i> Vertragsrecht</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #fef3c7; color: #78350f; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-undo-alt"></i> Widerrufsrecht</span>
                                        <span style="padding: 0.6rem 1.2rem; background: #dcfce7; color: #14532d; border-radius: 10px; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-check-circle"></i> Compliance</span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 140px;">
                                <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; font-size: 1rem; font-weight: 800; margin-bottom: 1rem; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35); white-space: nowrap;"><i class="fas fa-play-circle"></i> JETZT STARTEN</div>
                                <div style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Fortschritt: 0%</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- ğŸ¤– KI Verkaufstrainer Page (Bald verfÃ¼gbar) -->
            <!-- ğŸ¤– KI VERKAUFSTRAINER - VOLLSTÃ„NDIGE IMPLEMENTIERUNG -->
            <div class="page-section" id="page-ki-trainer">
                <!-- Premium Header mit Gradient -->
                <div class="ki-trainer-header">
                    <div class="ki-trainer-header-content">
                        <div class="ki-trainer-avatar">
                            <i class="fas fa-robot"></i>
                            <span class="ki-status-live"></span>
                        </div>
                        <div class="ki-trainer-header-text">
                            <h1><i class="fas fa-brain"></i> KI Verkaufstrainer</h1>
                            <p>Dein persÃ¶nlicher Verkaufs-Coach â€¢ Produkt-Empfehlungen â€¢ Einwandbehandlung</p>
                        </div>
                        <div class="ki-trainer-badge">
                            <span class="ki-live-dot"></span> LIVE
                        </div>
                    </div>
                </div>

                <!-- Mode Selector Tabs -->
                <div class="ki-trainer-modes">
                    <button class="ki-mode-btn active" onclick="switchKIMode('chat')" id="ki-mode-chat">
                        <i class="fas fa-comments"></i>
                        <span>Live-Chat</span>
                    </button>
                    <button class="ki-mode-btn" onclick="switchKIMode('produkte')" id="ki-mode-produkte">
                        <i class="fas fa-box-open"></i>
                        <span>Produkt-Berater</span>
                    </button>
                    <button class="ki-mode-btn" onclick="switchKIMode('einwand')" id="ki-mode-einwand">
                        <i class="fas fa-hand-paper"></i>
                        <span>Einwandbehandlung</span>
                    </button>
                    <button class="ki-mode-btn" onclick="switchKIMode('training')" id="ki-mode-training">
                        <i class="fas fa-dumbbell"></i>
                        <span>Verkaufstraining</span>
                    </button>
                    <button class="ki-mode-btn" onclick="switchKIMode('motivation')" id="ki-mode-motivation">
                        <i class="fas fa-fire-alt"></i>
                        <span>Motivator</span>
                    </button>
                </div>

                <!-- Main Content Area -->
                <div class="ki-trainer-content">
                    <!-- Left: Chat/Content Area -->
                    <div class="ki-trainer-main">
                        <!-- Mode: Chat -->
                        <div class="ki-mode-content active" id="ki-content-chat">
                            <div class="ki-chat-container">
                                <div class="ki-chat-messages" id="ki-chat-messages">
                                    <!-- Welcome Message -->
                                    <div class="ki-message bot-message">
                                        <div class="ki-message-avatar">
                                            <i class="fas fa-robot"></i>
                                        </div>
                                        <div class="ki-message-content">
                                            <p>ğŸ‘‹ Hallo! Ich bin dein KI-Verkaufstrainer.</p>
                                            <p>Ich helfe dir bei:</p>
                                            <ul>
                                                <li>ğŸ¯ Das richtige Produkt fÃ¼r deinen Kunden finden</li>
                                                <li>ğŸ’¬ VerkaufsgesprÃ¤che fÃ¼hren</li>
                                                <li>ğŸ›¡ï¸ EinwÃ¤nde professionell behandeln</li>
                                                <li>ğŸ“ˆ Deine Verkaufsskills verbessern</li>
                                            </ul>
                                            <p style="margin-top: 12px; color: #6366f1;"><strong>Wie kann ich dir helfen?</strong></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Questions - ERWEITERT -->
                                <div class="ki-quick-questions">
                                    <button onclick="askKIQuestion('mobilfunk_beratung')">ğŸ“± Handyvertrag beraten</button>
                                    <button onclick="askKIQuestion('zu_teuer')">ğŸ’° "Zu teuer" Einwand</button>
                                    <button onclick="askKIQuestion('abschluss_tipps')">âœ… Abschlusstechniken</button>
                                    <button onclick="askKIQuestion('ueberlegen')">ğŸ¤” "Muss Ã¼berlegen"</button>
                                    <button onclick="askKIQuestion('dsl_empfehlung')">ğŸŒ DSL verkaufen</button>
                                    <button onclick="askKIQuestion('gespraechseinstieg')">ğŸ‘‹ GesprÃ¤chseinstieg</button>
                                    <button onclick="askKIQuestion('kaufsignale')">ğŸ¯ Kaufsignale</button>
                                    <button onclick="askKIQuestion('strom_gas')">âš¡ Strom/Gas</button>
                                </div>

                                <!-- Input -->
                                <div class="ki-chat-input">
                                    <input type="text" id="ki-chat-input" placeholder="Frag mich was zum Verkaufen..." onkeypress="handleKIChatKeypress(event)">
                                    <button onclick="sendKIMessage()" class="ki-send-btn">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Mode: Produkt-Berater - ERWEITERT -->
                        <div class="ki-mode-content" id="ki-content-produkte">
                            <div class="ki-section-header">
                                <h2><i class="fas fa-box-open"></i> Produkt-Berater</h2>
                                <p>Finde das perfekte Produkt fÃ¼r deinen Kunden</p>
                            </div>

                            <!-- Kundenprofil Input -->
                            <div class="ki-card">
                                <h3>ğŸ‘¤ Kundenprofil eingeben</h3>
                                <div class="ki-form-grid">
                                    <div class="ki-form-group">
                                        <label>Was sucht der Kunde?</label>
                                        <select id="ki-produkt-kategorie" onchange="toggleHandyOptions()">
                                            <option value="">Bitte wÃ¤hlen...</option>
                                            <option value="mobilfunk">ğŸ“± Handyvertrag mit GerÃ¤t</option>
                                            <option value="sim-only">ğŸ’³ SIM-Only Tarif</option>
                                            <option value="dsl">ğŸŒ DSL / Internet</option>
                                            <option value="strom">âš¡ Strom</option>
                                            <option value="gas">ğŸ”¥ Gas</option>
                                            <option value="versicherung">ğŸ›¡ï¸ Versicherung</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Handy-Auswahl (nur bei Mobilfunk sichtbar) -->
                                    <div class="ki-form-group" id="ki-handy-gruppe" style="display: none;">
                                        <label>ğŸ“± Welches Handy?</label>
                                        <select id="ki-produkt-handy">
                                            <option value="">Kunde ist offen...</option>
                                            <optgroup label="ğŸ Apple iPhone">
                                                <option value="iphone-15-pro-max">iPhone 15 Pro Max</option>
                                                <option value="iphone-15-pro">iPhone 15 Pro</option>
                                                <option value="iphone-15">iPhone 15</option>
                                                <option value="iphone-14">iPhone 14</option>
                                                <option value="iphone-se">iPhone SE</option>
                                            </optgroup>
                                            <optgroup label="ğŸ“± Samsung Galaxy">
                                                <option value="samsung-s24-ultra">Samsung Galaxy S24 Ultra</option>
                                                <option value="samsung-s24">Samsung Galaxy S24</option>
                                                <option value="samsung-a55">Samsung Galaxy A55</option>
                                                <option value="samsung-a35">Samsung Galaxy A35</option>
                                                <option value="samsung-a15">Samsung Galaxy A15</option>
                                            </optgroup>
                                            <optgroup label="ğŸ”· Xiaomi">
                                                <option value="xiaomi-14">Xiaomi 14</option>
                                                <option value="xiaomi-redmi">Xiaomi Redmi Note 13</option>
                                            </optgroup>
                                            <optgroup label="ğŸ“² Andere">
                                                <option value="google-pixel">Google Pixel 8</option>
                                                <option value="oneplus">OnePlus 12</option>
                                                <option value="guenstig">GÃ¼nstiges Einsteiger-Handy</option>
                                            </optgroup>
                                        </select>
                                    </div>

                                    <div class="ki-form-group">
                                        <label>ğŸ’¶ Budget (monatlich)</label>
                                        <select id="ki-produkt-budget">
                                            <option value="">Egal / Offen</option>
                                            <option value="low">GÃ¼nstig (bis 25â‚¬)</option>
                                            <option value="medium">Mittel (25-45â‚¬)</option>
                                            <option value="high">Premium (45â‚¬+)</option>
                                        </select>
                                    </div>

                                    <div class="ki-form-group">
                                        <label>ğŸ“¶ Bevorzugtes Netz?</label>
                                        <select id="ki-produkt-netz">
                                            <option value="">Egal</option>
                                            <option value="telekom">Telekom (D1) - Beste QualitÃ¤t</option>
                                            <option value="vodafone">Vodafone (D2) - Gut</option>
                                            <option value="o2">O2 - Preis-Leistung</option>
                                        </select>
                                    </div>

                                    <div class="ki-form-group">
                                        <label>ğŸ“Š Datenvolumen-Bedarf?</label>
                                        <select id="ki-produkt-daten">
                                            <option value="">Kunde weiÃŸ nicht</option>
                                            <option value="wenig">Wenig (bis 5 GB)</option>
                                            <option value="normal">Normal (5-15 GB)</option>
                                            <option value="viel">Viel (15-30 GB)</option>
                                            <option value="unlimited">Unlimited / Power-User</option>
                                        </select>
                                    </div>

                                    <div class="ki-form-group">
                                        <label>âœ¨ Wichtig fÃ¼r den Kunden:</label>
                                        <div class="ki-checkbox-group">
                                            <label><input type="checkbox" id="ki-prio-preis"> ğŸ’° GÃ¼nstiger Preis</label>
                                            <label><input type="checkbox" id="ki-prio-netz"> ğŸ“¶ Bestes Netz</label>
                                            <label><input type="checkbox" id="ki-prio-daten"> ğŸ“Š Viel Datenvolumen</label>
                                            <label><input type="checkbox" id="ki-prio-handy"> ğŸ“± Neuestes Handy</label>
                                            <label><input type="checkbox" id="ki-prio-5g"> âš¡ 5G wichtig</label>
                                            <label><input type="checkbox" id="ki-prio-ausland"> ğŸŒ Ausland/Roaming</label>
                                        </div>
                                    </div>
                                </div>
                                <button class="ki-action-btn" onclick="getProduktEmpfehlung()">
                                    <i class="fas fa-magic"></i> Empfehlung generieren
                                </button>
                            </div>

                            <!-- Empfehlung Output -->
                            <div class="ki-card" id="ki-empfehlung-result" style="display: none;">
                                <h3>âœ¨ KI-Empfehlung</h3>
                                <div id="ki-empfehlung-content"></div>
                            </div>
                        </div>

                        <!-- Mode: Einwandbehandlung -->
                        <div class="ki-mode-content" id="ki-content-einwand">
                            <div class="ki-section-header">
                                <h2><i class="fas fa-hand-paper"></i> Einwandbehandlung</h2>
                                <p>Professionelle Antworten auf KundeneinwÃ¤nde</p>
                            </div>

                            <!-- HÃ¤ufige EinwÃ¤nde -->
                            <div class="ki-einwand-grid">
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('zu_teuer')">
                                    <div class="ki-einwand-icon">ğŸ’°</div>
                                    <h4>"Das ist mir zu teuer!"</h4>
                                    <p>Der hÃ¤ufigste Einwand</p>
                                </div>
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('ueberlegen')">
                                    <div class="ki-einwand-icon">ğŸ¤”</div>
                                    <h4>"Ich muss Ã¼berlegen"</h4>
                                    <p>Bedenkzeit-Einwand</p>
                                </div>
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('partner_fragen')">
                                    <div class="ki-einwand-icon">ğŸ‘«</div>
                                    <h4>"Muss Partner fragen"</h4>
                                    <p>EntscheidungshÃ¼rde</p>
                                </div>
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('kein_interesse')">
                                    <div class="ki-einwand-icon">ğŸ™…</div>
                                    <h4>"Kein Interesse"</h4>
                                    <p>Erste Ablehnung</p>
                                </div>
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('vertrag_laeuft')">
                                    <div class="ki-einwand-icon">ğŸ“…</div>
                                    <h4>"Vertrag lÃ¤uft noch"</h4>
                                    <p>Bindungs-Einwand</p>
                                </div>
                                <div class="ki-einwand-card" onclick="showEinwandAntwort('zufrieden')">
                                    <div class="ki-einwand-icon">ğŸ˜Š</div>
                                    <h4>"Bin zufrieden"</h4>
                                    <p>Zufriedenheits-Einwand</p>
                                </div>
                            </div>

                            <!-- Einwand Antwort Modal -->
                            <div class="ki-card" id="ki-einwand-result" style="display: none;">
                                <div class="ki-einwand-header">
                                    <h3 id="ki-einwand-title"></h3>
                                    <button onclick="document.getElementById('ki-einwand-result').style.display='none'" class="ki-close-btn">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div id="ki-einwand-content"></div>
                            </div>
                        </div>

                        <!-- Mode: Verkaufstraining -->
                        <div class="ki-mode-content" id="ki-content-training">
                            <div class="ki-section-header">
                                <h2><i class="fas fa-dumbbell"></i> Verkaufstraining</h2>
                                <p>Ãœbe VerkaufsgesprÃ¤che mit dem KI-Rollenspiel</p>
                            </div>

                            <!-- Training Scenarios -->
                            <div class="ki-training-scenarios">
                                <div class="ki-training-card" onclick="startTraining('handyvertrag')">
                                    <div class="ki-training-icon">ğŸ“±</div>
                                    <div class="ki-training-info">
                                        <h4>Handyvertrag verkaufen</h4>
                                        <p>Ãœbe das klassische Mobilfunk-GesprÃ¤ch</p>
                                        <span class="ki-difficulty easy">Einsteiger</span>
                                    </div>
                                </div>
                                <div class="ki-training-card" onclick="startTraining('upselling')">
                                    <div class="ki-training-icon">â¬†ï¸</div>
                                    <div class="ki-training-info">
                                        <h4>Upselling Meistern</h4>
                                        <p>Vom SIM-Only zum Premium-Bundle</p>
                                        <span class="ki-difficulty medium">Fortgeschritten</span>
                                    </div>
                                </div>
                                <div class="ki-training-card" onclick="startTraining('schwieriger_kunde')">
                                    <div class="ki-training-icon">ğŸ˜¤</div>
                                    <div class="ki-training-info">
                                        <h4>Schwieriger Kunde</h4>
                                        <p>Umgang mit Beschwerden & Ablehnung</p>
                                        <span class="ki-difficulty hard">Profi</span>
                                    </div>
                                </div>
                                <div class="ki-training-card" onclick="startTraining('cross_selling')">
                                    <div class="ki-training-icon">ğŸ”—</div>
                                    <div class="ki-training-info">
                                        <h4>Cross-Selling</h4>
                                        <p>DSL zum Mobilfunk dazu verkaufen</p>
                                        <span class="ki-difficulty medium">Fortgeschritten</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Training Area -->
                            <div class="ki-card" id="ki-training-area" style="display: none;">
                                <div class="ki-training-header">
                                    <h3 id="ki-training-title">ğŸ­ Rollenspiel</h3>
                                    <button onclick="endTraining()" class="ki-end-btn">
                                        <i class="fas fa-stop"></i> Beenden
                                    </button>
                                </div>
                                <div class="ki-training-scenario">
                                    <div class="ki-customer-info">
                                        <img src="https://api.dicebear.com/7.x/personas/svg?seed=customer" alt="Kunde" class="ki-customer-avatar">
                                        <div>
                                            <h4 id="ki-customer-name">Max Mustermann</h4>
                                            <p id="ki-customer-situation">Situation wird geladen...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="ki-chat-messages" id="ki-training-messages" style="height: 250px;"></div>
                                <div class="ki-chat-input">
                                    <input type="text" id="ki-training-input" placeholder="Deine Antwort..." onkeypress="handleTrainingKeypress(event)">
                                    <button onclick="sendTrainingMessage()" class="ki-send-btn">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Mode: Motivator -->
                        <div class="ki-mode-content" id="ki-content-motivation">
                            <div class="ki-section-header">
                                <h2><i class="fas fa-fire-alt"></i> Verkaufs-Motivator</h2>
                                <p>Dein tÃ¤glicher Motivations-Boost</p>
                            </div>

                            <!-- Motivations-Dashboard -->
                            <div class="ki-motivation-grid">
                                <div class="ki-motivation-card main">
                                    <div class="ki-motivation-quote" id="ki-motivation-quote">
                                        <i class="fas fa-quote-left"></i>
                                        <p>"Der Unterschied zwischen einem erfolgreichen Menschen und anderen ist nicht ein Mangel an StÃ¤rke oder Wissen, sondern ein Mangel an Willen."</p>
                                        <span>- Vince Lombardi</span>
                                    </div>
                                    <button onclick="getNewMotivation()" class="ki-action-btn">
                                        <i class="fas fa-sync-alt"></i> Neuer Spruch
                                    </button>
                                </div>

                                <div class="ki-motivation-card">
                                    <div class="ki-motivation-icon">ğŸ¯</div>
                                    <h4>Tages-Challenge</h4>
                                    <p id="ki-daily-challenge">FÃ¼hre heute 3 VerkaufsgesprÃ¤che mit der Einwand-Technik "Wertargumentation"</p>
                                    <button onclick="getNewChallenge()" class="ki-small-btn">Neue Challenge</button>
                                </div>

                                <div class="ki-motivation-card">
                                    <div class="ki-motivation-icon">ğŸ’¡</div>
                                    <h4>Verkaufstipp des Tages</h4>
                                    <p id="ki-daily-tip">Frage immer "Was ist Ihnen besonders wichtig?" bevor du ein Produkt empfiehlst.</p>
                                    <button onclick="getNewTip()" class="ki-small-btn">Neuer Tipp</button>
                                </div>

                                <div class="ki-motivation-card">
                                    <div class="ki-motivation-icon">ğŸ†</div>
                                    <h4>Dein Potenzial heute</h4>
                                    <div class="ki-potential-calc">
                                        <p>Bei <strong>5 GesprÃ¤chen</strong> und <strong>30% Abschlussquote</strong>:</p>
                                        <div class="ki-potential-result">
                                            <span class="ki-potential-number">~750â‚¬</span>
                                            <span>mÃ¶gliche Provision</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Erfolgs-Affirmationen -->
                            <div class="ki-card">
                                <h3>ğŸŒŸ Erfolgs-Affirmationen</h3>
                                <div class="ki-affirmations">
                                    <div class="ki-affirmation">âœ… Ich bin ein ausgezeichneter VerkÃ¤ufer</div>
                                    <div class="ki-affirmation">âœ… Jedes Nein bringt mich nÃ¤her zum Ja</div>
                                    <div class="ki-affirmation">âœ… Ich helfe Menschen, die beste LÃ¶sung zu finden</div>
                                    <div class="ki-affirmation">âœ… Mein Erfolg ist das Ergebnis meiner Einstellung</div>
                                    <div class="ki-affirmation">âœ… Ich werde jeden Tag besser</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Quick Info Sidebar -->
                    <div class="ki-trainer-sidebar">
                        <div class="ki-sidebar-card">
                            <h4><i class="fas fa-lightbulb"></i> Quick-Tipps</h4>
                            <div class="ki-tips-list">
                                <div class="ki-tip">
                                    <span class="ki-tip-num">1</span>
                                    <p>Stelle offene Fragen (Wie, Was, Warum)</p>
                                </div>
                                <div class="ki-tip">
                                    <span class="ki-tip-num">2</span>
                                    <p>HÃ¶re aktiv zu - 70% ZuhÃ¶ren, 30% Reden</p>
                                </div>
                                <div class="ki-tip">
                                    <span class="ki-tip-num">3</span>
                                    <p>Nutzen vor Preis kommunizieren</p>
                                </div>
                                <div class="ki-tip">
                                    <span class="ki-tip-num">4</span>
                                    <p>Kaufsignale erkennen und direkt abschlieÃŸen</p>
                                </div>
                            </div>
                        </div>

                        <div class="ki-sidebar-card">
                            <h4><i class="fas fa-book"></i> Aus der Akademie</h4>
                            <div class="ki-akademie-links">
                                <a onclick="goToAkademieModule('grundlagen')">ğŸ“± Mobilfunk Grundlagen</a>
                                <a onclick="goToAkademieModule('verkaufspsychologie')">ğŸ§  Verkaufspsychologie</a>
                                <a onclick="goToAkademieModule('einwandbehandlung')">ğŸ›¡ï¸ Einwandbehandlung</a>
                            </div>
                        </div>

                        <div class="ki-sidebar-card highlight">
                            <h4><i class="fas fa-trophy"></i> Dein Score</h4>
                            <div class="ki-score-display">
                                <div class="ki-score-number" id="ki-partner-score">85</div>
                                <div class="ki-score-label">Verkaufs-Score</div>
                            </div>
                            <div class="ki-score-bar">
                                <div class="ki-score-fill" style="width: 85%;"></div>
                            </div>
                            <p class="ki-score-tip">ğŸ’¡ Trainiere mehr, um deinen Score zu erhÃ¶hen!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KI VERKAUFSTRAINER STYLES -->
            <style>
                /* Header */
                .ki-trainer-header {
                    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
                    border-radius: 20px;
                    padding: 24px 28px;
                    margin-bottom: 24px;
                    box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);
                }

                .ki-trainer-header-content {
                    display: flex;
                    align-items: center;
                    gap: 20px;
                }

                .ki-trainer-avatar {
                    width: 60px;
                    height: 60px;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 16px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 28px;
                    color: white;
                    position: relative;
                }

                .ki-status-live {
                    position: absolute;
                    bottom: -4px;
                    right: -4px;
                    width: 16px;
                    height: 16px;
                    background: #22c55e;
                    border-radius: 50%;
                    border: 3px solid white;
                    animation: livePulse 2s ease-in-out infinite;
                }

                @keyframes livePulse {
                    0%, 100% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.2); opacity: 0.8; }
                }

                .ki-trainer-header-text {
                    flex: 1;
                }

                .ki-trainer-header-text h1 {
                    color: white;
                    font-size: 1.6rem;
                    font-weight: 700;
                    margin: 0 0 4px 0;
                }

                .ki-trainer-header-text p {
                    color: rgba(255, 255, 255, 0.9);
                    margin: 0;
                    font-size: 0.95rem;
                }

                .ki-trainer-badge {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 8px 16px;
                    border-radius: 50px;
                    color: white;
                    font-weight: 700;
                    font-size: 0.85rem;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .ki-live-dot {
                    width: 8px;
                    height: 8px;
                    background: #22c55e;
                    border-radius: 50%;
                    animation: livePulse 2s ease-in-out infinite;
                }

                /* Mode Tabs */
                .ki-trainer-modes {
                    display: flex;
                    gap: 8px;
                    padding: 8px;
                    background: #f1f5f9;
                    border-radius: 16px;
                    margin-bottom: 24px;
                    overflow-x: auto;
                }

                .ki-mode-btn {
                    flex: 1;
                    min-width: 120px;
                    padding: 14px 20px;
                    background: transparent;
                    border: none;
                    border-radius: 12px;
                    cursor: pointer;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 6px;
                    font-size: 0.85rem;
                    color: #64748b;
                    font-weight: 600;
                    transition: all 0.25s ease;
                }

                .ki-mode-btn i {
                    font-size: 1.2rem;
                }

                .ki-mode-btn:hover {
                    background: white;
                    color: #6366f1;
                }

                .ki-mode-btn.active {
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    color: white;
                    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
                }

                /* Main Content Layout */
                .ki-trainer-content {
                    display: grid;
                    grid-template-columns: 1fr 300px;
                    gap: 24px;
                }

                @media (max-width: 1024px) {
                    .ki-trainer-content {
                        grid-template-columns: 1fr;
                    }
                    .ki-trainer-sidebar {
                        display: none;
                    }
                }

                .ki-trainer-main {
                    min-height: 500px;
                }

                .ki-mode-content {
                    display: none;
                }

                .ki-mode-content.active {
                    display: block;
                    animation: fadeIn 0.3s ease;
                }

                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }

                /* Section Header */
                .ki-section-header {
                    margin-bottom: 24px;
                }

                .ki-section-header h2 {
                    font-size: 1.4rem;
                    color: #1e293b;
                    margin: 0 0 8px 0;
                    font-weight: 700;
                }

                .ki-section-header p {
                    color: #64748b;
                    margin: 0;
                }

                /* Cards */
                .ki-card {
                    background: white;
                    border-radius: 16px;
                    padding: 24px;
                    margin-bottom: 20px;
                    border: 1px solid #e2e8f0;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
                }

                .ki-card h3 {
                    font-size: 1.1rem;
                    color: #1e293b;
                    margin: 0 0 16px 0;
                    font-weight: 700;
                }

                /* Chat Container */
                .ki-chat-container {
                    background: white;
                    border-radius: 16px;
                    border: 1px solid #e2e8f0;
                    overflow: hidden;
                }

                .ki-chat-messages {
                    height: 280px;
                    overflow-y: auto;
                    padding: 16px;
                    display: flex;
                    flex-direction: column;
                    gap: 14px;
                    background: #f8fafc;
                }

                .ki-message {
                    display: flex;
                    gap: 12px;
                    max-width: 85%;
                    animation: messageSlide 0.3s ease;
                }

                @keyframes messageSlide {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }

                .ki-message.bot-message {
                    align-self: flex-start;
                }

                .ki-message.user-message {
                    align-self: flex-end;
                    flex-direction: row-reverse;
                }

                .ki-message-avatar {
                    width: 36px;
                    height: 36px;
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                }

                .bot-message .ki-message-avatar {
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    color: white;
                }

                .user-message .ki-message-avatar {
                    background: #e2e8f0;
                    color: #64748b;
                }

                .ki-message-content {
                    padding: 14px 18px;
                    border-radius: 16px;
                    font-size: 0.95rem;
                    line-height: 1.6;
                }

                .bot-message .ki-message-content {
                    background: white;
                    color: #1e293b;
                    border: 1px solid #e2e8f0;
                    border-bottom-left-radius: 4px;
                }

                .user-message .ki-message-content {
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    color: white;
                    border-bottom-right-radius: 4px;
                }

                .ki-message-content p {
                    margin: 0 0 8px 0;
                }

                .ki-message-content p:last-child {
                    margin-bottom: 0;
                }

                .ki-message-content ul {
                    margin: 8px 0;
                    padding-left: 20px;
                }

                .ki-message-content li {
                    margin: 4px 0;
                }

                /* Quick Questions */
                .ki-quick-questions {
                    padding: 12px 16px;
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                    background: white;
                    border-top: 1px solid #e2e8f0;
                }

                .ki-quick-questions button {
                    padding: 8px 14px;
                    background: #f1f5f9;
                    border: 1px solid #e2e8f0;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    color: #475569;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .ki-quick-questions button:hover {
                    background: #6366f1;
                    color: white;
                    border-color: #6366f1;
                }

                /* Chat Input */
                .ki-chat-input {
                    padding: 16px;
                    background: white;
                    border-top: 1px solid #e2e8f0;
                    display: flex;
                    gap: 12px;
                }

                .ki-chat-input input {
                    flex: 1;
                    padding: 14px 18px;
                    border: 1px solid #e2e8f0;
                    border-radius: 24px;
                    font-size: 0.95rem;
                    outline: none;
                    transition: all 0.2s;
                }

                .ki-chat-input input:focus {
                    border-color: #6366f1;
                    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
                }

                .ki-send-btn {
                    width: 48px;
                    height: 48px;
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    border: none;
                    border-radius: 50%;
                    color: white;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s;
                }

                .ki-send-btn:hover {
                    transform: scale(1.05);
                    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
                }

                /* Form Elements */
                .ki-form-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 16px;
                    margin-bottom: 20px;
                }

                .ki-form-group {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                }

                .ki-form-group label {
                    font-weight: 600;
                    color: #475569;
                    font-size: 0.9rem;
                }

                .ki-form-group select {
                    padding: 12px 16px;
                    border: 1px solid #e2e8f0;
                    border-radius: 10px;
                    font-size: 0.95rem;
                    background: white;
                    cursor: pointer;
                }

                .ki-checkbox-group {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 12px;
                }

                .ki-checkbox-group label {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    font-weight: 500;
                    cursor: pointer;
                }

                .ki-action-btn {
                    padding: 14px 28px;
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    border: none;
                    border-radius: 12px;
                    color: white;
                    font-size: 1rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    transition: all 0.2s;
                }

                .ki-action-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
                }

                /* Einwand Grid */
                .ki-einwand-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                    gap: 16px;
                    margin-bottom: 24px;
                }

                .ki-einwand-card {
                    background: white;
                    border: 2px solid #e2e8f0;
                    border-radius: 16px;
                    padding: 20px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.25s ease;
                }

                .ki-einwand-card:hover {
                    border-color: #6366f1;
                    transform: translateY(-4px);
                    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
                }

                .ki-einwand-icon {
                    font-size: 2.5rem;
                    margin-bottom: 12px;
                }

                .ki-einwand-card h4 {
                    font-size: 0.95rem;
                    color: #1e293b;
                    margin: 0 0 6px 0;
                }

                .ki-einwand-card p {
                    font-size: 0.8rem;
                    color: #64748b;
                    margin: 0;
                }

                .ki-einwand-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                }

                .ki-close-btn {
                    width: 32px;
                    height: 32px;
                    background: #f1f5f9;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    color: #64748b;
                }

                /* Training */
                .ki-training-scenarios {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 16px;
                    margin-bottom: 24px;
                }

                .ki-training-card {
                    background: white;
                    border: 2px solid #e2e8f0;
                    border-radius: 16px;
                    padding: 20px;
                    display: flex;
                    gap: 16px;
                    cursor: pointer;
                    transition: all 0.25s ease;
                }

                .ki-training-card:hover {
                    border-color: #6366f1;
                    transform: translateY(-4px);
                    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
                }

                .ki-training-icon {
                    font-size: 2rem;
                    width: 50px;
                    height: 50px;
                    background: #f1f5f9;
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .ki-training-info h4 {
                    margin: 0 0 4px 0;
                    color: #1e293b;
                    font-size: 1rem;
                }

                .ki-training-info p {
                    margin: 0 0 8px 0;
                    color: #64748b;
                    font-size: 0.85rem;
                }

                .ki-difficulty {
                    padding: 4px 10px;
                    border-radius: 20px;
                    font-size: 0.75rem;
                    font-weight: 600;
                }

                .ki-difficulty.easy { background: #dcfce7; color: #16a34a; }
                .ki-difficulty.medium { background: #fef3c7; color: #d97706; }
                .ki-difficulty.hard { background: #fee2e2; color: #dc2626; }

                .ki-training-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                }

                .ki-end-btn {
                    padding: 8px 16px;
                    background: #fee2e2;
                    border: none;
                    border-radius: 8px;
                    color: #dc2626;
                    font-weight: 600;
                    cursor: pointer;
                }

                .ki-customer-info {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    padding: 16px;
                    background: #f1f5f9;
                    border-radius: 12px;
                    margin-bottom: 16px;
                }

                .ki-customer-avatar {
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background: #e2e8f0;
                }

                /* Motivation */
                .ki-motivation-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 20px;
                    margin-bottom: 24px;
                }

                .ki-motivation-card {
                    background: white;
                    border-radius: 16px;
                    padding: 24px;
                    border: 1px solid #e2e8f0;
                }

                .ki-motivation-card.main {
                    grid-column: 1 / -1;
                    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                    border: none;
                }

                .ki-motivation-quote {
                    text-align: center;
                    margin-bottom: 20px;
                }

                .ki-motivation-quote i {
                    font-size: 2rem;
                    color: #d97706;
                    margin-bottom: 12px;
                }

                .ki-motivation-quote p {
                    font-size: 1.3rem;
                    font-weight: 600;
                    color: #92400e;
                    line-height: 1.5;
                    margin: 0 0 12px 0;
                }

                .ki-motivation-quote span {
                    color: #b45309;
                    font-style: italic;
                }

                .ki-motivation-icon {
                    font-size: 2rem;
                    margin-bottom: 12px;
                }

                .ki-motivation-card h4 {
                    font-size: 1rem;
                    color: #1e293b;
                    margin: 0 0 8px 0;
                }

                .ki-motivation-card p {
                    color: #64748b;
                    font-size: 0.9rem;
                    margin: 0 0 12px 0;
                    line-height: 1.5;
                }

                .ki-small-btn {
                    padding: 8px 14px;
                    background: #f1f5f9;
                    border: 1px solid #e2e8f0;
                    border-radius: 8px;
                    color: #6366f1;
                    font-size: 0.85rem;
                    font-weight: 600;
                    cursor: pointer;
                }

                .ki-potential-calc {
                    background: #f1f5f9;
                    border-radius: 12px;
                    padding: 16px;
                    text-align: center;
                }

                .ki-potential-result {
                    margin-top: 12px;
                }

                .ki-potential-number {
                    font-size: 2rem;
                    font-weight: 800;
                    color: #22c55e;
                    display: block;
                }

                .ki-affirmations {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }

                .ki-affirmation {
                    padding: 12px 16px;
                    background: linear-gradient(135deg, #f0fdf4, #dcfce7);
                    border-radius: 10px;
                    color: #166534;
                    font-weight: 500;
                }

                /* Sidebar */
                .ki-trainer-sidebar {
                    display: flex;
                    flex-direction: column;
                    gap: 20px;
                }

                .ki-sidebar-card {
                    background: white;
                    border-radius: 16px;
                    padding: 20px;
                    border: 1px solid #e2e8f0;
                }

                .ki-sidebar-card h4 {
                    font-size: 0.95rem;
                    color: #1e293b;
                    margin: 0 0 16px 0;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .ki-sidebar-card h4 i {
                    color: #6366f1;
                }

                .ki-tips-list {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }

                .ki-tip {
                    display: flex;
                    gap: 12px;
                    align-items: flex-start;
                }

                .ki-tip-num {
                    width: 24px;
                    height: 24px;
                    background: linear-gradient(135deg, #6366f1, #8b5cf6);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.75rem;
                    font-weight: 700;
                    flex-shrink: 0;
                }

                .ki-tip p {
                    margin: 0;
                    font-size: 0.85rem;
                    color: #475569;
                    line-height: 1.4;
                }

                .ki-akademie-links {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                }

                .ki-akademie-links a {
                    padding: 10px 14px;
                    background: #f1f5f9;
                    border-radius: 8px;
                    color: #475569;
                    text-decoration: none;
                    font-size: 0.85rem;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .ki-akademie-links a:hover {
                    background: #6366f1;
                    color: white;
                }

                .ki-sidebar-card.highlight {
                    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                    color: white;
                    border: none;
                }

                .ki-sidebar-card.highlight h4 {
                    color: white;
                }

                .ki-sidebar-card.highlight h4 i {
                    color: #fde68a;
                }

                .ki-score-display {
                    text-align: center;
                    margin-bottom: 16px;
                }

                .ki-score-number {
                    font-size: 3rem;
                    font-weight: 800;
                }

                .ki-score-label {
                    font-size: 0.85rem;
                    opacity: 0.9;
                }

                .ki-score-bar {
                    height: 8px;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 4px;
                    overflow: hidden;
                    margin-bottom: 12px;
                }

                .ki-score-fill {
                    height: 100%;
                    background: white;
                    border-radius: 4px;
                }

                .ki-score-tip {
                    font-size: 0.8rem;
                    opacity: 0.9;
                    margin: 0;
                }

                /* Mobile Responsive - APP-LIKE DESIGN */
                @media (max-width: 768px) {
                    .ki-trainer-header {
                        padding: 16px;
                        border-radius: 16px;
                        margin-bottom: 16px;
                    }

                    .ki-trainer-header-content {
                        flex-wrap: wrap;
                        gap: 12px;
                    }

                    .ki-trainer-avatar {
                        width: 48px;
                        height: 48px;
                        font-size: 22px;
                    }

                    .ki-trainer-header-text h1 {
                        font-size: 1.2rem;
                    }

                    .ki-trainer-header-text p {
                        font-size: 0.8rem;
                    }

                    .ki-trainer-badge {
                        padding: 6px 12px;
                        font-size: 0.75rem;
                    }

                    .ki-trainer-modes {
                        overflow-x: auto;
                        -webkit-overflow-scrolling: touch;
                        padding: 6px;
                        margin-bottom: 16px;
                        gap: 6px;
                    }

                    .ki-mode-btn {
                        min-width: 85px;
                        padding: 10px 12px;
                        font-size: 0.7rem;
                        gap: 4px;
                    }

                    .ki-mode-btn i {
                        font-size: 1rem;
                    }

                    .ki-trainer-content {
                        grid-template-columns: 1fr;
                        gap: 16px;
                    }

                    .ki-trainer-sidebar {
                        display: none;
                    }

                    .ki-section-header h2 {
                        font-size: 1.2rem;
                    }

                    .ki-section-header p {
                        font-size: 0.85rem;
                    }

                    .ki-card {
                        padding: 16px;
                        border-radius: 14px;
                        margin-bottom: 14px;
                    }

                    .ki-card h3 {
                        font-size: 1rem;
                    }

                    /* Chat Container Mobile */
                    .ki-chat-container {
                        border-radius: 14px;
                    }

                    .ki-chat-messages {
                        height: 300px;
                        padding: 14px;
                        gap: 12px;
                    }

                    .ki-message {
                        max-width: 90%;
                        gap: 8px;
                    }

                    .ki-message-avatar {
                        width: 30px;
                        height: 30px;
                        font-size: 12px;
                    }

                    .ki-message-content {
                        padding: 10px 14px;
                        font-size: 0.85rem;
                        border-radius: 14px;
                    }

                    .ki-quick-questions {
                        padding: 10px 12px;
                        gap: 6px;
                        overflow-x: auto;
                        flex-wrap: nowrap;
                        -webkit-overflow-scrolling: touch;
                    }

                    .ki-quick-questions button {
                        font-size: 0.75rem;
                        padding: 6px 10px;
                        white-space: nowrap;
                        flex-shrink: 0;
                    }

                    .ki-chat-input {
                        padding: 12px;
                        gap: 10px;
                    }

                    .ki-chat-input input {
                        padding: 10px 14px;
                        font-size: 14px;
                    }

                    .ki-send-btn {
                        width: 42px;
                        height: 42px;
                    }

                    /* Form Grid Mobile */
                    .ki-form-grid {
                        grid-template-columns: 1fr;
                        gap: 12px;
                    }

                    .ki-form-group label {
                        font-size: 0.85rem;
                    }

                    .ki-form-group select {
                        padding: 10px 14px;
                        font-size: 14px;
                    }

                    .ki-checkbox-group {
                        gap: 10px;
                    }

                    .ki-checkbox-group label {
                        font-size: 0.85rem;
                    }

                    .ki-action-btn {
                        width: 100%;
                        padding: 14px 20px;
                        font-size: 0.95rem;
                        justify-content: center;
                    }

                    /* Einwand Grid Mobile */
                    .ki-einwand-grid {
                        grid-template-columns: repeat(2, 1fr);
                        gap: 10px;
                    }

                    .ki-einwand-card {
                        padding: 14px;
                        border-radius: 12px;
                    }

                    .ki-einwand-icon {
                        font-size: 1.8rem;
                        margin-bottom: 8px;
                    }

                    .ki-einwand-card h4 {
                        font-size: 0.8rem;
                    }

                    .ki-einwand-card p {
                        font-size: 0.7rem;
                    }

                    /* Training Cards Mobile */
                    .ki-training-scenarios {
                        grid-template-columns: 1fr;
                        gap: 12px;
                    }

                    .ki-training-card {
                        padding: 14px;
                        gap: 12px;
                    }

                    .ki-training-icon {
                        width: 44px;
                        height: 44px;
                        font-size: 1.5rem;
                    }

                    .ki-training-info h4 {
                        font-size: 0.95rem;
                    }

                    .ki-training-info p {
                        font-size: 0.8rem;
                    }

                    /* Motivation Mobile */
                    .ki-motivation-grid {
                        grid-template-columns: 1fr;
                        gap: 14px;
                    }

                    .ki-motivation-card {
                        padding: 16px;
                    }

                    .ki-motivation-quote p {
                        font-size: 1.1rem;
                    }

                    .ki-affirmation {
                        padding: 10px 14px;
                        font-size: 0.85rem;
                    }

                    /* Produkt-Berater Output Mobile */
                    #ki-empfehlung-content > div {
                        padding: 14px !important;
                    }

                    #ki-empfehlung-content [style*="grid-template-columns: 1fr 1fr"] {
                        grid-template-columns: 1fr !important;
                    }
                }

                /* Extra small screens */
                @media (max-width: 400px) {
                    .ki-trainer-header {
                        padding: 12px;
                    }

                    .ki-trainer-avatar {
                        width: 40px;
                        height: 40px;
                        font-size: 18px;
                    }

                    .ki-trainer-header-text h1 {
                        font-size: 1rem;
                    }

                    .ki-mode-btn {
                        min-width: 75px;
                        padding: 8px 10px;
                        font-size: 0.65rem;
                    }

                    .ki-einwand-grid {
                        grid-template-columns: 1fr;
                    }

                    .ki-chat-messages {
                        height: 260px;
                    }
                }

                /* ========================================
                   ğŸ“± ULTRA MOBILE OPTIMIERUNG - APP STYLE
                   ======================================== */
                @media (max-width: 768px) {
                    /* Produkt-Berater Form Mobile */
                    .ki-form-grid {
                        grid-template-columns: 1fr !important;
                        gap: 14px !important;
                    }
                    
                    .ki-form-group select {
                        width: 100% !important;
                        padding: 14px 16px !important;
                        font-size: 16px !important; /* Verhindert iOS Zoom */
                        border-radius: 12px !important;
                        background-size: 14px !important;
                        -webkit-appearance: none;
                        appearance: none;
                    }
                    
                    .ki-form-group label {
                        font-size: 0.9rem !important;
                        font-weight: 600 !important;
                        margin-bottom: 6px !important;
                    }
                    
                    /* Checkbox Gruppe Mobile - Touch-freundlich */
                    .ki-checkbox-group {
                        display: grid !important;
                        grid-template-columns: 1fr 1fr !important;
                        gap: 10px !important;
                    }
                    
                    .ki-checkbox-group label {
                        display: flex !important;
                        align-items: center !important;
                        gap: 8px !important;
                        padding: 12px 14px !important;
                        background: rgba(99, 102, 241, 0.08) !important;
                        border-radius: 10px !important;
                        font-size: 0.85rem !important;
                        cursor: pointer !important;
                        transition: all 0.2s !important;
                    }
                    
                    .ki-checkbox-group label:active {
                        transform: scale(0.98) !important;
                        background: rgba(99, 102, 241, 0.15) !important;
                    }
                    
                    .ki-checkbox-group input[type="checkbox"] {
                        width: 20px !important;
                        height: 20px !important;
                        accent-color: #6366f1 !important;
                    }
                    
                    /* Action Button Mobile - Full Width & Touch */
                    .ki-action-btn {
                        width: 100% !important;
                        padding: 16px 24px !important;
                        font-size: 1rem !important;
                        font-weight: 600 !important;
                        border-radius: 14px !important;
                        justify-content: center !important;
                        gap: 10px !important;
                        touch-action: manipulation !important;
                    }
                    
                    .ki-action-btn:active {
                        transform: scale(0.98) !important;
                    }
                    
                    /* Empfehlung Output Mobile */
                    #ki-empfehlung-content > div {
                        padding: 14px !important;
                        border-radius: 14px !important;
                    }
                    
                    #ki-empfehlung-content [style*="grid-template-columns"] {
                        grid-template-columns: 1fr !important;
                    }
                    
                    /* Einwand Grid Mobile - 1 Spalte */
                    .ki-einwand-grid {
                        grid-template-columns: 1fr !important;
                        gap: 12px !important;
                    }
                    
                    .ki-einwand-card {
                        padding: 18px !important;
                        border-radius: 14px !important;
                        display: flex !important;
                        align-items: center !important;
                        gap: 14px !important;
                        flex-direction: row !important;
                    }
                    
                    .ki-einwand-card:active {
                        transform: scale(0.98) !important;
                    }
                    
                    .ki-einwand-icon {
                        font-size: 2rem !important;
                        margin-bottom: 0 !important;
                        min-width: 50px !important;
                        text-align: center !important;
                    }
                    
                    .ki-einwand-card h4 {
                        font-size: 0.95rem !important;
                        margin-bottom: 4px !important;
                    }
                    
                    .ki-einwand-card p {
                        font-size: 0.8rem !important;
                        margin: 0 !important;
                    }
                    
                    /* Training Szenarien Mobile */
                    .ki-training-scenarios {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .ki-training-card {
                        padding: 16px !important;
                        border-radius: 14px !important;
                    }
                    
                    /* Quick Questions Horizontal Scroll */
                    .ki-quick-questions {
                        display: flex !important;
                        overflow-x: auto !important;
                        -webkit-overflow-scrolling: touch !important;
                        scrollbar-width: none !important;
                        gap: 8px !important;
                        padding: 12px !important;
                    }
                    
                    .ki-quick-questions::-webkit-scrollbar {
                        display: none !important;
                    }
                    
                    .ki-quick-questions button {
                        flex-shrink: 0 !important;
                        white-space: nowrap !important;
                        padding: 10px 16px !important;
                        font-size: 0.85rem !important;
                        border-radius: 20px !important;
                    }
                    
                    /* Chat Messages - Full Height Mobile */
                    .ki-chat-messages {
                        height: calc(50vh - 100px) !important;
                        min-height: 280px !important;
                        max-height: 400px !important;
                    }
                    
                    /* Message Bubbles Mobile */
                    .ki-message {
                        max-width: 88% !important;
                    }
                    
                    .ki-message-content {
                        padding: 12px 16px !important;
                        font-size: 0.9rem !important;
                        line-height: 1.5 !important;
                        border-radius: 18px !important;
                    }
                    
                    /* Input Field Mobile - Sticky Bottom */
                    .ki-chat-input {
                        position: sticky !important;
                        bottom: 0 !important;
                        padding: 14px !important;
                        background: linear-gradient(to top, var(--glass), transparent) !important;
                        backdrop-filter: blur(20px) !important;
                        gap: 12px !important;
                    }
                    
                    .ki-chat-input input {
                        padding: 14px 18px !important;
                        font-size: 16px !important; /* Prevent iOS zoom */
                        border-radius: 24px !important;
                    }
                    
                    .ki-send-btn {
                        width: 48px !important;
                        height: 48px !important;
                        min-width: 48px !important;
                        border-radius: 24px !important;
                    }
                    
                    /* Motivation Grid Mobile */
                    .ki-motivation-grid {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .ki-motivation-card {
                        padding: 18px !important;
                        border-radius: 14px !important;
                    }
                    
                    /* Mode Buttons - Horizontal Scroll */
                    .ki-trainer-modes {
                        display: flex !important;
                        overflow-x: auto !important;
                        -webkit-overflow-scrolling: touch !important;
                        scrollbar-width: none !important;
                        padding: 8px !important;
                        gap: 8px !important;
                        margin: 0 -12px 16px -12px !important;
                        padding-left: 12px !important;
                        padding-right: 12px !important;
                    }
                    
                    .ki-trainer-modes::-webkit-scrollbar {
                        display: none !important;
                    }
                    
                    .ki-mode-btn {
                        flex-shrink: 0 !important;
                        padding: 12px 16px !important;
                        min-width: auto !important;
                        font-size: 0.8rem !important;
                        white-space: nowrap !important;
                        border-radius: 12px !important;
                    }
                    
                    .ki-mode-btn i {
                        font-size: 1.1rem !important;
                    }
                    
                    /* Header Mobile - Kompakter */
                    .ki-trainer-header {
                        padding: 14px !important;
                        border-radius: 14px !important;
                        margin: 0 !important;
                    }
                    
                    .ki-trainer-header-content {
                        flex-wrap: nowrap !important;
                        gap: 10px !important;
                    }
                    
                    .ki-trainer-avatar {
                        width: 44px !important;
                        height: 44px !important;
                        font-size: 20px !important;
                    }
                    
                    .ki-trainer-header-text h1 {
                        font-size: 1.1rem !important;
                    }
                    
                    .ki-trainer-header-text p {
                        font-size: 0.75rem !important;
                    }
                    
                    .ki-trainer-badge {
                        position: absolute !important;
                        top: 14px !important;
                        right: 14px !important;
                        padding: 4px 10px !important;
                        font-size: 0.65rem !important;
                    }
                    
                    /* Cards Mobile - Touch Feedback */
                    .ki-card {
                        padding: 18px !important;
                        border-radius: 16px !important;
                        margin-bottom: 16px !important;
                    }
                    
                    .ki-card h3 {
                        font-size: 1.05rem !important;
                        margin-bottom: 14px !important;
                    }
                    
                    /* Section Headers */
                    .ki-section-header {
                        padding: 0 4px !important;
                        margin-bottom: 16px !important;
                    }
                    
                    .ki-section-header h2 {
                        font-size: 1.15rem !important;
                    }
                    
                    .ki-section-header p {
                        font-size: 0.85rem !important;
                    }
                }

                /* Extra kleine Screens (< 380px) */
                @media (max-width: 380px) {
                    .ki-checkbox-group {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .ki-checkbox-group label {
                        padding: 10px 12px !important;
                    }
                    
                    .ki-trainer-header-text h1 {
                        font-size: 1rem !important;
                    }
                    
                    .ki-mode-btn {
                        padding: 10px 14px !important;
                        font-size: 0.75rem !important;
                    }
                    
                    .ki-einwand-card {
                        padding: 14px !important;
                    }
                    
                    .ki-action-btn {
                        padding: 14px 20px !important;
                    }
                }
            </style>

            <!-- Kalender Page -->
            <div class="page-section" id="page-kalender">
                <div style="margin-bottom: 2rem;">
                    <h1 style="font-size: 2rem; color: var(--text); margin-bottom: 0.5rem; font-weight: 800;">
                        <i class="fas fa-calendar-alt" style="color: var(--primary);"></i> Meine Termine
                    </h1>
                    <p style="font-size: 1.1rem; color: var(--text-light);">Verwalte deine Termine und Meetings</p>
                </div>

                <!-- Neuer Termin Button -->
                <div style="margin-bottom: 2rem;">
                    <button class="action-btn btn-primary" onclick="openNeuerPartnerTerminModal()" style="font-size: 16px; padding: 12px 24px;">
                        <i class="fas fa-plus-circle"></i> Neuer Termin
                    </button>
                </div>

                <!-- Kalender & Termine nebeneinander -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    
                    <!-- Kalender -->
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">
                                <i class="fas fa-calendar-alt"></i> Kalender
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="partnerChangeMonth(-1)" style="padding: 8px 12px; background: var(--bg-light); border: 2px solid var(--border); border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button onclick="partnerChangeMonth(1)" style="padding: 8px 12px; background: var(--bg-light); border: 2px solid var(--border); border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Monat/Jahr Anzeige -->
                        <div id="partner-calendar-header" style="text-align: center; font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 20px; padding: 12px; background: var(--bg-light); border-radius: 8px;">
                            November 2025
                        </div>
                        
                        <!-- Kalender Grid -->
                        <div id="partner-calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                            <!-- Wird mit JavaScript gefÃ¼llt -->
                        </div>
                    </div>

                    <!-- Termine Liste -->
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">
                                <i class="fas fa-list"></i> Kommende Termine
                            </div>
                            <button class="action-btn btn-primary" onclick="loadPartnerTermine()" style="padding: 8px 12px;">
                                <i class="fas fa-sync"></i>
                            </button>
                        </div>
                        
                        <div id="partner-termine-liste" style="display: flex; flex-direction: column; gap: 12px; max-height: 500px; overflow-y: auto;">
                            <!-- Wird mit JavaScript gefÃ¼llt -->
                            <div style="text-align: center; padding: 40px; color: var(--text-light);">
                                <i class="fas fa-calendar-check" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                                <p>Keine Termine vorhanden</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alle Termine Tabelle -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">
                            <i class="fas fa-list"></i> Alle Termine
                        </div>
                        <button class="action-btn btn-primary" onclick="loadPartnerTermine()">
                            <i class="fas fa-sync"></i> Aktualisieren
                        </button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Uhrzeit</th>
                                    <th>Titel</th>
                                    <th>Typ</th>
                                    <th>Status</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="partner-termineTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-light);">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 15px;"></i>
                                        <p>Lade Termine...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Hilfe & FAQ Page -->
            <div class="page-section" id="page-hilfe">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <i class="fas fa-question-circle" style="font-size: 4rem; color: var(--primary); margin-bottom: 1rem;"></i>
                    <h1 style="font-size: 2.5rem; color: var(--text); margin-bottom: 0.5rem; font-weight: 800;">Hilfe & FAQ</h1>
                    <p style="font-size: 1.1rem; color: var(--text-light);">Finde schnell Antworten auf deine Fragen</p>
                </div>

                <!-- Search Box -->
                <div style="max-width: 600px; margin: 0 auto 3rem; position: relative;">
                    <input type="text" id="faq-filter-search" placeholder="Suche nach Themen..." style="width: 100%; padding: 1rem 3.5rem 1rem 1.5rem; border: 2px solid var(--border); border-radius: 50px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" onkeyup="filterFAQ()">
                    <i class="fas fa-search" style="position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); font-size: 1.25rem; color: var(--text-light);"></i>
                </div>

                <!-- Categories -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 3rem;">
                    <div class="faq-category-card active" onclick="filterFAQCategory('alle')" data-category="alle" style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59,130,246,0.3);">
                        <i class="fas fa-th" style="font-size: 2rem; margin-bottom: 0.75rem;"></i>
                        <h3 style="font-size: 1.1rem; margin: 0;">Alle Themen</h3>
                    </div>
                    <div class="faq-category-card" onclick="filterFAQCategory('login')" data-category="login" style="background: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid var(--border);">
                        <i class="fas fa-key" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.75rem;"></i>
                        <h3 style="font-size: 1.1rem; margin: 0; color: var(--text);">Login & Zugang</h3>
                    </div>
                    <div class="faq-category-card" onclick="filterFAQCategory('vertrag')" data-category="vertrag" style="background: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid var(--border);">
                        <i class="fas fa-file-contract" style="font-size: 2rem; color: var(--success); margin-bottom: 0.75rem;"></i>
                        <h3 style="font-size: 1.1rem; margin: 0; color: var(--text);">VertrÃ¤ge</h3>
                    </div>
                    <div class="faq-category-card" onclick="filterFAQCategory('provision')" data-category="provision" style="background: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid var(--border);">
                        <i class="fas fa-euro-sign" style="font-size: 2rem; color: var(--warning); margin-bottom: 0.75rem;"></i>
                        <h3 style="font-size: 1.1rem; margin: 0; color: var(--text);">Provisionen</h3>
                    </div>
                    <div class="faq-category-card" onclick="filterFAQCategory('akademie')" data-category="akademie" style="background: white; padding: 1.5rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid var(--border);">
                        <i class="fas fa-graduation-cap" style="font-size: 2rem; color: #9f7aea; margin-bottom: 0.75rem;"></i>
                        <h3 style="font-size: 1.1rem; margin: 0; color: var(--text);">Akademie</h3>
                    </div>
                </div>

                <!-- FAQ Items -->
                <div id="faq-container" style="max-width: 900px; margin: 0 auto;">
                    <!-- Login & Zugang -->
                    <div class="faq-item" data-category="login">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ” Wie logge ich mich ein?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p><strong>Schritt 1:</strong> Gehe zu <strong><a href="https://partnerprogrammdeincheck.com/partner-login" target="_blank" style="color: var(--primary);">https://partnerprogrammdeincheck.com/partner-login</a></strong></p>
                                <p><strong>Schritt 2:</strong> Gib deine E-Mail-Adresse ein</p>
                                <p><strong>Schritt 3:</strong> Klicke auf "Login / Registrieren"</p>
                                <p><strong>Tipp:</strong> Keine PasswÃ¶rter notwendig! System erkennt dich automatisch.</p>
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" data-category="login">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">âŒ Was mache ich bei Login-Problemen?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p>âœ… <strong>PrÃ¼fe deine E-Mail-Adresse</strong> (Tippfehler?)</p>
                                <p>âœ… <strong>LÃ¶sche Browser-Cache</strong> (Strg + Shift + R)</p>
                                <p>âœ… <strong>Versuche es in einem anderen Browser</strong></p>
                                <p>âœ… <strong>Kontaktiere den Support</strong> falls weiterhin Probleme auftreten</p>
                            </div>
                        </div>
                    </div>

                    <!-- VertrÃ¤ge -->
                    <div class="faq-item" data-category="vertrag">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ“„ Wie erstelle ich einen Vertrag?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p><strong>1.</strong> Gehe zu <strong>"Partner-Tool"</strong> in der Navigation</p>
                                <p><strong>2.</strong> FÃ¼lle das Formular mit Kundendaten aus</p>
                                <p><strong>3.</strong> WÃ¤hle Produkt & Tarif</p>
                                <p><strong>4.</strong> Klicke auf "Vertrag absenden"</p>
                                <p><strong>5.</strong> Vertrag wird automatisch in "Meine VertrÃ¤ge" gespeichert</p>
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" data-category="vertrag">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸš« Wie storniere ich einen Vertrag?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p><strong>1.</strong> Gehe zu <strong>"Meine VertrÃ¤ge"</strong></p>
                                <p><strong>2.</strong> Klicke auf den <strong>ğŸš« Button</strong> beim Vertrag</p>
                                <p><strong>3.</strong> WÃ¤hle einen Stornierungsgrund</p>
                                <p><strong>4.</strong> Optional: Beschreibung hinzufÃ¼gen</p>
                                <p><strong>5.</strong> BestÃ¤tige Stornierung</p>
                                <p><strong>âš ï¸ Wichtig:</strong> Stornierung ist endgÃ¼ltig!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Provisionen -->
                    <div class="faq-item" data-category="provision">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ’° Wann erhalte ich meine Provision?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p>ğŸ“… <strong>Auszahlungszyklus:</strong> 6-8 Wochen nach Monatsende</p>
                                <p>âœ… <strong>Voraussetzungen:</strong></p>
                                <ul style="margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem;">
                                    <li>Vertrag muss "Aktiviert" sein</li>
                                    <li><strong>Kunde muss erste Rechnung bezahlt haben</strong> (Nachweis fÃ¼r Anbieter)</li>
                                    <li><strong>14-Tage-Widerrufsrecht</strong> muss abgelaufen sein</li>
                                </ul>
                                <p>ğŸ’³ <strong>Ãœberweisung:</strong> Auf deine hinterlegte IBAN</p>
                                <p>ğŸ“Š <strong>Tracking:</strong> Siehe "Provisionen" im Dashboard</p>
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" data-category="provision">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ“Š Wie sehe ich meine Provisions-Statistiken?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p><strong>Dashboard:</strong> Zeigt Gesamt-Provision, Monats-Provision und Hochrechnung</p>
                                <p><strong>Provisionen-Seite:</strong> Detaillierte Aufstellung mit Filtern</p>
                                <p><strong>Zeitraum-Filter:</strong> Filtern nach Datum (Von - Bis)</p>
                                <p><strong>Status:</strong> Ausgezahlt, Ausstehend, Abgelehnt</p>
                            </div>
                        </div>
                    </div>

                    <!-- Akademie -->
                    <div class="faq-item" data-category="akademie">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ“ Wie funktioniert die Akademie?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p><strong>1.</strong> Ã–ffne die Akademie Ã¼ber die Navigation</p>
                                <p><strong>2.</strong> WÃ¤hle ein Modul (Mobilfunk, Strom, Verkauf, Tools)</p>
                                <p><strong>3.</strong> Arbeite die Lektionen durch</p>
                                <p><strong>4.</strong> Absolviere das Quiz (80% richtig benÃ¶tigt)</p>
                                <p><strong>5.</strong> Erhalte dein Zertifikat!</p>
                                <p><strong>ğŸ’¡ Tipp:</strong> Schwierigkeitsgrade: â­ Leicht | â­â­ Mittel | â­â­â­ Schwer</p>
                            </div>
                        </div>
                    </div>

                    <div class="faq-item" data-category="akademie">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">ğŸ“œ Was bringen mir Zertifikate?</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p>âœ… <strong>Nachweis deiner Expertise</strong></p>
                                <p>âœ… <strong>Mehr Vertrauen bei Kunden</strong></p>
                                <p>âœ… <strong>Bessere Verkaufsargumente</strong></p>
                                <p>âœ… <strong>Optional: HÃ¶here Provisionen</strong> (je nach Vereinbarung)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Allgemein -->
                    <div class="faq-item" data-category="alle">
                        <div class="faq-question" onclick="toggleFAQ(this)" style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 700; font-size: 1.05rem; color: var(--text);">â“ Ich brauche weitere Hilfe!</span>
                            <i class="fas fa-chevron-down" style="color: var(--text-light); transition: transform 0.3s ease;"></i>
                        </div>
                        <div class="faq-answer" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 1.5rem; background: #f7fafc; border-radius: 0 0 12px 12px; margin-top: -1rem;">
                            <div style="padding: 1.5rem 0; color: var(--text); line-height: 1.8;">
                                <p>ğŸ“§ <strong>E-Mail Support:</strong> support@beispiel.de</p>
                                <p>ğŸ’¬ <strong>Live Chat:</strong> Klicke auf das Chat-Icon unten rechts</p>
                                <p>ğŸ“ <strong>Telefon:</strong> +49 123 456 789 (Mo-Fr 9-18 Uhr)</p>
                                <p>ğŸ« <strong>Ticket erstellen:</strong> Im Dashboard unter "Support"</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Card -->
                <div style="max-width: 700px; margin: 3rem auto 0; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; padding: 2.5rem; border-radius: 16px; text-align: center; box-shadow: 0 8px 25px rgba(59,130,246,0.3);">
                    <i class="fas fa-headset" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.9;"></i>
                    <h2 style="font-size: 1.75rem; margin-bottom: 0.75rem; font-weight: 700;">Noch Fragen?</h2>
                    <p style="font-size: 1.1rem; opacity: 0.95; margin-bottom: 1.5rem;">Unser Support-Team hilft dir gerne weiter!</p>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="openTicketModal()" style="padding: 0.75rem 1.5rem; background: white; color: var(--primary); border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <i class="fas fa-ticket-alt"></i> Ticket erstellen
                        </button>
                        <button onclick="alert('ğŸ“§ E-Mail: support@beispiel.de')" style="padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s;">
                            <i class="fas fa-envelope"></i> E-Mail
                        </button>
                        <button onclick="alert('ğŸ’¬ Live Chat kommt bald!')" style="padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s;">
                            <i class="fas fa-comments"></i> Live Chat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Einstellungen Page -->
            <div class="page-section" id="page-einstellungen">
                <!-- Profil -->
                <div class="data-card" style="margin-bottom: 1.5rem;">
                    <div class="data-card-header">
                        <div class="data-card-title"><i class="fas fa-user"></i> Profil-Einstellungen</div>
                        <button class="action-btn btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Speichern</button>
                    </div>
                    <div style="padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Vorname</label><input type="text" id="settings-vorname" placeholder="Max" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Nachname</label><input type="text" id="settings-nachname" placeholder="Mustermann" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">E-Mail</label><input type="email" id="settings-email" placeholder="max@partner.de" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Telefon</label><input type="tel" id="settings-telefon" placeholder="+49 123 456789" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                    </div>
                </div>
                
                <!-- Bankdaten -->
                <div class="data-card" style="margin-bottom: 1.5rem;">
                    <div class="data-card-header">
                        <div class="data-card-title"><i class="fas fa-university"></i> Bankdaten</div>
                        <button class="action-btn btn-primary" onclick="saveBankdaten()"><i class="fas fa-save"></i> Speichern</button>
                    </div>
                    <div style="padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">IBAN</label><input type="text" id="settings-iban" placeholder="Ihre IBAN eingeben" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                        <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Kontoinhaber</label><input type="text" id="settings-kontoinhaber" placeholder="Name des Kontoinhabers" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                    </div>
                </div>
                
                <!-- Passwort -->
                <div class="data-card">
                    <form id="change-password-form" onsubmit="changePassword(); return false;">
                        <div class="data-card-header">
                            <div class="data-card-title"><i class="fas fa-lock"></i> Passwort Ã¤ndern</div>
                            <button type="submit" class="action-btn btn-primary"><i class="fas fa-key"></i> Ã„ndern</button>
                        </div>
                        <div style="padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;" for="settings-old-password">Altes Passwort</label><input type="password" id="settings-old-password" name="current-password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                            <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;" for="settings-new-password">Neues Passwort</label><input type="password" id="settings-new-password" name="new-password" autocomplete="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                            <div><label style="display: block; margin-bottom: 0.5rem; font-weight: 600;" for="settings-confirm-password">BestÃ¤tigen</label><input type="password" id="settings-confirm-password" name="confirm-password" autocomplete="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px;"></div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ğŸ“š HILFE & FAQ PAGE -->
            <div class="page-section" id="page-hilfe">
                <!-- Hero Section -->
                <div style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; padding: 3rem 2rem; border-radius: 16px; text-align: center; margin-bottom: 2rem;">
                    <i class="fas fa-question-circle" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.9;"></i>
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem; font-weight: 800;">Hilfe & FAQ</h1>
                    <p style="font-size: 1.1rem; opacity: 0.95;">Finde schnell Antworten auf deine Fragen</p>
                </div>

                <!-- Search Box -->
                <div style="max-width: 600px; margin: 0 auto 3rem; position: relative;">
                    <input type="text" id="faq-search" placeholder="ğŸ” Suche nach einem Thema..." style="width: 100%; padding: 1.25rem 3.5rem 1.25rem 1.5rem; border: 2px solid var(--border); border-radius: 50px; font-size: 1rem; transition: all 0.3s;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" oninput="searchFAQ(this.value)">
                    <i class="fas fa-search" style="position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.2rem;"></i>
                </div>

                <!-- FAQ Categories -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
                    <!-- Category: Erste Schritte -->
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s; cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--primary)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(59,130,246,0.15)'" onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'" onclick="scrollToCategory('erste-schritte')">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #60a5fa); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                            <i class="fas fa-rocket" style="font-size: 1.75rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 0.5rem; color: var(--text); font-size: 1.25rem;">Erste Schritte</h3>
                        <p style="color: var(--text-light); font-size: 0.95rem;">Onboarding, Login, Dashboard</p>
                    </div>

                    <!-- Category: VertrÃ¤ge -->
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s; cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--success)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(72,187,120,0.15)'" onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'" onclick="scrollToCategory('vertraege')">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #48bb78, #38a169); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                            <i class="fas fa-file-contract" style="font-size: 1.75rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 0.5rem; color: var(--text); font-size: 1.25rem;">VertrÃ¤ge</h3>
                        <p style="color: var(--text-light); font-size: 0.95rem;">Abschluss, Verwaltung, Status</p>
                    </div>

                    <!-- Category: Provisionen -->
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s; cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--warning)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(237,137,54,0.15)'" onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'" onclick="scrollToCategory('provisionen')">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #ed8936, #dd6b20); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                            <i class="fas fa-euro-sign" style="font-size: 1.75rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 0.5rem; color: var(--text); font-size: 1.25rem;">Provisionen</h3>
                        <p style="color: var(--text-light); font-size: 0.95rem;">Auszahlung, Berechnung, Ãœbersicht</p>
                    </div>

                    <!-- Category: Akademie -->
                    <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s; cursor: pointer; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--info)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(66,153,225,0.15)'" onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'" onclick="scrollToCategory('akademie')">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4299e1, #3182ce); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                            <i class="fas fa-graduation-cap" style="font-size: 1.75rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 0.5rem; color: var(--text); font-size: 1.25rem;">Akademie</h3>
                        <p style="color: var(--text-light); font-size: 0.95rem;">Schulungen, Quiz, Zertifikate</p>
                    </div>
                </div>

                <!-- FAQ Sections -->
                <div id="faq-content">
                    <!-- Erste Schritte -->
                    <div class="faq-category" id="erste-schritte" style="margin-bottom: 3rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: var(--text); font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <i class="fas fa-rocket" style="color: var(--primary);"></i>
                            Erste Schritte
                        </h2>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Wie logge ich mich ein?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--primary); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Gehe auf <strong><a href="https://partnerprogrammdeincheck.com/partner-login" target="_blank" style="color: var(--primary);">https://partnerprogrammdeincheck.com/partner-login</a></strong> und gib deine E-Mail-Adresse ein. Keine PasswÃ¶rter notwendig! System erkennt dich automatisch.</p>
                            </div>
                        </div>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Was ist das Onboarding?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--primary); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Das Onboarding umfasst 6 Schritte:</p>
                                <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li>Registrierung abschlieÃŸen</li>
                                    <li>Dokumente hochladen (Ausweis, Gewerbeschein)</li>
                                    <li>Verifikation (wird manuell geprÃ¼ft)</li>
                                    <li>Bankdaten hinterlegen</li>
                                    <li>Akademie absolvieren</li>
                                    <li>Partner-Tool aktivieren</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- VertrÃ¤ge -->
                    <div class="faq-category" id="vertraege" style="margin-bottom: 3rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: var(--text); font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <i class="fas fa-file-contract" style="color: var(--success);"></i>
                            VertrÃ¤ge
                        </h2>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Wie erstelle ich einen Vertrag?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--success); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Nutze das <strong>Partner-Tool</strong> im Dashboard:</p>
                                <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li>WÃ¤hle die Kategorie (Mobilfunk, DSL, Strom, etc.)</li>
                                    <li>FÃ¼lle alle Kundendaten aus</li>
                                    <li>WÃ¤hle Produkt & Tarif</li>
                                    <li>Klick auf "Vertrag abschlieÃŸen"</li>
                                </ol>
                                <p style="margin-top: 0.5rem;">Der Vertrag wird automatisch im System gespeichert und erscheint unter "Meine VertrÃ¤ge".</p>
                            </div>
                        </div>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Kann ich einen Vertrag stornieren?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--success); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p><strong>Ja!</strong> Gehe zu "Meine VertrÃ¤ge" und klicke auf den ğŸš« Button. Du musst einen Grund angeben (z.B. Kunde hat storniert, Widerruf, etc.). Die Stornierung ist endgÃ¼ltig.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Provisionen -->
                    <div class="faq-category" id="provisionen" style="margin-bottom: 3rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: var(--text); font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <i class="fas fa-euro-sign" style="color: var(--warning);"></i>
                            Provisionen
                        </h2>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Wann wird meine Provision ausgezahlt?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--warning); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Provisionen werden <strong>monatlich</strong> ausgezahlt, sobald der Vertrag aktiviert wurde. Die Auszahlung erfolgt auf das hinterlegte Bankkonto (siehe Einstellungen).</p>
                            </div>
                        </div>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Wie berechnet sich meine Provision?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--warning); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Jedes Produkt hat eine feste Provision:</p>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li><strong>Mobilfunk:</strong> 30-50â‚¬ pro Vertrag</li>
                                    <li><strong>DSL:</strong> 50-80â‚¬ pro Vertrag</li>
                                    <li><strong>Strom:</strong> 40-70â‚¬ pro Vertrag</li>
                                    <li><strong>Gas:</strong> 40-70â‚¬ pro Vertrag</li>
                                </ul>
                                <p style="margin-top: 0.5rem;">Die genauen BetrÃ¤ge findest du im Partner-Tool.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Akademie -->
                    <div class="faq-category" id="akademie" style="margin-bottom: 3rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: var(--text); font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <i class="fas fa-graduation-cap" style="color: var(--info);"></i>
                            Akademie
                        </h2>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Muss ich die Akademie abschlieÃŸen?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--info); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p><strong>Ja!</strong> Die Akademie ist Teil des Onboardings (Schritt 5). Du musst mindestens ein Modul zu 100% abschlieÃŸen, um das Partner-Tool freizuschalten.</p>
                            </div>
                        </div>
                        <div class="faq-item" style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s;" onclick="toggleFAQ(this)" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="color: var(--text); font-weight: 600; font-size: 1.1rem;">Was sind die Quiz-Schwierigkeitsgrade?</h4>
                                <i class="fas fa-chevron-down" style="color: var(--info); transition: transform 0.3s;"></i>
                            </div>
                            <div class="faq-answer" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border); color: var(--text-light); line-height: 1.6;">
                                <p>Jede Quiz-Frage hat einen Schwierigkeitsgrad:</p>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li><strong>â­ Leicht:</strong> Grundlagen-Wissen</li>
                                    <li><strong>â­â­ Mittel:</strong> Beratung & Verkauf</li>
                                    <li><strong>â­â­â­ Schwer:</strong> Experten-Wissen & ProblemlÃ¶sung</li>
                                </ul>
                                <p style="margin-top: 0.5rem;">Du brauchst <strong>80% korrekte Antworten</strong>, um das Quiz zu bestehen.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Support -->
                <div style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; padding: 2.5rem; border-radius: 16px; text-align: center; margin-top: 3rem;">
                    <h3 style="font-size: 1.75rem; margin-bottom: 1rem; font-weight: 700;">Noch Fragen?</h3>
                    <p style="font-size: 1.1rem; opacity: 0.95; margin-bottom: 1.5rem;">Unser Support-Team hilft dir gerne weiter!</p>
                    <button onclick="window.location.href='mailto:support@partner.de'" style="padding: 0.875rem 2rem; background: white; color: var(--primary); border: none; border-radius: 50px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
                        <i class="fas fa-envelope"></i> Support kontaktieren
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“± MOBILE - Funktionen sind im HEAD definiert!
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // ====================================
        // ğŸ“š HILFE & FAQ FUNKTIONEN
        // ====================================
        function toggleFAQ(element) {
            const answer = element.querySelector('.faq-answer');
            const icon = element.querySelector('i.fa-chevron-down');
            
            if (answer.style.display === 'none' || !answer.style.display) {
                answer.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                answer.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }
        
        function scrollToCategory(categoryId) {
            const element = document.getElementById(categoryId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function searchFAQ(query) {
            const faqItems = document.querySelectorAll('.faq-item');
            const searchLower = query.toLowerCase();
            
            faqItems.forEach(item => {
                const title = item.querySelector('h4').textContent.toLowerCase();
                const answer = item.querySelector('.faq-answer').textContent.toLowerCase();
                
                if (title.includes(searchLower) || answer.includes(searchLower)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = searchLower === '' ? 'block' : 'none';
                }
            });
        }
        
        // Page Navigation (GLOBAL!)
        window.showPage = function(pageName) {
            // ğŸ“± MOBILE: Sidebar schlieÃŸen und Body zurÃ¼cksetzen
            if (window.isMobile && window.isMobile()) {
                window.closeMobileSidebar();
            }
            
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            const pageEl = document.getElementById(`page-${pageName}`);
            if (pageEl) {
                pageEl.classList.add('active');
            }
            
            // ğŸ“± MOBILE: Scroll zum Seitenanfang
            window.scrollTo(0, 0);
            document.querySelector('.main-content')?.scrollTo(0, 0);
            document.querySelector('.content')?.scrollTo(0, 0);
            
            // âœ… AKADEMIE: Lade Fortschritt beim Ã–ffnen
            if (pageName === 'akademie') {
                if (typeof updateAkademieStats === 'function') {
                    setTimeout(() => {
                        updateAkademieStats().catch(err => console.error('Fehler beim Laden des Akademie-Fortschritts:', err));
                    }, 100);
                }
            }
            
            // âœ… PROVISIONEN: Lade Daten beim Ã–ffnen
            if (pageName === 'provisionen') {
                setTimeout(() => {
                    loadProvisionenPage();
                }, 100);
            }

            // Update nav active state (only if called from nav)
            if (typeof event !== 'undefined' && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) navItem.classList.add('active');
            } else {
                // Find and activate corresponding nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    if (item.getAttribute('onclick')?.includes(`'${pageName}'`)) {
                        item.classList.add('active');
                    }
                });
            }

            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'partner-tool': 'Partner-Tool',
                'meine-vertraege': 'Meine VertrÃ¤ge',
                'provisionen': 'Bonus & Ziele',
                'qr-codes': 'QR-Codes',
                'empfehlungen': 'Empfehlungen',
                'marketing-material': 'Marketing Material',
                'partner-programm': 'Partner-Programm',
                'akademie': 'Partner Akademie',
                'kalender': 'Termine',
                'hilfe': 'Hilfe & FAQ',
                'einstellungen': 'Einstellungen'
            };
            // âœ… Nur den Titel Ã¤ndern, BegrÃ¼ÃŸung bleibt!
            const greetingText = document.getElementById('greeting-text').textContent;
            document.getElementById('pageTitle').innerHTML = `<span id="greeting-text">${greetingText}</span> ğŸ‘‹`;

            // Close mobile sidebar
            if (window.innerWidth <= 768) {
                closeMobileSidebar();
            }

            // Load data for specific pages - IMMER FRISCH VON DB LADEN!
            if (pageName === 'meine-vertraege') {
                console.log('ğŸ“„ [showPage] Meine VertrÃ¤ge - lade FRISCH von DB...');
                // Cache zurÃ¼cksetzen damit frisch geladen wird
                window.allePartnerVertraege = null;
                loadKundenVertraege();
            } else if (pageName === 'provisionen') {
                loadProvisionenPage();
            } else if (pageName === 'einstellungen') {
                loadSettings();
            }
        }

        // Toggle Sidebar (Mobile) - NUTZT toggleMobileSidebar!
        window.toggleSidebar = function() {
            toggleMobileSidebar();
        }
        
        // Toggle Sidebar Collapse (Desktop)
        window.toggleSidebarCollapse = function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            
            // Save state to localStorage
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“ AKADEMIE FORTSCHRITT-TRACKING SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        /**
         * Speichert Akademie-Fortschritt in der Datenbank
         * @param {string} modulId - Modul ID (z.B. 'grundlagen')
         * @param {string} lektionId - Lektion ID (z.B. 'lektion_1')
         * @param {object} data - Fortschritts-Daten
         */
        window.saveAkademieProgress = async function(modulId, lektionId, data) {
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                if (!partnerEmail) {
                    console.error('âŒ Keine Partner-Email gefunden');
                    return;
                }
                
                const progressData = {
                    partner_email: partnerEmail,
                    modul_id: modulId,
                    lektion_id: lektionId,
                    status: data.status || 'in_bearbeitung',
                    fortschritt_prozent: data.fortschritt_prozent || 0,
                    quiz_bestanden: data.quiz_bestanden || false,
                    quiz_punkte: data.quiz_punkte || 0,
                    quiz_max_punkte: data.quiz_max_punkte || 0,
                    gestartet_am: data.gestartet_am || new Date().toISOString(),
                    abgeschlossen_am: data.abgeschlossen_am || null,
                    notizen: data.notizen || ''
                };
                
                // âœ… Speichere in DB - RICHTIGE TABELLE: akademie_progress
                const response = await fetch('tables/akademie_progress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(progressData)
                });
                
                if (response.ok) {
                    console.log('âœ… Akademie-Fortschritt gespeichert:', modulId, lektionId);
                    
                    // Update UI
                    await updateAkademieStats();
                } else {
                    console.error('âŒ Fehler beim Speichern:', await response.text());
                }
            } catch (error) {
                console.error('âŒ Fehler beim Speichern des Fortschritts:', error);
            }
        };
        
        /**
         * LÃ¤dt Akademie-Fortschritt aus DB
         */
        window.loadAkademieProgress = async function() {
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                if (!partnerEmail) {
                    console.log('âš ï¸ Keine partnerEmail in localStorage');
                    return [];
                }
                
                // âœ… RICHTIGE TABELLE: akademie_progress (nicht akademie_fortschritt!)
                const response = await fetch(`tables/akademie_progress?limit=1000`);
                const data = await response.json();
                
                // Filtere nach Partner-Email (case-insensitive)
                const myProgress = (data.data || []).filter(p => 
                    p.partner_email && p.partner_email.toLowerCase() === partnerEmail.toLowerCase()
                );
                console.log('ğŸ“Š Akademie-Fortschritt geladen:', myProgress.length, 'EintrÃ¤ge fÃ¼r', partnerEmail);
                
                return myProgress;
            } catch (error) {
                console.error('âŒ Fehler beim Laden des Fortschritts:', error);
                return [];
            }
        };
        
        /**
         * âœ… MODUL ALS ABGESCHLOSSEN MARKIEREN
         */
        window.completeModul = async function(modulId, modulTitle) {
            try {
                console.log('ğŸ“ Modul abschlieÃŸen:', modulId);
                
                const partnerEmail = localStorage.getItem('partnerEmail');
                if (!partnerEmail) {
                    alert('âŒ Keine Partner-Email gefunden. Bitte logge dich erneut ein.');
                    return;
                }
                
                // Speichere Abschluss in DB
                await window.saveAkademieProgress(modulId, 'complete', {
                    status: 'abgeschlossen',
                    fortschritt_prozent: 100,
                    abgeschlossen_am: new Date().toISOString()
                });
                
                // âœ… ZERTIFIKAT AUTOMATISCH ERSTELLEN
                try {
                    const zertifikatData = {
                        partner_email: partnerEmail,
                        modul_id: modulId,
                        modul_name: modulTitle,
                        ausgestellt_am: new Date().toISOString(),
                        gueltig_bis: null,
                        zertifikat_nr: `CERT-${modulId.toUpperCase()}-${Date.now()}`,
                        punkte: 100,
                        note: 'Bestanden'
                    };
                    
                    const certResponse = await fetch('tables/zertifikate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(zertifikatData)
                    });
                    
                    if (certResponse.ok) {
                        console.log('âœ… Zertifikat erstellt:', zertifikatData);
                    }
                } catch (certError) {
                    console.error('âš ï¸ Fehler beim Erstellen des Zertifikats (nicht kritisch):', certError);
                }
                
                // SchlieÃŸe Modal
                const modal = document.getElementById('modul-detail-modal');
                if (modal) modal.remove();
                
                // Zeige Erfolgs-Nachricht
                alert(`âœ… Herzlichen GlÃ¼ckwunsch!\n\nDu hast das Modul "${modulTitle}" erfolgreich abgeschlossen! ğŸ‰\n\nDein Zertifikat wurde ausgestellt!\n\nDie Seite wird jetzt aktualisiert...`);
                
                // âœ… SEITE NEU LADEN (damit Badge sofort aktualisiert wird)
                window.location.reload();
                
                console.log('âœ… Modul erfolgreich abgeschlossen!');
            } catch (error) {
                console.error('âŒ Fehler beim AbschlieÃŸen des Moduls:', error);
                alert('âŒ Fehler beim Speichern. Bitte versuche es erneut.');
            }
        };
        
        /**
         * Update Akademie-Statistiken (Fortschrittsbalken, etc.)
         */
        window.updateAkademieStats = async function() {
            try {
                const allProgress = await loadAkademieProgress();
                
                // âœ… NUR LETZTEN EINTRAG PRO MODUL (keine Duplikate!)
                const modulIds = ['grundlagen', 'verkaufspsychologie', 'einwandbehandlung', 'abschlusstechniken', 'produktwissen', 'akquise', 'mindset', 'rechtliches'];
                const totalModules = modulIds.length; // 8
                
                // Gruppiere nach modul_id und nimm nur den neuesten Eintrag
                const progress = [];
                modulIds.forEach(modId => {
                    const modulEntries = allProgress.filter(p => p.modul_id === modId);
                    if (modulEntries.length > 0) {
                        // Sortiere nach letzter Aktualisierung (neuester zuerst)
                        modulEntries.sort((a, b) => new Date(b.letzter_zugriff || 0) - new Date(a.letzter_zugriff || 0));
                        progress.push(modulEntries[0]); // Nur neuesten nehmen
                    }
                });
                
                console.log('ğŸ“Š Akademie-Fortschritt (unique pro Modul):', progress.length, 'von', totalModules);
                
                // Berechne Statistiken - basierend auf unique Modulen
                const completed = progress.filter(p => p.abgeschlossen === true || p.fortschritt_prozent >= 100).length;
                const inProgress = progress.filter(p => p.fortschritt_prozent > 0 && p.fortschritt_prozent < 100 && !p.abgeschlossen).length;
                const notStarted = totalModules - completed - inProgress;
                
                const progressPercent = Math.round((completed / totalModules) * 100);
                
                // Update UI
                const progressElem = document.getElementById('akademie-progress');
                const progressBarElem = document.getElementById('akademie-progress-bar');
                const completedElem = document.getElementById('akademie-completed');
                const inProgressElem = document.getElementById('akademie-in-progress');
                const notStartedElem = document.getElementById('akademie-not-started');
                
                if (progressElem) progressElem.textContent = `${progressPercent}%`;
                if (progressBarElem) progressBarElem.style.width = `${progressPercent}%`;
                if (completedElem) completedElem.textContent = completed;
                if (inProgressElem) inProgressElem.textContent = inProgress;
                if (notStartedElem) notStartedElem.textContent = notStarted;
                
                // ğŸ¯ UPDATE MODUL-KARTEN MIT FORTSCHRITT & BADGES
                modulIds.forEach(modulId => {
                    const modulProgress = progress.find(p => p.modul_id === modulId);
                    
                    // Finde Modul-Karte (via onclick="openModul('...')")
                    const modulCard = document.querySelector(`[onclick="openModul('${modulId}')"]`);
                    if (!modulCard) return;
                    
                    // Finde Badge (LEVEL 1, LEVEL 2, etc.)
                    const statusBadges = modulCard.querySelectorAll('span');
                    let statusBadge = null;
                    statusBadges.forEach(badge => {
                        if (badge.textContent.includes('LEVEL') || badge.textContent.includes('ABGESCHLOSSEN') || badge.textContent.includes('BEARBEITUNG')) {
                            statusBadge = badge;
                        }
                    });
                    
                    // Finde Button (JETZT STARTEN, etc.)
                    const buttons = modulCard.querySelectorAll('div');
                    let actionButton = null;
                    buttons.forEach(btn => {
                        if (btn.textContent.includes('JETZT STARTEN') || btn.textContent.includes('FORTSETZEN') || btn.textContent.includes('ABGESCHLOSSEN')) {
                            if (btn.style.padding && btn.style.background) {
                                actionButton = btn;
                            }
                        }
                    });
                    
                    // Finde Fortschritt-Text (Fortschritt: 0%)
                    const textDivs = modulCard.querySelectorAll('div');
                    let progressText = null;
                    textDivs.forEach(div => {
                        if (div.textContent.includes('Fortschritt:')) {
                            progressText = div;
                        }
                    });
                    
                    if (modulProgress && (modulProgress.abgeschlossen === true || modulProgress.fortschritt_prozent >= 100)) {
                        // âœ… ABGESCHLOSSEN
                        if (statusBadge) {
                            statusBadge.textContent = 'âœ… ABGESCHLOSSEN';
                            statusBadge.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                            statusBadge.style.color = 'white';
                        }
                        if (progressText) {
                            progressText.textContent = 'Fortschritt: 100%';
                        }
                        if (actionButton) {
                            actionButton.innerHTML = '<i class="fas fa-check-circle"></i> ABGESCHLOSSEN';
                            actionButton.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        }
                    } else if (modulProgress && modulProgress.fortschritt_prozent > 0) {
                        // ğŸ”„ IN BEARBEITUNG
                        if (statusBadge) {
                            statusBadge.textContent = 'ğŸ”„ IN BEARBEITUNG';
                            statusBadge.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                            statusBadge.style.color = 'white';
                        }
                        const percent = modulProgress.fortschritt_prozent || 0;
                        if (progressText) {
                            progressText.textContent = `Fortschritt: ${percent}%`;
                        }
                        if (actionButton) {
                            actionButton.innerHTML = '<i class="fas fa-play-circle"></i> FORTSETZEN';
                        }
                    }
                });
                
                console.log('âœ… Akademie-UI aktualisiert:', { completed, inProgress, notStarted, progressPercent });
                
                console.log('ğŸ“Š Akademie-Stats aktualisiert:', { completed, inProgress, notStarted, progressPercent });
            } catch (error) {
                console.error('âŒ Fehler beim Update der Stats:', error);
            }
        };
        
        // Restore Sidebar State on Load
        window.addEventListener('DOMContentLoaded', () => {
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (sidebarCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
            }
        });

        // ğŸ“Š TRACKING: Admin-AktivitÃ¤ten tracken
        async function trackPartnerAktivitaet(aktion, kategorie, details = '', vertrag_id = null, betrag = null) {
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                const partnerName = localStorage.getItem('partnerName') || 'N/A';
                
                await fetch('tables/admin_aktivitaeten', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        partner_email: partnerEmail,
                        partner_name: partnerName,
                        aktion: aktion,
                        kategorie: kategorie,
                        details: details,
                        vertrag_id: vertrag_id || '',
                        betrag: betrag || '',
                        gelesen: false,
                        erstellt_am: new Date().getTime()
                    })
                });
                
                console.log('âœ… AktivitÃ¤t getrackt:', aktion);
            } catch (error) {
                console.error('Fehler beim Tracking:', error);
            }
        }

        // âœ… FIX: Refresh Data - LÃ¤dt ALLE relevanten Daten der aktuellen Seite
        function refreshData() {
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            icon.classList.add('fa-spin');
            
            console.log('ğŸ”„ Aktualisiere ALLE Daten...');
            
            // Dashboard-Daten immer laden
            if (typeof loadDashboardData === 'function') {
                loadDashboardData();
            }
            
            // Aktuelle Seite ermitteln und entsprechend laden
            const activeSection = document.querySelector('.page-section[style*="display: block"]');
            if (activeSection) {
                const pageId = activeSection.id.replace('page-', '');
                console.log('ğŸ“„ Aktive Seite:', pageId);
                
                // Seiten-spezifische Daten laden
                if (pageId === 'meine-vertraege' && typeof loadKundenVertraege === 'function') {
                    loadKundenVertraege(); // Nutze die neue Kunden-Karten-Funktion
                }
                if (pageId === 'provisionen' && typeof loadProvisionenPage === 'function') {
                    loadProvisionenPage();
                }
            }
            
            setTimeout(() => {
                icon.classList.remove('fa-spin');
                console.log('âœ… Aktualisierung abgeschlossen!');
            }, 1500);
        }

        // Logout
        function logout() {
            if (confirm('MÃ¶chten Sie sich wirklich abmelden?')) {
                localStorage.removeItem('partnerEmail');
                window.location.href = 'partner-login.html';
            }
        }

        // Load Dashboard Data
        // ========================================
        // ğŸ§ª DEMO-MODUS: TEST-DATEN LADEN
        // ========================================
        function loadDemoData() {
            console.log('\n\nğŸ§ªğŸ§ªğŸ§ª ============================================');
            console.log('ğŸ§ª DEMO-MODUS: Lade Test-Daten...');
            console.log('============================================\n');
            
            // User-Info setzen
            document.getElementById('userEmail').textContent = 'demo@partner.de';
            document.getElementById('userAvatar').textContent = 'DE';
            
            // ğŸ“± MOBILE: Demo User Name
            const mobileUserEl = document.getElementById('mobile-user-name');
            if (mobileUserEl) mobileUserEl.textContent = 'Demo Partner';
            
            // ğŸ“Š STATISTIK-CARDS (Heute, Gestern, Monat, Ausstehend, VertrÃ¤ge)
            document.getElementById('todayProvisionen').textContent = '150,00 â‚¬';
            document.getElementById('todayVertraege').textContent = '2 VertrÃ¤ge heute';
            
            document.getElementById('yesterdayProvisionen').textContent = '200,00 â‚¬';
            document.getElementById('yesterdayVertraege').textContent = '3 VertrÃ¤ge';
            
            document.getElementById('monthProvisionen').textContent = '2.450,00 â‚¬';
            
            document.getElementById('pendingProvisionen').textContent = '1.200,00 â‚¬';
            
            document.getElementById('totalVertraege').textContent = '42';
            
            // ğŸ“¦ ONBOARDING-WIDGET: Verstecken im Demo-Modus
            const onboardingWidget = document.getElementById('onboarding-widget');
            if (onboardingWidget) {
                onboardingWidget.style.display = 'none';
            }
            
            // ğŸ“Š PROJEKT-STATUS-WIDGET: Beispiel-Daten
            const projektWidget = document.getElementById('projekt-status-widget');
            if (projektWidget) {
                projektWidget.style.display = 'block';
                
                document.getElementById('projekt-title').innerHTML = 'ğŸª Ladenlokal';
                document.getElementById('projekt-progress-text').textContent = '25%';
                document.getElementById('projekt-progress-bar').style.width = '25%';
                document.getElementById('projekt-start').textContent = '1.10.2025';
                document.getElementById('projekt-weeks').textContent = '3 / 12 Wochen';
                document.getElementById('projekt-status').textContent = 'Starter';
                document.getElementById('projekt-status').style.color = '#ed8936';
            }
            
            // ğŸ“„ SCHNELLZUGRIFF: Neueste VertrÃ¤ge (Demo-Daten)
            const vertraegeList = document.getElementById('schnellzugriff-vertraege-list');
            if (vertraegeList) {
                vertraegeList.innerHTML = `
                    <div style="padding: 1rem; background: var(--bg); border-radius: 8px; margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <div>
                                <div style="font-weight: 600; color: var(--text);">Max Mustermann</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">Mobilfunk â€¢ Vodafone</div>
                            </div>
                            <span class="badge badge-success">Aktiviert</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem;">
                            <span style="color: var(--text-light);">07.12.2025</span>
                            <span style="font-weight: 600; color: var(--success);">75,00â‚¬</span>
                        </div>
                    </div>
                    
                    <div style="padding: 1rem; background: var(--bg); border-radius: 8px; margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <div>
                                <div style="font-weight: 600; color: var(--text);">Lisa MÃ¼ller</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">DSL â€¢ Telekom</div>
                            </div>
                            <span class="badge badge-warning">In Bearbeitung</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem;">
                            <span style="color: var(--text-light);">06.12.2025</span>
                            <span style="font-weight: 600; color: var(--warning);">100,00â‚¬</span>
                        </div>
                    </div>
                    
                    <div style="padding: 1rem; background: var(--bg); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <div>
                                <div style="font-weight: 600; color: var(--text);">Tom Schmidt</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">Strom â€¢ E.ON</div>
                            </div>
                            <span class="badge badge-success">Aktiviert</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem;">
                            <span style="color: var(--text-light);">05.12.2025</span>
                            <span style="font-weight: 600; color: var(--success);">50,00â‚¬</span>
                        </div>
                    </div>
                `;
            }
            
            // ğŸ’° LETZTE AUSZAHLUNGEN (Demo-Daten)
            const auszahlungenList = document.getElementById('letzte-auszahlungen-list');
            if (auszahlungenList) {
                auszahlungenList.innerHTML = `
                    <div style="padding: 1rem; background: var(--bg); border-radius: 8px; margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text);">November 2025</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">Ausgezahlt am 30.11.2025</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.25rem; font-weight: 700; color: var(--success);">850,00â‚¬</div>
                                <span class="badge badge-success">Bezahlt</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 1rem; background: var(--bg); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text);">Oktober 2025</div>
                                <div style="font-size: 0.875rem; color: var(--text-light);">Ausgezahlt am 31.10.2025</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.25rem; font-weight: 700; color: var(--success);">720,00â‚¬</div>
                                <span class="badge badge-success">Bezahlt</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            console.log('âœ… Demo-Daten erfolgreich geladen!');
            console.log('ğŸ§ª Partner-Dashboard lÃ¤uft im DEMO-MODUS');
            console.log('ğŸ”¥ VERSION: 08.12.2025 - 16:15 Uhr - NEUE VERSION!');
        }
        
        // âš ï¸ ERSTE loadDashboardData() ENTFERNT - Nur noch EINE Version (unten bei Zeile ~7717)
        // Die einzige loadDashboardData() ist jetzt die verbesserte Version mit limit=1000
        // Diese wurde bewusst entfernt um Duplikation und Konflikte zu vermeiden!
        
        // Placeholder fÃ¼r loadRecentAuszahlungen (wird noch benÃ¶tigt)
        async function loadRecentAuszahlungen_OLD(partnerEmail) {
            // Diese Funktion wurde in die Haupt-loadDashboardData integriert
            return;
        }
        
        // â¬‡ï¸ URSPRÃœNGLICHE ERSTE loadDashboardData() ENTFERNT (war von Zeile 3221-3479)
        // Grund: Konflikt mit zweiter Funktion (Zeile 7717), die bessere Logik hat
        
        console.log('ğŸ“Œ Erste loadDashboardData() wurde entfernt - nur noch eine Version aktiv!');
        
        // Dummy-Funktion um Fehler zu vermeiden falls irgendwo aufgerufen
        if (typeof window.loadDashboardData_OLD === 'undefined') {
            window.loadDashboardData_OLD = async function() {
                console.log('âš ï¸ loadDashboardData_OLD aufgerufen - wird ignoriert');
            };
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // âš ï¸ ENTFERNTER CODE - Alte loadDashboardData() und verwaiste BlÃ¶cke
        // Die Hauptversion befindet sich jetzt bei Zeile ~7717
        // Bereinigt am 15.12.2025 um Duplikate zu vermeiden
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // âœ… NEU: Letzte Auszahlungen laden
        async function loadRecentAuszahlungen(partnerEmail) {
            try {
                const res = await fetch('tables/provisionen?limit=100');
                const data = await res.json();
                const meineAuszahlungen = data.data
                    .filter(p => p.partner_email === partnerEmail && p.status === 'ausgezahlt')
                    .sort((a, b) => (b.ausgezahlt_am || b.created_at) - (a.ausgezahlt_am || a.created_at))
                    .slice(0, 5);

                const tbody = document.querySelector('#table-recent-auszahlungen tbody');
                
                if (meineAuszahlungen.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <p>Noch keine Auszahlungen</p>
                                    <small style="color: var(--text-light);">Deine ersten Provisionen werden hier angezeigt</small>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = meineAuszahlungen.map(a => {
                        const datum = a.ausgezahlt_am 
                            ? new Date(a.ausgezahlt_am).toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit', year: 'numeric'})
                            : new Date(a.created_at).toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit', year: 'numeric'});
                        
                        // Typ-Badge-Farbe
                        let typColor = '#3b82f6';
                        if (a.typ === 'mobilfunk' || a.typ === 'Mobilfunk') typColor = '#48bb78';
                        else if (a.typ === 'dsl' || a.typ === 'DSL/Internet') typColor = '#4299e1';
                        else if (a.typ === 'strom' || a.typ === 'Strom') typColor = '#ed8936';
                        else if (a.typ === 'versicherung' || a.typ === 'Versicherung') typColor = '#9f7aea';
                        
                        return `
                            <tr>
                                <td>${datum}</td>
                                <td style="font-weight: 500; color: #1a202c;">${a.tarif || 'Unbekannt'}</td>
                                <td>
                                    <span class="badge" style="background: ${typColor}20; color: ${typColor}; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                                        ${a.typ || 'Sonstige'}
                                    </span>
                                </td>
                                <td style="font-size: 16px; font-weight: 700; color: #48bb78;">â‚¬${(a.betrag || 0).toFixed(2)}</td>
                                <td>
                                    <span class="badge badge-success" style="background: #48bb7820; color: #48bb78; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600;">
                                        âœ… Ausgezahlt
                                    </span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }

                console.log('ğŸ’° Auszahlungen geladen:', meineAuszahlungen.length);
            } catch (error) {
                console.error('âŒ Fehler beim Laden der Auszahlungen:', error);
                const tbody = document.querySelector('#table-recent-auszahlungen tbody');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5">
                                <div class="empty-state" style="color: #f56565;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <p>Fehler beim Laden</p>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }
            
            // âœ… BONUS-WIDGET AUCH AUF DASHBOARD LADEN
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                if (partnerEmail) {
                    const partnerRes = await fetch(`tables/partners?search=${partnerEmail}&limit=1`);
                    const partnerData = await partnerRes.json();
                    if (partnerData.data && partnerData.data.length > 0) {
                        // Container-ID fÃ¼r Dashboard Ã¼bergeben
                        // await loadBonusWidget(partnerData.data[0], 'dashboard-bonus-widget'); // DEAKTIVIERT
                        console.log('ğŸ† Bonus-Widget DEAKTIVIERT (nicht mehr im Dashboard)');
                    }
                }
            } catch (err) {
                console.log('âš ï¸ Bonus-Widget Dashboard-Load Ã¼bersprungen:', err);
            }
        }

        // ====================================
        // ğŸ“¢ NEWS & AKTIONEN LADEN
        // ====================================
        async function loadPartnerNews() {
            if (window.IS_DEMO_MODE) return;
            
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                console.log('ğŸ“¢ Lade News fÃ¼r Partner:', partnerEmail);
                
                const res = await fetch('tables/news?limit=100');
                const data = await res.json();
                console.log('ğŸ“° News geladen:', data.data.length);
                
                // Hole Partner-Modell fÃ¼r Filter
                const partnerRes = await fetch(`tables/partners?limit=1000`);
                const partnerData = await partnerRes.json();
                const partner = partnerData.data.find(p => p.email === partnerEmail);
                const partnerModell = partner ? partner.modell : null;
                console.log('ğŸ‘¤ Partner-Modell:', partnerModell);
                
                // Filter relevante News
                const relevantNews = data.data.filter(news => {
                    if (!news.aktiv) return false;
                    
                    // GÃ¼ltigkeitsdatum prÃ¼fen
                    if (news.gueltig_bis) {
                        const gueltigBis = new Date(news.gueltig_bis);
                        if (gueltigBis < new Date()) return false;
                    }
                    
                    const zielgruppe = news.zielgruppe || 'alle';
                    
                    if (zielgruppe === 'alle') return true;
                    
                    // Modell-Filter
                    if (partnerModell && zielgruppe === partnerModell.toLowerCase()) return true;
                    
                    // E-Mail-Filter (zielgruppe enthÃ¤lt komma-getrennte E-Mails)
                    if (zielgruppe.includes('@')) {
                        const emails = zielgruppe.toLowerCase().split(',').map(e => e.trim());
                        return emails.includes(partnerEmail.toLowerCase());
                    }
                    
                    return false;
                });
                
                console.log('âœ… Relevante News:', relevantNews.length);
                
                const newsWidget = document.getElementById('news-widget-top');
                if (!newsWidget) {
                    console.error('âŒ News-Widget nicht gefunden!');
                    return;
                }
                
                if (relevantNews.length === 0) {
                    console.log('â„¹ï¸ Keine relevanten News gefunden');
                    newsWidget.innerHTML = '';
                    return;
                }
                
                console.log('ğŸ‰ Zeige', relevantNews.length, 'News an');
                
                // ğŸ¨ KOMPAKTES NEWS-DESIGN!
                newsWidget.innerHTML = `
                    <div class="data-card" style="margin-bottom: 1.5rem;">
                        <div class="data-card-header" style="margin-bottom: 1rem;">
                            <div class="data-card-title">
                                <i class="fas fa-bullhorn"></i>
                                <span>Neuigkeiten & Wichtige Infos</span>
                            </div>
                            <div style="background: var(--primary); color: white; padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600;">
                                ${relevantNews.length} ${relevantNews.length === 1 ? 'Info' : 'Infos'}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                            ${relevantNews.slice(0, 3).map((news, index) => {
                                const colors = {
                                    'info': { 
                                        bg: 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)', 
                                        shadow: '0 15px 40px rgba(59, 130, 246, 0.3)',
                                        icon: 'ğŸ’¬', 
                                        iconBg: 'rgba(255,255,255,0.25)' 
                                    },
                                    'warnung': { 
                                        bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', 
                                        shadow: '0 15px 40px rgba(240, 147, 251, 0.3)',
                                        icon: 'âš ï¸', 
                                        iconBg: 'rgba(255,255,255,0.25)' 
                                    },
                                    'erfolg': { 
                                        bg: 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)', 
                                        shadow: '0 15px 40px rgba(72, 187, 120, 0.3)',
                                        icon: 'âœ…', 
                                        iconBg: 'rgba(255,255,255,0.25)' 
                                    },
                                    'aktion': { 
                                        bg: 'linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)', 
                                        shadow: '0 15px 40px rgba(237, 137, 54, 0.3)',
                                        icon: 'ğŸ”¥', 
                                        iconBg: 'rgba(255,255,255,0.25)' 
                                    }
                                };
                                const color = colors[news.typ] || colors.info;
                                
                                return `
                                    <div style="
                                        background: ${color.bg}; 
                                        border-radius: 12px; 
                                        padding: 1.5rem; 
                                        color: white; 
                                        position: relative; 
                                        overflow: hidden; 
                                        box-shadow: 0 4px 12px rgba(0,0,0,0.12); 
                                        cursor: pointer; 
                                        transition: all 0.3s ease;
                                        animation: fadeInUp 0.4s ease-out ${index * 0.08}s both;
                                    " 
                                    onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='${color.shadow}'" 
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.12)'">
                                        
                                        <!-- Compact Header mit Icon & Titel -->
                                        <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                                            <!-- Icon (kompakter) -->
                                            <div style="
                                                width: 50px; 
                                                height: 50px; 
                                                min-width: 50px;
                                                border-radius: 12px; 
                                                background: ${color.iconBg}; 
                                                display: flex; 
                                                align-items: center; 
                                                justify-content: center; 
                                                font-size: 24px; 
                                                backdrop-filter: blur(10px);
                                                box-shadow: 0 4px 10px rgba(0,0,0,0.15);
                                            ">
                                                ${color.icon}
                                            </div>
                                            
                                            <!-- Titel -->
                                            <div style="flex: 1;">
                                                <h3 style="
                                                    margin: 0 0 0.5rem 0; 
                                                    font-size: 1.1rem; 
                                                    font-weight: 700; 
                                                    line-height: 1.3;
                                                ">${news.titel}</h3>
                                                
                                                <!-- Datum (klein & dezent) -->
                                                <div style="
                                                    display: inline-flex;
                                                    align-items: center;
                                                    gap: 0.4rem;
                                                    font-size: 0.75rem;
                                                    opacity: 0.85;
                                                ">
                                                    <i class="fas fa-clock" style="font-size: 0.7rem;"></i>
                                                    <span>${new Date(news.created_at).toLocaleDateString('de-DE', { day: '2-digit', month: 'short' })}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Content -->
                                        <p style="
                                            margin: 0; 
                                            font-size: 0.95rem; 
                                            line-height: 1.5; 
                                            opacity: 0.95;
                                        ">${news.inhalt}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <style>
                        @keyframes fadeInUp {
                            from {
                                opacity: 0;
                                transform: translateY(20px);
                            }
                            to {
                                opacity: 1;
                                transform: translateY(0);
                            }
                        }
                    </style>
                `;
            } catch (error) {
                console.error('Fehler beim Laden der News:', error);
            }
        }

        // âœ… WIEDERHERGESTELLTE FUNKTION - Verwendet tbody-vertraege
        let alleMeineVertraege = [];
        
        async function loadVertraegePage() {
            console.log('ğŸ“„ loadVertraegePage() gestartet...');
            
            const partnerEmail = localStorage.getItem('partnerEmail');
            console.log('ğŸ“§ Partner-Email:', partnerEmail);
            
            const tbody = document.getElementById('tbody-vertraege');
            if (!tbody) {
                console.error('âŒ tbody-vertraege nicht gefunden!');
                return;
            }
            
            // Loading anzeigen
            tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i><div>Lade VertrÃ¤ge...</div></td></tr>';
            
            // Demo-Modus wenn keine Email
            if (!partnerEmail) {
                console.log('ğŸ§ª Demo-Modus: Zeige Demo-VertrÃ¤ge');
                tbody.innerHTML = `
                    <tr><td>15.12.2025</td><td>#DEMO-001</td><td>Max Demo</td><td>demo@test.de</td><td>Berlin</td><td><span class="badge badge-info">Mobilfunk</span></td><td>Vodafone Red</td><td><strong style="color: var(--success);">75,00â‚¬</strong></td><td><span class="badge badge-success">Aktiviert</span></td><td><button class="action-btn btn-primary">Details</button></td></tr>
                    <tr><td>14.12.2025</td><td>#DEMO-002</td><td>Lisa Demo</td><td>lisa@test.de</td><td>MÃ¼nchen</td><td><span class="badge badge-info">DSL</span></td><td>1&1 DSL 100</td><td><strong style="color: var(--success);">50,00â‚¬</strong></td><td><span class="badge badge-warning">Neu</span></td><td><button class="action-btn btn-primary">Details</button></td></tr>
                `;
                return;
            }
            
            try {
                console.log('ğŸ”„ Lade VertrÃ¤ge von API...');
                const res = await fetch('tables/vertragsabschluesse?limit=1000');
                
                if (!res.ok) {
                    throw new Error('HTTP ' + res.status);
                }
                
                const data = await res.json();
                console.log('ğŸ“Š Gesamt VertrÃ¤ge:', data.data?.length || 0);
                
                // Filter fÃ¼r diesen Partner
                alleMeineVertraege = (data.data || []).filter(v => 
                    v.partner_email && v.partner_email.toLowerCase() === partnerEmail.toLowerCase()
                );
                console.log('âœ… Meine VertrÃ¤ge:', alleMeineVertraege.length);
                
                if (alleMeineVertraege.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 2rem; color: var(--text-light);"><i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i><div>Keine VertrÃ¤ge gefunden</div><small>Erstelle deinen ersten Vertrag Ã¼ber das Partner-Tool</small></td></tr>';
                    return;
                }
                
                // VertrÃ¤ge anzeigen
                tbody.innerHTML = alleMeineVertraege.map(v => {
                    const status = v.vertrag_status || v.status || 'neu';
                    const statusLower = status.toLowerCase();
                    const statusColor = statusLower.includes('aktiv') ? 'success' : statusLower.includes('abge') ? 'danger' : statusLower.includes('stor') ? 'secondary' : 'warning';
                    const statusDisplay = statusLower.includes('neu') ? 'Neu' : statusLower.includes('prÃ¼f') ? 'In PrÃ¼fung' : statusLower.includes('aktiv') ? 'Aktiviert' : statusLower.includes('abge') ? 'Abgelehnt' : statusLower.includes('stor') ? 'Storniert' : status;
                    
                    const provision = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                    const datum = v.erstellt_am || v.created_at;
                    const datumFormatted = datum ? new Date(datum).toLocaleDateString('de-DE') : 'N/A';
                    const kundeName = v.kunde_name || ((v.kunde_vorname || '') + ' ' + (v.kunde_nachname || '')).trim() || 'N/A';
                    const produkt = v.tarif || v.tarif_name || v.produkt || 'N/A';
                    
                    return `
                    <tr style="cursor: pointer;" onclick="showVertragDetails('${v.id}')">
                        <td>${datumFormatted}</td>
                        <td><strong>${v.vertragsnummer || '#' + (v.id ? v.id.substring(0, 8) : 'N/A')}</strong></td>
                        <td><div><strong>${kundeName}</strong></div></td>
                        <td><div><i class="fas fa-envelope"></i> ${v.kunde_email || 'N/A'}</div><div><i class="fas fa-phone"></i> ${v.kunde_telefon || 'N/A'}</div></td>
                        <td><div>${v.kunde_strasse || 'N/A'}</div><div style="font-size: 0.8rem;">${v.kunde_plz || ''} ${v.kunde_ort || ''}</div></td>
                        <td><span class="badge badge-info">${v.kategorie || 'N/A'}</span></td>
                        <td>${produkt}</td>
                        <td><strong style="color: var(--success);">${provision.toFixed(2)}â‚¬</strong></td>
                        <td><span class="badge badge-${statusColor}">${statusDisplay}</span></td>
                        <td>
                            <button class="action-btn btn-primary" onclick="event.stopPropagation(); showVertragDetails('${v.id}')"><i class="fas fa-eye"></i> Details</button>
                            ${!statusLower.includes('abge') && !statusLower.includes('stor') ? `<button class="action-btn btn-danger" onclick="event.stopPropagation(); openStornierungModal('${v.id}', '${datum}')"><i class="fas fa-times-circle"></i> Stornieren</button>` : ''}
                        </td>
                    </tr>
                    `;
                }).join('');
                
                // âœ… BONUS-FORTSCHRITT MIT ECHTEN VERTRÃ„GEN AKTUALISIEREN
                console.log('ğŸ¯ Aktualisiere Bonus-Fortschritt mit', alleMeineVertraege.length, 'VertrÃ¤gen');
                if (typeof aktualisiereBonusFortschritt === 'function') {
                    aktualisiereBonusFortschritt(alleMeineVertraege);
                }
                
            } catch (error) {
                console.error('âŒ Fehler:', error);
                tbody.innerHTML = `<tr><td colspan="10" style="text-align: center; padding: 2rem; color: var(--danger);"><i class="fas fa-exclamation-triangle" style="font-size: 2rem;"></i><div>Fehler beim Laden: ${error.message}</div><button onclick="loadVertraegePage()" class="action-btn btn-primary" style="margin-top: 1rem;"><i class="fas fa-sync"></i> Erneut versuchen</button></td></tr>`;
            }
        }
        
        // ========================================
        // ğŸ†• KUNDEN-VERTRÃ„GE MIT SCHÃ–NEN KARTEN
        // ========================================
        
        let alleKundenVertraegeData = [];
        let gefilterteKundenVertraege = [];
        
        async function loadKundenVertraege() {
            console.log('ğŸ‘¥ loadKundenVertraege() gestartet...');
            
            const container = document.getElementById('kunden-vertraege-liste');
            const sumBox = document.getElementById('vertraege-gesamt-provision');
            
            if (!container) {
                console.error('âŒ Container nicht gefunden!');
                return;
            }
            
            container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #94a3b8;"><i class="fas fa-spinner fa-spin" style="font-size: 40px; margin-bottom: 16px;"></i><p style="margin: 0;">Lade Kunden-VertrÃ¤ge...</p></div>';
            
            try {
                // 2. FINDE PARTNER-EMAIL ZUERST (mehrere Quellen)
                let partnerEmail = localStorage.getItem('partnerEmail');
                if (!partnerEmail) partnerEmail = localStorage.getItem('userEmail');
                if (!partnerEmail) partnerEmail = localStorage.getItem('email');
                if (!partnerEmail && typeof partnerData !== 'undefined' && partnerData?.email) {
                    partnerEmail = partnerData.email;
                }
                if (!partnerEmail) {
                    const el = document.getElementById('userEmail');
                    if (el && el.textContent && el.textContent.includes('@')) {
                        partnerEmail = el.textContent.trim();
                    }
                }
                
                console.log('ğŸ“§ Partner-Email gefunden:', partnerEmail || 'âŒ KEINE');
                const emailLower = (partnerEmail || '').toLowerCase();
                
                // âœ… IMMER FRISCH VON DB LADEN (kein Cache-Problem mehr!)
                let vertraege = [];
                
                // Direkt aus DB laden fÃ¼r aktuelle Daten
                try {
                    console.log('ğŸ“¡ Lade VertrÃ¤ge FRISCH aus DB...');
                    
                    // 1. Klassische VertrÃ¤ge laden (Partner-Tool)
                    const res = await fetch('tables/vertragsabschluesse?limit=1000&_t=' + Date.now());
                    const data = await res.json();
                    let alleVertraege = (data.data || []);
                    console.log('ğŸ“Š VertrÃ¤ge aus Partner-Tool:', alleVertraege.length);
                    
                    // 2. ğŸ†• Partner-Shop Bestellungen laden (VertragsHero etc.)
                    try {
                        const shopRes = await fetch('tables/partner_bestellungen?limit=1000&_t=' + Date.now());
                        const shopData = await shopRes.json();
                        let shopBestellungen = (shopData.data || []);
                        console.log('ğŸ›’ Partner-Shop Bestellungen:', shopBestellungen.length);
                        
                        // Shop-Bestellungen in Vertrags-Format konvertieren
                        const shopAlsVertraege = shopBestellungen.map(b => ({
                            // Identifikation
                            id: b.id,
                            vertragsnummer: b.bestellnummer || b.id,
                            partner_email: b.partner_email,
                            partner_id: b.partner_id,
                            
                            // Kundendaten (Mapping)
                            kunde_name: `${b.vorname || ''} ${b.nachname || ''}`.trim() || 'Unbekannt',
                            kunde_anrede: b.anrede,
                            kunde_vorname: b.vorname,
                            kunde_nachname: b.nachname,
                            kunde_email: b.email,
                            kunde_telefon: b.telefon,
                            kunde_strasse: b.strasse,
                            kunde_plz: b.plz,
                            kunde_ort: b.ort,
                            kunde_geburtsdatum: b.geburtsdatum,
                            
                            // Ausweisdaten
                            ausweis_typ: b.ausweis_typ,
                            ausweisnummer: b.ausweisnummer,
                            ausweis_behoerde: b.ausweis_behoerde,
                            ausweis_gueltig_bis: b.ausweis_gueltig,
                            
                            // Bankverbindung
                            kontoinhaber: b.kontoinhaber,
                            iban: b.iban,
                            bic: b.bic,
                            
                            // Rufnummernmitnahme
                            portierung: b.portierung_gewuenscht ? 'Ja' : 'Nein',
                            portierung_daten: b.portierung_daten,
                            
                            // Tarif-Daten
                            tarif_name: b.tarif_name,
                            kategorie: b.tarif_kategorie,
                            preis: b.tarif_preis,
                            tarif_details: b.tarif_details,
                            cross_sells: b.extras,
                            
                            // Status & Meta
                            status: b.status || 'neu',
                            quelle: b.quelle || 'partner-shop',
                            shop_name: b.shop_name || 'Partner-Shop',
                            created_at: b.erstellt_am || b.created_at,
                            anmerkungen: b.anmerkungen,
                            
                            // Markierung fÃ¼r UI
                            ist_shop_bestellung: true
                        }));
                        
                        alleVertraege = [...alleVertraege, ...shopAlsVertraege];
                        console.log('ğŸ“Š Gesamt (Tool + Shop):', alleVertraege.length);
                    } catch (shopError) {
                        console.warn('âš ï¸ Partner-Shop-Bestellungen konnten nicht geladen werden:', shopError);
                    }
                    
                    // Filtern fÃ¼r Partner
                    if (partnerEmail) {
                        vertraege = alleVertraege.filter(v => {
                            const vEmail = (v.partner_email || '').toLowerCase();
                            const vId = (v.partner_id || '').toLowerCase();
                            // Match by email OR partner_id
                            return vEmail === emailLower || 
                                   (vId && emailLower.includes(vId));
                        });
                        console.log('âœ… Gefiltert fÃ¼r ' + partnerEmail + ':', vertraege.length);
                        
                        // Cache + Global aktualisieren
                        localStorage.setItem('cachedVertraege_' + emailLower, JSON.stringify(vertraege));
                        window.allePartnerVertraege = vertraege;
                    } else {
                        vertraege = alleVertraege;
                    }
                } catch (dbError) {
                    console.warn('âš ï¸ DB-Fehler, nutze Fallback...', dbError);
                
                    // Fallback 1: Globale Variable
                    if (window.allePartnerVertraege && window.allePartnerVertraege.length > 0) {
                        console.log('âœ… Nutze globale VertrÃ¤ge als Fallback:', window.allePartnerVertraege.length);
                        vertraege = window.allePartnerVertraege;
                    } else {
                        // Fallback 2: Cache prÃ¼fen
                        try {
                            const cached = localStorage.getItem('cachedVertraege_' + emailLower);
                            if (cached) {
                                vertraege = JSON.parse(cached);
                                console.log('âœ… Aus Cache geladen:', vertraege.length, 'VertrÃ¤ge');
                                window.allePartnerVertraege = vertraege;
                            }
                        } catch(e) { 
                            console.log('Cache-Fehler:', e); 
                        }
                    }
                }
                
                alleKundenVertraegeData = vertraege;
                window.alleKundenVertraegeData = vertraege; // FÃ¼r Hochrechnung global verfÃ¼gbar
                gefilterteKundenVertraege = vertraege;
                
                // Auch die alte Tabelle aktualisieren
                alleMeineVertraege = vertraege;
                
                console.log('âœ… VertrÃ¤ge fÃ¼r Kunden-Karten:', vertraege.length);
                
                // ğŸš€ Charts-Flag zurÃ¼cksetzen bei explizitem Laden
                partnerChartsAlreadyRendered = false;
                
                renderKundenVertraege();
                
            } catch (error) {
                console.error('âŒ Fehler:', error);
                container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #ef4444;"><i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 16px;"></i><p>Fehler beim Laden</p></div>';
            }
        }
        
        function renderKundenVertraege() {
            const container = document.getElementById('kunden-vertraege-liste');
            const sumBox = document.getElementById('vertraege-gesamt-provision');
            
            if (!container) return;
            
            // Gruppiere VertrÃ¤ge nach Kunde (Email)
            const kundenMap = {};
            let gesamtProvision = 0;
            
            gefilterteKundenVertraege.forEach(v => {
                const kundeKey = (v.kunde_email || v.kunde_name || 'Unbekannt').toLowerCase();
                if (!kundenMap[kundeKey]) {
                    // Adresse zusammensetzen
                    let adresse = '';
                    if (v.kunde_strasse) adresse += v.kunde_strasse;
                    if (v.kunde_plz || v.kunde_ort) {
                        adresse += (adresse ? ', ' : '') + (v.kunde_plz || '') + ' ' + (v.kunde_ort || '');
                    }
                    
                    kundenMap[kundeKey] = {
                        name: v.kunde_name || ((v.kunde_vorname || '') + ' ' + (v.kunde_nachname || '')).trim() || 'Unbekannter Kunde',
                        vorname: v.kunde_vorname || '',
                        nachname: v.kunde_nachname || '',
                        email: v.kunde_email || '',
                        telefon: v.kunde_telefon || v.kunde_mobil || '',
                        mobil: v.kunde_mobil || '',
                        adresse: adresse.trim() || '',
                        strasse: v.kunde_strasse || '',
                        hausnummer: v.kunde_hausnummer || '',
                        plz: v.kunde_plz || '',
                        ort: v.kunde_ort || '',
                        geburtsdatum: v.kunde_geburtsdatum || '',
                        ausweisnummer: v.kunde_ausweisnummer || v.ausweisnummer || v.ausweis_nr || '',
                        iban: v.kunde_iban || v.iban || '',
                        bic: v.kunde_bic || v.bic || '',
                        kontoinhaber: v.kunde_kontoinhaber || v.kontoinhaber || '',
                        vertraege: [],
                        provision: 0
                    };
                }
                kundenMap[kundeKey].vertraege.push(v);
                const prov = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                kundenMap[kundeKey].provision += prov;
                gesamtProvision += prov;
            });
            
            // Gesamt-Provision aktualisieren
            if (sumBox) {
                sumBox.textContent = gesamtProvision.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' â‚¬';
            }
            
            // ğŸ“Š STATISTIK-KARTEN AKTUALISIEREN (basierend auf gefilterten Daten)
            updateVertraegeStatistikKarten(gefilterteKundenVertraege);
            
            // In Array umwandeln und sortieren
            let kundenArray = Object.values(kundenMap);
            
            // Sortierung anwenden
            const sortierung = document.getElementById('vertraege-sortierung')?.value || 'vertraege-desc';
            if (sortierung === 'vertraege-desc') {
                kundenArray.sort((a, b) => b.vertraege.length - a.vertraege.length);
            } else if (sortierung === 'provision-desc') {
                kundenArray.sort((a, b) => b.provision - a.provision);
            } else if (sortierung === 'name-asc') {
                kundenArray.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortierung === 'datum-desc') {
                kundenArray.sort((a, b) => {
                    const dateA = new Date(a.vertraege[0]?.erstellt_am || 0);
                    const dateB = new Date(b.vertraege[0]?.erstellt_am || 0);
                    return dateB - dateA;
                });
            }
            
            if (kundenArray.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #94a3b8;"><i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i><p style="font-size: 18px; margin: 0;">Keine VertrÃ¤ge gefunden</p><p style="font-size: 14px; margin-top: 8px;">Erstelle deinen ersten Vertrag Ã¼ber das Partner-Tool</p></div>';
                return;
            }
            
            // Gradient-Farben fÃ¼r Karten (wie im Admin)
            const gradients = [
                'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)',
                'linear-gradient(135deg, #5B86E5 0%, #36D1DC 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
            ];
            
            let html = '';
            kundenArray.forEach((kunde, index) => {
                const gradient = gradients[index % gradients.length];
                const initial = kunde.name.charAt(0).toUpperCase();
                const kundeId = 'kunde-' + index;
                
                html += `
                <div style="background: ${gradient}; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.15); transition: all 0.3s; margin-bottom: 12px;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 30px rgba(0,0,0,0.2)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 20px rgba(0,0,0,0.15)'">
                    <div onclick="toggleKundeDetails('${kundeId}')" style="padding: 16px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px; min-width: 200px; flex: 1;">
                            <div style="width: 44px; height: 44px; min-width: 44px; background: rgba(255,255,255,0.25); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 700; color: white;">
                                ${initial}
                            </div>
                            <div style="overflow: hidden;">
                                <div style="font-size: 15px; font-weight: 700; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${kunde.name}</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.85); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${kunde.email || kunde.telefon || 'Keine Kontaktdaten'}</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 22px; font-weight: 800; color: white;">${kunde.vertraege.length}</div>
                                <div style="font-size: 9px; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 0.5px;">VertrÃ¤ge</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 22px; font-weight: 800; color: white;">${kunde.provision.toFixed(2)}â‚¬</div>
                                <div style="font-size: 9px; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 0.5px;">Provision</div>
                            </div>
                            <i class="fas fa-chevron-down" id="${kundeId}-icon" style="color: rgba(255,255,255,0.7); font-size: 16px; transition: transform 0.3s;"></i>
                        </div>
                    </div>
                    <div id="${kundeId}" style="display: none; background: rgba(255,255,255,0.98); padding: 12px; border-top: 3px solid rgba(255,255,255,0.3); overflow-x: hidden;">
                        
                        <!-- ğŸ‘¤ KUNDEN-DETAILS BUTTON -->
                        <div style="margin-bottom: 10px;">
                            <button onclick="toggleKundenDetails('${kundeId}-details')" style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px;">
                                <i class="fas fa-user"></i> Kundendaten anzeigen
                                <i class="fas fa-chevron-down" id="${kundeId}-details-icon" style="font-size: 10px; transition: transform 0.3s;"></i>
                            </button>
                        </div>
                        
                        <!-- ğŸ‘¤ KUNDEN-INFO BOX (versteckt) - ALLE DATEN - RESPONSIVE -->
                        <div id="${kundeId}-details" style="display: none; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 12px; padding: 16px; margin-bottom: 16px; overflow-x: auto;">
                            
                            <!-- ğŸ“‹ PERSÃ–NLICHE DATEN -->
                            <div style="margin-bottom: 16px;">
                                <div style="font-size: 13px; font-weight: 700; color: #3b82f6; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-user-circle"></i> PersÃ¶nliche Daten
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ‘¤ Vorname</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-word;">${kunde.vorname || '-'}</div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ‘¤ Nachname</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-word;">${kunde.nachname || '-'}</div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ‚ Geburtsdatum</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b;">${kunde.geburtsdatum || '-'}</div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸªª Ausweis-Nr.</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-all;">${kunde.ausweisnummer || '-'}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ğŸ“ KONTAKTDATEN -->
                            <div style="margin-bottom: 16px;">
                                <div style="font-size: 13px; font-weight: 700; color: #10b981; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-address-book"></i> Kontaktdaten
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ“§ Email</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-all;">${kunde.email || '-'}</div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                        <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                            <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ“± Telefon</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1e293b;">${kunde.telefon || '-'}</div>
                                        </div>
                                        <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                            <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ“± Mobil</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1e293b;">${kunde.mobil || '-'}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ğŸ“ ADRESSE -->
                            <div style="margin-bottom: 16px;">
                                <div style="font-size: 13px; font-weight: 700; color: #f59e0b; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-map-marker-alt"></i> Adresse
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ  StraÃŸe + Hausnr.</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-word;">${kunde.strasse || '-'} ${kunde.hausnummer || ''}</div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                        <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                            <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ“® PLZ</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1e293b;">${kunde.plz || '-'}</div>
                                        </div>
                                        <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                            <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ™ï¸ Ort</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-word;">${kunde.ort || '-'}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ğŸ’³ BANKDATEN -->
                            <div>
                                <div style="font-size: 13px; font-weight: 700; color: #3b82f6; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-credit-card"></i> Bankdaten
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ‘¤ Kontoinhaber</div>
                                        <div style="font-size: 13px; font-weight: 600; color: #1e293b; word-break: break-word;">${kunde.kontoinhaber || '-'}</div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                        <div style="font-size: 9px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">ğŸ¦ IBAN</div>
                                        <div style="font-size: 12px; font-weight: 600; color: #1e293b; font-family: monospace; word-break: break-all;">${kunde.iban || '-'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ğŸ“‹ VERTRÃ„GE TABELLE - RESPONSIVE -->
                        <div style="overflow-x: auto; margin: 0 -10px; padding: 0 10px;">
                        <table style="width: 100%; min-width: 600px; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f1f5f9; color: #475569;">
                                    <th style="padding: 10px 8px; text-align: left; border-radius: 8px 0 0 8px; white-space: nowrap;">Datum</th>
                                    <th style="padding: 10px 8px; text-align: left; white-space: nowrap;">Kategorie</th>
                                    <th style="padding: 10px 8px; text-align: left;">Produkt</th>
                                    <th style="padding: 10px 8px; text-align: right; white-space: nowrap;">Provision</th>
                                    <th style="padding: 10px 8px; text-align: center; white-space: nowrap;">Status</th>
                                    <th style="padding: 10px 8px; text-align: center; border-radius: 0 8px 8px 0; white-space: nowrap;">Aktion</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${kunde.vertraege.map(v => {
                                    const status = v.vertrag_status || v.status || 'neu';
                                    const statusLower = status.toLowerCase();
                                    const zahlungsstatus = v.zahlungsstatus || v.payment_status || '';
                                    
                                    // STATUS-FARBEN UND TEXTE
                                    let statusColor, statusText;
                                    if (statusLower.includes('aktiv')) {
                                        statusColor = '#10b981'; statusText = 'âœ… Aktiviert';
                                    } else if (statusLower.includes('abge') || statusLower.includes('reject')) {
                                        statusColor = '#ef4444'; statusText = 'âŒ Abgelehnt';
                                    } else if (statusLower.includes('prÃ¼f') || statusLower.includes('check')) {
                                        statusColor = '#f59e0b'; statusText = 'ğŸ” In PrÃ¼fung';
                                    } else if (statusLower.includes('stor')) {
                                        statusColor = '#6b7280'; statusText = 'ğŸš« Storniert';
                                    } else if (statusLower.includes('neu') || statusLower.includes('new') || statusLower.includes('eingegangen')) {
                                        statusColor = '#3b82f6'; statusText = 'ğŸ†• Neu';
                                    } else {
                                        statusColor = '#8b5cf6'; statusText = status;
                                    }
                                    
                                    // ZAHLUNGSSTATUS - Automatische Logik
                                    let zahlungsColor, zahlungsText;
                                    if (zahlungsstatus) {
                                        const zLower = zahlungsstatus.toLowerCase();
                                        if (zLower.includes('ausgezahlt') || zLower.includes('paid')) {
                                            zahlungsColor = '#10b981'; zahlungsText = 'ğŸ’° Ausgezahlt';
                                        } else if (zLower.includes('ausstehend') || zLower.includes('pending')) {
                                            zahlungsColor = '#f59e0b'; zahlungsText = 'â³ Ausstehend';
                                        } else {
                                            zahlungsColor = '#6b7280'; zahlungsText = zahlungsstatus;
                                        }
                                    } else {
                                        // Automatische Logik basierend auf Vertragsstatus
                                        if (statusLower.includes('aktiv')) {
                                            zahlungsColor = '#f59e0b'; zahlungsText = 'â³ Ausstehend';
                                        } else if (statusLower.includes('abge') || statusLower.includes('stor')) {
                                            zahlungsColor = '#6b7280'; zahlungsText = 'â€”';
                                        } else {
                                            zahlungsColor = '#94a3b8'; zahlungsText = 'â¸ï¸ Wartend';
                                        }
                                    }
                                    
                                    const datum = v.erstellt_am || v.created_at;
                                    const prov = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                                    return `
                                    <tr style="border-bottom: 1px solid #e2e8f0; transition: background 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                        <td style="padding: 10px 8px; white-space: nowrap;">${datum ? new Date(datum).toLocaleDateString('de-DE') : '-'}</td>
                                        <td style="padding: 10px 8px;"><span style="background: #e0e7ff; color: #4338ca; padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap;">${v.kategorie || '-'}</span></td>
                                        <td style="padding: 10px 8px; color: #475569; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${v.tarif || v.tarif_name || v.produkt || '-'}</td>
                                        <td style="padding: 10px 8px; text-align: right; font-weight: 700; color: #10b981; white-space: nowrap;">${prov.toFixed(2)}â‚¬</td>
                                        <td style="padding: 10px 8px; text-align: center;"><span style="background: ${statusColor}15; color: ${statusColor}; padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; white-space: nowrap;">${statusText}</span></td>
                                        <td style="padding: 10px 8px; text-align: center;">
                                            ${!statusLower.includes('abge') && !statusLower.includes('stor') ? 
                                                `<button onclick="event.stopPropagation(); openStornierungModal('${v.id}', '${datum}')" style="padding: 4px 8px; background: #fee2e2; color: #dc2626; border: none; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer;">
                                                    <i class="fas fa-times"></i>
                                                </button>` 
                                                : '<span style="color: #94a3b8;">â€”</span>'
                                            }
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        </div>
                        
                        <!-- ğŸ“Š ZUSAMMENFASSUNG -->
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid #e2e8f0; display: flex; justify-content: flex-end; gap: 16px; flex-wrap: wrap;">
                            <div style="text-align: right;">
                                <div style="font-size: 11px; color: #64748b;">VertrÃ¤ge</div>
                                <div style="font-size: 16px; font-weight: 700; color: #334155;">${kunde.vertraege.length}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 11px; color: #64748b;">Provision</div>
                                <div style="font-size: 16px; font-weight: 700; color: #10b981;">${kunde.provision.toFixed(2)}â‚¬</div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Auch alte Tabelle aktualisieren
            updateAlteVertraegeTabelle();
            
            // ğŸ“Š DIAGRAMME RENDERN
            renderPartnerVertraegeCharts(gefilterteKundenVertraege);
        }
        
        // ğŸ“Š PARTNER VERTRÃ„GE CHARTS
        let partnerChartInstances = {};
        let partnerChartsAlreadyRendered = false;  // ğŸš€ Optimierung: nur einmal laden
        
        function renderPartnerVertraegeCharts(vertraege, forceRender = false) {
            // ğŸš€ OPTIMIERUNG: Charts nur einmal beim ersten Laden rendern
            if (partnerChartsAlreadyRendered && !forceRender) {
                console.log('â­ï¸ Charts bereits gerendert - Ã¼bersprungen');
                return;
            }
            
            console.log('ğŸ“Š Rendere Partner-Charts mit', vertraege.length, 'VertrÃ¤gen');
            
            if (!vertraege || vertraege.length === 0) {
                console.log('âš ï¸ Keine VertrÃ¤ge fÃ¼r Charts');
                return;
            }
            
            // Kategorie-Icons und Farben - PREMIUM APPLE-STYLE PALETTE 2026
            const kategorieConfig = {
                'mobilfunk': { icon: 'ğŸ“±', color: '#6366f1', label: 'Mobilfunk' },      // Indigo
                'sim-only': { icon: 'ğŸ“²', color: '#8b5cf6', label: 'SIM-Only' },        // Violet
                'simonly': { icon: 'ğŸ“²', color: '#8b5cf6', label: 'SIM-Only' },         // Violet
                'dsl': { icon: 'ğŸŒ', color: '#0ea5e9', label: 'DSL/Internet' },         // Sky Blue
                'internet': { icon: 'ğŸŒ', color: '#06b6d4', label: 'Internet' },        // Cyan
                'strom': { icon: 'âš¡', color: '#f59e0b', label: 'Strom' },              // Amber
                'gas': { icon: 'ğŸ”¥', color: '#f97316', label: 'Gas' },                  // Orange
                'versicherung': { icon: 'ğŸ›¡ï¸', color: '#10b981', label: 'Versicherung' } // Emerald
            };
            
            // === CHART 1: VertrÃ¤ge nach Kategorie (Donut) ===
            const kategorienCount = {};
            vertraege.forEach(v => {
                const kat = (v.kategorie || 'sonstige').toLowerCase();
                kategorienCount[kat] = (kategorienCount[kat] || 0) + 1;
            });
            
            const katLabels = Object.keys(kategorienCount).map(k => {
                const config = kategorieConfig[k] || { icon: 'ğŸ“‹', label: k };
                return config.icon + ' ' + config.label;
            });
            const katValues = Object.values(kategorienCount);
            const katColors = Object.keys(kategorienCount).map(k => {
                return (kategorieConfig[k] || { color: '#94a3b8' }).color;
            });
            
            const ctx1 = document.getElementById('chart-vertraege-kategorie-partner');
            if (ctx1) {
                if (partnerChartInstances['kat']) partnerChartInstances['kat'].destroy();
                partnerChartInstances['kat'] = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: katLabels,
                        datasets: [{
                            data: katValues,
                            backgroundColor: katColors,
                            borderColor: '#ffffff',
                            borderWidth: 4,
                            hoverOffset: 12,
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 1000,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 18,
                                    font: { size: 13, weight: '600', family: "'SF Pro Display', -apple-system, sans-serif" },
                                    color: '#334155'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                padding: 14,
                                cornerRadius: 12,
                                titleFont: { size: 14, weight: '700' },
                                bodyFont: { size: 13, weight: '500' },
                                displayColors: true,
                                boxPadding: 6,
                                callbacks: {
                                    label: function(item) {
                                        const total = item.dataset.data.reduce((a, b) => a + b, 0);
                                        const percent = Math.round((item.raw / total) * 100);
                                        return ' ' + item.label + ': ' + item.raw + ' (' + percent + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // === CHART 2: Provision nach Kategorie (Bar) ===
            const kategorienProvision = {};
            vertraege.forEach(v => {
                const kat = (v.kategorie || 'sonstige').toLowerCase();
                const prov = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                kategorienProvision[kat] = (kategorienProvision[kat] || 0) + prov;
            });
            
            const provLabels = Object.keys(kategorienProvision).map(k => {
                const config = kategorieConfig[k] || { icon: 'ğŸ“‹', label: k };
                return config.icon + ' ' + config.label;
            });
            const provValues = Object.values(kategorienProvision).map(v => Math.round(v * 100) / 100);
            const provColors = Object.keys(kategorienProvision).map(k => {
                return (kategorieConfig[k] || { color: '#94a3b8' }).color;
            });
            
            const ctx2 = document.getElementById('chart-provision-kategorie-partner');
            if (ctx2) {
                if (partnerChartInstances['prov']) partnerChartInstances['prov'].destroy();
                partnerChartInstances['prov'] = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: provLabels,
                        datasets: [{
                            label: 'Provision â‚¬',
                            data: provValues,
                            backgroundColor: provColors.map(c => {
                                // Gradient-Ã¤hnlicher Effekt durch leichte Transparenz
                                return c + 'E6';
                            }),
                            borderColor: provColors,
                            borderWidth: 0,
                            borderRadius: 12,
                            borderSkipped: false,
                            hoverBackgroundColor: provColors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1200,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                padding: 14,
                                cornerRadius: 12,
                                titleFont: { size: 14, weight: '700' },
                                bodyFont: { size: 13, weight: '600' },
                                displayColors: true,
                                boxPadding: 6,
                                callbacks: {
                                    label: function(item) {
                                        return ' Provision: ' + item.raw.toLocaleString('de-DE', {minimumFractionDigits: 2}) + ' â‚¬';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { 
                                grid: { display: false },
                                ticks: {
                                    font: { size: 12, weight: '600', family: "'SF Pro Display', -apple-system, sans-serif" },
                                    color: '#64748b'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: { 
                                    color: 'rgba(148, 163, 184, 0.15)',
                                    drawBorder: false
                                },
                                ticks: {
                                    font: { size: 11, weight: '500' },
                                    color: '#94a3b8',
                                    callback: function(value) { return value.toLocaleString('de-DE') + ' â‚¬'; },
                                    padding: 8
                                }
                            }
                        }
                    }
                });
            }
            
            // === CHART 3: Status-Ãœbersicht (Horizontal Bar) ===
            // PREMIUM STATUS-FARBEN 2026
            const statusConfig = {
                'aktiviert': { label: 'âœ… Aktiviert', color: '#10b981' },       // Emerald
                'akzeptiert': { label: 'âœ… Akzeptiert', color: '#10b981' },     // Emerald
                'neu': { label: 'ğŸ†• Neu', color: '#6366f1' },                   // Indigo
                'neu_eingegangen': { label: 'ğŸ“¥ Eingegangen', color: '#8b5cf6' }, // Violet
                'in_pruefung': { label: 'ğŸ” In PrÃ¼fung', color: '#f59e0b' },    // Amber
                'in_bearbeitung': { label: 'â³ In Bearbeitung', color: '#0ea5e9' }, // Sky
                'abgelehnt': { label: 'âŒ Abgelehnt', color: '#ef4444' },       // Red
                'storniert': { label: 'ğŸš« Storniert', color: '#64748b' }        // Slate
            };
            
            const statusCount = {};
            vertraege.forEach(v => {
                const status = (v.vertrag_status || v.status || 'neu').toLowerCase();
                statusCount[status] = (statusCount[status] || 0) + 1;
            });
            
            const statusLabels = Object.keys(statusCount).map(s => {
                return (statusConfig[s] || { label: s }).label;
            });
            const statusValues = Object.values(statusCount);
            const statusColors = Object.keys(statusCount).map(s => {
                return (statusConfig[s] || { color: '#94a3b8' }).color;
            });
            
            const ctx3 = document.getElementById('chart-status-partner');
            if (ctx3) {
                if (partnerChartInstances['status']) partnerChartInstances['status'].destroy();
                partnerChartInstances['status'] = new Chart(ctx3, {
                    type: 'bar',
                    data: {
                        labels: statusLabels,
                        datasets: [{
                            label: 'Anzahl',
                            data: statusValues,
                            backgroundColor: statusColors.map(c => c + '30'),
                            borderColor: statusColors,
                            borderWidth: 2,
                            borderRadius: 10,
                            borderSkipped: false,
                            hoverBackgroundColor: statusColors.map(c => c + '60'),
                            hoverBorderWidth: 3
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 1000,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                padding: 14,
                                cornerRadius: 12,
                                titleFont: { size: 14, weight: '700' },
                                bodyFont: { size: 13, weight: '600' },
                                displayColors: true,
                                boxPadding: 6,
                                callbacks: {
                                    label: function(item) {
                                        const total = vertraege.length;
                                        const percent = total > 0 ? Math.round((item.raw / total) * 100) : 0;
                                        return ' ' + item.raw + ' VertrÃ¤ge (' + percent + '%)';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: { 
                                    color: 'rgba(148, 163, 184, 0.12)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    stepSize: 1,
                                    font: { size: 11, weight: '500' },
                                    color: '#94a3b8',
                                    padding: 8
                                }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { 
                                    font: { size: 13, weight: '600', family: "'SF Pro Display', -apple-system, sans-serif" },
                                    color: '#334155',
                                    padding: 12
                                }
                            }
                        }
                    }
                });
            }
            
            console.log('âœ… Partner-Charts gerendert!');
            partnerChartsAlreadyRendered = true;  // ğŸš€ Markieren als gerendert
            
            // ğŸ†• Neue erweiterte Charts rendern
            renderExtendedStatistics(vertraege);
        }
        
        // ğŸ†• ERWEITERTE STATISTIKEN - NEUE INNOVATE CHARTS 2026
        function renderExtendedStatistics(vertraege) {
            console.log('ğŸ“Š Rendere erweiterte Statistiken mit', vertraege.length, 'VertrÃ¤gen');
            
            // === QUICK STATS BERECHNEN ===
            const heute = new Date();
            const monatStart = new Date(heute.getFullYear(), heute.getMonth(), 1);
            
            let totalVertraege = vertraege.length;
            let totalProvision = 0;
            let aktivierteVertraege = 0;
            let monatVertraege = 0;
            let monatProvision = 0;
            
            vertraege.forEach(v => {
                const prov = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                totalProvision += prov;
                
                const status = (v.vertrag_status || v.status || '').toLowerCase();
                if (status.includes('aktiv') || status.includes('akzept')) {
                    aktivierteVertraege++;
                }
                
                const datum = new Date(v.erstellt_am || v.created_at);
                if (datum >= monatStart) {
                    monatVertraege++;
                    monatProvision += prov;
                }
            });
            
            // Quick Stats aktualisieren
            const statTotal = document.getElementById('stat-total-vertraege');
            const statProvision = document.getElementById('stat-total-provision');
            const statErfolg = document.getElementById('stat-erfolgsquote');
            const statAvg = document.getElementById('stat-avg-provision');
            const trendVertraege = document.getElementById('stat-vertraege-trend');
            const trendProvision = document.getElementById('stat-provision-trend');
            
            if (statTotal) statTotal.textContent = totalVertraege;
            if (statProvision) statProvision.textContent = totalProvision.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' â‚¬';
            if (statErfolg) statErfolg.textContent = totalVertraege > 0 ? Math.round((aktivierteVertraege / totalVertraege) * 100) + '%' : '0%';
            if (statAvg) statAvg.textContent = totalVertraege > 0 ? (totalProvision / totalVertraege).toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' â‚¬' : '0 â‚¬';
            
            if (trendVertraege) {
                trendVertraege.innerHTML = monatVertraege > 0 
                    ? '<i class="fas fa-arrow-up"></i> +' + monatVertraege + ' diesen Monat'
                    : '<i class="fas fa-minus"></i> 0 diesen Monat';
                trendVertraege.style.background = monatVertraege > 0 ? '#dcfce7' : '#f1f5f9';
                trendVertraege.style.color = monatVertraege > 0 ? '#16a34a' : '#64748b';
            }
            
            if (trendProvision) {
                trendProvision.innerHTML = monatProvision > 0 
                    ? '<i class="fas fa-arrow-up"></i> +' + monatProvision.toLocaleString('de-DE', {minimumFractionDigits: 2}) + ' â‚¬ diesen Monat'
                    : '<i class="fas fa-minus"></i> 0 â‚¬ diesen Monat';
                trendProvision.style.background = monatProvision > 0 ? '#dcfce7' : '#f1f5f9';
                trendProvision.style.color = monatProvision > 0 ? '#16a34a' : '#64748b';
            }
            
            // === CHART: Monatliche Entwicklung (Line) ===
            renderMonatsTrendChart(vertraege);
            
            // === CHART: Top Tarife ===
            renderTopTarifeChart(vertraege);
            
            // === CHART: Provision Timeline ===
            renderProvisionTimelineChart(vertraege);
            
            // === Anbieter Performance Grid ===
            renderAnbieterPerformance(vertraege);
        }
        
        // ğŸ“ˆ MONATS-TREND CHART
        function renderMonatsTrendChart(vertraege) {
            const ctx = document.getElementById('chart-monats-trend');
            if (!ctx) return;
            
            // Letzte 6 Monate berechnen
            const monate = [];
            const vertraegeProMonat = [];
            const provisionProMonat = [];
            
            for (let i = 5; i >= 0; i--) {
                const datum = new Date();
                datum.setMonth(datum.getMonth() - i);
                const monatStart = new Date(datum.getFullYear(), datum.getMonth(), 1);
                const monatEnde = new Date(datum.getFullYear(), datum.getMonth() + 1, 0);
                
                const monatName = datum.toLocaleString('de-DE', { month: 'short', year: '2-digit' });
                monate.push(monatName);
                
                let count = 0;
                let prov = 0;
                vertraege.forEach(v => {
                    const vDatum = new Date(v.erstellt_am || v.created_at);
                    if (vDatum >= monatStart && vDatum <= monatEnde) {
                        count++;
                        prov += parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                    }
                });
                vertraegeProMonat.push(count);
                provisionProMonat.push(Math.round(prov));
            }
            
            if (partnerChartInstances['trend']) partnerChartInstances['trend'].destroy();
            partnerChartInstances['trend'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monate,
                    datasets: [
                        {
                            label: 'VertrÃ¤ge',
                            data: vertraegeProMonat,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Provision (â‚¬)',
                            data: provisionProMonat,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { usePointStyle: true, padding: 15, font: { size: 12, weight: '600' } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 14,
                            cornerRadius: 12
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { font: { size: 11, weight: '500' }, color: '#64748b' } },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { font: { size: 11 }, color: '#3b82f6', stepSize: 1 },
                            title: { display: true, text: 'VertrÃ¤ge', color: '#3b82f6', font: { size: 11, weight: '600' } }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { font: { size: 11 }, color: '#10b981', callback: v => v + 'â‚¬' },
                            title: { display: true, text: 'Provision', color: '#10b981', font: { size: 11, weight: '600' } }
                        }
                    }
                }
            });
        }
        
        // ğŸ† TOP TARIFE CHART
        function renderTopTarifeChart(vertraege) {
            const ctx = document.getElementById('chart-top-tarife');
            if (!ctx) return;
            
            // Tarife zÃ¤hlen
            const tarifCount = {};
            vertraege.forEach(v => {
                const tarif = v.tarif_name || v.tarif || v.anbieter || 'Unbekannt';
                tarifCount[tarif] = (tarifCount[tarif] || 0) + 1;
            });
            
            // Top 5 sortieren
            const sorted = Object.entries(tarifCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const labels = sorted.map(([name]) => name.length > 25 ? name.substring(0, 22) + '...' : name);
            const values = sorted.map(([, count]) => count);
            const colors = ['#6366f1', '#8b5cf6', '#a78bfa', '#c4b5fd', '#ddd6fe'];
            
            if (partnerChartInstances['topTarife']) partnerChartInstances['topTarife'].destroy();
            partnerChartInstances['topTarife'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'VerkÃ¤ufe',
                        data: values,
                        backgroundColor: colors,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 12,
                            cornerRadius: 10,
                            callbacks: {
                                label: item => ' ' + item.raw + ' VerkÃ¤ufe'
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { stepSize: 1, font: { size: 11 }, color: '#64748b' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { font: { size: 12, weight: '600' }, color: '#334155' }
                        }
                    }
                }
            });
        }
        
        // ğŸ’° PROVISION TIMELINE CHART
        function renderProvisionTimelineChart(vertraege, monate = 6) {
            const ctx = document.getElementById('chart-provision-timeline');
            if (!ctx) return;
            
            const labels = [];
            const provisionData = [];
            const kumulativ = [];
            let summe = 0;
            
            for (let i = monate - 1; i >= 0; i--) {
                const datum = new Date();
                datum.setMonth(datum.getMonth() - i);
                const monatStart = new Date(datum.getFullYear(), datum.getMonth(), 1);
                const monatEnde = new Date(datum.getFullYear(), datum.getMonth() + 1, 0);
                
                labels.push(datum.toLocaleString('de-DE', { month: 'long', year: 'numeric' }));
                
                let prov = 0;
                vertraege.forEach(v => {
                    const vDatum = new Date(v.erstellt_am || v.created_at);
                    if (vDatum >= monatStart && vDatum <= monatEnde) {
                        prov += parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                    }
                });
                provisionData.push(Math.round(prov));
                summe += prov;
                kumulativ.push(Math.round(summe));
            }
            
            if (partnerChartInstances['timeline']) partnerChartInstances['timeline'].destroy();
            partnerChartInstances['timeline'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            type: 'bar',
                            label: 'Monatliche Provision',
                            data: provisionData,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 0,
                            borderRadius: 8,
                            order: 2
                        },
                        {
                            type: 'line',
                            label: 'Kumulativ',
                            data: kumulativ,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 5,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { usePointStyle: true, padding: 15, font: { size: 12, weight: '600' } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 14,
                            cornerRadius: 12,
                            callbacks: {
                                label: item => ' ' + item.dataset.label + ': ' + item.raw.toLocaleString('de-DE') + ' â‚¬'
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { font: { size: 11 }, color: '#64748b' } },
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { font: { size: 11 }, color: '#64748b', callback: v => v.toLocaleString('de-DE') + ' â‚¬' }
                        }
                    }
                }
            });
        }
        
        // Timeline Filter Update
        function updateProvisionTimeline() {
            const filter = document.getElementById('provision-timeline-filter');
            const monate = parseInt(filter?.value || 6);
            const vertraege = window.alleKundenVertraegeData || [];
            renderProvisionTimelineChart(vertraege, monate);
        }
        
        // ğŸ… ANBIETER PERFORMANCE GRID
        function renderAnbieterPerformance(vertraege) {
            const container = document.getElementById('anbieter-performance-grid');
            if (!container) return;
            
            // Anbieter aggregieren
            const anbieterStats = {};
            vertraege.forEach(v => {
                const anbieter = v.anbieter || 'Unbekannt';
                if (!anbieterStats[anbieter]) {
                    anbieterStats[anbieter] = { count: 0, provision: 0 };
                }
                anbieterStats[anbieter].count++;
                anbieterStats[anbieter].provision += parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
            });
            
            // Top 6 nach Provision sortieren
            const sorted = Object.entries(anbieterStats)
                .sort((a, b) => b[1].provision - a[1].provision)
                .slice(0, 6);
            
            if (sorted.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #94a3b8; grid-column: 1 / -1;"><i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>Noch keine Vertragsdaten vorhanden</div>';
                return;
            }
            
            const colors = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'];
            const icons = { 'Telekom': 'ğŸ“±', 'Vodafone': 'ğŸ“¶', 'O2': 'ğŸŒ', 'congstar': 'ğŸ“²', '1&1': 'ğŸ’»', 'default': 'ğŸ“„' };
            
            container.innerHTML = sorted.map(([name, stats], i) => {
                const icon = icons[name] || icons['default'];
                return `
                    <div style="background: linear-gradient(145deg, #ffffff, #f8fafc); border-radius: 16px; padding: 1.25rem; border: 1px solid ${colors[i]}20; box-shadow: 0 4px 15px ${colors[i]}15; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px ${colors[i]}25'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px ${colors[i]}15'">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, ${colors[i]}, ${colors[i]}99); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px;">${icon}</div>
                            <span style="font-size: 0.95rem; font-weight: 700; color: #1e293b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${name}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: 800; color: ${colors[i]};">${stats.provision.toLocaleString('de-DE', {minimumFractionDigits: 2})} â‚¬</div>
                                <div style="font-size: 0.8rem; color: #64748b; margin-top: 2px;">${stats.count} VertrÃ¤ge</div>
                            </div>
                            <div style="background: ${colors[i]}15; color: ${colors[i]}; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700;">
                                #${i + 1}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ğŸ”„ ALLE STATS REFRESHEN
        function refreshAllStats() {
            console.log('ğŸ”„ Refreshing all statistics...');
            partnerChartsAlreadyRendered = false;
            const vertraege = window.alleKundenVertraegeData || [];
            renderPartnerVertraegeCharts(vertraege, true);
        }
        
        // ğŸ“Š STATISTIK-KARTEN AKTUALISIEREN (fÃ¼r "Meine VertrÃ¤ge")
        // âœ… 17.12.2025: "Gesamt" und "Dieser Monat" entfernt (grÃ¼ner Kasten zeigt das)
        // âœ… Hochrechnung basiert IMMER auf aktuellem Monat (nicht gefiltert!)
        function updateVertraegeStatistikKarten(vertraege) {
            // IDs der 4 verbleibenden Karten
            const ids = ['vertraege-stat-ausgezahlt', 'vertraege-stat-ausstehend', 'vertraege-stat-hochrechnung', 'vertraege-stat-abgelehnt'];
            
            if (!vertraege || vertraege.length === 0) {
                // Alles auf 0 setzen
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = '0â‚¬';
                });
                const countEl = document.getElementById('vertraege-stat-abgelehnt-count');
                if (countEl) countEl.textContent = '0 VertrÃ¤ge';
                return;
            }
            
            let ausgezahlt = 0;
            let ausstehend = 0;
            let abgelehnt = 0;
            let abgelehntCount = 0;
            
            const heute = new Date();
            const monatStart = new Date(heute.getFullYear(), heute.getMonth(), 1);
            
            // Diese Werte basieren auf den GEFILTERTEN VertrÃ¤gen
            // âœ… FIX: ALLE VertrÃ¤ge mÃ¼ssen in eine Kategorie fallen!
            vertraege.forEach(v => {
                const prov = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                const status = (v.vertrag_status || v.status || '').toLowerCase();
                const zahlung = (v.zahlungsstatus || v.provision_status || '').toLowerCase();
                
                // 1. Abgelehnt/Storniert (diese zÃ¤hlen NICHT zur Provision)
                if (status.includes('abge') || status.includes('stor')) {
                    abgelehnt += prov;
                    abgelehntCount++;
                }
                // 2. Ausgezahlt
                else if (zahlung.includes('ausgezahlt') || zahlung.includes('bezahlt') || zahlung.includes('abgeschlossen')) {
                    ausgezahlt += prov;
                }
                // 3. Alles andere = Ausstehend (wartend auf Auszahlung)
                else {
                    ausstehend += prov;
                }
            });
            
            console.log('ğŸ“Š Berechnung: Gesamt sollte sein:', ausgezahlt + ausstehend, '(Ausgezahlt:', ausgezahlt, '+ Ausstehend:', ausstehend, ') | Abgelehnt separat:', abgelehnt);
            
            // ğŸ“ˆ HOCHRECHNUNG: IMMER basierend auf ALLEN VertrÃ¤gen des aktuellen Monats!
            // Nicht auf gefilterte Daten, sondern auf alleKundenVertraegeData
            let monatProvision = 0;
            const alleVertraege = window.alleKundenVertraegeData || vertraege;
            alleVertraege.forEach(v => {
                const datum = new Date(v.erstellt_am || v.created_at);
                if (datum >= monatStart) {
                    monatProvision += parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                }
            });
            
            const tageImMonat = new Date(heute.getFullYear(), heute.getMonth() + 1, 0).getDate();
            const vergangeTage = heute.getDate();
            const hochrechnung = vergangeTage > 0 ? (monatProvision / vergangeTage) * tageImMonat : 0;
            
            // UI aktualisieren
            const setVal = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.textContent = val.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + 'â‚¬';
            };
            
            setVal('vertraege-stat-ausgezahlt', ausgezahlt);
            setVal('vertraege-stat-ausstehend', ausstehend);
            setVal('vertraege-stat-hochrechnung', hochrechnung);
            setVal('vertraege-stat-abgelehnt', abgelehnt);
            
            const countEl = document.getElementById('vertraege-stat-abgelehnt-count');
            if (countEl) countEl.textContent = abgelehntCount + ' VertrÃ¤ge';
            
            console.log('ğŸ“Š Statistik-Karten aktualisiert:', { ausgezahlt, ausstehend, hochrechnung, abgelehnt, monatProvision });
        }
        
        function toggleKundeDetails(kundeId) {
            const details = document.getElementById(kundeId);
            const icon = document.getElementById(kundeId + '-icon');
            if (details) {
                if (details.style.display === 'none') {
                    details.style.display = 'block';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                } else {
                    details.style.display = 'none';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                }
            }
        }
        
        // ğŸ‘¤ TOGGLE KUNDEN-DETAILS BOX (mit Details-Button)
        function toggleKundenDetails(detailsId) {
            const details = document.getElementById(detailsId);
            const icon = document.getElementById(detailsId + '-icon');
            if (details) {
                if (details.style.display === 'none' || details.style.display === '') {
                    details.style.display = 'grid';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                } else {
                    details.style.display = 'none';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                }
            }
        }
        
        function toggleAlleVertraegeTabelle() {
            const container = document.getElementById('alle-vertraege-tabelle-container');
            const icon = document.getElementById('alle-vertraege-toggle-icon');
            if (container) {
                if (container.style.display === 'none') {
                    container.style.display = 'block';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                } else {
                    container.style.display = 'none';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                }
            }
        }
        
        function updateAlteVertraegeTabelle() {
            const tbody = document.getElementById('tbody-vertraege');
            if (!tbody || gefilterteKundenVertraege.length === 0) return;
            
            tbody.innerHTML = gefilterteKundenVertraege.map(v => {
                const status = v.vertrag_status || v.status || 'neu';
                const statusLower = status.toLowerCase();
                const statusColor = statusLower.includes('aktiv') ? 'success' : statusLower.includes('abge') ? 'danger' : 'warning';
                const statusDisplay = statusLower.includes('aktiv') ? 'Aktiviert' : statusLower.includes('abge') ? 'Abgelehnt' : statusLower.includes('prÃ¼f') ? 'In PrÃ¼fung' : 'Neu';
                const provision = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                const datum = v.erstellt_am || v.created_at;
                const kundeName = v.kunde_name || ((v.kunde_vorname || '') + ' ' + (v.kunde_nachname || '')).trim() || 'N/A';
                
                return `
                <tr>
                    <td>${datum ? new Date(datum).toLocaleDateString('de-DE') : '-'}</td>
                    <td><strong>${v.vertragsnummer || '-'}</strong></td>
                    <td>${kundeName}</td>
                    <td>${v.kunde_email || v.kunde_telefon || '-'}</td>
                    <td><span class="badge badge-info">${v.kategorie || '-'}</span></td>
                    <td>${v.tarif || v.tarif_name || '-'}</td>
                    <td><strong style="color: var(--success);">${provision.toFixed(2)}â‚¬</strong></td>
                    <td><span class="badge badge-${statusColor}">${statusDisplay}</span></td>
                    <td><button class="action-btn btn-primary" onclick="showVertragDetails('${v.id}')"><i class="fas fa-eye"></i></button></td>
                </tr>
                `;
            }).join('');
        }
        
        function filterKundenVertraege() {
            const zeitraum = document.getElementById('vertraege-filter-zeitraum')?.value;
            const vonDatum = document.getElementById('vertraege-filter-von')?.value;
            const bisDatum = document.getElementById('vertraege-filter-bis')?.value;
            const kategorie = document.getElementById('vertraege-filter-kategorie')?.value;
            const status = document.getElementById('vertraege-filter-status')?.value;
            const zahlungsstatus = document.getElementById('vertraege-filter-zahlung')?.value;
            const suche = (document.getElementById('vertraege-filter-suche')?.value || '').toLowerCase();
            
            gefilterteKundenVertraege = alleKundenVertraegeData.filter(v => {
                // Zeitraum-Filter
                if (zeitraum || vonDatum || bisDatum) {
                    const datum = new Date(v.erstellt_am || v.created_at);
                    const heute = new Date();
                    heute.setHours(23, 59, 59, 999);
                    
                    if (zeitraum === 'heute') {
                        const startHeute = new Date();
                        startHeute.setHours(0, 0, 0, 0);
                        if (datum < startHeute || datum > heute) return false;
                    } else if (zeitraum === 'woche') {
                        const startWoche = new Date();
                        startWoche.setDate(startWoche.getDate() - startWoche.getDay() + 1);
                        startWoche.setHours(0, 0, 0, 0);
                        if (datum < startWoche || datum > heute) return false;
                    } else if (zeitraum === 'monat') {
                        const startMonat = new Date(heute.getFullYear(), heute.getMonth(), 1);
                        if (datum < startMonat || datum > heute) return false;
                    } else if (zeitraum === 'quartal') {
                        const q = Math.floor(heute.getMonth() / 3);
                        const startQuartal = new Date(heute.getFullYear(), q * 3, 1);
                        if (datum < startQuartal || datum > heute) return false;
                    } else if (zeitraum === 'jahr') {
                        const startJahr = new Date(heute.getFullYear(), 0, 1);
                        if (datum < startJahr || datum > heute) return false;
                    }
                    
                    if (vonDatum && datum < new Date(vonDatum)) return false;
                    if (bisDatum) {
                        const bisEnd = new Date(bisDatum);
                        bisEnd.setHours(23, 59, 59, 999);
                        if (datum > bisEnd) return false;
                    }
                }
                
                // Kategorie-Filter
                if (kategorie && (v.kategorie || '').toLowerCase() !== kategorie.toLowerCase()) return false;
                
                // Status-Filter
                if (status) {
                    const vStatus = (v.vertrag_status || v.status || '').toLowerCase();
                    if (!vStatus.includes(status.toLowerCase())) return false;
                }
                
                // Zahlungsstatus-Filter
                if (zahlungsstatus) {
                    const vZahlung = (v.zahlungsstatus || '').toLowerCase();
                    const vStatus = (v.vertrag_status || v.status || '').toLowerCase();
                    
                    // Wenn kein expliziter Zahlungsstatus, aus Vertragsstatus ableiten
                    let effektiverZahlungsstatus = vZahlung;
                    if (!effektiverZahlungsstatus) {
                        if (vStatus.includes('aktiv')) {
                            effektiverZahlungsstatus = 'ausstehend';
                        } else if (vStatus.includes('abge') || vStatus.includes('storn')) {
                            effektiverZahlungsstatus = 'storniert';
                        } else {
                            effektiverZahlungsstatus = 'wartend';
                        }
                    }
                    
                    if (!effektiverZahlungsstatus.includes(zahlungsstatus.toLowerCase())) return false;
                }
                
                // Suche
                if (suche) {
                    const suchText = [
                        v.kunde_name, v.kunde_vorname, v.kunde_nachname, 
                        v.kunde_email, v.vertragsnummer
                    ].join(' ').toLowerCase();
                    if (!suchText.includes(suche)) return false;
                }
                
                return true;
            });
            
            renderKundenVertraege();
        }
        
        function sortKundenVertraege() {
            renderKundenVertraege();
        }
        
        // ========================================
        
        // Vertrags-Details Modal anzeigen
        async function showVertragDetails(vertragId) {
            let vertrag = alleMeineVertraege.find(v => v.id === vertragId);
            if (!vertrag) {
                alert('Vertrag nicht gefunden');
                return;
            }
            
            // ğŸ” TARIF-DATEN LADEN (falls tarif_name vorhanden)
            if (vertrag.tarif_name || vertrag.tarif || vertrag.produkt) {
                try {
                    const tarifName = vertrag.tarif_name || vertrag.tarif || vertrag.produkt;
                    console.log('ğŸ” Lade Tarif-Details fÃ¼r:', tarifName);
                    const tarifRes = await fetch(`tables/tarife?search=${encodeURIComponent(tarifName)}&limit=1`);
                    if (tarifRes.ok) {
                        const tarifData = await tarifRes.json();
                        if (tarifData.data && tarifData.data.length > 0) {
                            const tarifDetails = tarifData.data[0];
                            console.log('âœ… Tarif-Details gefunden:', tarifDetails);
                            
                            // Ãœberschreibe Vertragsdaten mit korrekten Tarifdaten
                            vertrag.anbieter = tarifDetails.anbieter || vertrag.anbieter;
                            vertrag.tarif_preis = parseFloat(tarifDetails.preis_monatlich || vertrag.tarif_preis || 0);
                            vertrag.tarif_preis_ab_monat_10 = parseFloat(tarifDetails.preis_ab_monat || 0);
                        } else {
                            console.warn('âš ï¸ Tarif nicht gefunden:', tarifName);
                        }
                    }
                } catch (error) {
                    console.error('âŒ Fehler beim Laden der Tarif-Details:', error);
                }
            }
            
            const provision = parseFloat(vertrag.provision) || parseFloat(vertrag.gesamt_provision) || 0;
            const statusColor = vertrag.status === 'Aktiviert' ? 'var(--success)' : vertrag.status === 'Abgelehnt' ? 'var(--danger)' : 'var(--warning)';
            
            // Parse Cross-Sells if available
            let crossSellsHtml = '';
            if (vertrag.cross_sells) {
                try {
                    const crossSells = typeof vertrag.cross_sells === 'string' ? JSON.parse(vertrag.cross_sells) : vertrag.cross_sells;
                    if (crossSells && crossSells.length > 0) {
                        crossSellsHtml = `
                            <div style="margin-top: 1.5rem; background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #9f7aea;">
                                <h3 style="margin: 0 0 1rem 0; color: #9f7aea; font-size: 1.1rem;"><i class="fas fa-cart-plus"></i> Cross-Sells</h3>
                                <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">
                                    ${crossSells.map(cs => `<div>â€¢ ${cs.name || 'N/A'} - ${parseFloat(cs.price || 0).toFixed(2)}â‚¬ (Provision: ${parseFloat(cs.provision || 0).toFixed(2)}â‚¬)</div>`).join('')}
                                </div>
                            </div>
                        `;
                    }
                } catch (e) {
                    console.error('Fehler beim Parsen der Cross-Sells:', e);
                }
            }
            
            const modalContent = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 1rem;" onclick="this.remove()">
                    <div style="background: white; border-radius: 15px; max-width: 1100px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 2rem; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border);">
                            <h2 style="margin: 0; color: var(--primary);"><i class="fas fa-file-contract"></i> Vertrags-Details</h2>
                            <button onclick="this.closest('[style*=fixed]').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='var(--bg)'" onmouseout="this.style.background='none'">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                            <!-- Kundendaten -->
                            <div style="background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid var(--primary);">
                                <h3 style="margin: 0 0 1rem 0; color: var(--primary); font-size: 1.1rem;"><i class="fas fa-user"></i> Kundendaten</h3>
                                <div style="display: grid; gap: 0.75rem; font-size: 0.95rem;">
                                    <div><strong style="color: var(--text-light);">Anrede:</strong> ${vertrag.kunde_anrede || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Name:</strong> ${vertrag.kunde_vorname || 'N/A'} ${vertrag.kunde_nachname || ''}</div>
                                    <div><strong style="color: var(--text-light);">E-Mail:</strong> ${vertrag.kunde_email || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Telefon:</strong> ${vertrag.kunde_telefon || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Adresse:</strong> ${vertrag.kunde_strasse || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">PLZ/Ort:</strong> ${vertrag.kunde_plz || 'N/A'} ${vertrag.kunde_ort || vertrag.kunde_stadt || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Geburtsdatum:</strong> ${vertrag.kunde_geburtsdatum || 'N/A'}</div>
                                </div>
                            </div>
                            
                            <!-- Vertragsdaten -->
                            <div style="background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid var(--success);">
                                <h3 style="margin: 0 0 1rem 0; color: var(--success); font-size: 1.1rem;"><i class="fas fa-file-alt"></i> Vertragsdaten</h3>
                                <div style="display: grid; gap: 0.75rem; font-size: 0.95rem;">
                                    <div><strong style="color: var(--text-light);">Vertragsnr.:</strong> ${vertrag.vertragsnummer || '#' + (vertrag.id ? vertrag.id.substring(0, 8) : 'N/A')}</div>
                                    <div><strong style="color: var(--text-light);">Datum:</strong> ${new Date(vertrag.created_at || vertrag.erstellt_am).toLocaleDateString('de-DE')}</div>
                                    <div><strong style="color: var(--text-light);">Kategorie:</strong> ${vertrag.kategorie || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Anbieter:</strong> ${vertrag.anbieter || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Tarif:</strong> ${vertrag.tarif_name || vertrag.produkt || vertrag.tarif || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Tarif-Preis:</strong> ${parseFloat(vertrag.tarif_preis || 0).toFixed(2)}â‚¬/Monat${vertrag.tarif_preis_ab_monat_10 && vertrag.tarif_preis_ab_monat_10 > 0 ? ` <span style="color: #f59e0b; font-size: 0.85rem;">(ab 10. Monat: ${vertrag.tarif_preis_ab_monat_10.toFixed(2)}â‚¬/Monat)</span>` : ''}</div>
                                    <div><strong style="color: var(--text-light);">Provision:</strong> <strong style="color: var(--success); font-size: 1.2rem;">${provision.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2})}â‚¬</strong></div>
                                    <div><strong style="color: var(--text-light);">Status:</strong> <span style="padding: 0.4rem 0.8rem; background: ${statusColor}; color: white; border-radius: 5px; font-weight: 600; font-size: 0.85rem;">${vertrag.status || vertrag.provision_status || 'Neu'}</span></div>
                                </div>
                            </div>
                            
                            <!-- Bankdaten & ID -->
                            <div style="background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #ed8936;">
                                <h3 style="margin: 0 0 1rem 0; color: #ed8936; font-size: 1.1rem;"><i class="fas fa-credit-card"></i> Bankdaten & Ausweis</h3>
                                <div style="display: grid; gap: 0.75rem; font-size: 0.95rem;">
                                    <div><strong style="color: var(--text-light);">IBAN:</strong> ${vertrag.iban || vertrag.kunde_iban || 'N/A'}</div>
                                    <div><strong style="color: var(--text-light);">Kontoinhaber:</strong> ${vertrag.kontoinhaber || 'N/A'}</div>
                                    ${vertrag.ausweisnummer ? `<div><strong style="color: var(--text-light);">Ausweisnr.:</strong> ${vertrag.ausweisnummer}</div>` : ''}
                                    ${vertrag.ausweis_gueltig_bis ? `<div><strong style="color: var(--text-light);">GÃ¼ltig bis:</strong> ${vertrag.ausweis_gueltig_bis}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        ${vertrag.handy_modell ? `
                        <div style="margin-top: 1.5rem; background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #4299e1;">
                            <h3 style="margin: 0 0 1rem 0; color: #4299e1; font-size: 1.1rem;"><i class="fas fa-mobile-alt"></i> Handy-Daten</h3>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;">
                                <div><strong style="color: var(--text-light);">Modell:</strong> ${vertrag.handy_modell}</div>
                                <div><strong style="color: var(--text-light);">Preis:</strong> ${parseFloat(vertrag.handy_preis || 0).toFixed(2)}â‚¬</div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${vertrag.portierung ? `
                        <div style="margin-top: 1.5rem; background: var(--bg); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #38a169;">
                            <h3 style="margin: 0 0 1rem 0; color: #38a169; font-size: 1.1rem;"><i class="fas fa-exchange-alt"></i> Rufnummernmitnahme</h3>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;">
                                <div><strong style="color: var(--text-light);">Alte Rufnummer:</strong> ${vertrag.alte_rufnummer || 'N/A'}</div>
                                <div><strong style="color: var(--text-light);">Alter Anbieter:</strong> ${vertrag.alter_anbieter || 'N/A'}</div>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${crossSellsHtml}
                        
                        ${vertrag.kunde_unterschrift ? `
                        <div style="margin-top: 1.5rem; background: var(--bg); padding: 1.5rem; border-radius: 10px;">
                            <h3 style="margin: 0 0 1rem 0; color: var(--primary); font-size: 1.1rem;"><i class="fas fa-signature"></i> Unterschrift</h3>
                            <img src="${vertrag.kunde_unterschrift}" style="max-width: 400px; width: 100%; border: 2px solid var(--border); border-radius: 10px; padding: 1rem; background: white;">
                        </div>
                        ` : ''}
                        
                        ${vertrag.notizen ? `
                        <div style="margin-top: 1.5rem; background: var(--bg); padding: 1.5rem; border-radius: 10px;">
                            <h3 style="margin: 0 0 1rem 0; color: var(--info); font-size: 1.1rem;"><i class="fas fa-sticky-note"></i> Notizen</h3>
                            <div style="white-space: pre-wrap; font-size: 0.95rem;">${vertrag.notizen}</div>
                        </div>
                        ` : ''}
                        
                        <div style="margin-top: 2rem; display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                            <div>
                                ${vertrag.status !== 'Abgelehnt' && vertrag.status !== 'Storniert' ? `
                                <button onclick="this.closest('[style*=fixed]').remove(); openStornierungModal('${vertrag.id}', '${vertrag.created_at || vertrag.erstellt_am}')" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #fc8181, #f56565); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; box-shadow: 0 4px 12px rgba(252, 129, 129, 0.3);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                    <i class="fas fa-times-circle"></i> Vertrag stornieren
                                </button>
                                ` : ''}
                            </div>
                            <button onclick="this.closest('[style*=fixed]').remove()" style="padding: 0.75rem 1.5rem; background: var(--border); color: var(--text); border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#cbd5e0'" onmouseout="this.style.background='var(--border)'">
                                <i class="fas fa-times"></i> SchlieÃŸen
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        // Load Bonus & Ziele Page (ehemals Provisionen)
        // âœ… 17.12.2025: Statistik-Karten wurden nach "Meine VertrÃ¤ge" verschoben
        // Diese Seite zeigt jetzt nur noch das Bonus-Widget
        async function loadProvisionenPage(dateFrom = null, dateTo = null) {
            console.log('ğŸ¯ Bonus & Ziele Seite wird geladen...');
            
            const partnerEmail = localStorage.getItem('partnerEmail');
            const emailLower = (partnerEmail || '').toLowerCase();
            
            // ğŸ§ª Demo-Modus: Trotzdem Bonus mit gecachten VertrÃ¤gen berechnen
            if (window.IS_DEMO_MODE || !partnerEmail) {
                console.log('ğŸ§ª DEMO-MODUS fÃ¼r Bonus & Ziele Seite');
                // Trotzdem VertrÃ¤ge nutzen wenn vorhanden
                if (window.allePartnerVertraege && window.allePartnerVertraege.length > 0) {
                    console.log('âœ… Demo-Modus: Nutze globale VertrÃ¤ge fÃ¼r Bonus:', window.allePartnerVertraege.length);
                    aktualisiereBonusFortschritt(window.allePartnerVertraege);
                }
                return;
            }
            
            // âœ… ZUERST: Globale Variable prÃ¼fen (bereits vom Dashboard geladen)
            if (window.allePartnerVertraege && window.allePartnerVertraege.length > 0) {
                console.log('âœ… Nutze globale VertrÃ¤ge fÃ¼r Bonus:', window.allePartnerVertraege.length);
                aktualisiereBonusFortschritt(window.allePartnerVertraege);
                return;
            }
            
            // Im produktiven Modus: Bonus-Widget mit echten Daten laden
            try {
                console.log('ğŸ¯ Lade Bonus-Daten fÃ¼r:', partnerEmail);
                
                // ğŸ’¾ ZUERST Cache prÃ¼fen (schneller!)
                let meineVertraege = [];
                try {
                    const cached = localStorage.getItem('cachedVertraege_' + emailLower);
                    if (cached) {
                        meineVertraege = JSON.parse(cached);
                        console.log('âœ… Bonus aus Cache:', meineVertraege.length);
                    }
                } catch(e) { console.log('Cache-Fehler:', e); }
                
                // Falls Cache leer, aus DB laden
                if (meineVertraege.length === 0) {
                    const res = await fetch('tables/vertragsabschluesse?limit=1000');
                    const data = await res.json();
                    let alleVertraege = data.data || [];
                    
                    // Filtern fÃ¼r Partner
                    meineVertraege = alleVertraege.filter(v => 
                        v.partner_email && v.partner_email.toLowerCase() === emailLower
                    );
                    console.log('ğŸ“Š Bonus aus DB:', meineVertraege.length);
                    
                    // Cache aktualisieren
                    if (meineVertraege.length > 0) {
                        localStorage.setItem('cachedVertraege_' + emailLower, JSON.stringify(meineVertraege));
                    }
                }
                
                // Global speichern fÃ¼r andere Seiten
                window.allePartnerVertraege = meineVertraege;
                
                console.log('ğŸ¯ Bonus berechnen mit', meineVertraege.length, 'VertrÃ¤gen');
                aktualisiereBonusFortschritt(meineVertraege);
                
            } catch (error) {
                console.error('Fehler beim Laden der Bonus-Seite:', error);
                
                // âŒ Bei Fehler: Letzte Chance - Cache nochmal prÃ¼fen
                try {
                    const cached = localStorage.getItem('cachedVertraege_' + emailLower);
                    if (cached) {
                        const cachedData = JSON.parse(cached);
                        console.log('âš ï¸ Fehler-Fallback aus Cache:', cachedData.length);
                        aktualisiereBonusFortschritt(cachedData);
                    }
                } catch(e) {}
            }
        }

        // ===== BONUS-WIDGET LOADER (separiert fÃ¼r Provisionen-Seite) =====
        async function loadBonusWidget(partner, containerId = 'bonus-widget') {
            const projektModels = {
                'ladenlokal': {
                    title: 'Ladenlokal',
                    icon: 'ğŸª',
                    ziel_vertraege: 100,
                    ziel_provision: 15000,
                    weeks: 12,
                    bonus_stufen: [
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 10, provision: 0 }
                            ],
                            total_bonus: 300,
                            label: 'Staffel 1: 10 VertrÃ¤ge/Monat â†’ 300â‚¬ Bonus'
                        },
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 30, provision: 0 },
                                { name: 'Internet', count: 10, provision: 0 },
                                { name: 'Strom', count: 5, provision: 0 }
                            ],
                            total_bonus: 750,
                            label: 'Staffel 2: 30 VertrÃ¤ge (10 Internet + 5 Strom) â†’ 750â‚¬ Schub'
                        },
                        { 
                            products: [
                                { name: 'Individuell', count: 0, provision: 0 }
                            ],
                            total_bonus: 0,
                            label: 'Staffel 3: Individuelles Ziel â†’ Kontaktiere uns!'
                        }
                    ]
                },
                'onlineshop': {
                    title: 'Online-Shop',
                    icon: 'ğŸ›’',
                    ziel_vertraege: 200,
                    ziel_provision: 25000,
                    weeks: 16,
                    bonus_stufen: [
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 10, provision: 0 }
                            ],
                            total_bonus: 300,
                            label: 'Staffel 1: 10 VertrÃ¤ge/Monat â†’ 300â‚¬ Bonus'
                        },
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 30, provision: 0 },
                                { name: 'Internet', count: 10, provision: 0 },
                                { name: 'Strom', count: 5, provision: 0 }
                            ],
                            total_bonus: 750,
                            label: 'Staffel 2: 30 VertrÃ¤ge (10 Internet + 5 Strom) â†’ 750â‚¬ Schub'
                        },
                        { 
                            products: [
                                { name: 'Individuell', count: 0, provision: 0 }
                            ],
                            total_bonus: 0,
                            label: 'Staffel 3: Individuelles Ziel â†’ Kontaktiere uns!'
                        }
                    ]
                },
                'promotion': {
                    title: 'Promotionstand',
                    icon: 'ğŸª',
                    ziel_vertraege: 150,
                    ziel_provision: 20000,
                    weeks: 12,
                    bonus_stufen: [
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 10, provision: 0 }
                            ],
                            total_bonus: 300,
                            label: 'Staffel 1: 10 VertrÃ¤ge/Monat â†’ 300â‚¬ Bonus'
                        },
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 30, provision: 0 },
                                { name: 'Internet', count: 10, provision: 0 },
                                { name: 'Strom', count: 5, provision: 0 }
                            ],
                            total_bonus: 750,
                            label: 'Staffel 2: 30 VertrÃ¤ge (10 Internet + 5 Strom) â†’ 750â‚¬ Schub'
                        },
                        { 
                            products: [
                                { name: 'Individuell', count: 0, provision: 0 }
                            ],
                            total_bonus: 0,
                            label: 'Staffel 3: Individuelles Ziel â†’ Kontaktiere uns!'
                        }
                    ]
                },
                'affiliate': {
                    title: 'Affiliate Marketing',
                    icon: 'ğŸ’»',
                    ziel_vertraege: 300,
                    ziel_provision: 35000,
                    weeks: 24,
                    bonus_stufen: [
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 10, provision: 0 }
                            ],
                            total_bonus: 300,
                            label: 'Staffel 1: 10 VertrÃ¤ge/Monat â†’ 300â‚¬ Bonus'
                        },
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 30, provision: 0 },
                                { name: 'Internet', count: 10, provision: 0 },
                                { name: 'Strom', count: 5, provision: 0 }
                            ],
                            total_bonus: 750,
                            label: 'Staffel 2: 30 VertrÃ¤ge (10 Internet + 5 Strom) â†’ 750â‚¬ Schub'
                        },
                        { 
                            products: [
                                { name: 'Individuell', count: 0, provision: 0 }
                            ],
                            total_bonus: 0,
                            label: 'Staffel 3: Individuelles Ziel â†’ Kontaktiere uns!'
                        }
                    ]
                },
                'shop_in_shop': {
                    title: 'Shop-in-Shop',
                    icon: 'ğŸ¬',
                    ziel_vertraege: 120,
                    ziel_provision: 18000,
                    weeks: 14,
                    bonus_stufen: [
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 10, provision: 0 }
                            ],
                            total_bonus: 300,
                            label: 'Staffel 1: 10 VertrÃ¤ge/Monat â†’ 300â‚¬ Bonus'
                        },
                        { 
                            products: [
                                { name: 'Mobilfunk', count: 30, provision: 0 },
                                { name: 'Internet', count: 10, provision: 0 },
                                { name: 'Strom', count: 5, provision: 0 }
                            ],
                            total_bonus: 750,
                            label: 'Staffel 2: 30 VertrÃ¤ge (10 Internet + 5 Strom) â†’ 750â‚¬ Schub'
                        },
                        { 
                            products: [
                                { name: 'Individuell', count: 0, provision: 0 }
                            ],
                            total_bonus: 0,
                            label: 'Staffel 3: Individuelles Ziel â†’ Kontaktiere uns!'
                        }
                    ]
                }
            };
            
            const model = (partner.modell || 'ladenlokal').toLowerCase();
            const projekt = projektModels[model];
            
            // Load actual contracts
            const partnerEmail = localStorage.getItem('partnerEmail');
            let aktuelleVertraege = 0;
            let productCounts = {};  // ZÃ¤hlt VertrÃ¤ge pro Produkt
            
            try {
                const res = await fetch('tables/vertragsabschluesse?limit=1000');
                const data = await res.json();
                const meineVertraege = data.data.filter(v => v.partner_email && v.partner_email.toLowerCase() === partnerEmail.toLowerCase());
                aktuelleVertraege = meineVertraege.length;
                
                // ZÃ¤hle VertrÃ¤ge pro Produkt-Kategorie
                meineVertraege.forEach(v => {
                    const product = (v.produkt || v.anbieter || v.kategorie || '').toUpperCase();
                    
                    // Mobilfunk (alle VertrÃ¤ge auÃŸer Internet/Strom)
                    if (product.includes('MOBILFUNK') || product.includes('HANDY') || product.includes('FREENET') || product.includes('AYILDIZ') || product.includes('VODAFONE') || product.includes('TELEKOM') || product.includes('O2')) {
                        productCounts['Mobilfunk'] = (productCounts['Mobilfunk'] || 0) + 1;
                    }
                    // Internet
                    else if (product.includes('DSL') || product.includes('INTERNET') || product.includes('KABEL') || product.includes('GLASFASER')) {
                        productCounts['Internet'] = (productCounts['Internet'] || 0) + 1;
                    }
                    // Strom
                    else if (product.includes('STROM') || product.includes('ENERGIE') || product.includes('POWER')) {
                        productCounts['Strom'] = (productCounts['Strom'] || 0) + 1;
                    }
                    // Falls nichts erkannt: als Mobilfunk zÃ¤hlen
                    else {
                        productCounts['Mobilfunk'] = (productCounts['Mobilfunk'] || 0) + 1;
                    }
                });
            } catch (error) {
                console.error('Fehler beim Laden der VertrÃ¤ge fÃ¼r Bonus-Widget:', error);
            }
            
            // Show widget
            const bonusWidget = document.getElementById('bonus-widget');
            bonusWidget.style.display = 'block';
            
            let nextBonus = null;
            const bonusStufenHtml = projekt.bonus_stufen.map((stufe, index) => {
                // STAFFEL 3 = Individuell (kein echtes Ziel, nur Call-to-Action)
                const istIndividuell = stufe.products.some(p => p.name === 'Individuell');
                
                if (istIndividuell) {
                    // Staffel 3: Keine Berechnung, nur anzeigen
                    return `
                        <div style="background: linear-gradient(135deg, #fff9e6 0%, #ffe7b3 100%); border: 1.5px solid #ffd700; border-radius: 14px; padding: 1.5rem 1.75rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 16px rgba(255, 215, 0, 0.2);" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 24px rgba(255, 215, 0, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(255, 215, 0, 0.2)'">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 1.25rem;">
                                    <div style="width: 52px; height: 52px; background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%); border-radius: 13px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 4px 14px rgba(255, 215, 0, 0.4);">
                                        ğŸ’
                                    </div>
                                    <div>
                                        <div style="font-size: 1.2rem; font-weight: 700; color: #8b6914; margin-bottom: 0.5rem; letter-spacing: -0.3px;">${stufe.label}</div>
                                        <div style="font-size: 0.95rem; color: #996515; font-weight: 500;">PersÃ¶nliches Ziel und Bonus auf Anfrage</div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <button onclick="window.location.href='mailto:support@deincheck.de?subject=Individuelles%20Bonus-Ziel%20anfragen'" style="background: linear-gradient(135deg, #ffd700, #ffa500); color: #8b6914; font-weight: 700; padding: 0.75rem 1.5rem; border: none; border-radius: 10px; cursor: pointer; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3); font-size: 0.95rem; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        Kontakt aufnehmen
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // PrÃ¼fe, ob alle Produkte dieser Stufe erreicht sind
                let allProductsReached = true;
                let totalProgress = 0;
                const productDetails = stufe.products.map(p => {
                    const current = productCounts[p.name] || 0;
                    const reached = current >= p.count;
                    if (!reached) allProductsReached = false;
                    totalProgress += current / p.count;
                    return {
                        ...p,
                        current,
                        reached
                    };
                });
                
                const overallProgress = Math.min(Math.round((totalProgress / stufe.products.length) * 100), 99);
                const erreicht = allProductsReached;
                if (!erreicht && !nextBonus) nextBonus = stufe;
                
                // Produkt-Details HTML
                const productDetailsHtml = productDetails.map(p => {
                    // FÃ¼r Staffel 1 nur Mobilfunk anzeigen
                    if (index === 0) {
                        return `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                                <span style="font-weight: 500;">VertrÃ¤ge diesen Monat</span>
                                <span style="font-weight: 600; color: ${p.reached ? '#10b981' : '#ff9500'};">${p.current}/${p.count} ${p.reached ? 'âœ“' : ''}</span>
                            </div>
                        `;
                    }
                    // FÃ¼r Staffel 2 alle Produkte anzeigen
                    return `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <span style="font-weight: 500;">${p.name}</span>
                            <span style="font-weight: 600; color: ${p.reached ? '#10b981' : '#ff9500'};">${p.current}/${p.count} ${p.reached ? 'âœ“' : ''}</span>
                        </div>
                    `;
                }).join('');
                
                return `
                    <div style="background: ${erreicht ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : 'white'}; border: ${erreicht ? '1.5px solid #6ee7b7' : '1.5px solid rgba(0,0,0,0.08)'}; border-radius: 14px; padding: 1.5rem 1.75rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: ${erreicht ? '0 4px 16px rgba(52, 211, 153, 0.2)' : '0 2px 8px rgba(0,0,0,0.04)'};" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='${erreicht ? '0 8px 24px rgba(52, 211, 153, 0.25)' : '0 6px 16px rgba(0,0,0,0.1)'}'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='${erreicht ? '0 4px 16px rgba(52, 211, 153, 0.2)' : '0 2px 8px rgba(0,0,0,0.04)'}'">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1.25rem;">
                                <div style="width: 52px; height: 52px; background: ${erreicht ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ff9500 0%, #ff5e3a 100%)'}; border-radius: 13px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.35rem; box-shadow: ${erreicht ? '0 4px 14px rgba(16, 185, 129, 0.35)' : '0 4px 14px rgba(255, 94, 58, 0.35)'}; flex-shrink: 0;">
                                    ${erreicht ? '<i class="fas fa-check" style="font-weight: 700;"></i>' : '<i class="fas fa-trophy"></i>'}
                                </div>
                                <div>
                                    <div style="font-size: 1.2rem; font-weight: 700; color: ${erreicht ? '#065f46' : '#1d1d1f'}; margin-bottom: 0.5rem; letter-spacing: -0.3px;">${stufe.label}</div>
                                    <div style="font-size: 0.95rem; color: ${erreicht ? '#059669' : '#6e6e73'}; font-weight: 500;">Bonus: <strong style="color: ${erreicht ? '#047857' : '#ff9500'}; font-weight: 700; font-size: 1.1rem;">${stufe.total_bonus.toLocaleString('de-DE')}â‚¬</strong></div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                ${erreicht 
                                    ? '<div style="font-size: 2rem; color: #10b981; line-height: 1;">âœ“</div><div style="font-size: 0.75rem; color: #059669; font-weight: 600; margin-top: 0.375rem; text-transform: uppercase; letter-spacing: 0.5px;">Erreicht</div>' 
                                    : `<div style="font-size: 1.5rem; font-weight: 700; color: #ff9500; line-height: 1;">${overallProgress}%</div><div style="font-size: 0.75rem; color: #86868b; font-weight: 600; margin-top: 0.375rem; text-transform: uppercase; letter-spacing: 0.5px;">Fortschritt</div>`
                                }
                            </div>
                        </div>
                        
                        <!-- Produkt-Details -->
                        <div style="background: ${erreicht ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.02)'}; border-radius: 8px; padding: 1rem; font-size: 0.9rem;">
                            ${productDetailsHtml}
                        </div>
                        
                        ${!erreicht ? `
                        <div style="margin-top: 1rem; background: #f5f5f7; border-radius: 8px; height: 8px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #ff9500, #ff5e3a); height: 100%; width: ${overallProgress}%; transition: width 0.5s ease; border-radius: 8px;"></div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // âœ… Container-ID nutzen (fÃ¼r Dashboard oder Provisionen-Page)
            const container = document.getElementById(containerId);
            if (container) {
                container.style.display = 'block';
                // Widget-HTML erstellen
                container.innerHTML = `
                    <div class="data-card" style="background: linear-gradient(135deg, #fafafa 0%, #ffffff 100%); border: 1px solid rgba(0,0,0,0.08); border-radius: 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 0 1px rgba(0,0,0,0.04); overflow: hidden;">
                        <div style="height: 4px; background: linear-gradient(90deg, #ff9500 0%, #ff6b35 50%, #ff3366 100%);"></div>
                        <div style="padding: 2rem 2.5rem;">
                            <div style="display: flex; align-items: center; gap: 1.25rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(0,0,0,0.06);">
                                <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #ff9500 0%, #ff5e3a 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 8px 24px rgba(255, 94, 58, 0.35), 0 2px 8px rgba(0,0,0,0.08);">ğŸ†</div>
                                <div style="flex: 1;">
                                    <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700; color: #1d1d1f; letter-spacing: -0.6px; line-height: 1.2;">Bonus-Ziele</h2>
                                    <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #6e6e73; font-weight: 400; line-height: 1.4;">Erreiche Meilensteine und sichere dir attraktive PrÃ¤mien</p>
                                </div>
                            </div>
                            <div id="bonus-stufen-container" style="display: grid; gap: 1.25rem; margin-bottom: 2rem;">
                                ${bonusStufenHtml}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (nextBonus) {
                document.getElementById('bonus-next').innerHTML = `<strong>${nextBonus.bonus.toLocaleString('de-DE')}â‚¬</strong> bei ${nextBonus.label}`;
            } else {
                document.getElementById('bonus-next').innerHTML = '<strong>Alle Ziele erreicht!</strong> ğŸ‰';
            }
        }
        
        // ENTFERNT: Alte openModul Funktion (wird durch neue Akademie ersetzt)
        
        // Filter Provisionen
        // ========================================
        // ğŸ“Š PROVISIONS-ÃœBERSICHT CHART RENDERN
        // ========================================
        let provisionChartInstance = null;
        
        function renderProvisionChart(vertraege) {
            // ğŸ“Š DEAKTIVIERT - Chart wurde auf User-Wunsch entfernt (17.12.2025)
            console.log('ğŸ“Š renderProvisionChart() DEAKTIVIERT - Chart wurde entfernt');
            return;
            
            // Destroy existing chart
            if (provisionChartInstance) {
                provisionChartInstance.destroy();
                provisionChartInstance = null;
            }
            
            const canvas = document.getElementById('provisionChart');
            if (!canvas) {
                console.error('âŒ provisionChart Canvas nicht gefunden!');
                return;
            }
            
            // Gruppiere VertrÃ¤ge nach Monat
            const monthlyData = {};
            vertraege.forEach(v => {
                const date = new Date(v.created_at || v.erstellt_am);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const monthLabel = date.toLocaleDateString('de-DE', { year: 'numeric', month: 'short' });
                
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = { label: monthLabel, provision: 0, count: 0 };
                }
                
                monthlyData[monthKey].provision += parseFloat(v.gesamt_provision || v.provision || 0);
                monthlyData[monthKey].count += 1;
            });
            
            // Sortiere nach Datum
            const sortedMonths = Object.keys(monthlyData).sort();
            const labels = sortedMonths.map(k => monthlyData[k].label);
            const provisions = sortedMonths.map(k => monthlyData[k].provision);
            const counts = sortedMonths.map(k => monthlyData[k].count);
            
            console.log('ğŸ“Š Chart-Daten:', { labels, provisions, counts });
            
            // Erstelle Chart
            const ctx = canvas.getContext('2d');
            provisionChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Provision (â‚¬)',
                            data: provisions,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Anzahl VertrÃ¤ge',
                            data: counts,
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.datasetIndex === 0) {
                                            label += context.parsed.y.toFixed(2) + 'â‚¬';
                                        } else {
                                            label += context.parsed.y + ' VertrÃ¤ge';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Provision (â‚¬)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(0) + 'â‚¬';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Anzahl VertrÃ¤ge'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
            
            console.log('âœ… Provisions-Chart erfolgreich gerendert!');
        }
        
        function filterProvisionen() {
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            loadProvisionenPage(dateFrom, dateTo);
        }
        
        // Reset Provisionen Filter
        function resetProvisionenFilter() {
            document.getElementById('filter-date-from').value = '';
            document.getElementById('filter-date-to').value = '';
            loadProvisionenPage();
        }
        
        // ğŸ“Š CSV EXPORT FUNKTION
        function exportVertraegeCSV() {
            try {
                if (gefilterteKundenVertraege.length === 0) {
                    alert('Keine VertrÃ¤ge zum Exportieren vorhanden.');
                    return;
                }
                
                const partnerName = localStorage.getItem('partnerName') || 'Partner';
                
                // CSV Header
                const headers = [
                    'Datum', 'Vertragsnummer', 'Kunde', 'Email', 'Telefon', 
                    'Adresse', 'Kategorie', 'Produkt', 'Anbieter', 
                    'Provision', 'Status', 'Zahlungsstatus'
                ];
                
                // CSV Daten
                const rows = gefilterteKundenVertraege.map(v => {
                    const datum = v.erstellt_am || v.created_at;
                    const kundeName = v.kunde_name || ((v.kunde_vorname || '') + ' ' + (v.kunde_nachname || '')).trim() || 'N/A';
                    const adresse = [v.kunde_strasse, v.kunde_plz, v.kunde_ort].filter(Boolean).join(', ');
                    const provision = parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0;
                    const status = v.vertrag_status || v.status || 'Neu';
                    const zahlung = v.zahlungsstatus || (status.toLowerCase().includes('aktiv') ? 'Ausstehend' : '-');
                    
                    return [
                        datum ? new Date(datum).toLocaleDateString('de-DE') : '-',
                        v.vertragsnummer || '-',
                        kundeName,
                        v.kunde_email || '-',
                        v.kunde_telefon || v.kunde_mobil || '-',
                        adresse || '-',
                        v.kategorie || '-',
                        v.tarif || v.tarif_name || v.produkt || '-',
                        v.anbieter || '-',
                        provision.toFixed(2) + ' â‚¬',
                        status,
                        zahlung
                    ];
                });
                
                // CSV zusammenbauen
                const csvContent = [
                    headers.join(';'),
                    ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(';'))
                ].join('\n');
                
                // BOM fÃ¼r Excel Umlaute
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Vertraege_${partnerName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                alert(`âœ… ${gefilterteKundenVertraege.length} VertrÃ¤ge als CSV exportiert!`);
            } catch (error) {
                console.error('CSV Export Fehler:', error);
                alert('âŒ Fehler beim CSV Export. Bitte versuche es erneut.');
            }
        }
        
        // ğŸ“„ Export VertrÃ¤ge als APPLE-LIKE PDF!
        async function exportVertraege() {
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                const partnerName = localStorage.getItem('partnerName') || 'Partner';
                
                const res = await fetch('tables/vertragsabschluesse?limit=1000');
                const data = await res.json();
                const meineVertraege = data.data.filter(v => v.partner_email && v.partner_email.toLowerCase() === partnerEmail.toLowerCase());
                
                if (meineVertraege.length === 0) {
                    alert('Keine VertrÃ¤ge zum Exportieren vorhanden.');
                    return;
                }
                
                // ğŸ PDF erstellen - APPLE-LIKE DESIGN!
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4'); // Landscape
                
                // ğŸ¨ MODERN CLEAN HEADER (Apple-Style - kein Gradient!)
                doc.setFillColor(102, 126, 234); // Elegant Lila
                doc.rect(0, 0, 297, 50, 'F');
                
                // ğŸ“ LOGO: "DeinCheck Partnerprogramm"
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont(undefined, 'bold');
                doc.text('DeinCheck', 15, 20);
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text('Partnerprogramm', 15, 28);
                
                // ğŸ“Š TITEL
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('VertragsÃ¼bersicht', 15, 43);
                
                // ğŸ“… INFO-BOX (rechts, Apple-like clean)
                doc.setFillColor(255, 255, 255);
                doc.roundedRect(200, 12, 82, 32, 3, 3, 'F');
                
                doc.setTextColor(45, 55, 72);
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                doc.text('Erstellt am:', 205, 18);
                doc.text('Partner:', 205, 24);
                doc.text('Anzahl VertrÃ¤ge:', 205, 30);
                
                // ğŸ’° SUMME berechnen
                const gesamtProvision = meineVertraege.reduce((sum, v) => {
                    return sum + (parseFloat(v.provision) || parseFloat(v.gesamt_provision) || 0);
                }, 0);
                doc.text('Gesamt-Provision:', 205, 36);
                
                doc.setFont(undefined, 'bold');
                doc.text(new Date().toLocaleDateString('de-DE'), 255, 18);
                doc.text(partnerName, 255, 24);
                doc.text(meineVertraege.length.toString(), 255, 30);
                doc.text(`${gesamtProvision.toFixed(2)}â‚¬`, 255, 36);
                
                // ğŸ“‹ APPLE-LIKE TABELLE (clean, minimalistisch)
                const tableData = meineVertraege.map(v => [
                    new Date(v.created_at).toLocaleDateString('de-DE'),
                    (v.id ? '#' + v.id.substring(0, 8) : 'N/A'),
                    `${v.kunde_vorname || ''} ${v.kunde_nachname || ''}`.trim() || 'N/A',
                    v.kategorie || 'N/A',
                    v.produkt || 'N/A',
                    v.anbieter || 'N/A',
                    (parseFloat(v.provision) || parseFloat(v.gesamt_provision) || 0).toFixed(2) + 'â‚¬',
                    v.status || 'Neu'
                ]);
                
                doc.autoTable({
                    startY: 56,
                    head: [['Datum', 'Nr.', 'Kunde', 'Kategorie', 'Produkt', 'Anbieter', 'Provision', 'Status']],
                    body: tableData,
                    theme: 'plain', // ğŸ APPLE-STYLE: Kein Grid, clean!
                    headStyles: {
                        fillColor: [248, 249, 250], // Hell-grau (Apple-like)
                        textColor: [45, 55, 72],    // Dunkel-grau
                        fontStyle: 'bold',
                        fontSize: 9,
                        cellPadding: 4,
                        lineWidth: 0,
                        lineColor: [226, 232, 240]
                    },
                    bodyStyles: {
                        fontSize: 8,
                        textColor: [45, 55, 72],
                        cellPadding: 4,
                        lineWidth: 0
                    },
                    alternateRowStyles: {
                        fillColor: [252, 253, 254] // Sehr hell (subtil)
                    },
                    columnStyles: {
                        0: { cellWidth: 25 },  // Datum
                        1: { cellWidth: 28 },  // Nr.
                        2: { cellWidth: 45 },  // Kunde
                        3: { cellWidth: 30 },  // Kategorie
                        4: { cellWidth: 45 },  // Produkt
                        5: { cellWidth: 35 },  // Anbieter
                        6: { cellWidth: 25, halign: 'right', fontStyle: 'bold' },  // Provision
                        7: { cellWidth: 25, halign: 'center' }   // Status
                    },
                    margin: { left: 15, right: 15 },
                    // ğŸ DÃ¼nne Linie zwischen Rows (Apple-Style)
                    didDrawPage: function(data) {
                        doc.setDrawColor(226, 232, 240);
                        doc.setLineWidth(0.1);
                    },
                    willDrawCell: function(data) {
                        // ğŸ WICHTIG: Badge VOR dem Text zeichnen!
                        if (data.column.index === 7 && data.section === 'body') {
                            const status = data.cell.raw;
                            let bgColor = [241, 245, 249]; // Default grau
                            
                            if (status === 'Aktiviert') {
                                bgColor = [220, 252, 231]; // Hell-grÃ¼n
                            } else if (status === 'Abgelehnt' || status === 'Storniert') {
                                bgColor = [254, 226, 226]; // Hell-rot
                            } else if (status === 'In Bearbeitung') {
                                bgColor = [254, 243, 199]; // Hell-orange
                            } else if (status === 'Neu') {
                                bgColor = [219, 234, 254]; // Hell-blau
                            }
                            
                            // ğŸ Pill-Shape Badge Background
                            const x = data.cell.x;
                            const y = data.cell.y;
                            const w = data.cell.width;
                            const h = data.cell.height;
                            
                            doc.setFillColor(bgColor[0], bgColor[1], bgColor[2]);
                            doc.roundedRect(x + 3, y + 2, w - 6, h - 4, 2, 2, 'F');
                        }
                    },
                    didDrawCell: function(data) {
                        // ğŸ Text NACH der Badge zeichnen
                        if (data.column.index === 7 && data.section === 'body') {
                            const status = data.cell.raw;
                            let textColor = [71, 85, 105]; // Default grau
                            
                            if (status === 'Aktiviert') {
                                textColor = [22, 101, 52];  // Dunkel-grÃ¼n
                            } else if (status === 'Abgelehnt' || status === 'Storniert') {
                                textColor = [153, 27, 27];  // Dunkel-rot
                            } else if (status === 'In Bearbeitung') {
                                textColor = [161, 98, 7];   // Dunkel-orange
                            } else if (status === 'Neu') {
                                textColor = [30, 64, 175];  // Dunkel-blau
                            }
                            
                            // ğŸ Text zentriert in Badge
                            const x = data.cell.x;
                            const y = data.cell.y;
                            const w = data.cell.width;
                            const h = data.cell.height;
                            
                            doc.setTextColor(textColor[0], textColor[1], textColor[2]);
                            doc.setFontSize(7);
                            doc.setFont(undefined, 'bold');
                            doc.text(status, x + w / 2, y + h / 2 + 1, { align: 'center' });
                        }
                    }
                });
                
                // ğŸ“ APPLE-LIKE FOOTER (minimalistisch)
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    
                    // DÃ¼nne Linie oben (Apple-Style)
                    doc.setDrawColor(226, 232, 240);
                    doc.setLineWidth(0.1);
                    doc.line(15, 198, 282, 198);
                    
                    doc.setFontSize(7);
                    doc.setTextColor(113, 128, 150);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Seite ${i} von ${pageCount}`, 15, 202);
                    doc.text('Â© DeinCheck Partnerprogramm - Vertraulich', 148, 202, { align: 'center' });
                    doc.text(new Date().toLocaleDateString('de-DE'), 282, 202, { align: 'right' });
                }
                
                // ğŸ’¾ DOWNLOAD
                const fileName = `Vertraege_${partnerName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                alert(`âœ… ${meineVertraege.length} VertrÃ¤ge erfolgreich als PDF exportiert!`);
            } catch (error) {
                console.error('Export-Fehler:', error);
                alert('âŒ Fehler beim Exportieren der VertrÃ¤ge. Bitte versuche es erneut.');
            }
        }

        // =========================================
        // ğŸš« STORNIERUNG-FUNKTIONEN
        // =========================================
        
        let currentStornierungVertragId = null;
        let currentStornierungDatum = null;
        
        // Modal Ã¶ffnen
        window.openStornierungModal = function(vertragId, erstelltAm) {
            console.log('ğŸš« Ã–ffne Stornierung-Modal fÃ¼r Vertrag:', vertragId);
            
            currentStornierungVertragId = vertragId;
            currentStornierungDatum = erstelltAm;
            
            // Finde Vertrag
            const vertrag = alleMeineVertraege.find(v => v.id === vertragId);
            if (!vertrag) {
                alert('Vertrag nicht gefunden');
                return;
            }
            
            // Vertrags-Info anzeigen
            const kunde = `${vertrag.kunde_vorname || ''} ${vertrag.kunde_nachname || ''}`.trim() || 'N/A';
            const produkt = vertrag.produkt || vertrag.tarif_name || 'N/A';
            const provision = parseFloat(vertrag.provision || vertrag.gesamt_provision || 0).toFixed(2);
            document.getElementById('stornierung-vertrag-info').innerHTML = `
                <div style="line-height: 1.6;">
                    <div><strong>${kunde}</strong></div>
                    <div style="font-size: 0.9rem; color: var(--text-light);">${produkt} â€¢ ${provision}â‚¬ Provision</div>
                </div>
            `;
            
            // 14-Tage-Check
            const erstelltDatum = new Date(erstelltAm);
            const heute = new Date();
            const diffTage = Math.floor((heute - erstelltDatum) / (1000 * 60 * 60 * 24));
            
            console.log('ğŸ“… Vertragsalter:', diffTage, 'Tage');
            
            const warnungDiv = document.getElementById('stornierung-warnung');
            const tageText = document.getElementById('stornierung-tage-text');
            
            if (diffTage < 14) {
                warnungDiv.style.display = 'block';
                tageText.textContent = `Der Vertrag ist ${diffTage} ${diffTage === 1 ? 'Tag' : 'Tage'} alt (< 14 Tage).`;
                console.warn('âš ï¸ WARNUNG: Vertrag ist weniger als 14 Tage alt!');
            } else {
                warnungDiv.style.display = 'none';
                console.log('âœ… Vertrag ist Ã¤lter als 14 Tage');
            }
            
            // Formular zurÃ¼cksetzen
            document.getElementById('stornierung-grund').value = '';
            document.getElementById('stornierung-beschreibung').value = '';
            document.getElementById('stornierung-char-count').textContent = '0 / 20 Zeichen (min.)';
            
            // Modal anzeigen
            const modal = document.getElementById('stornierung-modal');
            modal.style.display = 'flex';
            
            // Char-Counter aktivieren
            document.getElementById('stornierung-beschreibung').addEventListener('input', function() {
                const length = this.value.length;
                document.getElementById('stornierung-char-count').textContent = `${length} / 20 Zeichen (min.)`;
                document.getElementById('stornierung-char-count').style.color = length >= 20 ? 'var(--success)' : 'var(--text-light)';
            });
        };
        
        // Modal schlieÃŸen
        window.closeStornierungModal = function() {
            document.getElementById('stornierung-modal').style.display = 'none';
            currentStornierungVertragId = null;
            currentStornierungDatum = null;
        };
        
        // Stornierung absenden
        window.submitStornierung = async function() {
            const grund = document.getElementById('stornierung-grund').value;
            const beschreibung = document.getElementById('stornierung-beschreibung').value.trim();
            
            // Validierung
            if (!grund) {
                alert('Bitte wÃ¤hle einen Grund aus!');
                return;
            }
            
            if (beschreibung.length < 20) {
                alert('Bitte gib eine ausfÃ¼hrlichere Beschreibung ein (min. 20 Zeichen)!');
                return;
            }
            
            // BestÃ¤tigung
            if (!confirm('Bist du sicher? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!')) {
                return;
            }
            
            console.log('ğŸš« Stornierung wird eingereicht...');
            console.log('   Vertrag-ID:', currentStornierungVertragId);
            console.log('   Grund:', grund);
            console.log('   Beschreibung:', beschreibung);
            
            // Button deaktivieren
            const submitBtn = document.getElementById('stornierung-submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird gespeichert...';
            
            try {
                // Vertrag updaten
                const updateData = {
                    status: 'Storniert',
                    stornierung_grund: grund,
                    stornierung_beschreibung: beschreibung,
                    storniert_am: new Date().toISOString(),
                    storniert_von: 'Partner'
                };
                
                console.log('ğŸ“¤ Sende Update:', updateData);
                
                const res = await fetch(`tables/vertragsabschluesse/${currentStornierungVertragId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(updateData)
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${await res.text()}`);
                }
                
                const result = await res.json();
                console.log('âœ… Stornierung erfolgreich gespeichert:', result);
                
                // ğŸ”” Admin-Benachrichtigung erstellen
                try {
                    const partnerEmail = localStorage.getItem('partnerEmail');
                    const partnerName = localStorage.getItem('partnerName') || partnerEmail;
                    const vertrag = alleMeineVertraege.find(v => v.id === currentStornierungVertragId);
                    const kunde = vertrag ? `${vertrag.kunde_vorname || ''} ${vertrag.kunde_nachname || ''}`.trim() : 'Unbekannt';
                    const produkt = vertrag ? (vertrag.produkt || vertrag.tarif_name || 'N/A') : 'N/A';
                    
                    // 14-Tage-Check fÃ¼r Benachrichtigung
                    const erstelltDatum = new Date(currentStornierungDatum);
                    const heute = new Date();
                    const diffTage = Math.floor((heute - erstelltDatum) / (1000 * 60 * 60 * 24));
                    const istWiderruf = diffTage < 14;
                    
                    const benachrichtigungData = {
                        typ: 'stornierung',
                        titel: istWiderruf ? 'âš ï¸ WIDERRUF: Partner hat Vertrag storniert' : 'ğŸš« Partner hat Vertrag storniert',
                        nachricht: `Partner <strong>${partnerName}</strong> hat einen Vertrag storniert:<br><br>` +
                                   `<strong>Kunde:</strong> ${kunde}<br>` +
                                   `<strong>Produkt:</strong> ${produkt}<br>` +
                                   `<strong>Grund:</strong> ${grund}<br>` +
                                   `<strong>Beschreibung:</strong> ${beschreibung}<br>` +
                                   `<strong>Vertragsalter:</strong> ${diffTage} Tage ${istWiderruf ? '(< 14 Tage - Widerrufsrecht!)' : ''}`,
                        partner_email: partnerEmail,
                        vertrag_id: currentStornierungVertragId,
                        prioritaet: istWiderruf ? 'hoch' : 'normal',
                        gelesen: false,
                        erstellt_am: new Date().toISOString()
                    };
                    
                    const benachrichtigungRes = await fetch('tables/benachrichtigungen', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(benachrichtigungData)
                    });
                    
                    if (benachrichtigungRes.ok) {
                        console.log('âœ… Admin-Benachrichtigung erstellt');
                    } else {
                        console.warn('âš ï¸ Admin-Benachrichtigung konnte nicht erstellt werden');
                    }
                } catch (notifError) {
                    console.error('âŒ Fehler beim Erstellen der Benachrichtigung:', notifError);
                    // Nicht kritisch - weitermachen
                }
                
                // Erfolgs-Nachricht
                alert('âœ… Vertrag wurde erfolgreich storniert!\n\nDer Admin wurde benachrichtigt.');
                
                // Modal schlieÃŸen
                closeStornierungModal();
                
                // VertrÃ¤ge neu laden
                await loadVertraegePage();
                
                // Dashboard neu laden (fÃ¼r Statistiken)
                await loadDashboardData();
                
            } catch (error) {
                console.error('âŒ Fehler beim Stornieren:', error);
                alert('âŒ Fehler beim Stornieren: ' + error.message);
                
                // Button wieder aktivieren
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> Stornierung bestÃ¤tigen';
            }
        };

        // ===== ğŸ“ AKADEMIE-SYSTEM =====
        // Wird jetzt von akademie-system.js geladen
        
        // ALTE FUNKTION ENTFERNT - Jetzt in akademie-system.js
        /*
        window.openModul = async function(modulId) {
            // ğŸ“ AUTOMATISCHES TRACKING: Modul gestartet
            try {
                await window.saveAkademieProgress(modulId, 'start', {
                    status: 'in_bearbeitung',
                    fortschritt_prozent: 0,
                    gestartet_am: new Date().toISOString()
                });
                console.log('âœ… Akademie-Progress gespeichert:', modulId, 'gestartet');
            } catch (error) {
                console.error('âŒ Fehler beim Speichern des Fortschritts:', error);
            }
            
            // Modul-Daten Definition
            const module = {
                'grundlagen': {
                    title: 'Grundlagen Mobilfunk',
                    icon: 'ğŸ“š',
                    color: '#3b82f6',
                    duration: '90 Min',
                    lessons: 12,
                    description: 'Komplettes Grundlagen-Wissen zum deutschen Mobilfunkmarkt',
                    content: [
                        { type: 'section', title: 'ğŸ“± Netztechnologien verstehen', items: [
                            'â€¢ GSM, UMTS, LTE, 5G - Die Evolution des Mobilfunks',
                            'â€¢ FrequenzbÃ¤nder und Netzabdeckung in Deutschland',
                            'â€¢ Unterschiede zwischen D1, D2 und O2-Netz',
                            'ğŸ’¡ Verkaufsargument: "Im D-Netz hast du 98% Abdeckung, perfekt fÃ¼r dich!"'
                        ]},
                        { type: 'section', title: 'ğŸ’¶ Tarifstrukturen im Detail', items: [
                            'â€¢ Postpaid vs. Prepaid - Wann empfiehlst du was?',
                            'â€¢ Allnet-Flats, Datenvolumen, EU-Roaming erklÃ¤rt',
                            'â€¢ Tarifoptionen: SMS-Flat, Roaming, Hotspot',
                            'ğŸ’¡ Verkaufsargument: "Mit 50 GB surfst du den ganzen Monat sorgenfrei!"'
                        ]},
                        { type: 'section', title: 'ğŸ“‹ Vertragsarten meistern', items: [
                            'â€¢ 24-Monats-Vertrag vs. Monatlich kÃ¼ndbar',
                            'â€¢ Young-Tarife, Family-Pakete, Business-VertrÃ¤ge',
                            'â€¢ Hardware-Bundle vs. SIM-Only',
                            'ğŸ’¡ Verkaufsargument: "Das iPhone gibt\'s mit Vertrag fÃ¼r 1â‚¬ - ohne zahlst du 999â‚¬!"'
                        ]},
                        { type: 'section', title: 'ğŸ¢ Provider-Ãœbersicht Deutschland', items: [
                            'â€¢ Telekom (D1) - Premium-QualitÃ¤t, hÃ¶chster Preis',
                            'â€¢ Vodafone (D2) - Starkes Netz, mittleres Preissegment',
                            'â€¢ O2 - GÃ¼nstigster Anbieter, schwÃ¤chere Netzabdeckung',
                            'â€¢ Discounter: Aldi Talk, Freenet, Congstar, Lidl Connect',
                            'ğŸ’¡ Verkaufsargument: "Telekom ist wie Mercedes - teuer, aber beste QualitÃ¤t!"'
                        ]}
                    ]
                },
                'verkaufspsychologie': {
                    title: 'Verkaufspsychologie & GesprÃ¤chsfÃ¼hrung',
                    icon: 'ğŸ§ ',
                    color: '#10b981',
                    duration: '120 Min',
                    lessons: 15,
                    description: 'Die Kunst erfolgreicher VerkaufsgesprÃ¤che - psychologisch fundiert',
                    content: [
                        { type: 'section', title: 'ğŸ¯ Bedarfsanalyse - Den Kunden verstehen', items: [
                            'â€¢ Die richtigen Fragen stellen (offene vs. geschlossene Fragen)',
                            'â€¢ "Was ist Ihnen bei einem Handyvertrag am wichtigsten?"',
                            'â€¢ "Wie viel telefonieren/surfen Sie durchschnittlich?"',
                            'â€¢ "Welches Budget haben Sie pro Monat eingeplant?"',
                            'ğŸ’¡ NIEMALS direkt verkaufen - erst verstehen, dann beraten!'
                        ]},
                        { type: 'section', title: 'ğŸ‘‚ Aktives ZuhÃ¶ren - Der Game-Changer', items: [
                            'â€¢ Paraphrasieren: "Wenn ich Sie richtig verstehe, mÃ¶chten Sie..."',
                            'â€¢ Empathie zeigen: "Das kann ich gut nachvollziehen."',
                            'â€¢ Notizen machen wÃ¤hrend des GesprÃ¤chs',
                            'ğŸ’¡ Kunden kaufen von Menschen, die sie verstehen!'
                        ]},
                        { type: 'section', title: 'â“ Professionelle Fragetechniken', items: [
                            'â€¢ Offene Fragen: "Was erwarten Sie von Ihrem neuen Vertrag?"',
                            'â€¢ Alternativ-Fragen: "Lieber 50 oder 100 GB Datenvolumen?"',
                            'â€¢ Suggestiv-Fragen: "Sie mÃ¶chten sicher auch EU-Roaming, oder?"',
                            'ğŸ’¡ Wer fragt, der fÃ¼hrt das GesprÃ¤ch!'
                        ]},
                        { type: 'section', title: 'ğŸ’ Nutzen-Argumentation statt Features', items: [
                            'âŒ FALSCH: "Der Tarif hat 100 GB Datenvolumen"',
                            'âœ… RICHTIG: "Mit 100 GB kannst du 4 Stunden tÃ¤glich Netflix schauen!"',
                            'âŒ FALSCH: "5G-Technologie inklusive"',
                            'âœ… RICHTIG: "Downloads in Sekunden statt Minuten - perfekt fÃ¼r unterwegs!"',
                            'ğŸ’¡ Kunden interessieren sich nicht fÃ¼r Features - nur fÃ¼r Nutzen!'
                        ]},
                        { type: 'script', title: 'ğŸ¬ VERKAUFSSKRIPT: Perfekter GesprÃ¤chseinstieg', script: `<strong>DU:</strong> "Guten Tag! SchÃ¶n, dass Sie sich Zeit nehmen. Bevor ich Ihnen die besten Angebote zeige - darf ich kurz fragen: Was ist Ihnen bei einem Handyvertrag am wichtigsten?"

<strong>KUNDE:</strong> "Ich brauche viel Datenvolumen und gute Netzabdeckung."

<strong>DU:</strong> "Verstehe ich! Wie viel GB nutzen Sie aktuell pro Monat?"

<strong>KUNDE:</strong> "Keine Ahnung, vielleicht 20-30 GB?"

<strong>DU:</strong> "Perfekt! Dann empfehle ich Ihnen 50 GB - damit haben Sie immer Puffer. Und bei der Netzabdeckung: Nutzen Sie Ihr Handy hauptsÃ¤chlich in der Stadt oder auch auf dem Land?"

ğŸ’¡ <strong>So gewinnst du jedes GesprÃ¤ch!</strong>` }
                    ]
                },
                'einwandbehandlung': {
                    title: 'Einwandbehandlung Masterclass',
                    icon: 'ğŸ›¡ï¸',
                    color: '#f59e0b',
                    duration: '105 Min',
                    lessons: 18,
                    description: 'Konkrete Antworten auf ALLE KundeneinwÃ¤nde - praxiserprobt',
                    content: [
                        { type: 'section', title: 'ğŸ’° Einwand: "Das ist mir zu teuer!"', items: [
                            '<strong>Technik 1 - Preis relativieren:</strong>',
                            '"39â‚¬ im Monat sind nur 1,30â‚¬ pro Tag - weniger als ein Kaffee!"',
                            '',
                            '<strong>Technik 2 - Vergleich zum Ist-Zustand:</strong>',
                            '"Was zahlen Sie aktuell? 29â‚¬? FÃ¼r 10â‚¬ mehr bekommen Sie doppeltes Datenvolumen!"',
                            '',
                            '<strong>Technik 3 - Wert hervorheben:</strong>',
                            '"Stimmt, es ist nicht billig - aber das iPhone 15 Pro ist im Vertrag drin. Ohne Vertrag kostet es 1.299â‚¬. Sie sparen also Ã¼ber 1.000â‚¬!"',
                            '',
                            'ğŸ’¡ NIEMALS sagen: "Das ist doch gar nicht teuer!" - Das invalidiert den Kunden!'
                        ]},
                        { type: 'section', title: 'â° Einwand: "Ich habe keine Zeit / muss Ã¼berlegen"', items: [
                            '<strong>Technik 1 - Zeitdruck erzeugen:</strong>',
                            '"Ich verstehe! Das Angebot lÃ¤uft nur bis morgen. Soll ich es fÃ¼r Sie reservieren?"',
                            '',
                            '<strong>Technik 2 - Konkrete Frage:</strong>',
                            '"NatÃ¼rlich! Was genau mÃ¶chten Sie denn noch Ã¼berprÃ¼fen? Dann kann ich Ihnen direkt helfen."',
                            '',
                            '<strong>Technik 3 - Alternative anbieten:</strong>',
                            '"Kein Problem! Darf ich Ihnen meine Nummer geben? Dann kÃ¶nnen Sie mich anrufen, wenn Sie Fragen haben."',
                            '',
                            'ğŸ’¡ "Ich Ã¼berlege" bedeutet meistens: "Ich bin noch nicht Ã¼berzeugt!" - Finde heraus WARUM!'
                        ]},
                        { type: 'section', title: 'ğŸ“± Einwand: "Mein aktueller Vertrag lÃ¤uft noch"', items: [
                            '<strong>Technik 1 - Wechsel vorbereiten:</strong>',
                            '"Wann lÃ¤uft er denn aus? Dann tragen wir das KÃ¼ndigungsdatum ein und Sie bekommen automatisch die neue SIM zugeschickt!"',
                            '',
                            '<strong>Technik 2 - Sofortwechsel anbieten:</strong>',
                            '"Bei einem Wechsel zu uns Ã¼bernehmen wir die Restlaufzeit! Sie zahlen keinen Cent doppelt."',
                            '',
                            '<strong>Technik 3 - Vergleich rechnen:</strong>',
                            '"Sie zahlen jetzt noch 6 Monate Ã  35â‚¬ = 210â‚¬. Unser neuer Vertrag spart Ihnen langfristig 500â‚¬ - lohnt sich also trotzdem!"'
                        ]},
                        { type: 'script', title: 'ğŸ¬ VERKAUFSSKRIPT: "Zu teuer" in 60 Sekunden lÃ¶sen', script: `<strong>KUNDE:</strong> "39â‚¬ im Monat? Das ist mir ehrlich gesagt zu teuer."

<strong>DU:</strong> "Das kann ich gut verstehen! Darf ich fragen: Was zahlen Sie aktuell fÃ¼r Ihren Vertrag?"

<strong>KUNDE:</strong> "25â‚¬ bei meinem jetzigen Anbieter."

<strong>DU:</strong> "OK, also 14â‚¬ Unterschied. Jetzt schauen Sie mal: Bei Ihrem aktuellen Vertrag haben Sie 10 GB Daten, richtig?"

<strong>KUNDE:</strong> "Ja, genau."

<strong>DU:</strong> "Bei unserem Tarif bekommen Sie 50 GB, also 5x mehr! Plus das neue Samsung Galaxy A54 im Wert von 450â‚¬ GRATIS dazu. Rechnen wir kurz:

450â‚¬ Handy Ã· 24 Monate = 18,75â‚¬ pro Monat
Tarif selbst = 20,25â‚¬

Sie zahlen also eigentlich nur 20â‚¬ fÃ¼r den Tarif - gÃ¼nstiger als jetzt! Und Sie haben ein neues Handy im Wert von 450â‚¬. Passt das?"

<strong>KUNDE:</strong> "Wenn ich das so rechne... ja, macht Sinn!"

ğŸ’¡ <strong>IMMER DEN WERT GREIFBAR MACHEN!</strong>` }
                    ]
                },
                'abschlusstechniken': {
                    title: 'Abschlusstechniken & Closing',
                    icon: 'ğŸ¯',
                    color: '#ef4444',
                    duration: '95 Min',
                    lessons: 14,
                    description: 'Die effektivsten Closing-Techniken fÃ¼r garantierte AbschlÃ¼sse',
                    content: [
                        { type: 'section', title: 'ğŸš€ Assumptive Close - Abschluss als SelbstverstÃ¤ndlichkeit', items: [
                            '<strong>Was ist das?</strong> Du gehst davon aus, dass der Kunde kauft.',
                            '',
                            '<strong>Beispiel 1:</strong>',
                            '"Perfekt! Dann tragen wir hier Ihre Daten ein. Wie ist Ihre Adresse?"',
                            '',
                            '<strong>Beispiel 2:</strong>',
                            '"Super! Wann mÃ¶chten Sie die neue SIM-Karte geliefert bekommen? Diese Woche oder nÃ¤chste?"',
                            '',
                            'ğŸ’¡ Sage NIEMALS: "MÃ¶chten Sie kaufen?" - Das provoziert ein "Nein"!'
                        ]},
                        { type: 'section', title: 'âš¡ Alternativ-Close - Immer zwei Optionen anbieten', items: [
                            '<strong>Technik:</strong> Gib dem Kunden die Wahl zwischen A und B - nicht zwischen Ja und Nein!',
                            '',
                            '<strong>Beispiel 1:</strong>',
                            '"MÃ¶chten Sie lieber den Tarif mit 50 GB oder 100 GB?"',
                            '',
                            '<strong>Beispiel 2:</strong>',
                            '"Nehmen wir das iPhone in Schwarz oder lieber in WeiÃŸ?"',
                            '',
                            '<strong>Beispiel 3:</strong>',
                            '"Zahlen Sie monatlich 39â‚¬ oder lieber einmalig 450â‚¬ und dann nur 25â‚¬ im Monat?"',
                            '',
                            'ğŸ’¡ Der Kunde entscheidet nur noch WELCHE Variante - nicht OB er kauft!'
                        ]},
                        { type: 'section', title: 'ğŸ Verknappungs-Close - Limited Edition', items: [
                            '<strong>Technik:</strong> Zeitdruck oder VerfÃ¼gbarkeit als Hebel nutzen',
                            '',
                            '<strong>Beispiel 1 - Zeitlimit:</strong>',
                            '"Das Angebot mit dem gratis Handy lÃ¤uft nur noch bis heute Abend!"',
                            '',
                            '<strong>Beispiel 2 - StÃ¼ckzahl:</strong>',
                            '"Vom iPhone 15 Pro in Blau haben wir nur noch 3 StÃ¼ck auf Lager."',
                            '',
                            '<strong>Beispiel 3 - Sonderaktion:</strong>',
                            '"Die 50% Rabatt-Aktion gibt es nur diese Woche - nÃ¤chste Woche kostet der Tarif wieder 59â‚¬!"',
                            '',
                            'âš ï¸ WICHTIG: Nur nutzen, wenn es wirklich stimmt! LÃ¼gen zerstÃ¶ren Vertrauen!'
                        ]},
                        { type: 'script', title: 'ğŸ¬ CLOSING-SKRIPT: Vom Interesse zum Abschluss in 3 Minuten', script: `<strong>DU:</strong> "Also zusammengefasst: Der Telekom Tarif mit 50 GB, Allnet-Flat, EU-Roaming und dem iPhone 15 fÃ¼r nur 44,99â‚¬ im Monat. Passt das fÃ¼r Sie?"

<strong>KUNDE:</strong> "Ja, klingt gut... aber ich weiÃŸ nicht..."

<strong>DU [Assumptive Close]:</strong> "Perfekt! Dann machen wir das so. Das Beste: Die Lieferung dauert nur 2-3 Tage. MÃ¶chten Sie die SIM-Karte lieber nach Hause oder zur Packstation geschickt bekommen?"

<strong>KUNDE:</strong> "Ã„hm... nach Hause wÃ¤re besser."

<strong>DU [Verknappung]:</strong> "Super! Wichtig: Das Angebot mit dem gratis iPhone gilt nur noch heute. Morgen kostet das Handy wieder 199â‚¬ dazu. Deshalb tragen wir das jetzt direkt ein, okay?"

<strong>KUNDE:</strong> "OK, machen wir!"

<strong>DU:</strong> "GroÃŸartig! Dann brauche ich nur noch Ihren Ausweis und Ihre Bankdaten fÃ¼r die SEPA-Lastschrift. Haben Sie Ihre EC-Karte dabei?"

<strong>KUNDE:</strong> "Ja, hier!"

ğŸ’¡ <strong>ABSCHLUSS! So einfach kann es sein!</strong>

<em>Wichtige Regel: Nach dem Abschluss SOFORT ZUM NÃ„CHSTEN SCHRITT Ã¼bergehen. Nicht "MÃ¶chten Sie jetzt unterschreiben?" fragen - einfach machen!</em>` }
                    ]
                },
                'produktwissen': {
                    title: 'Produktwissen Komplett',
                    icon: 'ğŸ“¦',
                    color: '#6366f1',
                    duration: '180 Min',
                    lessons: 22,
                    description: 'Alle Produkte, Provider und Tarife im Detail',
                    content: [
                        { type: 'section', title: 'ğŸ“± Telekom (D1-Netz) - Der Premium-Anbieter', items: [
                            '<strong>Netzabdeckung:</strong> 98% in Deutschland (beste QualitÃ¤t)',
                            '<strong>Preisniveau:</strong> Hoch (40-60â‚¬/Monat)',
                            '<strong>Zielgruppe:</strong> BerufstÃ¤tige, Vielreisende, QualitÃ¤tsbewusste',
                            '',
                            '<strong>Top-Tarife:</strong>',
                            'â€¢ MagentaMobil S (10 GB) - 39,95â‚¬',
                            'â€¢ MagentaMobil M (20 GB) - 49,95â‚¬',
                            'â€¢ MagentaMobil L (40 GB) - 59,95â‚¬',
                            '',
                            'ğŸ’¡ Verkaufsargument: "Telekom ist wie Mercedes - teurer, aber Sie haben Ã¼berall perfektes Netz!"'
                        ]},
                        { type: 'section', title: 'ğŸ“± Vodafone (D2-Netz) - Preis-Leistungs-Sieger', items: [
                            '<strong>Netzabdeckung:</strong> 96% in Deutschland (sehr gut)',
                            '<strong>Preisniveau:</strong> Mittel (30-50â‚¬/Monat)',
                            '<strong>Zielgruppe:</strong> Preisbewusste mit hohen AnsprÃ¼chen',
                            '',
                            '<strong>Top-Tarife:</strong>',
                            'â€¢ Red S (10 GB) - 29,99â‚¬',
                            'â€¢ Red M (20 GB) - 39,99â‚¬',
                            'â€¢ Red L (40 GB) - 49,99â‚¬',
                            '',
                            'ğŸ’¡ Verkaufsargument: "Vodafone hat fast die gleiche QualitÃ¤t wie Telekom, aber 10-15â‚¬ gÃ¼nstiger!"'
                        ]},
                        { type: 'section', title: 'ğŸ“± O2 (TelefÃ³nica) - Der Preis-Champion', items: [
                            '<strong>Netzabdeckung:</strong> 92% in Deutschland (ausreichend in StÃ¤dten)',
                            '<strong>Preisniveau:</strong> Niedrig (15-40â‚¬/Monat)',
                            '<strong>Zielgruppe:</strong> Studenten, Preisbewusste, Stadtbewohner',
                            '',
                            '<strong>Top-Tarife:</strong>',
                            'â€¢ O2 Free S (10 GB) - 19,99â‚¬',
                            'â€¢ O2 Free M (20 GB) - 29,99â‚¬',
                            'â€¢ O2 Free L (60 GB) - 39,99â‚¬',
                            '',
                            'ğŸ’¡ Verkaufsargument: "O2 ist perfekt, wenn du hauptsÃ¤chlich in der Stadt unterwegs bist - und du sparst 20â‚¬ im Monat!"'
                        ]},
                        { type: 'section', title: 'ğŸ’° Discounter-Tarife - Die SparfÃ¼chse', items: [
                            '<strong>Aldi Talk:</strong> O2-Netz, 10 GB fÃ¼r 7,99â‚¬',
                            '<strong>Freenet Mobile:</strong> D-Netz oder O2, flexible Tarife',
                            '<strong>Congstar:</strong> Telekom-Tochter, gutes Netz, gÃ¼nstig',
                            '<strong>Lidl Connect:</strong> Vodafone-Netz, 10 GB fÃ¼r 9,99â‚¬',
                            '',
                            'ğŸ’¡ Verkaufsargument: "Discounter nutzen die gleichen Netze wie die GroÃŸen - nur ohne Service und Extras!"'
                        ]}
                    ]
                },
                'akquise': {
                    title: 'Kaltakquise & Lead-Generierung',
                    icon: 'ğŸ“',
                    color: '#a855f7',
                    duration: '110 Min',
                    lessons: 16,
                    description: 'Baue dir eine eigene Kundenpipeline auf',
                    content: [
                        { type: 'section', title: 'ğŸ“ Cold Calling Masterclass', items: [
                            '<strong>Vorbereitung:</strong>',
                            'â€¢ Recherchiere den Kunden (LinkedIn, Google, Facebook)',
                            'â€¢ Bereite 3-5 Ã–ffnungssÃ¤tze vor',
                            'â€¢ Habe alle Unterlagen griffbereit',
                            '',
                            '<strong>Perfekter GesprÃ¤chseinstieg:</strong>',
                            '"Guten Tag Herr MÃ¼ller, hier ist [DEIN NAME] von [FIRMA]. Ich habe gesehen, dass Ihr Handyvertrag bald auslÃ¤uft - stimmt das?"',
                            '',
                            '<strong>Bei Ablehnung:</strong>',
                            '"Verstehe ich! Kurze Frage: WÃ¤ren Sie interessiert, wenn ich Ihnen zeige, wie Sie 300â‚¬ im Jahr bei Ihrem Handyvertrag sparen kÃ¶nnen?"',
                            '',
                            'ğŸ’¡ Die ersten 10 Sekunden entscheiden Ã¼ber Erfolg oder Ablehnung!'
                        ]},
                        { type: 'section', title: 'ğŸ¤ Networking-Strategien', items: [
                            '<strong>1. Familie & Freunde:</strong>',
                            'Deine ersten Kunden! Biete ihnen Sonderkonditionen an.',
                            '',
                            '<strong>2. Lokale Events:</strong>',
                            'Besuche Messen, MÃ¤rkte, Firmenevents und verteile Visitenkarten.',
                            '',
                            '<strong>3. Empfehlungsmarketing:</strong>',
                            '"Kennen Sie jemanden, der auch einen neuen Handyvertrag braucht? Pro Empfehlung gibt\'s 50â‚¬ Bonus!"',
                            '',
                            '<strong>4. Social Media:</strong>',
                            'Poste regelmÃ¤ÃŸig Angebote auf Facebook, Instagram, TikTok',
                            '',
                            'ğŸ’¡ 1 zufriedener Kunde bringt dir 3 neue Kunden durch Empfehlungen!'
                        ]},
                        { type: 'script', title: 'ğŸ¬ COLD CALLING SKRIPT: Die ersten 60 Sekunden', script: `<strong>DU:</strong> "Guten Tag Frau Schmidt, hier ist [DEIN NAME]. Ich bin Mobilfunk-Berater und helfe Menschen dabei, bis zu 400â‚¬ im Jahr bei ihrem Handyvertrag zu sparen. Haben Sie 2 Minuten Zeit?"

<strong>KUNDE:</strong> "Ã„hm... worum geht es genau?"

<strong>DU:</strong> "Ich habe gesehen, dass Sie aktuell bei Vodafone sind und 45â‚¬ im Monat zahlen. Stimmt das ungefÃ¤hr?"

<strong>KUNDE:</strong> "Ja, etwa."

<strong>DU:</strong> "Perfekt! Ich kÃ¶nnte Ihnen den gleichen Tarif fÃ¼r 30â‚¬ anbieten - gleiche Leistung, 15â‚¬ gÃ¼nstiger. Das sind 180â‚¬ Ersparnis pro Jahr. Wollen wir kurz schauen, ob das fÃ¼r Sie passt?"

<strong>KUNDE:</strong> "OK, warum nicht..."

ğŸ’¡ <strong>ABSCHLUSSCHANCE: 60%! So startest du JEDES Cold Call!</strong>` }
                    ]
                },
                'mindset': {
                    title: 'Mindset & Motivation',
                    icon: 'ğŸ’ª',
                    color: '#ec4899',
                    duration: '75 Min',
                    lessons: 10,
                    description: 'Das richtige Mindset ist 80% deines Erfolgs',
                    content: [
                        { type: 'section', title: 'ğŸ’ Winner-Mindset entwickeln', items: [
                            '<strong>1. Erfolg ist planbar:</strong>',
                            'Top-VerkÃ¤ufer machen jeden Tag 20-30 Anrufe. Du auch? Dann wirst du auch Top-VerkÃ¤ufer!',
                            '',
                            '<strong>2. Fokus auf LÃ¶sungen:</strong>',
                            'Problem: "Kunde sagt Nein" âŒ',
                            'LÃ¶sung: "Was kann ich beim nÃ¤chsten Mal besser machen?" âœ…',
                            '',
                            '<strong>3. Vergleiche dich mit dir selbst:</strong>',
                            'Nicht: "Max hat mehr AbschlÃ¼sse als ich"',
                            'Sondern: "Letzten Monat hatte ich 10 AbschlÃ¼sse, diesen Monat 15 - ICH wachse!"',
                            '',
                            'ğŸ’¡ Dein einziger Konkurrent bist DU SELBST von gestern!'
                        ]},
                        { type: 'section', title: 'ğŸš« Mit Ablehnung umgehen', items: [
                            '<strong>Die Wahrheit:</strong>',
                            'â€¢ 80% deiner Anrufe werden NEIN sagen',
                            'â€¢ Das ist NORMAL und hat nichts mit dir zu tun',
                            'â€¢ Selbst Top-VerkÃ¤ufer haben 70-80% Ablehnungen',
                            '',
                            '<strong>Mindset-Shift:</strong>',
                            'âŒ "Der Kunde hat MICH abgelehnt"',
                            'âœ… "Der Kunde hat das ANGEBOT abgelehnt - beim nÃ¤chsten passt es!"',
                            '',
                            '<strong>Regel:</strong>',
                            'Jedes "Nein" bringt dich nÃ¤her ans "Ja"!',
                            'Wenn 8 von 10 Nein sagen â†’ Nach 8x Nein kommen 2x JA!',
                            '',
                            'ğŸ’¡ Ablehnung ist kein Scheitern - Aufgeben ist Scheitern!'
                        ]},
                        { type: 'section', title: 'âš¡ Selbstdisziplin aufbauen', items: [
                            '<strong>Die 20-Anrufe-Regel:</strong>',
                            'Mache JEDEN Tag mindestens 20 Anrufe - egal was kommt!',
                            '',
                            '<strong>Morgenroutine:</strong>',
                            'â€¢ 8:00 Uhr: Kaffee + Ziele fÃ¼r heute aufschreiben',
                            'â€¢ 8:30 Uhr: Erste 10 Anrufe',
                            'â€¢ 10:00 Uhr: Pause',
                            'â€¢ 10:30 Uhr: Weitere 10 Anrufe',
                            'â€¢ 12:00 Uhr: FERTIG! Rest des Tages ist Bonus',
                            '',
                            'ğŸ’¡ Disziplin schlÃ¤gt Motivation - JEDEN TAG!'
                        ]}
                    ]
                },
                'rechtliches': {
                    title: 'Rechtliche Grundlagen & Compliance',
                    icon: 'âš–ï¸',
                    color: '#3b82f6',
                    duration: '60 Min',
                    lessons: 8,
                    description: 'Rechtssicher verkaufen - vermeide teure Fehler',
                    content: [
                        { type: 'section', title: 'ğŸ”’ DSGVO-konform arbeiten', items: [
                            '<strong>Was du beachten MUSST:</strong>',
                            'â€¢ Kundendaten nur mit Einwilligung speichern',
                            'â€¢ Daten verschlÃ¼sselt aufbewahren (z.B. Excel mit Passwort)',
                            'â€¢ Nach Vertragsende: Daten lÃ¶schen (nach 10 Jahren)',
                            '',
                            '<strong>Bei Anrufen:</strong>',
                            '"Ich speichere Ihre Daten zur Vertragsabwicklung. Ist das fÃ¼r Sie in Ordnung?"',
                            '',
                            '<strong>Bei E-Mails:</strong>',
                            'Immer einen Abmeldelink einfÃ¼gen!',
                            '',
                            'âš ï¸ WICHTIG: VerstÃ¶ÃŸe kÃ¶nnen bis zu 20.000â‚¬ Strafe kosten!'
                        ]},
                        { type: 'section', title: 'ğŸ“‹ Vertragsrecht: Was Kunden wissen mÃ¼ssen', items: [
                            '<strong>Widerrufsrecht (14 Tage):</strong>',
                            'Kunden kÃ¶nnen innerhalb von 14 Tagen ohne BegrÃ¼ndung widerrufen.',
                            '',
                            '<strong>Mindestvertragslaufzeit:</strong>',
                            'Meist 24 Monate - danach monatlich kÃ¼ndbar',
                            '',
                            '<strong>KÃ¼ndigungsfrist:</strong>',
                            'Meist 3 Monate vor Vertragsende',
                            '',
                            'ğŸ’¡ IMMER transparent kommunizieren - keine versteckten Klauseln!'
                        ]},
                        { type: 'section', title: 'â†©ï¸ Widerrufsbelehrung korrekt durchfÃ¼hren', items: [
                            '<strong>Pflicht:</strong>',
                            'Du MUSST den Kunden Ã¼ber sein Widerrufsrecht informieren!',
                            '',
                            '<strong>Formulierung:</strong>',
                            '"Sie haben das Recht, binnen 14 Tagen ohne Angabe von GrÃ¼nden diesen Vertrag zu widerrufen. Die Widerrufsfrist betrÃ¤gt 14 Tage ab dem Tag des Vertragsabschlusses."',
                            '',
                            '<strong>Schriftlich:</strong>',
                            'Immer schriftlich im Vertrag vermerken!',
                            '',
                            'âš ï¸ WICHTIG: Ohne korrekte Widerrufsbelehrung ist der Vertrag anfechtbar!'
                        ]}
                    ]
                }
            };

            const modul = module[modulId];
            if (!modul) {
                alert('Modul wird noch entwickelt! Coming soon... ğŸš€');
                return;
            }

            // Modal HTML erstellen
            let contentHTML = '';
            modul.content.forEach(item => {
                if (item.type === 'section') {
                    contentHTML += `
                        <div style="background: #f9fafb; border-left: 4px solid ${modul.color}; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0 0 1rem 0; font-size: 1.2rem; color: var(--text); font-weight: 700;">${item.title}</h3>
                            <div style="color: var(--text-light); line-height: 1.9; white-space: pre-line; font-size: 1rem;">${item.items.join('\n')}</div>
                        </div>
                    `;
                } else if (item.type === 'script') {
                    contentHTML += `
                        <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2);">
                            <h3 style="margin: 0 0 1rem 0; font-size: 1.3rem; color: #92400e; font-weight: 800; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-video" style="color: #f59e0b;"></i> ${item.title}
                            </h3>
                            <div style="background: white; padding: 1.5rem; border-radius: 8px; color: var(--text); line-height: 2; font-size: 1rem; border-left: 4px solid #f59e0b;">${item.script}</div>
                        </div>
                    `;
                }
            });

            // Modal anzeigen
            const modal = document.createElement('div');
            modal.id = 'modul-detail-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 20000; padding: 10px; backdrop-filter: blur(5px);';
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; max-width: 1200px; width: 100%; max-height: 95vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; -webkit-overflow-scrolling: touch;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, ${modul.color}, ${modul.color}dd); padding: 1.5rem; border-radius: 16px 16px 0 0; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                                <div style="font-size: 2.5rem; line-height: 1; flex-shrink: 0;">${modul.icon}</div>
                                <div style="min-width: 0;">
                                    <h2 style="margin: 0 0 0.25rem 0; font-size: 1.3rem; font-weight: 700;">${modul.title}</h2>
                                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${modul.description}</p>
                                </div>
                            </div>
                            <button onclick="document.getElementById('modul-detail-modal').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; min-width: 36px; border-radius: 50%; cursor: pointer; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; margin-left: 10px;">Ã—</button>
                        </div>
                        <div style="display: flex; gap: 2rem; font-size: 0.95rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-book"></i>
                                <strong>${modul.lessons} Lektionen</strong>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-clock"></i>
                                <strong>${modul.duration} Dauer</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div style="padding: 2.5rem;">
                        ${contentHTML}
                        
                        <!-- Abschluss Button -->
                        <div style="text-align: center; padding: 2rem 0; border-top: 2px dashed #e5e7eb; margin-top: 2rem;">
                            <button onclick="window.completeModul('${modulId}', '${modul.title}')" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 1rem 3rem; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.3)'">
                                <i class="fas fa-check-circle"></i> Modul als abgeschlossen markieren
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
        */
        
        // Initialize
        // ===== ğŸ†• VEREINFACHTER LOGIN-CHECK (OHNE Onboarding-Widget) =====
        async function loadOnboardingStatus() {
            // ğŸ§ª Demo-Modus Ã¼berspringen
            if (window.IS_DEMO_MODE) {
                console.log('ğŸ§ª Demo-Modus: loadOnboardingStatus() Ã¼bersprungen');
                return;
            }
            
            const partnerEmail = localStorage.getItem('partnerEmail');
            
            // ğŸ†• BESTANDS-PARTNER CHECK: Kein Onboarding fÃ¼r bereits existierende Partner!
            const isBestandsPartner = localStorage.getItem('isBestandsPartner') === 'true';
            if (isBestandsPartner) {
                console.log('âœ… BESTANDS-PARTNER erkannt - Onboarding wird Ã¼bersprungen!');
                // Onboarding-Widget verstecken
                const widget = document.getElementById('onboarding-widget');
                if (widget) widget.style.display = 'none';
                // Projekt-Widget auch verstecken (nicht relevant)
                const projektWidget = document.getElementById('projekt-status-widget');
                if (projektWidget) projektWidget.style.display = 'none';
                // Trotzdem Partner-Daten laden fÃ¼r Name etc.
            }
            
            if (!partnerEmail) {
                // Kein Login â†’ Redirect zum Login
                console.warn('âš ï¸ Kein Partner eingeloggt - Redirect zum Login');
                window.location.href = 'partner-login.html';
                return;
            }

            try {
                console.log('ğŸ” Suche Partner:', partnerEmail);
                
                // âœ… Alle Partner laden und manuell filtern
                const response = await fetch(`tables/partners?limit=1000`);
                const data = await response.json();
                
                console.log('ğŸ“Š API Response:', data.data?.length, 'Partner total');
                
                // Manuell nach Email suchen
                let partner = data.data?.find(p => p.email?.toLowerCase() === partnerEmail.toLowerCase());
                
                // ğŸ†• BESTANDS-PARTNER: Wenn nicht in DB, nutze localStorage-Daten
                if (!partner) {
                    const localData = localStorage.getItem('partnerData');
                    if (localData) {
                        partner = JSON.parse(localData);
                        partner.ist_affiliate = true;
                        partner.email = partner.email || partnerEmail;
                        console.log('âœ… Bestands-Partner aus localStorage geladen:', partner.email);
                    }
                }
                
                if (partner) {
                    // ğŸ” GLOBAL SPEICHERN fÃ¼r Passwort-Ã„ndern etc.
                    window.currentPartner = partner;
                    
                    // ğŸ†• BESTANDS-PARTNER ERKENNUNG - aus localStorage partnerData lesen!
                    const localPartnerData = localStorage.getItem('partnerData');
                    let istBestandsPartner = partner.ist_bestandspartner === true || partner.ist_affiliate === true;
                    let mussPasswortAendern = partner.passwort_muss_geaendert_werden === true;
                    
                    // Falls localStorage partnerData existiert, diese Flags nutzen (vom Login gesetzt)
                    if (localPartnerData) {
                        try {
                            const lpd = JSON.parse(localPartnerData);
                            if (lpd.ist_bestandspartner === true) istBestandsPartner = true;
                            if (lpd.ist_affiliate === true) istBestandsPartner = true;
                            if (lpd.passwort_muss_geaendert_werden === true) mussPasswortAendern = true;
                        } catch(e) {}
                    }
                    
                    console.log('âœ… Partner gefunden:', partner.email, '| Bestands-Partner:', istBestandsPartner, '| Passwort Ã¤ndern:', mussPasswortAendern);
                    
                    // ğŸ” PASSWORT Ã„NDERN MODAL - SOFORT anzeigen wenn nÃ¶tig!
                    if (mussPasswortAendern) {
                        console.log('ğŸ” PASSWORT MUSS GEÃ„NDERT WERDEN - ZEIGE MODAL!');
                        setTimeout(() => showPasswortAendernModal(), 300);
                    }
                    
                    // ğŸš« KEIN ONBOARDING fÃ¼r Bestands-Partner - SOFORT verstecken!
                    if (istBestandsPartner) {
                        console.log('ğŸš« BESTANDS-PARTNER - Onboarding VERSTECKT!');
                        const widget = document.getElementById('onboarding-widget');
                        if (widget) {
                            widget.style.display = 'none';
                            widget.style.visibility = 'hidden';
                            widget.remove(); // KOMPLETT ENTFERNEN!
                        }
                        const projektWidget = document.getElementById('projekt-status-widget');
                        if (projektWidget) {
                            projektWidget.style.display = 'none';
                            projektWidget.style.visibility = 'hidden';
                        }
                    }
                    
                    // âœ… User Name + Avatar setzen
                    document.getElementById('userEmail').textContent = partner.email || partnerEmail;
                    const initials = (partner.vorname?.charAt(0) || '') + (partner.nachname?.charAt(0) || '');
                    if (initials) {
                        document.getElementById('userAvatar').textContent = initials.toUpperCase();
                    }
                    
                    // âœ… PERSÃ–NLICHE BEGRÃœSSUNG setzen
                    const fullName = `${partner.vorname || ''} ${partner.nachname || ''}`.trim();
                    const emailName = (partner.email || partnerEmail || '').split('@')[0];
                    const displayName = fullName || emailName || 'Partner';
                    const vorname = partner.vorname || emailName || 'Partner';
                    
                    document.getElementById('greeting-text').textContent = `Hallo ${vorname}!`;
                    document.getElementById('userName').textContent = displayName;
                    
                    // ğŸ“± MOBILE: User Name im Header setzen
                    const mobileUserEl = document.getElementById('mobile-user-name');
                    if (mobileUserEl) {
                        mobileUserEl.textContent = displayName;
                        console.log('ğŸ“± Mobile User Name gesetzt:', displayName);
                    }
                    
                    // âœ… PRÃœFE OB PARTNER VERTRÃ„GE HAT â†’ Automatisch "Erster Vertrag" als erledigt markieren
                    if (!partner.onboarding_abschluss) {
                        try {
                            const vertraegeRes = await fetch('tables/vertragsabschluesse?limit=1000');
                            const vertraegeData = await vertraegeRes.json();
                            const meineVertraege = vertraegeData.data.filter(v => {
                                const vEmail = v.partner_email || v.email || v.partnerEmail || v.partner;
                                return vEmail === partnerEmail;
                            });
                            
                            console.log('ğŸ“Š VertrÃ¤ge gefunden:', meineVertraege.length);
                            
                            // Wenn Partner mindestens 1 Vertrag hat â†’ "Erster Vertrag" als erledigt markieren
                            if (meineVertraege.length > 0) {
                                console.log('âœ… Partner hat VertrÃ¤ge! Markiere "Erster Vertrag" als erledigt...');
                                
                                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                                    method: 'PATCH',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify({
                                        onboarding_abschluss: true
                                    })
                                });
                                
                                if (updateRes.ok) {
                                    console.log('âœ… "Erster Vertrag" automatisch als erledigt markiert!');
                                    partner.onboarding_abschluss = true; // Update lokales Objekt
                                }
                            }
                        } catch (error) {
                            console.error('âŒ Fehler beim PrÃ¼fen der VertrÃ¤ge:', error);
                        }
                    }
                    
                    // ğŸ†• BESTANDS-PARTNER: KEIN Onboarding! (istBestandsPartner wurde oben schon gesetzt)
                    if (istBestandsPartner) {
                        // âœ… BESTANDS-PARTNER: ONBOARDING KOMPLETT ENTFERNEN!
                        console.log('ğŸš« BESTANDS-PARTNER - Onboarding WIRD ENTFERNT!');
                        const widget = document.getElementById('onboarding-widget');
                        if (widget) widget.remove();
                        const projektWidget = document.getElementById('projekt-status-widget');
                        if (projektWidget) projektWidget.style.display = 'none';
                    } else {
                        // âœ… NEUE PARTNER: Onboarding & Projekt-Widget anzeigen
                        console.log('ğŸ“‹ Neuer Partner - zeige Onboarding & Projekt-Widget');
                        showOnboardingWidget(partner);
                        loadProjektStatus(partner);
                    }
                    
                    console.log('âœ… Partner-Dashboard mit Onboarding-Widget & Projekt-Status bereit!');
                } else {
                    // Partner nicht in DB gefunden
                    console.error('âŒ Partner nicht in Datenbank gefunden:', partnerEmail);
                    console.log('âŒ VerfÃ¼gbare Emails (Sample):', data.data?.map(p => p.email).slice(0, 5));
                    
                    alert('âš ï¸ Ihr Partner-Account wurde nicht gefunden.\n\nBitte registrieren Sie sich oder kontaktieren Sie den Support.');
                    localStorage.removeItem('partnerEmail');
                    window.location.href = 'partner-login.html';
                }
            } catch (error) {
                console.error('âŒ Fehler beim Laden des Partner-Accounts:', error);
                
                // Bestands-Partner: Nutze localStorage-Daten statt Fehler zu zeigen
                const localData = localStorage.getItem('partnerData');
                if (localData) {
                    const partner = JSON.parse(localData);
                    partner.email = partner.email || partnerEmail;
                    partner.ist_affiliate = true;
                    partner.ist_bestandspartner = true;
                    window.currentPartner = partner;
                    
                    console.log('âœ… Bestands-Partner aus localStorage (nach API-Fehler):', partner.email);
                    
                    // UI aktualisieren
                    document.getElementById('userEmail').textContent = partner.email;
                    document.getElementById('greeting-text').textContent = 'Hallo Partner!';
                    
                    // KEIN Onboarding fÃ¼r Bestands-Partner!
                    const widget = document.getElementById('onboarding-widget');
                    if (widget) widget.style.display = 'none';
                    const projektWidget = document.getElementById('projekt-status-widget');
                    if (projektWidget) projektWidget.style.display = 'none';
                    
                    // Passwort-Modal wenn nÃ¶tig
                    if (partner.passwort_muss_geaendert_werden === true) {
                        setTimeout(() => showPasswortAendernModal(), 300);
                    }
                    return;
                }
                
                alert('âŒ Fehler beim Laden Ihres Accounts.\n\nBitte versuchen Sie es erneut.');
            }
        }

        // âœ… AFFILIATE ONBOARDING WIDGET - NUR fÃ¼r NEUE Partner, NICHT fÃ¼r Bestands-Partner!
        function showAffiliateOnboardingWidget(partner) {
            // ğŸš« SOFORT ABBRECHEN wenn Bestands-Partner!
            let istBestandsPartner = partner.ist_bestandspartner === true || partner.ist_affiliate === true;
            // Auch localStorage prÃ¼fen (vom Login gesetzt)
            try {
                const lpd = JSON.parse(localStorage.getItem('partnerData') || '{}');
                if (lpd.ist_bestandspartner || lpd.ist_affiliate) istBestandsPartner = true;
            } catch(e) {}
            
            if (istBestandsPartner) {
                console.log('ğŸš« BESTANDS-PARTNER - showAffiliateOnboardingWidget ABGEBROCHEN!');
                const widget = document.getElementById('onboarding-widget');
                if (widget) widget.remove();
                return;
            }
            
            console.log('ğŸ¯ showAffiliateOnboardingWidget aufgerufen fÃ¼r:', partner.email);
            
            const widget = document.getElementById('onboarding-widget');
            if (!widget) return;
            widget.style.display = 'block';

            // Affiliate-spezifische Onboarding-Schritte
            const steps = [
                {
                    id: 'profil',
                    icon: 'fas fa-user-edit',
                    title: '1. Profil vervollstÃ¤ndigen',
                    desc: 'Name, E-Mail und Kontaktdaten prÃ¼fen',
                    badge: 'SCHRITT 1',
                    completed: !!(partner.vorname && partner.nachname && partner.email),
                    action: "showPage('einstellungen')"
                },
                {
                    id: 'passwort',
                    icon: 'fas fa-lock',
                    title: '2. Passwort Ã¤ndern',
                    desc: 'Sicheres Passwort festlegen',
                    badge: 'SCHRITT 2',
                    completed: partner.passwort_muss_geaendert_werden === false,
                    action: 'showPasswortAendernModal()'
                },
                {
                    id: 'bank',
                    icon: 'fas fa-university',
                    title: '3. Bankverbindung hinterlegen',
                    desc: 'IBAN fÃ¼r Provisions-Auszahlungen',
                    badge: 'SCHRITT 3',
                    completed: !!(partner.iban || partner.payment_info || partner.zahlungsinfo),
                    action: "showPage('einstellungen')"
                },
                {
                    id: 'referral',
                    icon: 'fas fa-share-alt',
                    title: '4. Referral-Link teilen',
                    desc: 'Deinen persÃ¶nlichen Link nutzen',
                    badge: 'SCHRITT 4',
                    completed: !!(partner.referral_code || partner.standard_link),
                    action: "showPage('partner-tool')"
                },
                {
                    id: 'abschluss',
                    icon: 'fas fa-handshake',
                    title: '5. Erster Vertragsabschluss',
                    desc: 'Deinen ersten Kunden gewinnen',
                    badge: 'SCHRITT 5',
                    completed: partner.erster_vertrag_abgeschlossen === true,
                    action: "showPage('vertraege')"
                }
            ];

            const completedSteps = steps.filter(s => s.completed).length;
            const progress = Math.round((completedSteps / steps.length) * 100);

            // Header aktualisieren
            const progressEl = document.getElementById('onboarding-progress');
            const progressBarEl = document.getElementById('onboarding-progress-bar');
            
            if (progressEl) progressEl.textContent = progress + '%';
            if (progressBarEl) progressBarEl.style.width = progress + '%';

            const stepsHtml = steps.map((step, index) => `
                <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 1rem; cursor: pointer; transition: all 0.2s; ${step.completed ? 'opacity: 0.7; border: 2px solid #48bb78;' : 'border: 2px solid #8b5cf6;'}" 
                     onclick="${step.action}"
                     onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(139,92,246,0.4)'; this.style.borderColor='#8b5cf6'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; ${step.completed ? 'this.style.borderColor=\'#48bb78\'' : 'this.style.borderColor=\'#8b5cf6\''}">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <div style="width: 45px; height: 45px; background: ${step.completed ? 'linear-gradient(135deg, #48bb78, #38a169)' : 'linear-gradient(135deg, #8b5cf6, #a78bfa)'}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3rem; flex-shrink: 0;">
                            <i class="${step.completed ? 'fas fa-check' : step.icon}"></i>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; color: #2d3748; font-size: 0.95rem; margin-bottom: 0.25rem;">${step.title}</div>
                            <div style="font-size: 0.75rem; color: #718096; line-height: 1.3;">${step.desc}</div>
                        </div>
                        <div style="flex-shrink: 0;">
                            <span style="padding: 0.3rem 0.6rem; background: ${step.completed ? '#d1fae5' : '#ede9fe'}; color: ${step.completed ? '#065f46' : '#5b21b6'}; border-radius: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase;">${step.badge}</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: flex-end; margin-top: 0.5rem;">
                        ${step.completed 
                            ? '<span style="color: #48bb78; font-size: 0.85rem; font-weight: 600;"><i class="fas fa-check-circle"></i> Erledigt</span>' 
                            : '<span style="color: #8b5cf6; font-size: 0.85rem; font-weight: 600; animation: pulse 2s infinite;">ğŸ‘‰ Jetzt starten <i class="fas fa-arrow-right" style="margin-left: 5px;"></i></span>'
                        }
                    </div>
                </div>
            `).join('');

            const stepsEl = document.getElementById('onboarding-steps');
            if (stepsEl) {
                stepsEl.innerHTML = stepsHtml;
            }
            
            console.log('âœ… Affiliate-Onboarding-Widget geladen:', completedSteps + '/' + steps.length + ' Schritte erledigt');
        }

        function showOnboardingWidget(partner) {
            // ğŸš« SOFORT ABBRECHEN wenn Bestands-Partner!
            let istBestandsPartner = partner.ist_bestandspartner === true || partner.ist_affiliate === true;
            // Auch localStorage prÃ¼fen (vom Login gesetzt)
            try {
                const lpd = JSON.parse(localStorage.getItem('partnerData') || '{}');
                if (lpd.ist_bestandspartner || lpd.ist_affiliate) istBestandsPartner = true;
            } catch(e) {}
            
            if (istBestandsPartner) {
                console.log('ğŸš« BESTANDS-PARTNER - showOnboardingWidget ABGEBROCHEN!');
                const widget = document.getElementById('onboarding-widget');
                if (widget) widget.remove();
                return;
            }
            
            const widget = document.getElementById('onboarding-widget');
            if (!widget) return;
            widget.style.display = 'block';

            const steps = [
                {
                    id: 'termin',
                    icon: 'fas fa-calendar-check',
                    title: '1. Termin vereinbaren',
                    desc: 'ErstgesprÃ¤ch mit deinem Ansprechpartner',
                    badge: 'SCHRITT 1',
                    completed: partner.onboarding_termin || false,
                    action: 'openTerminModal()'
                },
                {
                    id: 'dokumente',
                    icon: 'fas fa-file-upload',
                    title: '2. Dokumente hochladen',
                    desc: 'Gewerbeschein, Steuernummer, etc.',
                    badge: 'SCHRITT 2',
                    completed: partner.onboarding_dokumente || false,
                    action: 'openDokumenteModal()'
                },
                {
                    id: 'ausweis',
                    icon: 'fas fa-id-card',
                    title: '3. Ausweis hochladen',
                    desc: 'Vorderseite & RÃ¼ckseite',
                    badge: 'SCHRITT 3',
                    completed: partner.onboarding_ausweis || false,
                    action: 'openAusweisModal()'
                },
                {
                    id: 'bank',
                    icon: 'fas fa-university',
                    title: '4. Bankverbindung',
                    desc: 'IBAN fÃ¼r Provisions-Auszahlungen',
                    badge: 'SCHRITT 4',
                    completed: partner.onboarding_bank || false,
                    action: "showPage('einstellungen')"
                },
                {
                    id: 'akademie',
                    icon: 'fas fa-graduation-cap',
                    title: '5. Akademie absolvieren',
                    desc: 'Pflicht-Schulung durchfÃ¼hren',
                    badge: 'SCHRITT 5',
                    completed: partner.onboarding_akademie || false,
                    action: "showPage('akademie')"
                },
                {
                    id: 'abschluss',
                    icon: 'fas fa-handshake',
                    title: '6. Erster Vertragsabschluss',
                    desc: 'Deinen ersten Kunden gewinnen',
                    badge: 'SCHRITT 6',
                    completed: partner.onboarding_abschluss || false,
                    action: "showPage('partner-tool')"
                }
            ];

            const completedSteps = steps.filter(s => s.completed).length;
            const progress = Math.round((completedSteps / steps.length) * 100);

            document.getElementById('onboarding-progress').textContent = progress + '%';
            document.getElementById('onboarding-progress-bar').style.width = progress + '%';

            const stepsHtml = steps.map((step, index) => `
                <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 1rem; cursor: pointer; transition: all 0.2s; ${step.completed ? 'opacity: 0.7; border: 2px solid #48bb78;' : 'border: 2px solid #3b82f6;'}" 
                     onclick="${step.action}"
                     onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(59,130,246,0.4)'; this.style.borderColor='#3b82f6'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; ${step.completed ? 'this.style.borderColor=\'#48bb78\'' : 'this.style.borderColor=\'#3b82f6\''}">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                        <div style="width: 45px; height: 45px; background: ${step.completed ? 'linear-gradient(135deg, #48bb78, #38a169)' : 'linear-gradient(135deg, #3b82f6, #60a5fa)'}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3rem; flex-shrink: 0;">
                            <i class="${step.completed ? 'fas fa-check' : step.icon}"></i>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; color: #2d3748; font-size: 0.95rem; margin-bottom: 0.25rem;">${step.title}</div>
                            <div style="font-size: 0.75rem; color: #718096; line-height: 1.3;">${step.desc}</div>
                        </div>
                        <div style="flex-shrink: 0;">
                            <span style="padding: 0.3rem 0.6rem; background: ${step.completed ? '#d1fae5' : '#fef3c7'}; color: ${step.completed ? '#065f46' : '#92400e'}; border-radius: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase;">${step.badge}</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: flex-end; margin-top: 0.5rem;">
                        ${step.completed 
                            ? '<span style="color: #48bb78; font-size: 0.85rem; font-weight: 600;"><i class="fas fa-check-circle"></i> Erledigt</span>' 
                            : '<span style="color: #3b82f6; font-size: 0.85rem; font-weight: 600; animation: pulse 2s infinite;">ğŸ‘‰ Jetzt starten <i class="fas fa-arrow-right" style="margin-left: 5px;"></i></span>'
                        }
                    </div>
                </div>
            `).join('');

            document.getElementById('onboarding-steps').innerHTML = stepsHtml;
        }

        // ===== PROJEKT-STATUS MIT ZIELEN, HOCHRECHNUNGEN, BONUS-SYSTEM =====
        async function loadProjektStatus(partner) {
            // Only show for certain models
            const projektModels = {
                'ladenlokal': { 
                    weeks: 12, 
                    icon: 'ğŸª', 
                    title: 'Dein Ladenlokal-Projekt',
                    ziel_vertraege: 100,
                    ziel_provision: 5000,
                    bonus_stufen: [
                        { min: 50, bonus: 500, label: '50 VertrÃ¤ge' },
                        { min: 100, bonus: 1000, label: '100 VertrÃ¤ge' },
                        { min: 150, bonus: 2000, label: '150 VertrÃ¤ge' }
                    ]
                },
                'promotion': { 
                    weeks: 8, 
                    icon: 'ğŸ“£', 
                    title: 'Dein Promotion-Projekt',
                    ziel_vertraege: 60,
                    ziel_provision: 3000,
                    bonus_stufen: [
                        { min: 30, bonus: 300, label: '30 VertrÃ¤ge' },
                        { min: 60, bonus: 600, label: '60 VertrÃ¤ge' },
                        { min: 90, bonus: 1200, label: '90 VertrÃ¤ge' }
                    ]
                },
                'shopinshop': { 
                    weeks: 10, 
                    icon: 'ğŸ¬', 
                    title: 'Dein Shop-in-Shop-Projekt',
                    ziel_vertraege: 80,
                    ziel_provision: 4000,
                    bonus_stufen: [
                        { min: 40, bonus: 400, label: '40 VertrÃ¤ge' },
                        { min: 80, bonus: 800, label: '80 VertrÃ¤ge' },
                        { min: 120, bonus: 1600, label: '120 VertrÃ¤ge' }
                    ]
                },
                'onlineshop': { 
                    weeks: 6, 
                    icon: 'ğŸ’»', 
                    title: 'Dein Online-Shop-Projekt',
                    ziel_vertraege: 40,
                    ziel_provision: 2000,
                    bonus_stufen: [
                        { min: 20, bonus: 200, label: '20 VertrÃ¤ge' },
                        { min: 40, bonus: 400, label: '40 VertrÃ¤ge' },
                        { min: 60, bonus: 800, label: '60 VertrÃ¤ge' }
                    ]
                },
                'affiliate': {
                    weeks: 0,
                    icon: 'ğŸ¤',
                    title: 'Dein Affiliate-Programm',
                    ziel_vertraege: 20,
                    ziel_provision: 1000,
                    bonus_stufen: [
                        { min: 10, bonus: 100, label: '10 VertrÃ¤ge' },
                        { min: 20, bonus: 200, label: '20 VertrÃ¤ge' },
                        { min: 30, bonus: 400, label: '30 VertrÃ¤ge' }
                    ]
                }
            };

            const model = (partner.modell || partner.model || '').toLowerCase();
            if (!projektModels[model]) {
                document.getElementById('projekt-status-widget').style.display = 'none';
                return;
            }

            const projekt = projektModels[model];
            
            // âš ï¸ Affiliate hat kein Projekt-Widget (weeks = 0) â†’ Ausblenden!
            if (projekt.weeks === 0 || model === 'affiliate') {
                document.getElementById('projekt-status-widget').style.display = 'none';
                return;
            }

            const widget = document.getElementById('projekt-status-widget');
            widget.style.display = 'block';
            const startDate = new Date(partner.registriert_am || partner.created_at);
            const now = new Date();
            const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
            const weeksPassed = Math.floor(daysPassed / 7);
            
            // Load actual contracts
            const partnerEmail = localStorage.getItem('partnerEmail');
            let aktuelleVertraege = 0;
            let aktuelleProv = 0;
            
            try {
                const res = await fetch('tables/vertragsabschluesse?limit=1000');
                const data = await res.json();
                const meineVertraege = data.data.filter(v => v.partner_email && v.partner_email.toLowerCase() === partnerEmail.toLowerCase());
                aktuelleVertraege = meineVertraege.length;
                aktuelleProv = meineVertraege.reduce((sum, v) => sum + (parseFloat(v.provision) || parseFloat(v.gesamt_provision) || 0), 0);
            } catch (error) {
                console.error('Fehler beim Laden der VertrÃ¤ge fÃ¼r Projekt-Widget:', error);
            }
            
            // âœ… NEUE LOGIK: Prozent basiert auf WOCHEN, nicht auf VertrÃ¤gen!
            let weekProgress = 0;
            if (projekt.weeks > 0) {
                weekProgress = Math.min(Math.round((weeksPassed / projekt.weeks) * 100), 100);
            } else {
                // FÃ¼r Affiliate ohne feste Wochenzahl: Verwende Vertrags-Progress
                weekProgress = Math.min(Math.round((aktuelleVertraege / projekt.ziel_vertraege) * 100), 100);
            }

            // Update UI - Projekt Widget
            document.getElementById('projekt-title').innerHTML = `${projekt.icon} ${projekt.title}`;
            document.getElementById('projekt-progress-text').textContent = weekProgress + '%';
            document.getElementById('projekt-progress-bar').style.width = weekProgress + '%';
            document.getElementById('projekt-start').textContent = startDate.toLocaleDateString('de-DE');
            
            if (projekt.weeks > 0) {
                document.getElementById('projekt-weeks').textContent = `${weeksPassed} / ${projekt.weeks} Wochen`;
            } else {
                document.getElementById('projekt-weeks').textContent = `${weeksPassed} Wochen`;
            }

            // Update status basierend auf Wochen-Progress
            if (weekProgress < 33) {
                document.getElementById('projekt-status').textContent = 'Starter';
                document.getElementById('projekt-status').style.color = '#ed8936';
            } else if (weekProgress < 66) {
                document.getElementById('projekt-status').textContent = 'Fortgeschritten';
                document.getElementById('projekt-status').style.color = '#4299e1';
            } else if (weekProgress < 100) {
                document.getElementById('projekt-status').textContent = 'Fast am Ziel';
                document.getElementById('projekt-status').style.color = '#38a169';
            } else {
                document.getElementById('projekt-status').textContent = 'Ziel erreicht! ğŸ‰';
                document.getElementById('projekt-status').style.color = '#48bb78';
            }
            
            // âœ… Bonus Widget mit neuer separater Funktion laden
            // await loadBonusWidget(partner); // DEAKTIVIERT
            
            console.log('ğŸ“Š Projekt-Status:', {
                modell: model,
                wochen: `${weeksPassed} / ${projekt.weeks}`,
                vertraege: `${aktuelleVertraege} / ${projekt.ziel_vertraege}`,
                provision: `${aktuelleProv.toFixed(2)}â‚¬ / ${projekt.ziel_provision}â‚¬`,
                weekProgress: `${weekProgress}% (basiert auf Wochen!)`,
                info: 'âœ… Prozent basiert jetzt auf vergangenen Wochen, nicht auf VertrÃ¤gen!'
            });
        }

        // Onboarding: Termin vereinbaren via Calendly (INLINE)
        window.openTerminModal = function() {
            // Erstelle Modal mit Calendly Embed
            const modal = document.createElement('div');
            modal.id = 'calendly-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; width: 90%; max-width: 1000px; height: 90vh; position: relative; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="padding: 20px; border-bottom: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="margin: 0; color: #1a202c; font-size: 1.5rem;"><i class="fas fa-calendar"></i> Termin vereinbaren</h2>
                        <button onclick="document.getElementById('calendly-modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096; padding: 8px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <iframe src="https://calendly.com/deincheck-info/15min?month=2025-12&hide_gdpr_banner=1" 
                            style="width: 100%; height: calc(100% - 80px); border: none;" 
                            frameborder="0"></iframe>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // SchlieÃŸen bei Klick auÃŸerhalb
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // âœ… MANUELLE BESTÃ„TIGUNG: Nach Termin-Buchung nachfragen
            // FÃ¼ge Button fÃ¼r manuelle BestÃ¤tigung hinzu
            const confirmBtn = document.createElement('button');
            confirmBtn.id = 'calendly-confirm-btn';
            confirmBtn.style.cssText = 'position: fixed; bottom: 30px; right: 30px; z-index: 10001; padding: 16px 32px; background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4); transition: all 0.3s;';
            confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Termin gebucht? â†’ Als erledigt markieren';
            confirmBtn.onmouseover = function() { this.style.transform = 'translateY(-3px)'; this.style.boxShadow = '0 15px 40px rgba(72, 187, 120, 0.5)'; };
            confirmBtn.onmouseout = function() { this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 10px 30px rgba(72, 187, 120, 0.4)'; };
            
            confirmBtn.onclick = async function() {
                const confirmed = confirm('ğŸ“… Hast du einen Termin gebucht?\n\nKlicke auf "OK" wenn du einen Termin bei Calendly vereinbart hast. Wir markieren diesen Onboarding-Schritt dann als erledigt.');
                
                if (!confirmed) return;
                
                try {
                    console.log('âœ… Partner bestÃ¤tigt: Termin gebucht!');
                    
                    const response = await fetch('tables/partners?limit=1000');
                    const result = await response.json();
                    const partner = result.data.find(p => p.email === localStorage.getItem('partnerEmail'));

                    if (partner) {
                        const updateRes = await fetch(`tables/partners/${partner.id}`, {
                            method: 'PATCH',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                onboarding_termin: true
                            })
                        });

                        if (updateRes.ok) {
                            showToast('âœ… Termin bestÃ¤tigt', 'Wir freuen uns auf das GesprÃ¤ch mit dir!', 'success');
                            
                            // Modal schlieÃŸen
                            setTimeout(() => {
                                document.getElementById('calendly-modal')?.remove();
                            }, 1500);
                            
                            // Onboarding-Widget neu laden
                            setTimeout(() => {
                                loadOnboardingStatus();
                            }, 2000);
                        } else {
                            alert('âŒ Fehler beim Speichern. Bitte versuche es erneut.');
                        }
                    }
                } catch (error) {
                    console.error('âŒ Fehler beim Speichern:', error);
                    alert('âŒ Fehler beim Speichern. Bitte versuche es erneut.');
                }
            };
            
            modal.appendChild(confirmBtn);
            
            // Entferne Button beim SchlieÃŸen des Modals
            modal.addEventListener('DOMNodeRemoved', () => {
                confirmBtn.remove();
            });
        }

        window.openDokumenteModal = async function() {
            const confirmed = confirm('ğŸ“„ Dokumente hochladen\n\nHaben Sie Ihre GeschÃ¤ftsdokumente bereits per E-Mail an uns gesendet?\n\nâ€¢ Gewerbeschein\nâ€¢ Steuernummer\nâ€¢ Handelsregisterauszug\n\nKlicken Sie auf OK, um diesen Schritt als erledigt zu markieren.');
            
            if (!confirmed) return;
            
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                const response = await fetch('tables/partners?limit=1000');
                const result = await response.json();
                const partner = result.data.find(p => p.email === partnerEmail);
                
                if (!partner) {
                    showToast('âŒ Partner nicht gefunden', 'Bitte melde dich erneut an', 'error');
                    return;
                }
                
                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        onboarding_dokumente: true,
                        dokumente_manuell_geprueft: false
                    })
                });
                
                const updatedPartner = await updateRes.json();
                showToast('âœ… Dokumente hochgeladen', 'Deine Dokumente werden von unserem Team geprÃ¼ft', 'success');
                // âœ… Onboarding-Widget neu laden
                showOnboardingWidget(updatedPartner);
            } catch (error) {
                console.error('Fehler:', error);
                alert('âŒ Fehler beim Speichern. Bitte versuchen Sie es erneut.');
            }
        }
        
        window.openAusweisModal = async function() {
            const confirmed = confirm('ğŸªª Ausweis hochladen\n\nHaben Sie Ihren Personalausweis oder Reisepass bereits per E-Mail an uns gesendet?\n\nâ€¢ Vorderseite\nâ€¢ RÃ¼ckseite\n\nKlicken Sie auf OK, um diesen Schritt als erledigt zu markieren.');
            
            if (!confirmed) return;
            
            try {
                const partnerEmail = localStorage.getItem('partnerEmail');
                const response = await fetch('tables/partners?limit=1000');
                const result = await response.json();
                const partner = result.data.find(p => p.email === partnerEmail);
                
                if (!partner) {
                    showToast('âŒ Partner nicht gefunden', 'Bitte melde dich erneut an', 'error');
                    return;
                }
                
                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        onboarding_ausweis: true,
                        ausweis_manuell_geprueft: false
                    })
                });
                
                const updatedPartner = await updateRes.json();
                showToast('âœ… Ausweis hochgeladen', 'Dein Ausweis wird von unserem Team geprÃ¼ft', 'success');
                // âœ… Onboarding-Widget neu laden
                showOnboardingWidget(updatedPartner);
            } catch (error) {
                console.error('Fehler:', error);
                showToast('âŒ Fehler beim Speichern', error.message, 'error');
            }
        }

        // ===== EINSTELLUNGEN FUNKTIONEN =====
        
        // Profil speichern (global)
        window.saveProfile = async function() {
            console.log('ğŸ’¾ saveProfile() aufgerufen!');
            const vorname = document.getElementById('settings-vorname').value.trim();
            const nachname = document.getElementById('settings-nachname').value.trim();
            const email = document.getElementById('settings-email').value.trim();
            const telefon = document.getElementById('settings-telefon').value.trim();

            if (!vorname || !nachname || !email) {
                alert('âŒ Bitte fÃ¼lle alle Pflichtfelder aus!');
                return;
            }

            try {
                // Partner in DB finden
                const partnerEmail = localStorage.getItem('partnerEmail');
                console.log('ğŸ” Suche Partner:', partnerEmail);
                
                const response = await fetch('tables/partners?limit=1000');
                const result = await response.json();
                const partner = result.data.find(p => p.email === partnerEmail);

                if (!partner) {
                    showToast('âŒ Partner nicht gefunden', 'Bitte melde dich erneut an', 'error');
                    return;
                }

                console.log('âœ… Partner gefunden:', partner.id, partner.email);

                // âœ… PrÃ¼fe ob Partner-ID existiert
                if (!partner.id) {
                    console.error('âŒ Partner-ID ist undefined!', partner);
                    showToast('âŒ Fehler', 'Partner-ID fehlt. Bitte melde dich erneut an.', 'error');
                    return;
                }

                // Daten aktualisieren
                const updateData = {
                    vorname: vorname,
                    nachname: nachname,
                    email: email,
                    telefon: telefon  // âœ… KORRIGIERT: DB-Spalte heiÃŸt "telefon"
                };
                console.log('ğŸ“¤ Sende PATCH Request:', updateData);
                console.log('ğŸ“¤ URL:', `tables/partners/${partner.id}`);
                
                // âœ… PUT statt PATCH verwenden (volle Partner-Daten)
                const partnerData = {
                    ...partner,
                    vorname: vorname,
                    nachname: nachname,
                    email: email,
                    telefon: telefon  // âœ… KORRIGIERT: DB-Spalte heiÃŸt "telefon"
                };
                delete partnerData.id;
                delete partnerData.gs_project_id;
                delete partnerData.gs_table_name;
                delete partnerData.created_at;
                delete partnerData.updated_at;
                
                console.log('ğŸ“¤ Sende PUT Request mit vollstÃ¤ndigen Daten');
                
                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(partnerData)
                });

                if (!updateRes.ok) {
                    const errorText = await updateRes.text();
                    console.error('âŒ API Error:', updateRes.status, errorText);
                    throw new Error(`HTTP ${updateRes.status}: ${errorText || updateRes.statusText}`);
                }

                showToast('âœ… Profil gespeichert', 'Deine Daten wurden aktualisiert', 'success');
                
                // ğŸ’¾ LOKAL SPEICHERN fÃ¼r Persistenz nach DB-Neustart
                if (window.LocalPersistence) {
                    await LocalPersistence.savePartner(partnerData);
                    console.log('ğŸ’¾ Profildaten auch lokal gespeichert (LocalPersistence)');
                }
                
                // Falls Email geÃ¤ndert wurde
                if (email !== localStorage.getItem('partnerEmail')) {
                    localStorage.setItem('partnerEmail', email);
                }

                // Dashboard neu laden
                loadDashboardData();

            } catch (error) {
                console.error('Fehler:', error);
                showToast('âŒ Fehler beim Speichern', error.message, 'error'); // âœ… Toast statt Alert
            }
        };

        // Bankdaten speichern (global)
        window.saveBankdaten = async function() {
            console.log('ğŸ¦ saveBankdaten() aufgerufen!');
            const iban = document.getElementById('settings-iban').value.trim();
            const kontoinhaber = document.getElementById('settings-kontoinhaber').value.trim();

            // âœ… APPLE-STYLE Validierung (schnell + inline)
            if (!iban || !kontoinhaber) {
                showToast('âŒ Felder fehlen', 'Bitte fÃ¼lle alle Felder aus', 'warning');
                return;
            }

            // IBAN Validierung (professionell wie O2/Vodafone)
            const ibanClean = iban.replace(/\s/g, '').toUpperCase();
            if (!/^[A-Z]{2}[0-9]{2}[A-Z0-9]+$/.test(ibanClean) || ibanClean.length < 15 || ibanClean.length > 34) {
                showToast('âŒ UngÃ¼ltige IBAN', 'Bitte gib eine gÃ¼ltige IBAN ein (beginnend mit DE, 22 Zeichen)', 'error');
                return;
            }

            try {
                // Partner in DB finden (schneller Cache)
                const partnerEmail = localStorage.getItem('partnerEmail');
                console.log('ğŸ” Suche Partner fÃ¼r Bankdaten:', partnerEmail);
                
                const response = await fetch(`tables/partners?limit=100&_t=${Date.now()}`, {
                    cache: 'no-store'
                });
                const result = await response.json();
                const partner = result.data.find(p => p.email === partnerEmail);

                if (!partner) {
                    showToast('âŒ Partner nicht gefunden', 'Bitte melde dich erneut an', 'error');
                    console.error('âŒ Partner nicht in DB:', partnerEmail);
                    return;
                }

                console.log('âœ… Partner gefunden:', partner.id, partner.email);

                // âœ… PrÃ¼fe ob Partner-ID existiert
                if (!partner.id) {
                    console.error('âŒ Partner-ID ist undefined!', partner);
                    showToast('âŒ Fehler', 'Partner-ID fehlt. Bitte melde dich erneut an.', 'error');
                    return;
                }

                // Bankdaten aktualisieren
                const updateData = {
                    iban: iban,
                    kontoinhaber: kontoinhaber,
                    onboarding_bank: true,
                    bankdaten_hinterlegt: true
                };
                console.log('ğŸ“¤ Sende PATCH fÃ¼r Bankdaten:', `tables/partners/${partner.id}`, updateData);
                console.log('ğŸ“¤ URL:', `tables/partners/${partner.id}`);
                
                // âœ… PUT statt PATCH verwenden (volle Partner-Daten)
                const partnerData = {
                    ...partner,
                    iban: iban,
                    kontoinhaber: kontoinhaber,
                    onboarding_bank: true,
                    bankdaten_hinterlegt: true
                };
                delete partnerData.id;
                delete partnerData.gs_project_id;
                delete partnerData.gs_table_name;
                delete partnerData.created_at;
                delete partnerData.updated_at;
                
                console.log('ğŸ“¤ Sende PUT Request mit vollstÃ¤ndigen Daten');
                
                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(partnerData)
                });

                if (!updateRes.ok) {
                    const errorText = await updateRes.text();
                    console.error('âŒ Bankdaten API Error:', updateRes.status, errorText);
                    showToast('âŒ Fehler beim Speichern', `HTTP ${updateRes.status}: ${errorText || updateRes.statusText}`, 'error');
                    return;
                }

                // âœ… Partner-Daten aus Response holen (sofort aktualisiert)
                const updatedPartner = await updateRes.json();
                console.log('âœ… Partner nach PATCH-Update:', updatedPartner);

                // ğŸ’¾ LOKAL SPEICHERN fÃ¼r Persistenz nach DB-Neustart
                if (window.LocalPersistence) {
                    await LocalPersistence.savePartner(updatedPartner);
                    console.log('ğŸ’¾ Bankdaten auch lokal gespeichert (LocalPersistence)');
                }

                // âœ… APPLE-STYLE: Toast statt Alert
                showToast('âœ… Bankdaten gespeichert', 'Deine IBAN ist jetzt hinterlegt', 'success');
                
                // âœ… Onboarding-Widget DIREKT mit neuen Daten aktualisieren
                if (typeof showOnboardingWidget === 'function') {
                    // âœ… Onboarding-Widget neu laden
                    showOnboardingWidget(updatedPartner);
                }
                
                // Modal schlieÃŸen nach Erfolg
                const modal = document.querySelector('[style*="Bankdaten"]')?.closest('[id^="modal"]');
                if (modal) modal.style.display = 'none';

            } catch (error) {
                console.error('Fehler:', error);
                showToast('âŒ Fehler beim Speichern', error.message, 'error'); // âœ… Toast statt Alert
            }
        };

        // âœ… APPLE-STYLE TOAST NOTIFICATION (wie iOS/O2/Vodafone)
        function showToast(title, message, type = 'success') {
            // Toast-Container erstellen falls nicht vorhanden
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    max-width: 400px;
                `;
                document.body.appendChild(container);
            }

            // Toast erstellen
            const toast = document.createElement('div');
            const colors = {
                success: { bg: '#48bb78', icon: 'fa-check-circle' },
                error: { bg: '#f56565', icon: 'fa-exclamation-circle' },
                info: { bg: '#4299e1', icon: 'fa-info-circle' },
                warning: { bg: '#ed8936', icon: 'fa-exclamation-triangle' }
            };
            const color = colors[type] || colors.success;

            toast.style.cssText = `
                background: white;
                border-left: 4px solid ${color.bg};
                border-radius: 12px;
                padding: 16px 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                display: flex;
                align-items: start;
                gap: 12px;
                animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                max-width: 400px;
            `;

            toast.innerHTML = `
                <div style="width: 40px; height: 40px; border-radius: 50%; background: ${color.bg}; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas ${color.icon}" style="color: white; font-size: 18px;"></i>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 600; color: #1a202c; margin-bottom: 4px; font-size: 15px;">${title}</div>
                    <div style="color: #718096; font-size: 13px; line-height: 1.4;">${message}</div>
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: #a0aec0; cursor: pointer; font-size: 18px; padding: 0; width: 24px; height: 24px; flex-shrink: 0;">
                    <i class="fas fa-times"></i>
                </button>
            `;

            container.appendChild(toast);

            // Auto-remove nach 4 Sekunden
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Toast-Animationen (Apple-Style)
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Passwort Ã¤ndern (global)
        window.changePassword = async function() {
            console.log('ğŸ” changePassword() aufgerufen!');
            const oldPassword = document.getElementById('settings-old-password').value;
            const newPassword = document.getElementById('settings-new-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;

            if (!oldPassword || !newPassword || !confirmPassword) {
                alert('âŒ Bitte fÃ¼lle alle Felder aus!');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('âŒ Die neuen PasswÃ¶rter stimmen nicht Ã¼berein!');
                return;
            }

            if (newPassword.length < 6) {
                alert('âŒ Das neue Passwort muss mindestens 6 Zeichen lang sein!');
                return;
            }

            try {
                // Partner in DB finden
                const response = await fetch('tables/partners?limit=1000');
                const result = await response.json();
                const partner = result.data.find(p => p.email === localStorage.getItem('partnerEmail'));

                if (!partner) {
                    alert('âŒ Partner nicht gefunden!');
                    return;
                }

                // Altes Passwort prÃ¼fen
                if (partner.password !== oldPassword) {
                    alert('âŒ Das alte Passwort ist falsch!');
                    return;
                }

                // Neues Passwort setzen (PUT statt PATCH)
                const partnerData = {
                    ...partner,
                    password: newPassword
                };
                delete partnerData.id;
                delete partnerData.gs_project_id;
                delete partnerData.gs_table_name;
                delete partnerData.created_at;
                delete partnerData.updated_at;
                
                const updateRes = await fetch(`tables/partners/${partner.id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(partnerData)
                });

                if (!updateRes.ok) {
                    throw new Error(`HTTP ${updateRes.status}: ${updateRes.statusText}`);
                }

                alert('âœ… Passwort erfolgreich geÃ¤ndert!');
                
                // Felder leeren
                document.getElementById('settings-old-password').value = '';
                document.getElementById('settings-new-password').value = '';
                document.getElementById('settings-confirm-password').value = '';

            } catch (error) {
                console.error('Fehler:', error);
                alert(`âŒ Fehler: ${error.message}\n\nBitte versuche es erneut.`);
            }
        };

        // Einstellungen laden (beim Ã–ffnen der Settings-Seite) (global)
        window.loadSettings = async function() {
            console.log('ğŸ“‚ loadSettings() aufgerufen!');
            
            // ğŸ§ª Demo-Modus: Demo-Daten anzeigen
            if (window.IS_DEMO_MODE) {
                console.log('ğŸ§ª Demo-Modus: Zeige Demo-Einstellungen');
                document.getElementById('settings-vorname').value = 'Demo';
                document.getElementById('settings-nachname').value = 'Partner';
                document.getElementById('settings-email').value = 'demo@test.de';
                document.getElementById('settings-telefon').value = '+49 123 456789';
                document.getElementById('settings-iban').value = '';
                document.getElementById('settings-kontoinhaber').value = '';
                return;
            }
            
            try {
                const response = await fetch('tables/partners?limit=1000');
                const result = await response.json();
                const partner = result.data.find(p => p.email === localStorage.getItem('partnerEmail'));

                if (partner) {
                    document.getElementById('settings-vorname').value = partner.vorname || '';
                    document.getElementById('settings-nachname').value = partner.nachname || '';
                    document.getElementById('settings-email').value = partner.email || '';
                    document.getElementById('settings-telefon').value = partner.telefon || partner.phone || '';
                    document.getElementById('settings-iban').value = partner.iban || '';
                    document.getElementById('settings-kontoinhaber').value = partner.kontoinhaber || '';
                    console.log('âœ… Einstellungen geladen:', partner);
                }
            } catch (error) {
                console.error('âŒ Fehler beim Laden der Einstellungen:', error);
            }
        };

        // ============================================================
        // ğŸ†•ğŸ†•ğŸ†• BRANDNEUE INIT-LOGIK (2025-12-02 - KOMPLETT NEU!)
        // ============================================================
        // âœ… LÃ–SUNG: requestAnimationFrame + setTimeout + Retry-Logik
        // ============================================================
        
        // ğŸš€ INIT-LOGIK MIT LOGIN-CHECK
        window.IS_DEMO_MODE = false;
        let dashboardInitAttempts = 0;
        
        // Haupt-Init-Funktion mit Retry
        function initDashboard() {
            dashboardInitAttempts++;
            
            console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log(`ğŸ”„ INIT-VERSUCH #${dashboardInitAttempts}`);
            console.log('ğŸ• Zeit:', new Date().toLocaleTimeString());
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
            
            // ğŸ” LOGIN CHECK - Verwende echte Email aus localStorage
            const partnerEmail = localStorage.getItem('partnerEmail');
            console.log('ğŸ” Login Check:', partnerEmail || 'âŒ NICHT GEFUNDEN');
            
            if (!partnerEmail) {
                console.log('ğŸ§ª Keine Email gefunden â†’ DEMO-MODUS aktiviert!\n');
                // KEIN REDIRECT! Demo-Modus lÃ¤uft weiter
                console.log('ğŸ“¦ Lade Demo-Daten...');
                loadDashboardData(); // Wird Demo-Modus aktivieren
                
                // âœ… 17.12.2025: Auch im Demo-Modus Kunden-VertrÃ¤ge vorab laden!
                console.log('ğŸ“¦ Lade Kunden-VertrÃ¤ge vorab (Demo-Modus)...');
                if (typeof loadKundenVertraege === 'function') {
                    loadKundenVertraege();
                }
                
                console.log('\nâœ…âœ…âœ… DEMO-MODUS INIT ERFOLGREICH!\n');
                return;
            }
            
            console.log('âœ… Login OK - Partner Email:', partnerEmail);
            console.log('ğŸ“§ Lade Daten fÃ¼r:', partnerEmail, '\n');
            
            // Element Check
            console.log('ğŸ” HTML-Elemente prÃ¼fen...');
            const elem = {
                todayProvisionen: document.getElementById('todayProvisionen'),
                yesterdayProvisionen: document.getElementById('yesterdayProvisionen'),
                monthProvisionen: document.getElementById('monthProvisionen'),
                pendingProvisionen: document.getElementById('pendingProvisionen'),
                totalVertraege: document.getElementById('totalVertraege')
            };
            
            const missing = Object.entries(elem).filter(([k,v]) => !v).map(([k]) => k);
            
            if (missing.length > 0) {
                console.error('âŒ Elemente fehlen:', missing.join(', '));
                
                if (dashboardInitAttempts < 5) {
                    const delay = dashboardInitAttempts * 300;
                    console.error(`â° Retry in ${delay}ms...\n`);
                    setTimeout(initDashboard, delay);
                } else {
                    console.error('âŒâŒâŒ ALLE VERSUCHE FEHLGESCHLAGEN!\n');
                    alert('Fehler beim Laden. Bitte neu laden (F5).');
                }
                return;
            }
            
            console.log('âœ… Alle Elemente gefunden\n');
            
            // ğŸ‘¤ Update User-Info SOFORT (vor loadDashboardData)
            console.log('ğŸ‘¤ Setze User-Info...');
            document.getElementById('userEmail').textContent = partnerEmail;
            document.getElementById('userName').textContent = 'Partner';
            const initials = partnerEmail.substring(0, 2).toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
            console.log('âœ… User-Info gesetzt:', partnerEmail, 'â†’ Avatar:', initials, '\n');
            
            // Daten laden
            console.log('ğŸ“¦ Lade Dashboard-Daten...');
            loadDashboardData();
            
            // ğŸ” AFFILIATE-CHECK: PrÃ¼fe ob Partner ein Affiliate ist
            checkAffiliateStatus(partnerEmail);
            
            console.log('ğŸ“¦ Lade Onboarding-Status...');
            loadOnboardingStatus();
            console.log('ğŸ“¦ Lade Partner-News...');
            loadPartnerNews();
            
            // âœ… 17.12.2025: Kunden-VertrÃ¤ge auch vorab laden!
            // Dies stellt sicher, dass "Meine VertrÃ¤ge" sofort Daten hat
            console.log('ğŸ“¦ Lade Kunden-VertrÃ¤ge vorab...');
            if (typeof loadKundenVertraege === 'function') {
                loadKundenVertraege();
            }
            
            console.log('\nâœ…âœ…âœ… INIT ERFOLGREICH!\n');
        }
        
        // Start bei window.load + requestAnimationFrame + setTimeout
        window.addEventListener('load', function() {
            console.log('\nğŸš€ window.onload gefeuert');
            
            // 3-Stufen-Init fÃ¼r maximale KompatibilitÃ¤t
            requestAnimationFrame(() => {
                setTimeout(initDashboard, 50);
            });
        });
        
        // ====================================
        // ğŸš« VERTRAG STORNIEREN / Ã„NDERN
        // ====================================
        let currentVertragToStornieren = null;
        
        function stornierenVertrag(vertragId) {
            currentVertragToStornieren = vertragId;
            const vertrag = alleMeineVertraege.find(v => v.id === vertragId);
            if (!vertrag) {
                alert('Vertrag nicht gefunden');
                return;
            }
            
            // Zeige Modal
            document.getElementById('modal-stornieren-overlay').style.display = 'block';
            document.getElementById('modal-stornieren').style.display = 'block';
            document.getElementById('stornieren-vertrag-info').innerHTML = `
                <strong>Vertragsnr.:</strong> #${vertragId.substring(0, 8)}<br>
                <strong>Kunde:</strong> ${vertrag.kunde_vorname} ${vertrag.kunde_nachname}<br>
                <strong>Produkt:</strong> ${vertrag.produkt}<br>
                <strong>Provision:</strong> ${(parseFloat(vertrag.provision) || parseFloat(vertrag.gesamt_provision) || 0).toFixed(2)}â‚¬
            `;
        }
        
        function closeStornierenModal() {
            document.getElementById('modal-stornieren-overlay').style.display = 'none';
            document.getElementById('modal-stornieren').style.display = 'none';
            currentVertragToStornieren = null;
            document.getElementById('stornieren-grund').value = '';
            document.getElementById('stornieren-beschreibung').value = '';
        }
        
        async function submitStornierung() {
            if (!currentVertragToStornieren) return;
            
            const grund = document.getElementById('stornieren-grund').value;
            const beschreibung = document.getElementById('stornieren-beschreibung').value;
            
            if (!grund) {
                alert('Bitte wÃ¤hle einen Grund aus.');
                return;
            }
            
            try {
                // Update Vertrag Status
                const res = await fetch(`tables/vertragsabschluesse/${currentVertragToStornieren}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        status: 'Storniert',
                        stornierung_grund: grund,
                        stornierung_beschreibung: beschreibung,
                        storniert_am: new Date().toISOString()
                    })
                });
                
                if (res.ok) {
                    // ğŸ“Š TRACKING: Stornierung tracken
                    const vertrag = alleMeineVertraege.find(v => v.id === currentVertragToStornieren);
                    if (vertrag) {
                        await trackPartnerAktivitaet(
                            'Vertrag storniert',
                            'vertrag',
                            `Grund: ${grund} - ${beschreibung || 'Keine Beschreibung'}`,
                            currentVertragToStornieren,
                            null
                        );
                    }
                    
                    alert('âœ… Vertrag wurde erfolgreich storniert!');
                    closeStornierenModal();
                    loadVertraegePage(); // Reload
                    loadDashboardData(); // Update stats
                } else {
                    alert('âŒ Fehler beim Stornieren. Bitte versuche es erneut.');
                }
            } catch (error) {
                console.error('Fehler beim Stornieren:', error);
                alert('âŒ Fehler beim Stornieren. Bitte versuche es erneut.');
            }
        }
        
        // ====================================
        // ğŸ“„ VERTRÃ„GE-SEITE LADEN
        // ====================================
        // âš ï¸ DOPPELTE loadVertraegePage(), loadDemoVertraege() UND renderVertraegeTable() FUNKTIONEN ENTFERNT
        // âœ… Die korrekte Version ist oben definiert (verwendet tbody-vertraege mit 10 Spalten)
        
        // ====================================
        // ğŸ“– FAQ FUNKTIONEN
        // ====================================
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            const icon = element.querySelector('i.fa-chevron-down');
            const isActive = answer.style.maxHeight && answer.style.maxHeight !== '0px';
            
            // Close all other FAQs
            document.querySelectorAll('.faq-answer').forEach(a => {
                a.style.maxHeight = '0';
                a.style.paddingTop = '0';
                a.style.paddingBottom = '0';
            });
            document.querySelectorAll('.faq-question i.fa-chevron-down').forEach(i => {
                i.style.transform = 'rotate(0deg)';
            });
            
            // Toggle current FAQ
            if (!isActive) {
                answer.style.maxHeight = answer.scrollHeight + 'px';
                answer.style.paddingTop = '0';
                answer.style.paddingBottom = '0';
                icon.style.transform = 'rotate(180deg)';
                element.style.borderBottomLeftRadius = '0';
                element.style.borderBottomRightRadius = '0';
            } else {
                element.style.borderRadius = '12px';
            }
        }
        
        function filterFAQCategory(category) {
            const items = document.querySelectorAll('.faq-item');
            const cards = document.querySelectorAll('.faq-category-card');
            
            // Update active card
            cards.forEach(card => {
                if (card.getAttribute('data-category') === category) {
                    card.classList.add('active');
                    card.style.background = 'linear-gradient(135deg, #3b82f6, #60a5fa)';
                    card.style.color = 'white';
                    card.style.border = 'none';
                    card.style.boxShadow = '0 4px 12px rgba(59,130,246,0.3)';
                } else {
                    card.classList.remove('active');
                    card.style.background = 'white';
                    card.style.color = '';
                    card.style.border = '2px solid var(--border)';
                    card.style.boxShadow = 'none';
                }
            });
            
            // Filter items
            items.forEach(item => {
                const itemCategory = item.getAttribute('data-category');
                if (category === 'alle' || itemCategory === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Close all answers
            document.querySelectorAll('.faq-answer').forEach(a => {
                a.style.maxHeight = '0';
            });
            document.querySelectorAll('.faq-question i.fa-chevron-down').forEach(i => {
                i.style.transform = 'rotate(0deg)';
            });
        }
        
        function filterFAQ() {
            const searchTerm = document.getElementById('faq-search').value.toLowerCase();
            const items = document.querySelectorAll('.faq-item');
            
            items.forEach(item => {
                const question = item.querySelector('.faq-question span').textContent.toLowerCase();
                const answer = item.querySelector('.faq-answer').textContent.toLowerCase();
                
                if (question.includes(searchTerm) || answer.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    </script>
    
    <!-- Modal: Vertrag stornieren -->
    <div id="modal-stornieren-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 9998;"></div>
    <div id="modal-stornieren" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 16px; padding: 2rem; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); z-index: 9999; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin: 0; font-size: 1.5rem; color: #2d3748;">ğŸš« Vertrag stornieren</h2>
            <button onclick="closeStornierenModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #a0aec0;">&times;</button>
        </div>
        
        <div id="stornieren-vertrag-info" style="background: #f7fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; font-size: 0.9rem; color: #4a5568; line-height: 1.6;"></div>
        
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2d3748;">Grund fÃ¼r Stornierung *</label>
            <select id="stornieren-grund" style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; transition: border 0.2s;">
                <option value="">-- Bitte auswÃ¤hlen --</option>
                <option value="Kunde hat storniert">Kunde hat storniert</option>
                <option value="Kunde ist umgezogen">Kunde ist umgezogen</option>
                <option value="Technische Probleme">Technische Probleme</option>
                <option value="Falscher Tarif">Falscher Tarif</option>
                <option value="Zu teuer">Zu teuer</option>
                <option value="Widerruf">Widerruf (14 Tage Frist)</option>
                <option value="Sonstiges">Sonstiges</option>
            </select>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2d3748;">ZusÃ¤tzliche Beschreibung (optional)</label>
            <textarea id="stornieren-beschreibung" rows="4" placeholder="Weitere Details zur Stornierung..." style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: border 0.2s; resize: vertical;"></textarea>
        </div>
        
        <div style="background: #fff5f5; border-left: 4px solid #fc8181; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
            <p style="margin: 0; color: #c53030; font-size: 0.9rem; font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> Wichtig:</p>
            <p style="margin: 0.5rem 0 0 0; color: #742a2a; font-size: 0.85rem;">Die Stornierung ist endgÃ¼ltig und kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Die Provision wird auf "0â‚¬" gesetzt.</p>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button onclick="closeStornierenModal()" style="flex: 1; padding: 0.75rem; background: #e2e8f0; color: #2d3748; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                Abbrechen
            </button>
            <button onclick="submitStornierung()" style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #fc8181, #f56565); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(252, 129, 129, 0.3);">
                <i class="fas fa-ban"></i> Vertrag stornieren
            </button>
        </div>
    </div>
    
    <!-- ğŸ« Ticket Modal -->
    <div id="ticket-modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9998;" onclick="closeTicketModal()"></div>
    <div id="ticket-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; width: 90%; max-width: 600px; max-height: 85vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.4); z-index: 9999;">
        <div style="padding: 2rem; border-bottom: 2px solid #e2e8f0; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; border-radius: 20px 20px 0 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.5rem;"><i class="fas fa-ticket-alt"></i> Support Ticket erstellen</h2>
                <button onclick="closeTicketModal()" style="background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; color: white; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">&times;</button>
            </div>
        </div>
        
        <div style="padding: 2rem;">
            <form id="ticket-form" onsubmit="submitTicket(event)">
                <!-- Betreff -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 700; color: #2d3748;">Betreff *</label>
                    <input type="text" id="ticket-betreff" required placeholder="z.B. Problem mit Vertragsabschluss" style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.95rem; transition: border 0.2s;" onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e2e8f0'">
                </div>
                
                <!-- Kategorie -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 700; color: #2d3748;">Kategorie *</label>
                    <select id="ticket-kategorie" required style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.95rem; transition: border 0.2s;" onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e2e8f0'">
                        <option value="">-- Bitte auswÃ¤hlen --</option>
                        <option value="Technisches Problem">ğŸ”§ Technisches Problem</option>
                        <option value="VertrÃ¤ge">ğŸ“„ VertrÃ¤ge</option>
                        <option value="Provisionen">ğŸ’° Provisionen</option>
                        <option value="Akademie">ğŸ“ Akademie</option>
                        <option value="Account">ğŸ‘¤ Account / Login</option>
                        <option value="Sonstiges">â“ Sonstiges</option>
                    </select>
                </div>
                
                <!-- PrioritÃ¤t -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 700; color: #2d3748;">PrioritÃ¤t *</label>
                    <select id="ticket-prioritaet" required style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.95rem; transition: border 0.2s;" onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e2e8f0'">
                        <option value="niedrig">ğŸŸ¢ Niedrig</option>
                        <option value="mittel" selected>ğŸŸ¡ Mittel</option>
                        <option value="hoch">ğŸ”´ Hoch</option>
                    </select>
                </div>
                
                <!-- Nachricht -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 700; color: #2d3748;">Nachricht *</label>
                    <textarea id="ticket-nachricht" required rows="6" placeholder="Beschreibe dein Problem so detailliert wie mÃ¶glich..." style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.95rem; font-family: inherit; transition: border 0.2s; resize: vertical;" onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e2e8f0'"></textarea>
                </div>
                
                <!-- Info Box -->
                <div style="background: #e6f2ff; border-left: 4px solid #4299e1; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                    <p style="margin: 0; color: #2c5282; font-size: 0.9rem;"><i class="fas fa-info-circle"></i> <strong>Tipp:</strong> Je detaillierter deine Beschreibung, desto schneller kÃ¶nnen wir dir helfen!</p>
                </div>
                
                <!-- Buttons -->
                <div style="display: flex; gap: 1rem;">
                    <button type="button" onclick="closeTicketModal()" style="flex: 1; padding: 0.75rem; background: #e2e8f0; color: #2d3748; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.2s;">
                        Abbrechen
                    </button>
                    <button type="submit" style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(59,130,246,0.3);">
                        <i class="fas fa-paper-plane"></i> Ticket absenden
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // ====================================
        // ğŸ« TICKET MODAL FUNKTIONEN
        // ====================================
        function openTicketModal() {
            document.getElementById('ticket-modal-overlay').style.display = 'block';
            document.getElementById('ticket-modal').style.display = 'block';
        }
        
        function closeTicketModal() {
            document.getElementById('ticket-modal-overlay').style.display = 'none';
            document.getElementById('ticket-modal').style.display = 'none';
            document.getElementById('ticket-form').reset();
        }
        
        async function submitTicket(event) {
            event.preventDefault();
            
            const betreff = document.getElementById('ticket-betreff').value;
            const kategorie = document.getElementById('ticket-kategorie').value;
            const prioritaet = document.getElementById('ticket-prioritaet').value;
            const nachricht = document.getElementById('ticket-nachricht').value;
            const partnerEmail = localStorage.getItem('partnerEmail');
            
            if (!partnerEmail) {
                alert('âŒ Fehler: Partner-Email nicht gefunden. Bitte neu einloggen.');
                return;
            }
            
            try {
                // Ticket-Nummer generieren
                const ticketNr = 'T' + Date.now().toString().substring(-6);
                
                const res = await fetch('tables/tickets', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        ticket_nr: ticketNr,
                        partner_email: partnerEmail,
                        partner_name: localStorage.getItem('partnerName') || 'Unbekannt',
                        betreff: betreff,
                        kategorie: kategorie,
                        prioritaet: prioritaet,
                        nachricht: nachricht,
                        status: 'offen',
                        erstellt_am: new Date().toISOString()
                    })
                });
                
                if (res.ok) {
                    alert('âœ… Ticket erfolgreich erstellt!\n\nTicket-Nr: ' + ticketNr + '\n\nWir melden uns schnellstmÃ¶glich bei dir!');
                    closeTicketModal();
                } else {
                    alert('âŒ Fehler beim Erstellen des Tickets. Bitte versuche es erneut.');
                }
            } catch (error) {
                console.error('Fehler beim Erstellen des Tickets:', error);
                alert('âŒ Fehler beim Erstellen des Tickets. Bitte versuche es erneut.');
            }
        }

        // ====================================
        // ğŸ“… PARTNER TERMINE & KALENDER
        // ====================================
        let partnerCurrentMonth = new Date().getMonth();
        let partnerCurrentYear = new Date().getFullYear();
        let partnerAllTermine = [];

        async function loadPartnerTermine() {
            try {
                console.log('ğŸ“… Lade Partner-Termine...');
                const partnerEmail = localStorage.getItem('partnerEmail');
                if (!partnerEmail) {
                    console.log('âš ï¸ Keine Partner-E-Mail gefunden');
                    return;
                }

                const res = await fetch('tables/termine?limit=100&sort=-datum');
                const data = await res.json();
                
                // Nur Termine des Partners
                partnerAllTermine = data.data.filter(t => t.partner_email === partnerEmail);
                
                console.log('âœ… Partner-Termine geladen:', partnerAllTermine.length);
                
                // Kalender rendern
                renderPartnerCalendar();
                
                // Termine-Liste rendern
                renderPartnerTermineListe();
                
                // Tabelle rendern
                renderPartnerTermineTabelle();
                
            } catch (error) {
                console.error('âŒ Fehler beim Laden der Partner-Termine:', error);
                document.getElementById('partner-termineTable').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #f56565;">Fehler beim Laden der Termine</td></tr>';
            }
        }

        function renderPartnerCalendar() {
            const monthNames = ['Januar', 'Februar', 'MÃ¤rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            const dayNames = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            
            // Header aktualisieren
            document.getElementById('partner-calendar-header').textContent = `${monthNames[partnerCurrentMonth]} ${partnerCurrentYear}`;
            
            // Kalender Grid
            const grid = document.getElementById('partner-calendar-grid');
            grid.innerHTML = '';
            
            // Wochentage
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.cssText = 'text-align: center; font-weight: 700; color: var(--primary); padding: 8px; font-size: 12px;';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Erster Tag des Monats
            const firstDay = new Date(partnerCurrentYear, partnerCurrentMonth, 1);
            let startDay = firstDay.getDay();
            if (startDay === 0) startDay = 7;
            startDay -= 1;
            
            // Leere Zellen am Anfang
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.style.cssText = 'padding: 12px; text-align: center;';
                grid.appendChild(emptyDay);
            }
            
            // Tage des Monats
            const daysInMonth = new Date(partnerCurrentYear, partnerCurrentMonth + 1, 0).getDate();
            const today = new Date();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(partnerCurrentYear, partnerCurrentMonth, day);
                
                // Termine an diesem Tag
                const termineToday = partnerAllTermine.filter(t => {
                    const tDate = new Date(t.datum);
                    return tDate.getDate() === day && 
                           tDate.getMonth() === partnerCurrentMonth && 
                           tDate.getFullYear() === partnerCurrentYear;
                });
                
                // Style
                const isToday = today.getDate() === day && 
                               today.getMonth() === partnerCurrentMonth && 
                               today.getFullYear() === partnerCurrentYear;
                
                dayCell.style.cssText = `
                    padding: 12px 8px;
                    text-align: center;
                    border-radius: 8px;
                    cursor: pointer;
                    transition: all 0.2s;
                    background: ${isToday ? 'var(--primary)' : (termineToday.length > 0 ? 'var(--bg-light)' : 'white')};
                    color: ${isToday ? 'white' : 'var(--text)'};
                    border: ${termineToday.length > 0 ? '2px solid var(--primary)' : '1px solid var(--border)'};
                    font-weight: ${isToday || termineToday.length > 0 ? '700' : '400'};
                `;
                
                dayCell.onmouseover = () => {
                    if (!isToday) {
                        dayCell.style.background = 'var(--bg-light)';
                        dayCell.style.borderColor = 'var(--primary)';
                    }
                };
                dayCell.onmouseout = () => {
                    if (!isToday) {
                        dayCell.style.background = termineToday.length > 0 ? 'var(--bg-light)' : 'white';
                        dayCell.style.borderColor = termineToday.length > 0 ? 'var(--primary)' : 'var(--border)';
                    }
                };
                
                dayCell.innerHTML = `
                    <div style="font-size: 14px; margin-bottom: 4px;">${day}</div>
                    ${termineToday.length > 0 ? `<div style="font-size: 10px; color: ${isToday ? 'white' : 'var(--primary)'};">${termineToday.length} Termin${termineToday.length > 1 ? 'e' : ''}</div>` : ''}
                `;
                
                grid.appendChild(dayCell);
            }
        }

        function partnerChangeMonth(direction) {
            partnerCurrentMonth += direction;
            if (partnerCurrentMonth > 11) {
                partnerCurrentMonth = 0;
                partnerCurrentYear++;
            } else if (partnerCurrentMonth < 0) {
                partnerCurrentMonth = 11;
                partnerCurrentYear--;
            }
            renderPartnerCalendar();
        }

        function renderPartnerTermineListe() {
            const liste = document.getElementById('partner-termine-liste');
            
            // Nur zukÃ¼nftige Termine
            const now = new Date();
            const zukunftige = partnerAllTermine
                .filter(t => new Date(t.datum) >= now)
                .sort((a, b) => new Date(a.datum) - new Date(b.datum))
                .slice(0, 5);
            
            if (zukunftige.length === 0) {
                liste.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-light);">
                        <i class="fas fa-calendar-check" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>Keine kommenden Termine</p>
                    </div>
                `;
                return;
            }
            
            liste.innerHTML = zukunftige.map(termin => {
                const date = new Date(termin.datum);
                const statusColors = {
                    'geplant': '#3b82f6',
                    'bestaetigt': '#48bb78',
                    'abgesagt': '#f56565'
                };
                const color = statusColors[termin.status] || '#718096';
                
                return `
                    <div style="padding: 16px; background: white; border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s;" 
                         onmouseover="this.style.borderColor='${color}'" 
                         onmouseout="this.style.borderColor='var(--border)'">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div style="font-weight: 700; color: var(--text); font-size: 15px;">${termin.titel || 'Ohne Titel'}</div>
                            <div style="background: ${color}20; color: ${color}; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600;">
                                ${termin.status || 'geplant'}
                            </div>
                        </div>
                        <div style="display: flex; gap: 16px; font-size: 13px; color: var(--text-light);">
                            <span><i class="fas fa-calendar"></i> ${date.toLocaleDateString('de-DE')}</span>
                            <span><i class="fas fa-clock"></i> ${termin.uhrzeit || 'â€”'}</span>
                            ${termin.ort ? `<span><i class="fas fa-map-marker-alt"></i> ${termin.ort}</span>` : ''}
                        </div>
                        ${termin.beschreibung ? `<div style="margin-top: 8px; font-size: 13px; color: var(--text-light);">${termin.beschreibung}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderPartnerTermineTabelle() {
            const tbody = document.getElementById('partner-termineTable');
            
            if (partnerAllTermine.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-light);">Keine Termine vorhanden</td></tr>';
                return;
            }
            
            tbody.innerHTML = partnerAllTermine.map(termin => {
                const date = new Date(termin.datum);
                const statusColors = {
                    'geplant': 'info',
                    'bestaetigt': 'success',
                    'abgesagt': 'danger'
                };
                
                return `
                    <tr style="cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--bg-light)'" onmouseout="this.style.background='white'">
                        <td>${date.toLocaleDateString('de-DE')}</td>
                        <td>${termin.uhrzeit || 'â€”'}</td>
                        <td><strong>${termin.titel || 'Ohne Titel'}</strong></td>
                        <td><span class="badge badge-${statusColors[termin.typ] || 'info'}">${termin.typ || 'Meeting'}</span></td>
                        <td><span class="badge badge-${statusColors[termin.status] || 'secondary'}">${termin.status || 'geplant'}</span></td>
                        <td>
                            ${termin.ort ? `<small style="color: var(--text-light);"><i class="fas fa-map-marker-alt"></i> ${termin.ort}</small>` : 'â€”'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // âœ… Alte prompt()-Funktion entfernt - jetzt nutzen wir das Apple-Style Modal!

        // Auto-Load bei Page-Wechsel
        const originalShowPage = window.showPage;
        window.showPage = function(pageName) {
            if (originalShowPage) originalShowPage(pageName);
            
            if (pageName === 'kalender') {
                loadPartnerTermine();
            }
        };
    </script>
    
    <!-- MODAL: Neuer Termin (Partner) -->
    <div id="modal-neuer-termin-partner" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(4px);">
        <div style="background: white; border-radius: 16px; padding: 0; max-width: 600px; width: 90%; max-height: 90vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); padding: 32px; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="margin: 0; font-size: 28px; font-weight: 700;">
                        <i class="fas fa-calendar-plus"></i> Neuer Termin
                    </h3>
                    <button onclick="closeModalPartnerTermin()" style="background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; color: white; font-size: 20px; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div style="padding: 32px; max-height: calc(90vh - 140px); overflow-y: auto;">
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; font-size: 14px;">Titel*</label>
                        <input type="text" id="termin-titel" placeholder="z.B. Schulung, Meeting, etc." style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px;" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; font-size: 14px;">Datum*</label>
                            <input type="date" id="termin-datum" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px; cursor: pointer;" required>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; font-size: 14px;">Uhrzeit*</label>
                            <input type="time" id="termin-uhrzeit" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px; cursor: pointer;" required>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4a5568; font-size: 14px;">Beschreibung</label>
                        <textarea id="termin-beschreibung" placeholder="Optional..." style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px; min-height: 100px; resize: vertical;"></textarea>
                    </div>
                </div>

                <!-- Buttons -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 24px; border-top: 1px solid #e2e8f0; margin-top: 24px;">
                    <button onclick="closeModalPartnerTermin()" style="padding: 12px 24px; background: #e2e8f0; color: #4a5568; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#cbd5e0'" onmouseout="this.style.background='#e2e8f0'">
                        Abbrechen
                    </button>
                    <button onclick="speicherePartnerTermin()" style="padding: 12px 24px; background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 18px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'">
                        <i class="fas fa-check"></i> Termin erstellen
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // ğŸ“… PARTNER TERMIN FUNKTIONEN
    function openNeuerPartnerTerminModal() {
        document.getElementById('modal-neuer-termin-partner').style.display = 'flex';
        // Felder zurÃ¼cksetzen
        document.getElementById('termin-titel').value = '';
        document.getElementById('termin-datum').value = '';
        document.getElementById('termin-uhrzeit').value = '';
        // âœ… Typ-Feld entfernt
        document.getElementById('termin-beschreibung').value = '';
        
        // Heutiges Datum als Standard
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('termin-datum').value = today;
    }
    
    function closeModalPartnerTermin() {
        document.getElementById('modal-neuer-termin-partner').style.display = 'none';
    }
    
    async function speicherePartnerTermin() {
        try {
            const titel = document.getElementById('termin-titel').value.trim();
            const datum = document.getElementById('termin-datum').value;
            const uhrzeit = document.getElementById('termin-uhrzeit').value;
            // âœ… Typ entfernt - nur private Termine
            const beschreibung = document.getElementById('termin-beschreibung').value.trim();
            
            // Validierung
            if (!titel) {
                alert('âŒ Bitte gib einen Titel ein!');
                return;
            }
            if (!datum) {
                alert('âŒ Bitte wÃ¤hle ein Datum!');
                return;
            }
            if (!uhrzeit) {
                alert('âŒ Bitte wÃ¤hle eine Uhrzeit!');
                return;
            }
            
            const partnerEmail = localStorage.getItem('partnerEmail');
            const partnerName = localStorage.getItem('partnerName') || 'Partner';
            
            // Termin speichern
            const response = await fetch('tables/termine', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    titel: titel,
                    datum: datum,
                    uhrzeit: uhrzeit,
                    typ: 'Privat', // âœ… Fest auf 'Privat' gesetzt
                    beschreibung: beschreibung,
                    partner_email: partnerEmail,
                    partner_name: partnerName,
                    status: 'geplant',
                    erstellt_am: Date.now()
                })
            });
            
            if (!response.ok) {
                throw new Error('Fehler beim Speichern');
            }
            
            // Erfolgsmeldung
            alert(`âœ… Termin "${titel}" erfolgreich erstellt!\n\nDatum: ${new Date(datum).toLocaleDateString('de-DE')}\nUhrzeit: ${uhrzeit}`);
            
            // Modal schlieÃŸen & Termine neu laden
            closeModalPartnerTermin();
            loadPartnerTermine();
            renderPartnerCalendar();
            
        } catch (error) {
            console.error('Fehler beim Speichern des Termins:', error);
            alert('âŒ Fehler beim Erstellen des Termins!\n\n' + error.message);
        }
    }
    </script>

    <!-- ===================================== -->
    <!-- ğŸ“„ SEITEN-NAVIGATION & PROVISIONS -->
    <!-- ===================================== -->
    <script>
    // ===========================
    // ğŸ”„ SEITEN-NAVIGATION (FINALE VERSION)
    // ===========================
    window.showPage = function(pageName, event) {
        console.log(`ğŸ“„ showPage('${pageName}') aufgerufen`);
        
        // ğŸ“± MOBILE: Sidebar schlieÃŸen
        if (window.isMobile && window.isMobile()) {
            window.closeMobileSidebar();
        }
        
        // Alle Seiten ausblenden
        document.querySelectorAll('.page-section').forEach(page => {
            page.style.display = 'none';
            page.classList.remove('active');
        });
        
        // GewÃ¤hlte Seite anzeigen
        const targetPage = document.getElementById(`page-${pageName}`);
        if (targetPage) {
            targetPage.style.display = 'block';
            console.log(`âœ… Seite '${pageName}' angezeigt`);
            
            // Seiten-spezifische Initialisierung
            if (pageName === 'provisionen') {
                loadProvisionenPage();
            } else if (pageName === 'meine-vertraege') {
                // âœ… FIX: BEIDE VertrÃ¤ge-Ansichten laden (Tabelle + Kunden-Karten)
                console.log('ğŸ“„ Meine VertrÃ¤ge ausgewÃ¤hlt - lade ALLE Ansichten...');
                // Cache zurÃ¼cksetzen fÃ¼r frische Daten
                window.allePartnerVertraege = null;
                // Tabellen-Ansicht laden
                if (typeof loadVertraegePage === 'function') loadVertraegePage();
                // Kunden-Karten-Ansicht laden
                if (typeof loadKundenVertraege === 'function') loadKundenVertraege();
            } else if (pageName === 'dashboard') {
                // Dashboard-Daten aktualisieren
                if (typeof loadDashboardData === 'function') {
                    loadDashboardData();
                }
            }
        } else {
            console.error(`âŒ Seite 'page-${pageName}' nicht gefunden!`);
        }
        
        // Navigation-Highlights aktualisieren
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        if (event && event.target) {
            event.target.closest('.nav-item')?.classList.add('active');
        } else {
            // Finde den passenden Nav-Item
            document.querySelectorAll('.nav-item').forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick && onclick.includes(`'${pageName}'`)) {
                    item.classList.add('active');
                }
            });
        }
        
        // ğŸ“± MOBILE: Scroll nach oben
        window.scrollTo(0, 0);
        document.querySelector('.main-content')?.scrollTo(0, 0);
    }

    // ===========================
    // ğŸ’° HINWEIS: loadProvisionenPage() ist jetzt oben bei "Bonus & Ziele" definiert
    // Die Statistik-Karten wurden zu "Meine VertrÃ¤ge" verschoben (17.12.2025)
    // ===========================
    </script>

    <!-- ğŸ‰ GLÃœCKWUNSCH-POPUP MIT KONFETTI -->
    <div id="achievement-popup" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 99999; align-items: center; justify-content: center; backdrop-filter: blur(8px);">
        <div style="background: white; border-radius: 24px; padding: 50px; max-width: 550px; text-align: center; box-shadow: 0 30px 80px rgba(0,0,0,0.5); animation: popupBounce 0.5s ease-out;">
            <div style="font-size: 100px; margin-bottom: 24px; animation: celebration 1s ease-in-out infinite;">ğŸ‰</div>
            <h2 id="achievement-title" style="font-size: 32px; font-weight: 800; color: #1a202c; margin-bottom: 20px; letter-spacing: -0.5px;"></h2>
            <p id="achievement-text" style="font-size: 19px; color: #4a5568; margin-bottom: 35px; line-height: 1.7;"></p>
            <button onclick="closeAchievementPopup()" style="padding: 16px 40px; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.5)'">
                Weiter so! ğŸ’ª
            </button>
        </div>
    </div>

    <style>
        @keyframes popupBounce {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes celebration {
            0%, 100% { transform: rotate(-5deg) scale(1); }
            50% { transform: rotate(5deg) scale(1.1); }
        }
    </style>

    <!-- Konfetti-Bibliothek -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
    // âœ… ACHIEVEMENTS-SYSTEM
    function getAchievements() {
        const stored = localStorage.getItem('achievements');
        return stored ? JSON.parse(stored) : {
            firstContract: false,
            firstGoal: false,
            certificates: []
        };
    }

    function saveAchievements(achievements) {
        localStorage.setItem('achievements', JSON.stringify(achievements));
    }

    async function checkAchievements() {
        const achievements = getAchievements();
        const partnerEmail = localStorage.getItem('partnerEmail');
        if (!partnerEmail) return;
        
        try {
            // VertrÃ¤ge laden
            const vertraegeRes = await fetch(`tables/vertragsabschluesse?limit=1000`);
            const allVertraege = (await vertraegeRes.json()).data || [];
            const vertraege = allVertraege.filter(v => v.partner_email && v.partner_email.toLowerCase() === partnerEmail.toLowerCase());
            
            // 1ï¸âƒ£ ERSTER VERTRAG
            if (!achievements.firstContract && vertraege.length >= 1) {
                achievements.firstContract = true;
                saveAchievements(achievements);
                showAchievement('ğŸ‰ GlÃ¼ckwunsch!', 'Du hast deinen ersten Vertrag abgeschlossen! Das ist der Anfang deiner Erfolgsgeschichte!');
                return;
            }
            
            // 2ï¸âƒ£ ERSTES ZIEL (Staffel 1)
            if (!achievements.firstGoal) {
                const mobilfunk = vertraege.filter(v => {
                    const p = (v.produkt || v.anbieter || v.kategorie || '').toUpperCase();
                    return p.includes('MOBILFUNK') || p.includes('FREENET') || p.includes('AYILDIZ') || p.includes('VODAFONE') || p.includes('TELEKOM') || p.includes('O2');
                }).length;
                
                if (mobilfunk >= 10) {
                    achievements.firstGoal = true;
                    saveAchievements(achievements);
                    showAchievement('ğŸ† Staffel 1 erreicht!', 'Du hast 10 Mobilfunk-VertrÃ¤ge geschafft! 300â‚¬ Bonus warten auf dich!');
                    return;
                }
            }
            
            // 3ï¸âƒ£ ZERTIFIKATE
            const zertRes = await fetch(`tables/zertifikate?limit=100`);
            const allZertifikate = (await zertRes.json()).data || [];
            const zertifikate = allZertifikate.filter(z => z.partner_email && z.partner_email.toLowerCase() === partnerEmail.toLowerCase());
            
            for (const zert of zertifikate) {
                if (!achievements.certificates.includes(zert.id)) {
                    achievements.certificates.push(zert.id);
                    saveAchievements(achievements);
                    showAchievement('ğŸ“œ Zertifikat erhalten!', `Herzlichen GlÃ¼ckwunsch! Du hast das Zertifikat "${zert.modul_name}" erfolgreich abgeschlossen!`);
                    return;
                }
            }
            
        } catch (error) {
            console.error('âŒ Fehler beim PrÃ¼fen der Achievements:', error);
        }
    }

    function showAchievement(title, text) {
        document.getElementById('achievement-title').textContent = title;
        document.getElementById('achievement-text').textContent = text;
        document.getElementById('achievement-popup').style.display = 'flex';
        
        // ğŸŠ KONFETTI-SHOW!
        confetti({
            particleCount: 200,
            spread: 80,
            origin: { y: 0.6 },
            colors: ['#3b82f6', '#60a5fa', '#ff6b6b', '#feca57', '#48dbfb']
        });
        
        setTimeout(() => {
            confetti({
                particleCount: 100,
                spread: 60,
                origin: { x: 0.2, y: 0.5 },
                colors: ['#3b82f6', '#60a5fa', '#ff6b6b']
            });
        }, 250);
        
        setTimeout(() => {
            confetti({
                particleCount: 100,
                spread: 60,
                origin: { x: 0.8, y: 0.5 },
                colors: ['#feca57', '#48dbfb', '#1dd1a1']
            });
        }, 500);
    }

    function closeAchievementPopup() {
        document.getElementById('achievement-popup').style.display = 'none';
    }

    // âœ… Bei Dashboard-Load und alle 60 Sekunden prÃ¼fen
    if (typeof checkAchievements === 'function') {
        checkAchievements(); // Sofort
        setInterval(checkAchievements, 60000); // Alle 60 Sekunden
    }

    // ===========================
    // ğŸ”¥ DASHBOARD-DATEN LADEN (INKL. DEMO-MODUS)
    // ===========================
    let _dashboardLoadInProgress = false;
    let _lastDashboardLoad = 0;
    
    async function loadDashboardData() {
        // Verhindere doppelte Aufrufe
        const now = Date.now();
        if (_dashboardLoadInProgress || (now - _lastDashboardLoad < 2000)) {
            console.log('â³ loadDashboardData() Ã¼bersprungen - bereits am Laden oder kÃ¼rzlich geladen');
            return;
        }
        _dashboardLoadInProgress = true;
        _lastDashboardLoad = now;
        
        console.log('ğŸ“Š loadDashboardData() [Version 2] gestartet!');
        
        // âœ… MEHRERE MÃ–GLICHE EMAIL-KEYS PRÃœFEN
        let partnerEmail = localStorage.getItem('partnerEmail');
        if (!partnerEmail) partnerEmail = localStorage.getItem('userEmail');
        if (!partnerEmail) partnerEmail = localStorage.getItem('email');
        
        // Auch aus partnerData extrahieren
        if (!partnerEmail) {
            try {
                const partnerData = JSON.parse(localStorage.getItem('partnerData') || '{}');
                partnerEmail = partnerData.email || partnerData.partner_email;
            } catch(e) {}
        }
        
        console.log('ğŸ“§ Gefundene Email:', partnerEmail || 'âŒ KEINE');
        console.log('ğŸ” localStorage Keys:', Object.keys(localStorage));
        
        // âœ… DEMO-MODUS wenn keine Email vorhanden
        if (!partnerEmail) {
            console.log('ğŸ§ª DEMO-MODUS: Keine Email gefunden, lade Test-Daten...');
            loadDemoData();
            return;
        }
        
        try {
            // âœ… WICHTIG: VertrÃ¤ge laden (max 1000 pro Request)
            const response = await fetch('tables/vertragsabschluesse?limit=1000');
            const result = await response.json();
            
            // âœ… CASE-INSENSITIVE Filter fÃ¼r Partner-Email
            const emailLower = partnerEmail.toLowerCase();
            let alleVertraege = result.data || [];
            
            console.log(`ğŸ“Š ALLE VertrÃ¤ge in DB: ${alleVertraege.length}`);
            
            // ğŸ’¾ LOKALER CACHE via LocalPersistence: Wenn DB VertrÃ¤ge hat, lokal speichern
            if (alleVertraege.length > 0 && window.LocalPersistence) {
                LocalPersistence._setCache(LocalPersistence.CACHE_KEYS.VERTRAEGE, alleVertraege);
                console.log('ğŸ’¾ VertrÃ¤ge via LocalPersistence gecached!');
            } else if (alleVertraege.length > 0) {
                // Fallback auf alten Cache
                localStorage.setItem('cachedVertraege_' + emailLower, JSON.stringify(alleVertraege.filter(v => 
                    v.partner_email && v.partner_email.toLowerCase() === emailLower
                )));
                localStorage.setItem('cachedVertraege_timestamp', Date.now().toString());
                console.log('ğŸ’¾ VertrÃ¤ge lokal gecached (Fallback)!');
            }
            
            // ğŸ’¾ FALLBACK: Wenn DB leer, versuche lokalen Cache
            if (alleVertraege.length === 0) {
                console.log('âš ï¸ DB leer - versuche lokalen Cache...');
                try {
                    // Zuerst LocalPersistence Cache prÃ¼fen
                    if (window.LocalPersistence) {
                        const lpCache = LocalPersistence._getCache(LocalPersistence.CACHE_KEYS.VERTRAEGE);
                        if (lpCache && lpCache.length > 0) {
                            console.log('âœ… LocalPersistence Cache gefunden:', lpCache.length, 'VertrÃ¤ge');
                            alleVertraege = lpCache;
                            
                            // Automatisch in DB wiederherstellen
                            LocalPersistence.restoreVertraegeToDatabase(lpCache);
                        }
                    }
                    
                    // Fallback auf alten Cache
                    if (alleVertraege.length === 0) {
                        const cached = localStorage.getItem('cachedVertraege_' + emailLower);
                        if (cached) {
                            const cachedData = JSON.parse(cached);
                            if (cachedData && cachedData.length > 0) {
                                console.log('âœ… Lokaler Cache gefunden:', cachedData.length, 'VertrÃ¤ge');
                                alleVertraege = cachedData;
                            }
                        }
                    }
                } catch(e) {
                    console.log('âŒ Cache-Fehler:', e);
                }
            }
            
            if (alleVertraege.length > 0) {
                console.log('ğŸ“„ Erster Vertrag:', alleVertraege[0]);
            }
            
            const meineVertraege = alleVertraege.filter(v => 
                v.partner_email && v.partner_email.toLowerCase() === emailLower
            );
            console.log(`âœ… ${meineVertraege.length} VertrÃ¤ge fÃ¼r ${partnerEmail}`);
            
            // Debug: Zeige ersten Vertrag
            if (meineVertraege.length > 0) {
                console.log('ğŸ“„ Mein Vertrag:', meineVertraege[0]);
                console.log('ğŸ’° Provision:', meineVertraege[0].gesamt_provision || meineVertraege[0].provision);
                console.log('ğŸ“… Datum:', meineVertraege[0].erstellt_am || meineVertraege[0].created_at);
            } else {
                console.log('âŒ KEINE VERTRÃ„GE fÃ¼r diese Email gefunden!');
            }
            
            // âœ… HELPER: Provision aus verschiedenen Feldern holen
            const getProvision = (v) => {
                return parseFloat(v.gesamt_provision) || 
                       parseFloat(v.provision) || 
                       parseFloat(v.provision_betrag) || 0;
            };
            
            // âœ… HELPER: Datum aus verschiedenen Feldern holen
            const getDatum = (v) => {
                const d = v.erstellt_am || v.created_at || v.datum;
                if (!d) return null;
                try {
                    return new Date(d);
                } catch {
                    return null;
                }
            };
            
            // Stats berechnen
            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterdayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            let todayProv = 0, todayContracts = 0;
            let yesterdayProv = 0, yesterdayContracts = 0;
            let monthProv = 0, pendingProv = 0, totalContracts = 0;
            let totalProv = 0;
            
            meineVertraege.forEach(v => {
                const provision = getProvision(v);
                const datum = getDatum(v);
                const status = (v.vertrag_status || v.status || '').toLowerCase();
                
                totalContracts++;
                totalProv += provision;
                
                if (datum) {
                    // Heute
                    if (datum >= todayStart) {
                        todayProv += provision;
                        todayContracts++;
                    }
                    // Gestern (zwischen gestern 00:00 und heute 00:00)
                    else if (datum >= yesterdayStart && datum < todayStart) {
                        yesterdayProv += provision;
                        yesterdayContracts++;
                    }
                    // Dieser Monat
                    if (datum >= monthStart) {
                        monthProv += provision;
                    }
                }
                
                // Ausstehend (noch nicht ausgezahlt)
                if (status.includes('neu') || status.includes('prÃ¼f') || status.includes('bearbeit') || status === '') {
                    pendingProv += provision;
                }
            });
            
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log(`ğŸ“Š STATISTIKEN BERECHNET:`);
            console.log(`   ğŸ“… Heute: ${todayProv.toFixed(2)}â‚¬ (${todayContracts} VertrÃ¤ge)`);
            console.log(`   ğŸ“… Gestern: ${yesterdayProv.toFixed(2)}â‚¬ (${yesterdayContracts} VertrÃ¤ge)`);
            console.log(`   ğŸ“… Dieser Monat: ${monthProv.toFixed(2)}â‚¬`);
            console.log(`   â³ Ausstehend: ${pendingProv.toFixed(2)}â‚¬`);
            console.log(`   ğŸ“Š Gesamt: ${totalProv.toFixed(2)}â‚¬ (${totalContracts} VertrÃ¤ge)`);
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            
            // Stats anzeigen - mit professioneller Formatierung
            console.log('ğŸ–¥ï¸ Setze DOM-Elemente...');
            
            // Hilfsfunktion fÃ¼r schÃ¶ne Euro-Formatierung
            const formatEuro = (betrag) => {
                return betrag.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' â‚¬';
            };
            
            document.getElementById('todayProvisionen').textContent = formatEuro(todayProv);
            document.getElementById('todayVertraege').textContent = todayContracts + (todayContracts === 1 ? ' Vertrag heute' : ' VertrÃ¤ge heute');
            document.getElementById('yesterdayProvisionen').textContent = formatEuro(yesterdayProv);
            document.getElementById('yesterdayVertraege').textContent = yesterdayContracts + (yesterdayContracts === 1 ? ' Vertrag' : ' VertrÃ¤ge');
            document.getElementById('monthProvisionen').textContent = formatEuro(monthProv);
            document.getElementById('pendingProvisionen').textContent = formatEuro(pendingProv);
            document.getElementById('totalVertraege').textContent = totalContracts;
            console.log('âœ… DOM-Elemente gesetzt!');
            
            // Neueste 5 VertrÃ¤ge anzeigen
            const tbody = document.querySelector('#table-recent-vertraege tbody');
            if (tbody && meineVertraege.length > 0) {
                const neuesteVertraege = meineVertraege
                    .sort((a, b) => {
                        const dateA = new Date(a.erstellt_am || a.created_at || 0);
                        const dateB = new Date(b.erstellt_am || b.created_at || 0);
                        return dateB - dateA;
                    })
                    .slice(0, 5);
                
                tbody.innerHTML = neuesteVertraege.map(v => {
                    const d = v.erstellt_am || v.created_at;
                    const datum = d ? new Date(d).toLocaleDateString('de-DE') : '-';
                    const provision = (parseFloat(v.gesamt_provision) || parseFloat(v.provision) || 0).toFixed(2).replace('.', ',');
                    const kunde = v.kunde_name || ((v.kunde_vorname || '') + ' ' + (v.kunde_nachname || '')).trim() || 'N/A';
                    const status = v.vertrag_status || v.status || 'Neu';
                    const statusLower = status.toLowerCase();
                    const statusClass = statusLower.includes('aktiv') ? 'status-success' : 
                                      statusLower.includes('abge') || statusLower.includes('stor') ? 'status-danger' : 
                                      'status-warning';
                    
                    return `
                        <tr onclick="showVertragDetails('${v.id}')" style="cursor:pointer;">
                            <td>${datum}</td>
                            <td>${kunde}</td>
                            <td>${v.kategorie || '-'}</td>
                            <td><strong style="color: #48bb78;">${provision}â‚¬</strong></td>
                            <td><span class="status-badge ${statusClass}">${status}</span></td>
                        </tr>
                    `;
                }).join('');
                console.log(`âœ… ${neuesteVertraege.length} neueste VertrÃ¤ge in Tabelle`);
            } else if (tbody) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:2rem;color:#718096;"><i class="fas fa-inbox" style="font-size:2rem;margin-bottom:0.5rem;opacity:0.5;"></i><br>Keine VertrÃ¤ge vorhanden</td></tr>';
            }
            
            // âœ… BONUS-FORTSCHRITT MIT ECHTEN VERTRÃ„GEN AKTUALISIEREN
            console.log('ğŸ¯ Aktualisiere Bonus-Fortschritt mit', meineVertraege.length, 'echten VertrÃ¤gen');
            
            // ğŸŒ GLOBAL SPEICHERN fÃ¼r alle Seiten!
            window.allePartnerVertraege = meineVertraege;
            window.alleMeineVertraege = meineVertraege;
            alleMeineVertraege = meineVertraege;
            alleKundenVertraegeData = meineVertraege;
            window.alleKundenVertraegeData = meineVertraege;
            console.log('ğŸŒ VertrÃ¤ge global gespeichert:', window.allePartnerVertraege?.length || 0);
            
            aktualisiereBonusFortschritt(meineVertraege);
            
            console.log('âœ… Dashboard-Daten geladen!');
        } catch (error) {
            console.error('âŒ Fehler beim Laden:', error);
        } finally {
            _dashboardLoadInProgress = false;
        }
    }

    // ===========================
    // ğŸ§ª DEMO-MODUS DATEN
    // ===========================
    function loadDemoData() {
        console.log('ğŸ§ª Lade Demo-Daten...');
        
        // User-Info
        const partnerName = document.getElementById('partner-name');
        if (partnerName) partnerName.textContent = 'Demo Partner';
        const partnerEmail = document.getElementById('partner-email');
        if (partnerEmail) partnerEmail.textContent = 'demo@partner.de';
        
        // ğŸ“± MOBILE: Demo User Name im Header
        const mobileUserEl = document.getElementById('mobile-user-name');
        if (mobileUserEl) mobileUserEl.textContent = 'Demo Partner';
        
        // Desktop User Info
        const userEmail = document.getElementById('userEmail');
        if (userEmail) userEmail.textContent = 'demo@partner.de';
        const userAvatar = document.getElementById('userAvatar');
        if (userAvatar) userAvatar.textContent = 'DP';
        const userName = document.getElementById('userName');
        if (userName) userName.textContent = 'Demo Partner';
        const greetingText = document.getElementById('greeting-text');
        if (greetingText) greetingText.textContent = 'Hallo Demo!';
        
        // Stats
        const todayProv = document.getElementById('todayProvisionen');
        if (todayProv) todayProv.textContent = '150,00â‚¬';
        const todayVert = document.getElementById('todayVertraege');
        if (todayVert) todayVert.textContent = '2';
        const yesterdayProv = document.getElementById('yesterdayProvisionen');
        if (yesterdayProv) yesterdayProv.textContent = '200,00â‚¬';
        const yesterdayVert = document.getElementById('yesterdayVertraege');
        if (yesterdayVert) yesterdayVert.textContent = '3';
        const monthProv = document.getElementById('monthProvisionen');
        if (monthProv) monthProv.textContent = '2.450,00â‚¬';
        const pendingProv = document.getElementById('pendingProvisionen');
        if (pendingProv) pendingProv.textContent = '1.200,00â‚¬';
        const totalVert = document.getElementById('totalVertraege');
        if (totalVert) totalVert.textContent = '42';
        
        // Onboarding Widget verstecken
        const onboardingWidget = document.getElementById('onboarding-widget');
        if (onboardingWidget) onboardingWidget.style.display = 'none';
        
        // Projekt-Status Widget anzeigen
        const projektWidget = document.getElementById('projekt-status-widget');
        if (projektWidget) projektWidget.style.display = 'block';
        
        // Projekt-Status setzen
        const projektTitle = document.getElementById('projekt-title');
        if (projektTitle) projektTitle.textContent = 'ğŸª Ladenlokal';
        const projektProgressText = document.getElementById('projekt-progress-text');
        if (projektProgressText) projektProgressText.textContent = '25%';
        const projektProgressBar = document.getElementById('projekt-progress-bar');
        if (projektProgressBar) projektProgressBar.style.width = '25%';
        const projektStatus = document.getElementById('projekt-status');
        if (projektStatus) {
            projektStatus.textContent = 'Starter';
            projektStatus.style.color = '#ed8936';
        }
        const projektStart = document.getElementById('projekt-start');
        if (projektStart) projektStart.textContent = '02.12.2025';
        const projektWeeks = document.getElementById('projekt-weeks');
        if (projektWeeks) projektWeeks.textContent = '3 / 12 Wochen';
        
        // Demo-VertrÃ¤ge
        const demoVertraege = [
            { id: 'demo-1', datum: '08.12.2025', kunde: 'Max Mustermann', kategorie: 'Mobilfunk', produkt: 'Vodafone', tarif_preis: 94.00, provision: '75,00â‚¬', status: 'Aktiviert', created_at: Date.now() - (2 * 86400000) },
            { id: 'demo-2', datum: '07.12.2025', kunde: 'Lisa MÃ¼ller', kategorie: 'Strom', produkt: 'Telekom', tarif_preis: 94.00, provision: '100,00â‚¬', status: 'In Bearbeitung', created_at: Date.now() - (7 * 86400000) },
            { id: 'demo-3', datum: '06.12.2025', kunde: 'Tom Schmidt', kategorie: 'Gas', produkt: 'E.ON', tarif_preis: 94.00, provision: '50,00â‚¬', status: 'Neu', created_at: Date.now() - (20 * 86400000) }
        ];
        
        const tbody = document.querySelector('#table-recent-vertraege tbody');
        if (tbody) {
            tbody.innerHTML = demoVertraege.map(v => {
                const statusClass = v.status === 'Aktiviert' ? 'status-success' : 
                                  v.status === 'In Bearbeitung' ? 'status-warning' : 
                                  'status-info';
                
                return `
                    <tr onclick="showVertragDetails('${v.id}', ${JSON.stringify(v).replace(/"/g, '&quot;')})" style="cursor:pointer;">
                        <td>${v.datum}</td>
                        <td>${v.kunde}</td>
                        <td>${v.kategorie}</td>
                        <td><strong>${v.provision}</strong></td>
                        <td><span class="status-badge ${statusClass}">${v.status}</span></td>
                    </tr>
                `;
            }).join('');
        }
        
        // Letzte Auszahlungen
        const auszahlungenTbody = document.querySelector('#table-recent-auszahlungen tbody');
        if (auszahlungenTbody) {
            auszahlungenTbody.innerHTML = `
                <tr>
                    <td>November 2025</td>
                    <td>Sammelauszahlung</td>
                    <td>Provision</td>
                    <td><strong>850,00â‚¬</strong></td>
                    <td><span class="status-badge status-success">Ausgezahlt</span></td>
                </tr>
                <tr>
                    <td>Oktober 2025</td>
                    <td>Sammelauszahlung</td>
                    <td>Provision</td>
                    <td><strong>720,00â‚¬</strong></td>
                    <td><span class="status-badge status-success">Ausgezahlt</span></td>
                </tr>
            `;
        }
        
        console.log('âœ… Demo-Daten erfolgreich geladen!');
        
        // Demo-VertrÃ¤ge fÃ¼r Bonus global speichern
        const demoVertraegeFuerBonus = [
            { kategorie: 'Mobilfunk' },
            { kategorie: 'DSL' },
            { kategorie: 'DSL' },
            { kategorie: 'Strom' },
            { kategorie: 'Mobilfunk' },
            { kategorie: 'Energie' },
            { kategorie: 'Mobilfunk' }
        ];
        
        // ğŸŒ GLOBAL speichern fÃ¼r andere Seiten!
        window.allePartnerVertraege = demoVertraegeFuerBonus;
        window.alleMeineVertraege = demoVertraegeFuerBonus;
        alleMeineVertraege = demoVertraegeFuerBonus;
        
        // Bonus-Fortschritt berechnen
        aktualisiereBonusFortschritt(demoVertraegeFuerBonus);
    }

    // ===========================
    // ğŸ¯ BONUS-STAFFEL BERECHNUNG
    // ===========================
    window.aktualisiereBonusFortschritt = function aktualisiereBonusFortschritt(vertraege) {
        console.log('ğŸ¯ aktualisiereBonusFortschritt() mit', vertraege?.length || 0, 'VertrÃ¤gen aufgerufen');
        
        // Nur aktivierte VertrÃ¤ge zÃ¤hlen (nicht abgelehnt/storniert)
        const aktiveVertraege = vertraege.filter(v => {
            const status = (v.vertrag_status || v.status || '').toLowerCase();
            return !status.includes('abge') && !status.includes('stor');
        });
        
        const gesamt = aktiveVertraege.length;
        const dsl = aktiveVertraege.filter(v => {
            const kat = (v.kategorie || '').toLowerCase();
            return kat.includes('dsl') || kat.includes('internet') || kat.includes('breitband');
        }).length;
        const strom = aktiveVertraege.filter(v => {
            const kat = (v.kategorie || '').toLowerCase();
            return kat.includes('strom') || kat.includes('energie') || kat.includes('gas');
        }).length;
        
        console.log(`ğŸ“Š Bonus-Berechnung: ${gesamt} Gesamt | ${dsl} DSL | ${strom} Strom`);
        
        // ===== STAFFEL 1: 10 VertrÃ¤ge = 250â‚¬ =====
        const staffel1Prozent = Math.min((gesamt / 10) * 100, 100);
        
        const staffel1El = document.getElementById('staffel-1-progress');
        const staffel1Bar = document.getElementById('staffel-1-bar');
        const staffel1ProzentEl = document.getElementById('staffel-1-prozent');
        
        if (staffel1El) {
            if (gesamt >= 10) {
                staffel1El.innerHTML = 'âœ… Erreicht!';
                staffel1El.style.color = '#48bb78';
            } else {
                staffel1El.textContent = `${gesamt}/10`;
            }
        }
        if (staffel1Bar) {
            staffel1Bar.style.width = `${staffel1Prozent}%`;
        }
        if (staffel1ProzentEl) {
            staffel1ProzentEl.textContent = `${Math.round(staffel1Prozent)}%`;
        }
        
        // ===== STAFFEL 2: 30 VertrÃ¤ge + 10 DSL + 5 Strom = 850â‚¬ =====
        const staffel2VertraegeEl = document.getElementById('staffel-2-vertraege');
        const staffel2DslEl = document.getElementById('staffel-2-dsl');
        const staffel2StromEl = document.getElementById('staffel-2-strom');
        const staffel2StatusEl = document.getElementById('staffel-2-status');
        const staffel2VertraegeBar = document.getElementById('staffel-2-vertraege-bar');
        const staffel2DslBar = document.getElementById('staffel-2-dsl-bar');
        const staffel2StromBar = document.getElementById('staffel-2-strom-bar');
        
        if (staffel2VertraegeEl) staffel2VertraegeEl.textContent = `${gesamt}/30`;
        if (staffel2DslEl) staffel2DslEl.textContent = `${dsl}/10`;
        if (staffel2StromEl) staffel2StromEl.textContent = `${strom}/5`;
        
        if (staffel2VertraegeBar) staffel2VertraegeBar.style.width = `${Math.min((gesamt / 30) * 100, 100)}%`;
        if (staffel2DslBar) staffel2DslBar.style.width = `${Math.min((dsl / 10) * 100, 100)}%`;
        if (staffel2StromBar) staffel2StromBar.style.width = `${Math.min((strom / 5) * 100, 100)}%`;
        
        if (staffel2StatusEl) {
            if (gesamt >= 30 && dsl >= 10 && strom >= 5) {
                staffel2StatusEl.innerHTML = 'âœ… Erreicht!';
                staffel2StatusEl.style.color = '#48bb78';
            } else {
                const fehlt = [];
                if (gesamt < 30) fehlt.push(`${30 - gesamt} VertrÃ¤ge`);
                if (dsl < 10) fehlt.push(`${10 - dsl} DSL`);
                if (strom < 5) fehlt.push(`${5 - strom} Strom`);
                staffel2StatusEl.textContent = fehlt.length > 0 ? `Noch ${fehlt.join(', ')}` : 'Offen';
            }
        }
        
        // ===== NÃ„CHSTES ZIEL ANZEIGEN =====
        const bonusNextEl = document.getElementById('bonus-next');
        if (bonusNextEl) {
            if (gesamt < 10) {
                bonusNextEl.innerHTML = `<span style="color: #48bb78; font-weight: 600;">ğŸ¯ Noch ${10 - gesamt} VertrÃ¤ge bis Staffel 1 (250â‚¬ Bonus)</span>`;
            } else if (gesamt < 30 || dsl < 10 || strom < 5) {
                const fehlt = [];
                if (gesamt < 30) fehlt.push(`${30 - gesamt} VertrÃ¤ge`);
                if (dsl < 10) fehlt.push(`${10 - dsl} DSL`);
                if (strom < 5) fehlt.push(`${5 - strom} Strom`);
                bonusNextEl.innerHTML = `<span style="color: #4299e1; font-weight: 600;">ğŸ¯ Staffel 2 (850â‚¬): Noch ${fehlt.join(', ')}</span>`;
            } else {
                bonusNextEl.innerHTML = `<span style="color: #805ad5; font-weight: 600;">ğŸ‰ Alle Staffeln erreicht! Kontaktiere uns fÃ¼r Staffel 3</span>`;
            }
        }
        
        console.log(`âœ… Bonus-Fortschritt aktualisiert: ${gesamt} VertrÃ¤ge | ${dsl} DSL | ${strom} Strom`);
    }

    // ===========================
    // ğŸ” AFFILIATE-CHECK FUNKTION
    // ===========================
    async function checkAffiliateStatus(email) {
        try {
            console.log('ğŸ” PrÃ¼fe Affiliate-Status fÃ¼r:', email);
            const response = await fetch(`tables/partners?search=${encodeURIComponent(email)}&limit=1`);
            const data = await response.json();
            
            if (data.data && data.data.length > 0) {
                const partner = data.data[0];
                console.log('ğŸ‘¤ Partner gefunden:', partner.vorname, partner.nachname);
                
                // Speichere Partner-Infos global
                window.currentPartner = partner;
                
                // ğŸ†• BESTANDS-PARTNER / AFFILIATE CHECK
                const istBestandsPartner = partner.ist_bestandspartner === true || partner.ist_affiliate === true;
                
                if (istBestandsPartner) {
                    console.log('ğŸš« BESTANDS-PARTNER/AFFILIATE - KEIN Onboarding!');
                    
                    // Onboarding & Projekt-Widget verstecken
                    const widget = document.getElementById('onboarding-widget');
                    if (widget) widget.style.display = 'none';
                    const projektWidget = document.getElementById('projekt-status-widget');
                    if (projektWidget) projektWidget.style.display = 'none';
                    
                    // Referral-Code speichern falls vorhanden
                    if (partner.referral_code) {
                        localStorage.setItem('partnerReferralCode', partner.referral_code);
                    }
                }
                
                // âœ… PASSWORT-Ã„NDERN-CHECK: Muss Partner sein Passwort Ã¤ndern?
                if (partner.passwort_muss_geaendert_werden === true) {
                    console.log('ğŸ”‘ Partner muss Passwort Ã¤ndern - zeige Modal SOFORT');
                    showPasswortAendernModal();
                }
                
                // Partner-Name in UI aktualisieren
                if (partner.vorname) {
                    const userNameEl = document.getElementById('userName');
                    if (userNameEl) {
                        userNameEl.textContent = partner.vorname + ' ' + (partner.nachname || '');
                    }
                }
            }
        } catch (error) {
            console.error('âŒ Fehler beim Affiliate-Check:', error);
        }
    }
    
    // ===========================
    // ğŸ”‘ PASSWORT Ã„NDERN MODAL
    // ===========================
    function showPasswortAendernModal() {
        // Erstelle Modal falls nicht vorhanden
        if (!document.getElementById('passwort-aendern-modal')) {
            const modalHTML = `
                <div id="passwort-aendern-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div id="passwort-aendern-modal" style="background: var(--card-bg, white); border-radius: 16px; padding: 2rem; max-width: 450px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”‘</div>
                            <h2 style="color: var(--text, #333); margin: 0 0 0.5rem 0; font-size: 1.5rem;">Passwort Ã¤ndern</h2>
                            <p style="color: var(--text-light, #666); margin: 0; font-size: 0.95rem;">Bitte legen Sie ein neues, sicheres Passwort fest.</p>
                        </div>
                        
                        <div style="margin-bottom: 1.25rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text, #333);">Neues Passwort</label>
                            <input type="password" id="pw-neu" placeholder="Mindestens 8 Zeichen" 
                                style="width: 100%; padding: 12px 16px; border: 2px solid var(--border, #e2e8f0); border-radius: 10px; font-size: 1rem; box-sizing: border-box;">
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text, #333);">Passwort bestÃ¤tigen</label>
                            <input type="password" id="pw-bestaetigen" placeholder="Passwort wiederholen"
                                style="width: 100%; padding: 12px 16px; border: 2px solid var(--border, #e2e8f0); border-radius: 10px; font-size: 1rem; box-sizing: border-box;">
                        </div>
                        
                        <div id="pw-error" style="display: none; padding: 10px; background: #fee2e2; border-radius: 8px; color: #dc2626; margin-bottom: 1rem; font-size: 0.9rem;"></div>
                        
                        <button onclick="saveNewPassword()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59,130,246,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            âœ… Passwort speichern
                        </button>
                        
                        <p style="text-align: center; margin-top: 1rem; font-size: 0.85rem; color: var(--text-light, #999);">
                            Ihr Passwort muss mindestens 8 Zeichen lang sein.
                        </p>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        document.getElementById('passwort-aendern-overlay').style.display = 'flex';
    }
    
    async function saveNewPassword() {
        const pwNeu = document.getElementById('pw-neu').value;
        const pwBestaetigen = document.getElementById('pw-bestaetigen').value;
        const errorEl = document.getElementById('pw-error');
        
        // Validierung
        if (pwNeu.length < 8) {
            errorEl.textContent = 'Das Passwort muss mindestens 8 Zeichen lang sein.';
            errorEl.style.display = 'block';
            return;
        }
        
        if (pwNeu !== pwBestaetigen) {
            errorEl.textContent = 'Die PasswÃ¶rter stimmen nicht Ã¼berein.';
            errorEl.style.display = 'block';
            return;
        }
        
        errorEl.style.display = 'none';
        
        const partnerEmail = localStorage.getItem('partnerEmail');
        console.log('ğŸ” Speichere neues Passwort fÃ¼r:', partnerEmail);
        
        // Auch aus localStorage die ID holen
        let partnerId = window.currentPartner?.id;
        if (!partnerId) {
            try {
                const lpd = JSON.parse(localStorage.getItem('partnerData') || '{}');
                partnerId = lpd.id;
                console.log('ğŸ“¦ Partner-ID aus localStorage:', partnerId);
            } catch(e) {}
        }
        
        let success = false;
        
        // 1. Versuche PATCH wenn ID vorhanden
        if (partnerId) {
            try {
                console.log('ğŸ“ PATCH Partner:', partnerId);
                const response = await fetch(`tables/partners/${partnerId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        passwort_hash: pwNeu,
                        passwort_muss_geaendert_werden: false
                    })
                });
                
                if (response.ok) {
                    console.log('âœ… PATCH erfolgreich!');
                    success = true;
                } else {
                    console.log('âš ï¸ PATCH fehlgeschlagen, versuche andere Methode...');
                }
            } catch(e) {
                console.log('âš ï¸ PATCH Fehler:', e);
            }
        }
        
        // 2. Falls PATCH fehlgeschlagen: Suche Partner und update
        if (!success) {
            try {
                console.log('ğŸ” Suche Partner in DB...');
                const searchRes = await fetch(`tables/partners?search=${encodeURIComponent(partnerEmail)}&limit=100`);
                const searchData = await searchRes.json();
                const foundPartner = searchData.data?.find(p => p.email?.toLowerCase() === partnerEmail?.toLowerCase());
                
                if (foundPartner && foundPartner.id) {
                    console.log('âœ… Partner gefunden, update:', foundPartner.id);
                    const patchRes = await fetch(`tables/partners/${foundPartner.id}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            passwort_hash: pwNeu,
                            passwort_muss_geaendert_werden: false
                        })
                    });
                    
                    if (patchRes.ok) {
                        success = true;
                        window.currentPartner = foundPartner;
                    }
                }
            } catch(e) {
                console.log('âš ï¸ Suche fehlgeschlagen:', e);
            }
        }
        
        // 3. Falls immer noch nicht: Erstelle neuen Partner
        if (!success) {
            try {
                console.log('ğŸ“ Erstelle neuen Partner...');
                const postRes = await fetch('tables/partners', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: partnerEmail,
                        passwort_hash: pwNeu,
                        passwort_muss_geaendert_werden: false,
                        ist_affiliate: true,
                        ist_bestandspartner: true,
                        aktiv: true,
                        status: 'Approved'
                    })
                });
                
                if (postRes.ok) {
                    const newPartner = await postRes.json();
                    window.currentPartner = newPartner;
                    success = true;
                    console.log('âœ… Neuer Partner erstellt:', newPartner.id);
                }
            } catch(e) {
                console.log('âš ï¸ POST fehlgeschlagen:', e);
            }
        }
        
        // 4. Lokal speichern (IMMER - als Backup)
        const partnerData = JSON.parse(localStorage.getItem('partnerData') || '{}');
        partnerData.passwort_hash = pwNeu;
        partnerData.passwort = pwNeu; // Auch als 'passwort' speichern
        partnerData.passwort_muss_geaendert_werden = false;
        localStorage.setItem('partnerData', JSON.stringify(partnerData));
        console.log('ğŸ’¾ Passwort lokal gespeichert:', { 
            email: partnerData.email, 
            pwLength: pwNeu.length,
            mussAendern: false 
        });
        
        if (window.currentPartner) {
            window.currentPartner.passwort_muss_geaendert_werden = false;
            window.currentPartner.passwort_hash = pwNeu;
            window.currentPartner.passwort = pwNeu;
        }
        
        // Modal schlieÃŸen
        const overlay = document.getElementById('passwort-aendern-overlay');
        if (overlay) overlay.remove();
        
        if (success) {
            alert('âœ… Passwort erfolgreich geÃ¤ndert!\n\nBei erneutem Login bitte das neue Passwort verwenden.');
        } else {
            alert('âœ… Passwort lokal gespeichert!\n\nBei erneutem Login bitte das neue Passwort verwenden.');
        }
    }
    
    // ===========================
    // ğŸš€ INITIALISIERUNG
    // ===========================
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('ğŸš€ Partner-Dashboard wird initialisiert...');
        
        // âœ… AUTO-RESTORE: PrÃ¼fen ob DB leer und Cache vorhanden
        if (window.LocalPersistence) {
            console.log('ğŸ”„ PrÃ¼fe Auto-Restore...');
            const restoreResult = await LocalPersistence.autoRestore();
            if (restoreResult) {
                console.log('âœ… Auto-Restore abgeschlossen:', restoreResult);
            }
        }
        
        loadDashboardData();
        
        // âœ… Akademie-Stats beim Start laden
        setTimeout(() => {
            if (typeof updateAkademieStats === 'function') {
                console.log('ğŸ“ Lade Akademie-Fortschritt...');
                updateAkademieStats().catch(err => console.log('Akademie-Stats:', err.message));
            }
        }, 300);
        
        // âœ… Provisions-Seite sofort initialisieren (auch wenn nicht sichtbar)
        setTimeout(() => {
            console.log('ğŸ”„ Initialisiere Provisions-Seite im Hintergrund...');
            loadProvisionenPage();
        }, 500);
    });
    
    // ========================================
    // ğŸ“‹ PROVISIONSLISTE - JavaScript Functions
    // ========================================
    
    // ============ ANBIETER-FARBEN ============
    const ANBIETER_FARBEN = {
        'Freenet O2': { bg: 'linear-gradient(135deg, #0066CC, #004C99)', text: '#0066CC' },
        'Freenet Telekom': { bg: 'linear-gradient(135deg, #E20074, #B8005C)', text: '#E20074' },
        'Freenet Vodafone': { bg: 'linear-gradient(135deg, #E60000, #B30000)', text: '#E60000' },
        'Klarmobil': { bg: 'linear-gradient(135deg, #FF6B00, #CC5500)', text: '#FF6B00' },
        'O2': { bg: 'linear-gradient(135deg, #0066CC, #004C99)', text: '#0066CC' },
        'O2 Direkt': { bg: 'linear-gradient(135deg, #0066CC, #004C99)', text: '#0066CC' },
        '1&1': { bg: 'linear-gradient(135deg, #00468B, #003366)', text: '#00468B' },
        'Ay Yildiz': { bg: 'linear-gradient(135deg, #C41230, #9A0E26)', text: '#C41230' },
        'Yourfone': { bg: 'linear-gradient(135deg, #7B2D8E, #5C2169)', text: '#7B2D8E' },
        'Telekom': { bg: 'linear-gradient(135deg, #E20074, #B8005C)', text: '#E20074' },
        'Vodafone': { bg: 'linear-gradient(135deg, #E60000, #B30000)', text: '#E60000' }
    };
    
    const ALLE_PROVISIONEN = [
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”µ FREENET O2 - 31 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile Unlimited Max 2024', daten: 'Unlimited 500 Mbit/s', preis: 99.99, provision: 510.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile Unlimited Max 2023', daten: 'Unlimited 500 Mbit/s', preis: 89.99, provision: 460.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile XL 2024', daten: '300 GB', preis: 59.99, provision: 335.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile Unlimited Smart', daten: 'Unlimited 15 Mbit/s', preis: 52.99, provision: 290.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile L 2024', daten: '100 GB', preis: 44.99, provision: 275.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 300 GB LTE', daten: '300 GB', preis: 49.99, provision: 265.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 200 GB LTE', daten: '200 GB', preis: 44.99, provision: 240.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile L Basic', daten: '100 GB', preis: 44.99, provision: 230.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 150 GB LTE', daten: '150 GB', preis: 39.99, provision: 220.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 100 GB LTE', daten: '100 GB', preis: 39.99, provision: 195.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 80 GB LTE', daten: '80 GB', preis: 34.99, provision: 180.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 60 GB LTE', daten: '60 GB', preis: 34.99, provision: 175.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 50 GB LTE', daten: '50 GB', preis: 29.99, provision: 165.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 40 GB LTE', daten: '40 GB', preis: 29.99, provision: 155.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 35 GB LTE', daten: '35 GB', preis: 27.99, provision: 145.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 30 GB LTE', daten: '30 GB', preis: 24.99, provision: 135.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 25 GB LTE', daten: '25 GB', preis: 22.99, provision: 125.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 20 GB LTE', daten: '20 GB', preis: 19.99, provision: 115.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 17 GB LTE', daten: '17 GB', preis: 17.99, provision: 105.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 15 GB LTE', daten: '15 GB', preis: 14.99, provision: 95.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 10 GB LTE', daten: '10 GB', preis: 12.99, provision: 85.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 8 GB LTE', daten: '8 GB', preis: 10.99, provision: 75.00 },
        { anbieter: 'Freenet O2', tarif: 'Unlimited Max 300 MBit/s', daten: 'Unlimited', preis: 34.99, provision: 105.00 },
        { anbieter: 'Freenet O2', tarif: 'Unlimited Smart 15 MBit/s', daten: 'Unlimited 15 Mbit/s', preis: 24.99, provision: 85.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile M 2024', daten: '30 GB', preis: 29.99, provision: 155.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile S 2024', daten: '10 GB', preis: 19.99, provision: 95.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 5 GB LTE', daten: '5 GB', preis: 9.99, provision: 55.00 },
        { anbieter: 'Freenet O2', tarif: 'Allnet Flat 3 GB LTE', daten: '3 GB', preis: 7.99, provision: 45.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Mobile XS 2024', daten: '5 GB', preis: 14.99, provision: 75.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Young M', daten: '40 GB', preis: 24.99, provision: 140.00 },
        { anbieter: 'Freenet O2', tarif: 'O2 Young L', daten: '100 GB', preis: 34.99, provision: 200.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸŸ£ FREENET TELEKOM - 22 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil XL', daten: 'Unlimited 5G', preis: 94.95, provision: 425.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil XL Young 5G', daten: 'Unlimited 5G', preis: 84.95, provision: 405.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 80 GB Premium', daten: '80 GB 5G', preis: 59.99, provision: 335.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil L', daten: '100 GB 5G', preis: 69.95, provision: 332.50 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 60 GB Premium', daten: '60 GB 5G', preis: 59.99, provision: 320.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil M', daten: '50 GB 5G', preis: 59.95, provision: 290.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 50 GB Premium', daten: '50 GB', preis: 49.99, provision: 275.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil S', daten: '30 GB 5G', preis: 49.95, provision: 237.50 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 40 GB LTE', daten: '40 GB', preis: 44.99, provision: 230.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 35 GB Basic', daten: '35 GB', preis: 39.99, provision: 202.50 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 30 GB LTE', daten: '30 GB', preis: 34.99, provision: 195.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 25 GB LTE', daten: '25 GB', preis: 29.99, provision: 175.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 20 GB LTE', daten: '20 GB', preis: 24.99, provision: 155.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 15 GB LTE', daten: '15 GB', preis: 19.99, provision: 130.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 10 GB LTE', daten: '10 GB', preis: 14.99, provision: 105.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Allnet Flat 6 GB LTE', daten: '6 GB', preis: 12.99, provision: 85.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Smart Connect S Basic', daten: '500 MB', preis: 9.95, provision: 72.50 },
        { anbieter: 'Freenet Telekom', tarif: 'Smart Connect M', daten: '3 GB', preis: 14.95, provision: 95.00 },
        { anbieter: 'Freenet Telekom', tarif: 'Magenta Mobil XS', daten: '10 GB 5G', preis: 39.95, provision: 180.00 },
        { anbieter: 'Freenet Telekom', tarif: 'MagentaMobil L Young', daten: '100 GB 5G', preis: 59.95, provision: 310.00 },
        { anbieter: 'Freenet Telekom', tarif: 'MagentaMobil M Young', daten: '50 GB 5G', preis: 49.95, provision: 265.00 },
        { anbieter: 'Freenet Telekom', tarif: 'MagentaMobil S Young', daten: '30 GB 5G', preis: 39.95, provision: 210.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”´ FREENET VODAFONE - 28 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 100 GB', daten: '100 GB 5G', preis: 64.99, provision: 420.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 80 GB', daten: '80 GB 5G', preis: 59.99, provision: 400.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 60 GB', daten: '60 GB 5G', preis: 54.99, provision: 350.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil XL', daten: 'Unlimited 5G', preis: 89.99, provision: 330.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil L', daten: '280 GB 5G', preis: 69.99, provision: 320.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 50 GB', daten: '50 GB', preis: 49.99, provision: 305.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil M', daten: '100 GB 5G', preis: 59.99, provision: 290.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 40 GB', daten: '40 GB', preis: 44.99, provision: 265.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 35 GB', daten: '35 GB', preis: 39.99, provision: 242.50 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 30 GB', daten: '30 GB', preis: 34.99, provision: 222.50 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 25 GB', daten: '25 GB', preis: 29.99, provision: 210.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil S', daten: '50 GB 5G', preis: 49.99, provision: 245.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 20 GB', daten: '20 GB', preis: 24.99, provision: 185.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 15 GB', daten: '15 GB', preis: 19.99, provision: 155.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 10 GB', daten: '10 GB', preis: 14.99, provision: 125.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 8 GB', daten: '8 GB', preis: 12.99, provision: 105.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 6 GB', daten: '6 GB', preis: 10.99, provision: 85.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat 4 GB', daten: '4 GB', preis: 9.99, provision: 70.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil XS', daten: '25 GB 5G', preis: 39.99, provision: 200.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil L Young', daten: '280 GB 5G', preis: 59.99, provision: 305.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil M Young', daten: '100 GB 5G', preis: 49.99, provision: 265.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'GigaMobil S Young', daten: '50 GB 5G', preis: 39.99, provision: 225.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Red L', daten: '70 GB 5G', preis: 59.99, provision: 285.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Red M', daten: '30 GB 5G', preis: 49.99, provision: 245.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Red S', daten: '15 GB 5G', preis: 39.99, provision: 200.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Red XS', daten: '6 GB 5G', preis: 29.99, provision: 150.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Smart Tech', daten: '5 GB', preis: 24.99, provision: 120.00 },
        { anbieter: 'Freenet Vodafone', tarif: 'Allnet Flat Basic', daten: '3 GB', preis: 7.99, provision: 50.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸŸ  KLARMOBIL - 16 Tarife (Vodafone, O2, Telekom)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Klarmobil', tarif: 'GigaMobil M Nov 24 (Vodafone)', daten: '50 GB 5G', preis: 59.99, provision: 280.00 },
        { anbieter: 'Klarmobil', tarif: 'GigaMobil Young XL (Vodafone)', daten: 'Unlimited 5G', preis: 79.99, provision: 275.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 40 GB (Vodafone)', daten: '40 GB', preis: 49.99, provision: 225.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 25 GB (Vodafone)', daten: '25 GB', preis: 39.99, provision: 210.00 },
        { anbieter: 'Klarmobil', tarif: 'GigaMobil S (Vodafone)', daten: '30 GB 5G', preis: 49.99, provision: 200.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 20 GB (Vodafone)', daten: '20 GB', preis: 34.99, provision: 180.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 40 GB (O2)', daten: '40 GB', preis: 44.99, provision: 195.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 30 GB LTE (O2)', daten: '30 GB', preis: 39.99, provision: 195.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 25 GB (O2)', daten: '25 GB', preis: 34.99, provision: 175.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 20 GB (O2)', daten: '20 GB', preis: 29.99, provision: 150.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 15 GB (O2)', daten: '15 GB', preis: 24.99, provision: 130.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 30 GB LTE (Telekom)', daten: '30 GB', preis: 39.99, provision: 195.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 20 GB (Telekom)', daten: '20 GB', preis: 34.99, provision: 170.00 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 15 GB (Telekom)', daten: '15 GB', preis: 29.99, provision: 152.50 },
        { anbieter: 'Klarmobil', tarif: 'Allnet Flat 10 GB (Telekom)', daten: '10 GB', preis: 24.99, provision: 130.00 },
        { anbieter: 'Klarmobil', tarif: 'Geburtstagsaktion 75 GB', daten: '75 GB', preis: 14.99, provision: 80.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”µ O2 DIREKT - 8 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'O2', tarif: 'O2 Mobile Unlimited Max', daten: 'Unlimited 500 Mbit/s', preis: 69.99, provision: 200.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile Unlimited On Demand', daten: 'Unlimited On Demand', preis: 54.99, provision: 150.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile XL', daten: '300 GB', preis: 54.99, provision: 147.50 },
        { anbieter: 'O2', tarif: 'O2 Mobile Unlimited Smart', daten: 'Unlimited 15 Mbit/s', preis: 42.99, provision: 145.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile L', daten: '100 GB', preis: 32.99, provision: 100.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile M', daten: '30 GB', preis: 24.99, provision: 80.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile S', daten: '10 GB', preis: 18.48, provision: 60.00 },
        { anbieter: 'O2', tarif: 'O2 Mobile XS', daten: '5 GB', preis: 12.99, provision: 40.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸŸ¦ 1&1 - 15 Tarife (Mobilfunk + Internet/DSL)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: '1&1', tarif: 'All-Net-Flat M', daten: '60 GB', preis: 39.99, provision: 112.50 },
        { anbieter: '1&1', tarif: 'All-Net-Flat L', daten: '120 GB', preis: 49.99, provision: 100.00 },
        { anbieter: '1&1', tarif: 'Glasfaser 1000', daten: '1000 Mbit/s Glasfaser', preis: 69.99, provision: 180.00 },
        { anbieter: '1&1', tarif: 'Glasfaser 600', daten: '600 Mbit/s Glasfaser', preis: 59.99, provision: 150.00 },
        { anbieter: '1&1', tarif: 'Glasfaser 300', daten: '300 Mbit/s Glasfaser', preis: 49.99, provision: 130.00 },
        { anbieter: '1&1', tarif: 'Glasfaser 150', daten: '150 Mbit/s Glasfaser', preis: 39.99, provision: 110.00 },
        { anbieter: '1&1', tarif: 'DSL 250', daten: '250 Mbit/s DSL', preis: 49.99, provision: 150.00 },
        { anbieter: '1&1', tarif: 'DSL 100', daten: '100 Mbit/s DSL', preis: 44.99, provision: 120.00 },
        { anbieter: '1&1', tarif: 'DSL 50', daten: '50 Mbit/s DSL', preis: 39.99, provision: 100.00 },
        { anbieter: '1&1', tarif: 'DSL 16', daten: '16 Mbit/s DSL', preis: 34.99, provision: 80.00 },
        { anbieter: '1&1', tarif: 'All-Net-Flat S', daten: '20 GB', preis: 29.99, provision: 75.00 },
        { anbieter: '1&1', tarif: 'All-Net-Flat XL', daten: 'Unlimited', preis: 59.99, provision: 75.00 },
        { anbieter: '1&1', tarif: 'All-Net-Flat XS', daten: '5 GB', preis: 14.99, provision: 50.00 },
        { anbieter: '1&1', tarif: 'Unlimited on demand M', daten: '100 Mbit/s On Demand', preis: 34.99, provision: 37.50 },
        { anbieter: '1&1', tarif: 'Unlimited on demand S', daten: '50 Mbit/s On Demand', preis: 24.99, provision: 25.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”´ AY YILDIZ - 4 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Ay Yildiz', tarif: 'AY Allnet Max', daten: '120 GB + TÃ¼rkei-Flat', preis: 37.99, provision: 260.00 },
        { anbieter: 'Ay Yildiz', tarif: 'AY Allnet Plus', daten: '60 GB + TÃ¼rkei-Flat', preis: 27.99, provision: 200.00 },
        { anbieter: 'Ay Yildiz', tarif: 'AY Allnet', daten: '12 GB + TÃ¼rkei-Flat', preis: 14.99, provision: 100.00 },
        { anbieter: 'Ay Yildiz', tarif: 'AY Yildiz Prepaid', daten: '6 GB + TÃ¼rkei-Flat', preis: 9.99, provision: 80.00 },
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸŸ£ YOURFONE - 4 Tarife
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        { anbieter: 'Yourfone', tarif: 'Yourfone 50 GB', daten: '50 GB 300 Mbit/s', preis: 34.98, provision: 200.00 },
        { anbieter: 'Yourfone', tarif: 'Yourfone 20 GB', daten: '20 GB 300 Mbit/s', preis: 24.98, provision: 170.00 },
        { anbieter: 'Yourfone', tarif: 'Yourfone 10 GB', daten: '10 GB 300 Mbit/s', preis: 19.98, provision: 125.00 },
        { anbieter: 'Yourfone', tarif: 'Yourfone 5 GB', daten: '5 GB 300 Mbit/s', preis: 14.98, provision: 100.00 }
    ];
    
    let gefilterteProvisionen = [...ALLE_PROVISIONEN];
    let angezeigteTarife = 20;
    
    function toggleProvisionsListe() {
        const content = document.getElementById('provisions-liste-content');
        const chevron = document.getElementById('provisions-chevron');
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            chevron.style.transform = 'rotate(180deg)';
            renderProvisionen();
        } else {
            content.style.display = 'none';
            chevron.style.transform = 'rotate(0deg)';
        }
    }
    
    function renderProvisionen() {
        const tbody = document.getElementById('provisions-tbody');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        const zuZeigen = gefilterteProvisionen.slice(0, angezeigteTarife);
        
        zuZeigen.forEach(tarif => {
            // Provisionsfarben basierend auf HÃ¶he
            const provColor = tarif.provision >= 300 ? '#dc2626' : tarif.provision >= 200 ? '#f59e0b' : tarif.provision >= 100 ? '#10b981' : '#64748b';
            const provBg = tarif.provision >= 300 ? 'rgba(220,38,38,0.1)' : tarif.provision >= 200 ? 'rgba(245,158,11,0.1)' : tarif.provision >= 100 ? 'rgba(16,185,129,0.1)' : 'rgba(100,116,139,0.1)';
            
            // Anbieterfarben aus der Farbkarte holen
            const anbieterFarbe = ANBIETER_FARBEN[tarif.anbieter] || { bg: 'linear-gradient(135deg, #64748b, #475569)', text: '#64748b' };
            
            // Daten-Badge styling - korrekte Reihenfolge fÃ¼r prÃ¤zise Kategorisierung
            let datenBg = 'var(--bg-secondary)';
            let datenColor = 'var(--text)';
            const datenLower = tarif.daten.toLowerCase();
            
            if (datenLower.includes('glasfaser')) {
                // Glasfaser-Internet - Hellblau
                datenBg = 'linear-gradient(135deg, #0ea5e9, #0284c7)';
                datenColor = 'white';
            } else if (datenLower.includes('dsl')) {
                // DSL-Internet - Orange
                datenBg = 'linear-gradient(135deg, #f59e0b, #d97706)';
                datenColor = 'white';
            } else if (datenLower.includes('on demand') && datenLower.includes('mbit')) {
                // Internet On Demand (z.B. 1&1) - TÃ¼rkis
                datenBg = 'linear-gradient(135deg, #14b8a6, #0d9488)';
                datenColor = 'white';
            } else if (datenLower.includes('tÃ¼rkei')) {
                // TÃ¼rkei-Flat (Ay Yildiz) - Rot
                datenBg = 'linear-gradient(135deg, #C41230, #9A0E26)';
                datenColor = 'white';
            } else if (datenLower.includes('unlimited')) {
                // Echte Unlimited-Mobilfunk-Tarife - Lila
                datenBg = 'linear-gradient(135deg, #8b5cf6, #a78bfa)';
                datenColor = 'white';
            } else if (datenLower.includes('5g')) {
                // 5G-Tarife - GrÃ¼n
                datenBg = 'linear-gradient(135deg, #10b981, #059669)';
                datenColor = 'white';
            }
            
            tbody.innerHTML += `
                <tr style="border-bottom: 1px solid var(--border); transition: background 0.2s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='transparent'">
                    <td style="padding: 12px;">
                        <span style="padding: 5px 12px; background: ${anbieterFarbe.bg}; color: white; border-radius: 6px; font-size: 12px; font-weight: 700; white-space: nowrap; display: inline-block;">
                            ${tarif.anbieter}
                        </span>
                    </td>
                    <td style="padding: 12px; font-weight: 600; color: var(--text);">${tarif.tarif}</td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="padding: 4px 10px; background: ${datenBg}; color: ${datenColor}; border-radius: 12px; font-size: 12px; font-weight: 600; white-space: nowrap;">
                            ${tarif.daten}
                        </span>
                    </td>
                    <td style="padding: 12px; text-align: right; color: var(--text-light); font-weight: 500;">${tarif.preis.toFixed(2).replace('.', ',')}â‚¬</td>
                    <td style="padding: 12px; text-align: right;">
                        <span style="padding: 6px 14px; background: ${provBg}; color: ${provColor}; border-radius: 8px; font-weight: 800; font-size: 14px; display: inline-block;">
                            ${tarif.provision.toFixed(2).replace('.', ',')}â‚¬
                        </span>
                    </td>
                </tr>
            `;
        });
        
        document.getElementById('prov-count').textContent = gefilterteProvisionen.length + ' Tarife';
        document.getElementById('load-more-prov').style.display = angezeigteTarife >= gefilterteProvisionen.length ? 'none' : 'inline-block';
    }
    
    function filterProvisionen() {
        const suchtext = document.getElementById('prov-search')?.value.toLowerCase() || '';
        const anbieterFilter = document.getElementById('prov-anbieter-filter')?.value || 'alle';
        
        gefilterteProvisionen = ALLE_PROVISIONEN.filter(t => {
            const matchSuche = t.tarif.toLowerCase().includes(suchtext) || t.anbieter.toLowerCase().includes(suchtext);
            const matchAnbieter = anbieterFilter === 'alle' || t.anbieter.toLowerCase().includes(anbieterFilter.toLowerCase());
            return matchSuche && matchAnbieter;
        });
        
        sortProvisionen();
    }
    
    function sortProvisionen() {
        const sortWert = document.getElementById('prov-sort')?.value || 'provision-desc';
        
        gefilterteProvisionen.sort((a, b) => {
            switch(sortWert) {
                case 'provision-desc': return b.provision - a.provision;
                case 'provision-asc': return a.provision - b.provision;
                case 'preis-asc': return a.preis - b.preis;
                case 'preis-desc': return b.preis - a.preis;
                case 'name-asc': return a.tarif.localeCompare(b.tarif);
                default: return 0;
            }
        });
        
        angezeigteTarife = 20;
        renderProvisionen();
    }
    
    function quickFilterProv(typ) {
        document.getElementById('prov-search').value = '';
        document.getElementById('prov-anbieter-filter').value = 'alle';
        
        switch(typ) {
            case 'top100':
                gefilterteProvisionen = ALLE_PROVISIONEN.filter(t => t.provision >= 100);
                break;
            case 'top200':
                gefilterteProvisionen = ALLE_PROVISIONEN.filter(t => t.provision >= 200);
                break;
            case 'unlimited':
                // Nur echte Unlimited-Mobilfunk-Tarife (nicht DSL/Internet und nicht TÃ¼rkei-Flat)
                gefilterteProvisionen = ALLE_PROVISIONEN.filter(t => {
                    const daten = t.daten.toLowerCase();
                    const tarif = t.tarif.toLowerCase();
                    // Muss "unlimited" im Datenfeld haben
                    const istUnlimited = daten.includes('unlimited');
                    // AusschlieÃŸen: DSL, Glasfaser, Internet-Tarife, On Demand (Internet)
                    const istInternet = daten.includes('dsl') || daten.includes('glasfaser') || daten.includes('mbit/s dsl') || daten.includes('mbit/s glasfaser') || tarif.includes('dsl') || tarif.includes('glasfaser');
                    const istOnDemandInternet = tarif.includes('unlimited on demand') && (daten.includes('mbit/s') && !daten.includes('unlimited'));
                    return istUnlimited && !istInternet && !istOnDemandInternet;
                });
                break;
            case 'guenstig':
                gefilterteProvisionen = ALLE_PROVISIONEN.filter(t => t.preis < 20);
                break;
        }
        
        gefilterteProvisionen.sort((a, b) => b.provision - a.provision);
        angezeigteTarife = 20;
        renderProvisionen();
    }
    
    function clearProvFilter() {
        document.getElementById('prov-search').value = '';
        document.getElementById('prov-anbieter-filter').value = 'alle';
        document.getElementById('prov-sort').value = 'provision-desc';
        gefilterteProvisionen = [...ALLE_PROVISIONEN];
        gefilterteProvisionen.sort((a, b) => b.provision - a.provision);
        angezeigteTarife = 20;
        renderProvisionen();
    }
    
    function loadMoreProvisionen() {
        angezeigteTarife += 20;
        renderProvisionen();
    }
    </script>
    
    <!-- ğŸ“ Akademie-System -->
    <!-- NEUES AKADEMIE-SYSTEM - 8 Module -->
    <script src="js/akademie-system-NEU.js"></script>
    <script src="js/akademie-module-extra.js"></script>
    <script src="js/akademie-module-extra2.js"></script>
    <script src="js/akademie-functions.js"></script>
    
    <!-- ========================================= -->
    <!-- ğŸ“‹ VERTRAGS-DETAILS-MODAL -->
    <!-- ========================================= -->
    <div id="vertrag-details-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 20000; align-items: center; justify-content: center; padding: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch;">
        <div style="background: white; border-radius: 16px; width: 100%; max-width: 800px; max-height: 95vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s; -webkit-overflow-scrolling: touch;">
            <!-- Header -->
            <div style="padding: 1rem 1.25rem; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; background: white; z-index: 10; border-radius: 16px 16px 0 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; color: #1a202c; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-file-contract" style="color: var(--primary);"></i>
                        Vertrags-Details
                    </h2>
                    <button onclick="closeVertragDetailsModal()" style="background: #f1f5f9; border: none; font-size: 1.2rem; cursor: pointer; color: #64748b; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Content -->
            <div style="padding: 1.25rem;">
                <!-- Vertragsnummer & Status -->
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding: 1rem; background: linear-gradient(135deg, #f7fafc, #edf2f7); border-radius: 12px;">
                    <div>
                        <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">Vertragsnummer</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--text);" id="detail-vertragsnr">-</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">Status</div>
                        <span id="detail-status" class="status-badge">-</span>
                    </div>
                </div>
                
                <!-- Kundendaten -->
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin: 0 0 1rem 0; color: var(--text); font-size: 1.125rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-user" style="color: var(--primary);"></i> Kundendaten
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Name</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-kunde-name">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Email</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-kunde-email">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Telefon</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-kunde-telefon">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Geburtsdatum</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-kunde-geburtsdatum">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Vertragsdaten -->
                <div style="margin-bottom: 2rem;">
                    <h3 style="margin: 0 0 1rem 0; color: var(--text); font-size: 1.125rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-file-alt" style="color: var(--primary);"></i> Vertragsdaten
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Datum</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-datum">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Kategorie</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-kategorie">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Anbieter</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-anbieter">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Produkt</div>
                            <div style="font-weight: 600; color: var(--text);" id="detail-produkt">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.25rem;">Provision</div>
                            <div style="font-weight: 700; font-size: 1.25rem; color: var(--success);" id="detail-provision">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Stornieren Button (nur wenn erlaubt) -->
                <div id="detail-stornieren-container" style="display: none; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e2e8f0;">
                    <button 
                        id="detail-stornieren-btn"
                        onclick="openStornierungModalFromDetails()" 
                        class="btn-danger" 
                        style="width: 100%; padding: 1rem; font-size: 1rem; border-radius: 12px; display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
                        <i class="fas fa-times-circle" style="font-size: 1.25rem;"></i>
                        <span>Vertrag stornieren</span>
                    </button>
                </div>
            </div>
            
            <!-- Footer -->
            <div style="padding: 1.5rem 2rem; border-top: 2px solid #e2e8f0; background: #f7fafc; border-radius: 0 0 20px 20px;">
                <button onclick="closeVertragDetailsModal()" class="btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem; border-radius: 12px;">
                    <i class="fas fa-check"></i> SchlieÃŸen
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- ğŸš« STORNIERUNG-MODAL -->
    <!-- ========================================= -->
    <div id="stornierung-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s;">
            <div style="padding: 2rem; border-bottom: 2px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; color: #1a202c; font-size: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-times-circle" style="color: var(--danger);"></i>
                        Vertrag stornieren
                    </h2>
                    <button onclick="closeStornierungModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096; padding: 8px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div style="padding: 2rem;">
                <!-- 14-Tage-Warnung (wird dynamisch angezeigt) -->
                <div id="stornierung-warnung" style="display: none; padding: 1rem; background: linear-gradient(135deg, #fed7d7, #feb2b2); border-left: 4px solid var(--danger); border-radius: 8px; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="fas fa-exclamation-triangle" style="color: var(--danger); font-size: 1.5rem; margin-top: 0.25rem;"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: var(--danger); margin-bottom: 0.5rem;">âš ï¸ Widerrufsrecht noch aktiv!</div>
                            <div style="font-size: 0.9rem; color: #742a2a; line-height: 1.5;">
                                <span id="stornierung-tage-text">Der Vertrag ist weniger als 14 Tage alt.</span> 
                                Der Kunde kann vom Widerrufsrecht Gebrauch machen. 
                                <strong>Die Stornierung ist trotzdem mÃ¶glich, wird aber an den Admin gemeldet.</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Info-Box -->
                <div style="padding: 1rem; background: #ebf8ff; border-left: 4px solid var(--info); border-radius: 8px; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="fas fa-info-circle" style="color: var(--info); font-size: 1.25rem; margin-top: 0.25rem;"></i>
                        <div style="flex: 1; font-size: 0.9rem; color: #2c5282; line-height: 1.5;">
                            <strong>Hinweis:</strong> Eine Stornierung ist <strong>endgÃ¼ltig</strong> und kann nicht rÃ¼ckgÃ¤ngig gemacht werden. 
                            Der Admin wird Ã¼ber die Stornierung informiert.
                        </div>
                    </div>
                </div>
                
                <!-- Vertrags-Info -->
                <div style="padding: 1rem; background: var(--bg); border-radius: 8px; margin-bottom: 1.5rem;">
                    <div style="font-size: 0.875rem; color: var(--text-light); margin-bottom: 0.5rem;">Vertrag:</div>
                    <div style="font-weight: 600; font-size: 1.1rem;" id="stornierung-vertrag-info">Wird geladen...</div>
                </div>
                
                <!-- Grund auswÃ¤hlen -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text);">
                        <i class="fas fa-list"></i> Grund fÃ¼r Stornierung *
                    </label>
                    <select id="stornierung-grund" style="width: 100%; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: white;" required>
                        <option value="">Bitte wÃ¤hlen...</option>
                        <option value="kunde_widerruf">Kunde hat Widerrufsrecht genutzt</option>
                        <option value="kunde_storniert">Kunde hat storniert (nach 14 Tagen)</option>
                        <option value="bonitaet">BonitÃ¤tsprÃ¼fung negativ</option>
                        <option value="anbieter_lehnt_ab">Anbieter lehnt ab</option>
                        <option value="fehlerhafte_daten">Fehlerhafte Daten / Dokumente</option>
                        <option value="duplikat">Duplikat / Doppelter Vertrag</option>
                        <option value="sonstiges">Sonstiges</option>
                    </select>
                </div>
                
                <!-- Beschreibung -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text);">
                        <i class="fas fa-comment-alt"></i> ZusÃ¤tzliche Beschreibung *
                    </label>
                    <textarea id="stornierung-beschreibung" placeholder="Bitte gib hier eine detaillierte ErklÃ¤rung an (min. 20 Zeichen)..." style="width: 100%; min-height: 120px; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical;" required></textarea>
                    <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 0.5rem;" id="stornierung-char-count">0 / 20 Zeichen (min.)</div>
                </div>
                
                <!-- Buttons -->
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button onclick="closeStornierungModal()" style="padding: 0.75rem 1.5rem; background: var(--border); color: var(--text); border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                        <i class="fas fa-times"></i> Abbrechen
                    </button>
                    <button id="stornierung-submit-btn" onclick="submitStornierung()" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, var(--danger), #e53e3e); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);">
                        <i class="fas fa-check-circle"></i> Stornierung bestÃ¤tigen
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>

    <!-- ğŸ¤– KI VERKAUFSTRAINER JAVASCRIPT -->
    <script>
        // =====================================================
        // ğŸ¤– KI VERKAUFSTRAINER - KOMPLETTE IMPLEMENTIERUNG
        // =====================================================

        // Mode Switching
        function switchKIMode(mode) {
            // Update buttons
            document.querySelectorAll('.ki-mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('ki-mode-' + mode).classList.add('active');

            // Update content
            document.querySelectorAll('.ki-mode-content').forEach(content => content.classList.remove('active'));
            document.getElementById('ki-content-' + mode).classList.add('active');

            console.log('ğŸ¤– KI-Modus gewechselt zu:', mode);
        }

        // =====================================================
        // ğŸ’¬ CHAT MODUS
        // =====================================================

        // ğŸ§  ERWEITERTE WISSENSBASIS FÃœR DEN KI-VERKAUFSTRAINER
        const kiKnowledgeBase = {
            // === MOBILFUNK BERATUNG ===
            mobilfunk_beratung: {
                keywords: ['handyvertrag', 'mobilfunk', 'tarif', 'handy', 'smartphone', 'vertrag', 'kunde will', 'beraten'],
                response: `<p><strong>ğŸ“± Handyvertrag-Verkauf - Dein Leitfaden:</strong></p>
                
<p><strong>1. Bedarfsanalyse (die wichtigsten Fragen):</strong></p>
<ul>
    <li>"Wie viel Datenvolumen nutzen Sie aktuell?"</li>
    <li>"Telefonieren Sie viel oder hauptsÃ¤chlich WhatsApp?"</li>
    <li>"Welches Netz haben Sie aktuell? Zufrieden?"</li>
    <li>"Brauchen Sie ein neues Handy oder nur einen Tarif?"</li>
    <li>"Wie wichtig ist Ihnen die NetzqualitÃ¤t auf dem Land?"</li>
</ul>

<p><strong>2. Tarif-Empfehlungen:</strong></p>
<ul>
    <li>ğŸ”· <strong>Viel-Surfer (20GB+):</strong> O2 Grow, Telekom Magenta XL</li>
    <li>ğŸ”· <strong>Preis-Bewusst:</strong> 1&1, freenet, congstar</li>
    <li>ğŸ”· <strong>Beste NetzqualitÃ¤t:</strong> Telekom D1-Netz</li>
    <li>ğŸ”· <strong>Gutes P/L:</strong> O2 oder Vodafone</li>
    <li>ğŸ”· <strong>TÃ¼rkei-Flat:</strong> ay yÄ±ldÄ±z</li>
</ul>

<p><strong>3. Provisions-Ãœbersicht:</strong></p>
<ul>
    <li>SIM-Only: 35â‚¬ - 120â‚¬</li>
    <li>Mit Handy: bis zu 1.000â‚¬!</li>
    <li style="font-size: 11px; color: #64748b;">(Tarif + Handy-Provision kombiniert)</li>
</ul>

<p style="color: #22c55e;"><strong>ğŸ’¡ Abschluss-Tipp:</strong> "Soll ich Ihnen zeigen wie einfach der Wechsel ist? Dauert nur 5 Minuten!"</p>`
            },

            // === ZU TEUER EINWAND ===
            zu_teuer: {
                keywords: ['teuer', 'preis', 'gÃ¼nstiger', 'kosten', 'billig', 'rabatt', 'reduzier', 'nachlass'],
                response: `<p><strong>ğŸ’° "Zu teuer!" - So reagierst du richtig:</strong></p>

<p><strong>Schritt 1: Nachfragen (nicht verteidigen!)</strong></p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px; border-left: 3px solid #6366f1;">
"Ich verstehe. Darf ich fragen: Was genau erscheint Ihnen zu teuer - der monatliche Betrag oder die Gesamtkosten?"
</p>

<p><strong>Schritt 2: Wert zeigen</strong></p>
<ul>
    <li>Tagespreis: "Das sind nur 1,33â‚¬ pro Tag"</li>
    <li>Vergleich: "Weniger als ein Kaffee tÃ¤glich"</li>
    <li>Leistungen auflisten: "DafÃ¼r bekommen Sie..."</li>
    <li>Ersparnis berechnen: "GegenÃ¼ber Ihrem jetzigen Tarif sparen Sie..."</li>
</ul>

<p><strong>Schritt 3: Alternative anbieten</strong></p>
<p style="background: #dcfce7; padding: 10px; border-radius: 8px;">
"Wir haben auch gÃ¼nstigere Tarife. Was wÃ¤re denn Ihr Wunschbudget pro Monat?"
</p>

<p><strong>ğŸš« NIEMALS:</strong></p>
<ul>
    <li>Sofort Rabatt geben</li>
    <li>Den Preis verteidigen</li>
    <li>NervÃ¶s werden</li>
</ul>

<p style="color: #6366f1;"><strong>Merke:</strong> Erst WERT zeigen, dann Ã¼ber Alternativen sprechen!</p>`
            },

            // === ABSCHLUSS TECHNIKEN ===
            abschluss_tipps: {
                keywords: ['abschluss', 'abschlieÃŸen', 'verkaufen', 'deal', 'unterschrift', 'kaufen', 'bestellen'],
                response: `<p><strong>âœ… Abschluss-Techniken fÃ¼r Profis:</strong></p>

<p><strong>1. Direkte Abschlussfrage:</strong></p>
<p style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px;">"Sollen wir den Vertrag jetzt fertig machen?"</p>

<p><strong>2. Alternativ-Frage:</strong></p>
<p style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px;">"MÃ¶chten Sie das iPhone in Schwarz oder WeiÃŸ?"</p>

<p><strong>3. Zusammenfassung:</strong></p>
<p style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px;">"Also: Unlimited Daten, iPhone 15, 39,99â‚¬/Monat. Passt das fÃ¼r Sie?"</p>

<p><strong>4. Zeitdruck (nur wenn ehrlich!):</strong></p>
<p style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px;">"Diese Aktion lÃ¤uft nur noch bis Freitag."</p>

<p><strong>5. Probeabschluss:</strong></p>
<p style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px;">"Wenn der Preis passen wÃ¼rde, wÃ¤re das Angebot interessant fÃ¼r Sie?"</p>

<p><strong>ğŸ” Kaufsignale erkennen:</strong></p>
<ul>
    <li>âœ… Fragt nach Lieferzeit</li>
    <li>âœ… Fragt nach Farben/Details</li>
    <li>âœ… Rechnet selbst nach</li>
    <li>âœ… Nickt zustimmend</li>
    <li>âœ… Lehnt sich vor</li>
    <li>âœ… Sagt "eigentlich ganz gut"</li>
</ul>

<p style="color: #22c55e;"><strong>Bei Kaufsignal â†’ SOFORT abschlieÃŸen!</strong></p>`
            },

            // === DSL BERATUNG ===
            dsl_empfehlung: {
                keywords: ['dsl', 'internet', 'wlan', 'router', 'glasfaser', 'wifi', 'home', 'zuhause'],
                response: `<p><strong>ğŸŒ DSL/Internet - Komplette Beratung:</strong></p>

<p><strong>Bedarfsanalyse-Fragen:</strong></p>
<ul>
    <li>"Wie viele Personen nutzen das Internet gleichzeitig?"</li>
    <li>"Streamen Sie Netflix, YouTube, Gaming?"</li>
    <li>"Home-Office mit Videokonferenzen?"</li>
    <li>"Wie zufrieden sind Sie mit Ihrem aktuellen Anbieter?"</li>
</ul>

<p><strong>Empfehlung nach Bedarf:</strong></p>
<table style="width: 100%; font-size: 13px; margin: 10px 0;">
    <tr style="background: #f1f5f9;"><td><strong>1-2 Personen</strong></td><td>50-100 Mbit/s</td></tr>
    <tr><td><strong>Familie (3-4)</strong></td><td>250 Mbit/s</td></tr>
    <tr style="background: #f1f5f9;"><td><strong>Gamer/Streaming</strong></td><td>500 Mbit/s</td></tr>
    <tr><td><strong>Power-User</strong></td><td>1000 Mbit/s (Glasfaser)</td></tr>
</table>

<p><strong>Provisions-Ãœbersicht:</strong></p>
<ul>
    <li>1&1 DSL: 65â‚¬ - 100â‚¬</li>
    <li>Telekom: 80â‚¬ - 120â‚¬</li>
    <li>Vodafone Kabel: 70â‚¬ - 150â‚¬</li>
</ul>

<p style="color: #6366f1;"><strong>ğŸ’¡ Cross-Selling:</strong> "Mobilfunk + DSL zusammen = 10â‚¬ Kombi-Rabatt!"</p>`
            },

            // === STROM & GAS ===
            strom_gas: {
                keywords: ['strom', 'gas', 'energie', 'heizung', 'stadtwerk', 'Ã¶kostrom'],
                response: `<p><strong>âš¡ Strom & Gas verkaufen:</strong></p>

<p><strong>GesprÃ¤chseinstieg:</strong></p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px;">
"Haben Sie schon mal Ihre Stromkosten verglichen? Die meisten Kunden zahlen zu viel ohne es zu wissen."
</p>

<p><strong>Bedarfsanalyse:</strong></p>
<ul>
    <li>"Wie hoch ist Ihre monatliche Abschlagszahlung?"</li>
    <li>"Wann haben Sie zuletzt den Anbieter gewechselt?"</li>
    <li>"Ist Ihnen Ã–kostrom wichtig?"</li>
</ul>

<p><strong>Verkaufsargumente:</strong></p>
<ul>
    <li>âœ… Oft 200-400â‚¬ Ersparnis pro Jahr</li>
    <li>âœ… Wechsel ist kinderleicht (wir kÃ¼ndigen)</li>
    <li>âœ… Preisgarantie fÃ¼r 12-24 Monate</li>
    <li>âœ… Kein Risiko - Versorgung immer garantiert</li>
</ul>

<p><strong>Provision:</strong> 80â‚¬ - 150â‚¬ pro Abschluss</p>

<p style="color: #22c55e;"><strong>ğŸ’¡ Tipp:</strong> Immer den aktuellen Verbrauch (kWh) erfragen fÃ¼r genaue Berechnung!</p>`
            },

            // === VERSICHERUNG ===
            versicherung: {
                keywords: ['versicherung', 'schutz', 'handy versicherung', 'haftpflicht', 'absicher'],
                response: `<p><strong>ğŸ›¡ï¸ Versicherungen verkaufen:</strong></p>

<p><strong>Handy-Versicherung (Zusatzverkauf!):</strong></p>
<p style="background: #fef3c7; padding: 10px; border-radius: 8px;">
"Ihr neues iPhone kostet 1.200â‚¬. FÃ¼r nur 6,99â‚¬/Monat ist es komplett geschÃ¼tzt gegen Displaybruch, Wasserschaden und Diebstahl."
</p>

<p><strong>Verkaufsargumente:</strong></p>
<ul>
    <li>âœ… Display-Reparatur kostet sonst 300-500â‚¬</li>
    <li>âœ… Diebstahl = Totalverlust ohne Versicherung</li>
    <li>âœ… Weltweit gÃ¼ltig</li>
    <li>âœ… Keine Selbstbeteiligung (je nach Tarif)</li>
</ul>

<p><strong>Wann ansprechen?</strong></p>
<p>IMMER bei Handy-Verkauf! Direkt nach dem Abschluss:</p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px;">
"Eine Frage noch: MÃ¶chten Sie Ihr neues GerÃ¤t absichern? Bei dem Wert wÃ¼rde ich das empfehlen."
</p>

<p><strong>Provision:</strong> 25â‚¬ - 60â‚¬ pro Versicherung</p>

<p style="color: #6366f1;"><strong>ğŸ’¡ Merke:</strong> Handy-Versicherung = leichter Zusatzverdienst bei JEDEM Verkauf!</p>`
            },

            // === EINWAND: ICH MUSS ÃœBERLEGEN ===
            ueberlegen: {
                keywords: ['Ã¼berlegen', 'nachdenken', 'Ã¼berleg', 'spÃ¤ter', 'morgen', 'zeit'],
                response: `<p><strong>ğŸ¤” "Ich muss darÃ¼ber nachdenken"</strong></p>

<p><strong>Die Power-Frage:</strong></p>
<p style="background: #6366f1; color: white; padding: 12px; border-radius: 8px;">
"Das verstehe ich vollkommen. Nur um sicher zu gehen: Was genau mÃ¶chten Sie sich Ã¼berlegen? Vielleicht kann ich Ihnen dabei helfen."
</p>

<p><strong>Typische echte GrÃ¼nde:</strong></p>
<ul>
    <li><strong>Preis:</strong> â†’ Wert-Argumentation oder Alternative</li>
    <li><strong>Partner fragen:</strong> â†’ Termin vereinbaren</li>
    <li><strong>Unsicherheit:</strong> â†’ Garantien/Widerruf betonen</li>
    <li><strong>Kein echtes Interesse:</strong> â†’ HÃ¶flich verabschieden</li>
</ul>

<p><strong>Termin sichern:</strong></p>
<p style="background: #dcfce7; padding: 10px; border-radius: 8px;">
"Kein Problem! Wann passt es Ihnen besser - sollen wir morgen oder Ã¼bermorgen nochmal telefonieren?"
</p>

<p style="color: #f59e0b;"><strong>âš ï¸ Wichtig:</strong> IMMER einen konkreten Folgetermin vereinbaren!</p>`
            },

            // === EINWAND: PARTNER FRAGEN ===
            partner_fragen: {
                keywords: ['partner', 'frau', 'mann', 'fragen', 'besprechen', 'familie'],
                response: `<p><strong>ğŸ‘« "Ich muss meinen Partner fragen"</strong></p>

<p><strong>VerstÃ¤ndnis zeigen & einbeziehen:</strong></p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px;">
"Das ist sehr vernÃ¼nftig! Ist Ihr Partner/Ihre Partnerin vielleicht gerade erreichbar? Ich erklÃ¤re gerne alles nochmal."
</p>

<p><strong>Wenn nicht erreichbar:</strong></p>
<ul>
    <li>Termin mit beiden vereinbaren</li>
    <li>Angebot schriftlich mitgeben</li>
    <li>Wichtige Punkte markieren</li>
    <li>Telefonnummer fÃ¼r RÃ¼ckfragen geben</li>
</ul>

<p><strong>Materialien vorbereiten:</strong></p>
<p>Gib dem Kunden etwas mit:</p>
<ul>
    <li>âœ… AngebotsÃ¼bersicht</li>
    <li>âœ… Deine Visitenkarte</li>
    <li>âœ… Wichtige Vorteile markiert</li>
</ul>

<p style="color: #6366f1;"><strong>ğŸ’¡ Tipp:</strong> "Soll ich Ihnen ein kurzes Video schicken, das alles erklÃ¤rt?"</p>`
            },

            // === SIM-ONLY TARIFE ===
            sim_only: {
                keywords: ['sim', 'nur tarif', 'kein handy', 'sim-karte', 'simkarte', 'ohne gerÃ¤t'],
                response: `<p><strong>ğŸ’³ SIM-Only Tarife - Die Basics:</strong></p>

<p><strong>FÃ¼r wen geeignet?</strong></p>
<ul>
    <li>Kunden mit eigenem Handy</li>
    <li>Preis-Bewusste</li>
    <li>Zweitkarte/Tablet</li>
</ul>

<p><strong>Top-Tarife nach Netz:</strong></p>
<table style="width: 100%; font-size: 13px; margin: 10px 0;">
    <tr style="background: #f1f5f9;"><td><strong>Telekom-Netz</strong></td><td>congstar, fraenk</td></tr>
    <tr><td><strong>Vodafone-Netz</strong></td><td>otelo, freenet</td></tr>
    <tr style="background: #f1f5f9;"><td><strong>O2-Netz</strong></td><td>O2 Free, 1&1</td></tr>
</table>

<p><strong>Upselling-MÃ¶glichkeit:</strong></p>
<p style="background: #fef3c7; padding: 10px; border-radius: 8px;">
"Wie alt ist Ihr aktuelles Handy? FÃ¼r nur Xâ‚¬ mehr im Monat bekommen Sie das neueste Modell dazu!"
</p>

<p><strong>Provision:</strong> 35â‚¬ - 120â‚¬ pro Vertrag</p>

<p style="color: #22c55e;"><strong>ğŸ’¡ Ziel:</strong> Immer versuchen, zum Vertrag MIT Handy upzusellen!</p>`
            },

            // === PORTIERUNG / RUFNUMMERNMITNAHME ===
            portierung: {
                keywords: ['portierung', 'rufnummer', 'nummer mitnehmen', 'alte nummer', 'wechsel'],
                response: `<p><strong>ğŸ“± Rufnummernmitnahme erklÃ¤rt:</strong></p>

<p><strong>So erklÃ¤rst du es dem Kunden:</strong></p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px;">
"Sie kÃ¶nnen Ihre Nummer natÃ¼rlich behalten! Das machen wir automatisch fÃ¼r Sie - Sie mÃ¼ssen nur das Formular unterschreiben."
</p>

<p><strong>Der Ablauf:</strong></p>
<ol>
    <li>Kunde unterschreibt Portierungsauftrag</li>
    <li>Wir kÃ¼ndigen beim alten Anbieter (oder Kunde macht es)</li>
    <li>Nummer wird zum Vertragsstart Ã¼bertragen</li>
    <li>Fertig! ğŸ‰</li>
</ol>

<p><strong>Wichtig zu wissen:</strong></p>
<ul>
    <li>âœ… Portierung ist gesetzlich garantiert</li>
    <li>âœ… Kostet beim alten Anbieter max. 6,82â‚¬</li>
    <li>âœ… Bonus bei uns: oft 25â‚¬ Gutschrift!</li>
    <li>â±ï¸ Dauer: ca. 1-3 Werktage</li>
</ul>

<p style="color: #6366f1;"><strong>ğŸ’¡ Verkaufsargument:</strong> "Die 25â‚¬ Portierungsbonus decken die Kosten komplett!"</p>`
            },

            // === GESPRÃ„CHSERÃ–FFNUNG ===
            gespraechseinstieg: {
                keywords: ['gesprÃ¤chs', 'einstieg', 'anfang', 'begrÃ¼ÃŸ', 'ansprechen', 'start gesprÃ¤ch'],
                response: `<p><strong>ğŸ‘‹ Perfekte GesprÃ¤chserÃ¶ffnung:</strong></p>

<p><strong>Im Laden/am Stand:</strong></p>
<p style="background: #f1f5f9; padding: 10px; border-radius: 8px;">
"Guten Tag! Darf ich fragen, was Sie hierher fÃ¼hrt? Suchen Sie etwas Bestimmtes?"
</p>

<p><strong>NICHT sagen:</strong></p>
<ul style="color: #dc2626;">
    <li>âŒ "Kann ich helfen?" (zu schwach)</li>
    <li>âŒ "Wollen Sie was kaufen?" (zu direkt)</li>
    <li>âŒ "Schauen Sie sich nur um?" (gibt Ausrede)</li>
</ul>

<p><strong>Bessere Alternativen:</strong></p>
<ul>
    <li>âœ… "Was darf ich Ihnen zeigen?"</li>
    <li>âœ… "Haben Sie schon etwas im Blick?"</li>
    <li>âœ… "Interessieren Sie sich fÃ¼r Handys oder Tarife?"</li>
</ul>

<p><strong>Bei "Ich schaue nur":</strong></p>
<p style="background: #dcfce7; padding: 10px; border-radius: 8px;">
"Sehr gern! Falls Sie Fragen haben - ich bin hier. Ãœbrigens: Wir haben gerade eine Aktion auf [Produkt]..."
</p>`
            },

            // === KAUFSIGNALE ===
            kaufsignale: {
                keywords: ['kaufsignal', 'interesse', 'wann abschlieÃŸ', 'merken', 'erkennen'],
                response: `<p><strong>ğŸ¯ Kaufsignale erkennen:</strong></p>

<p><strong>Verbale Signale:</strong></p>
<ul>
    <li>âœ… "Wann kann ich das abholen?"</li>
    <li>âœ… "Gibt es das auch in Blau?"</li>
    <li>âœ… "Wie lange dauert der Vertrag?"</li>
    <li>âœ… "Was kostet das genau?"</li>
    <li>âœ… "Kann ich das mal ausprobieren?"</li>
    <li>âœ… "Eigentlich ganz gut..."</li>
</ul>

<p><strong>KÃ¶rpersprache:</strong></p>
<ul>
    <li>âœ… Lehnt sich vor</li>
    <li>âœ… Nickt zustimmend</li>
    <li>âœ… HÃ¤lt Produkt fest</li>
    <li>âœ… Schaut zur Kasse/Ausgang</li>
    <li>âœ… Entspannte Haltung</li>
</ul>

<p style="background: #22c55e; color: white; padding: 12px; border-radius: 8px; text-align: center;">
<strong>Bei Kaufsignal â†’ SOFORT Abschlussfrage stellen!</strong>
</p>

<p style="color: #f59e0b;"><strong>âš ï¸ HÃ¤ufiger Fehler:</strong> Zu lange weitererklÃ¤ren statt abzuschlieÃŸen!</p>`
            },

            // === AKADEMIE-INHALTE ===
            akademie: {
                keywords: ['akademie', 'schulung', 'kurs', 'modul', 'lernen', 'training', 'video', 'lektion', 'zertifikat'],
                response: `<p><strong>ğŸ“ Partner-Akademie - Deine Schulungs-Module:</strong></p>

<p>Wir haben <strong>7 komplette Schulungsmodule</strong> fÃ¼r dich:</p>

<div style="margin: 12px 0;">
<p style="background: #dbeafe; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ“š Modul 1: Grundlagen Mobilfunk</strong><br>
12 Lektionen â€¢ 90 Min â€¢ <span style="color: #22c55e;">PFLICHT</span><br>
<small>Tarife, Netze, Provider-Ãœbersicht</small>
</p>

<p style="background: #dcfce7; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ§  Modul 2: Verkaufspsychologie</strong><br>
15 Lektionen â€¢ 120 Min â€¢ <span style="color: #22c55e;">PFLICHT</span><br>
<small>Bedarfsanalyse, Fragetechniken, Nutzen-Argumentation</small>
</p>

<p style="background: #fef3c7; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ›¡ï¸ Modul 3: Einwandbehandlung</strong><br>
18 Lektionen â€¢ 105 Min â€¢ <span style="color: #ef4444;">TOP EMPFOHLEN</span><br>
<small>"Zu teuer", "Muss Ã¼berlegen" - 50+ Beispiele!</small>
</p>

<p style="background: #fee2e2; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ¯ Modul 4: Abschlusstechniken</strong><br>
14 Lektionen â€¢ 95 Min â€¢ <span style="color: #22c55e;">PFLICHT</span><br>
<small>Closing-Skripte, Kaufsignale erkennen</small>
</p>

<p style="background: #e0e7ff; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ“¦ Modul 5: Produktwissen</strong><br>
22 Lektionen â€¢ 180 Min â€¢ <span style="color: #22c55e;">PFLICHT</span><br>
<small>DSL, Mobilfunk, Strom, Versicherungen</small>
</p>

<p style="background: #f3e8ff; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ“ Modul 6: Kaltakquise</strong><br>
16 Lektionen â€¢ 110 Min<br>
<small>Lead-Generierung, Networking, Social Selling</small>
</p>

<p style="background: #fce7f3; padding: 10px; border-radius: 8px; margin: 8px 0;">
<strong>ğŸ’ª Modul 7: Mindset & Motivation</strong><br>
<small>ErfolgsmentalitÃ¤t, Ziele setzen</small>
</p>
</div>

<p style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 12px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="showPage('akademie')">
<strong>ğŸ‘‰ Zur Akademie wechseln</strong>
</p>`
            },

            // === PROVISIONEN / VERDIENST ===
            provision: {
                keywords: ['provision', 'verdien', 'geld', 'euro', 'lohn', 'gehalt', 'wie viel', 'provision'],
                response: `<p><strong>ğŸ’° Provisions-Ãœbersicht (Echte Partner-Tool Tarife):</strong></p>

<p><strong>ğŸ“± Mobilfunk SIM-Only:</strong></p>
<ul>
    <li>O2 Direkt: 15â‚¬ - 40â‚¬</li>
    <li>freenet O2: 105â‚¬ - <strong style="color: #22c55e;">510â‚¬</strong> ğŸ”¥</li>
    <li>freenet Telekom: 210â‚¬ - <strong style="color: #22c55e;">425â‚¬</strong> ğŸ”¥</li>
    <li>freenet Vodafone: 125â‚¬ - <strong style="color: #22c55e;">420â‚¬</strong> ğŸ”¥</li>
    <li>1&1: 50â‚¬ - 120â‚¬</li>
    <li>Ay YÄ±ldÄ±z: 100â‚¬ - 260â‚¬</li>
    <li>Yourfone: 125â‚¬ - 200â‚¬</li>
</ul>

<p><strong>ğŸ“± Mobilfunk + Handy:</strong></p>
<ul>
    <li>Tarif-Provision + Handy-Provision</li>
    <li><strong>Bis zu 1.000â‚¬ pro Vertrag mÃ¶glich!</strong></li>
</ul>

<p><strong>ğŸŒ DSL/Internet (1&1):</strong></p>
<ul>
    <li>DSL 50: 50â‚¬</li>
    <li>DSL 100: 70â‚¬</li>
    <li>Glasfaser 1000: 100â‚¬</li>
</ul>

<p><strong>âš¡ Strom/Gas:</strong></p>
<ul>
    <li>Privatkunde: 25â‚¬ - 75â‚¬</li>
    <li>Gewerbekunde: 25â‚¬ - 75â‚¬</li>
</ul>

<p style="background: #dcfce7; padding: 12px; border-radius: 8px;">
<strong>ğŸ† Top-Tarife fÃ¼r maximale Provision:</strong><br>
â€¢ freenet Telekom Magenta XL: <strong>425â‚¬</strong><br>
â€¢ freenet O2 Unlimited Max 2024: <strong>510â‚¬</strong><br>
â€¢ freenet Vodafone 100 GB m.H.10: <strong>420â‚¬</strong>
</p>`
            },

            // === DEFAULT - INTELLIGENTE FALLBACK ===
            default: {
                response: `<p><strong>Gute Frage! ğŸ’ª</strong></p>

<p>Als dein KI-Verkaufstrainer helfe ich dir bei:</p>

<p><strong>ğŸ“± Produktberatung:</strong></p>
<ul>
    <li>HandyvertrÃ¤ge & Tarife</li>
    <li>DSL & Internet</li>
    <li>Strom & Gas</li>
    <li>Versicherungen</li>
</ul>

<p><strong>ğŸ’¬ Verkaufstechniken:</strong></p>
<ul>
    <li>GesprÃ¤chserÃ¶ffnung</li>
    <li>Bedarfsanalyse</li>
    <li>Abschlusstechniken</li>
    <li>Kaufsignale erkennen</li>
</ul>

<p><strong>ğŸ›¡ï¸ Einwandbehandlung:</strong></p>
<ul>
    <li>"Zu teuer"</li>
    <li>"Muss Ã¼berlegen"</li>
    <li>"Partner fragen"</li>
    <li>Und viele mehr...</li>
</ul>

<p><strong>ğŸ“ Akademie-Schulungen:</strong></p>
<ul>
    <li>7 Module mit 97+ Lektionen</li>
    <li>Grundlagen bis Profi-Level</li>
    <li>Video-Tutorials & Quizzes</li>
</ul>

<p style="background: #dbeafe; padding: 12px; border-radius: 8px; margin-top: 12px;">
<strong>ğŸ’¡ Tipp:</strong> Frag mich nach "Akademie", "Provisionen" oder nutze die Schnellfragen unten!
</p>`
            }
        };

        // Erweiterte Question-Map
        function askKIQuestion(topic) {
            const questionMap = {
                'mobilfunk_beratung': 'Wie berate ich einen Kunden zum Handyvertrag?',
                'zu_teuer': 'Der Kunde sagt "das ist mir zu teuer"',
                'abschluss_tipps': 'Wie schlieÃŸe ich am besten ab?',
                'dsl_empfehlung': 'Kunde braucht DSL/Internet - wie berate ich?',
                'ueberlegen': 'Der Kunde sagt "ich muss darÃ¼ber nachdenken"',
                'partner_fragen': 'Der Kunde muss seinen Partner fragen',
                'strom_gas': 'Wie verkaufe ich Strom und Gas?',
                'versicherung': 'Wie verkaufe ich Handy-Versicherungen?',
                'sim_only': 'Kunde will nur einen SIM-Tarif',
                'portierung': 'Wie funktioniert die Rufnummernmitnahme?',
                'gespraechseinstieg': 'Wie beginne ich ein VerkaufsgesprÃ¤ch?',
                'kaufsignale': 'Woran erkenne ich Kaufsignale?',
                'akademie': 'Welche Schulungen gibt es in der Akademie?',
                'provision': 'Wie viel Provision bekomme ich pro Tarif?'
            };

            const displayText = questionMap[topic] || topic;
            addKIUserMessage(displayText);
            
            setTimeout(() => {
                if (kiKnowledgeBase[topic]) {
                    addKIBotMessage(kiKnowledgeBase[topic].response);
                } else {
                    addKIBotMessage(kiKnowledgeBase.default.response);
                }
            }, 500);
        }

        function sendKIMessage() {
            const input = document.getElementById('ki-chat-input');
            const message = input.value.trim();
            if (!message) return;

            addKIUserMessage(message);
            input.value = '';

            // Show typing
            showKITyping();

            setTimeout(() => {
                hideKITyping();
                const response = findKIResponse(message);
                addKIBotMessage(response);
            }, 800 + Math.random() * 500);
        }

        function handleKIChatKeypress(event) {
            if (event.key === 'Enter') sendKIMessage();
        }

        function addKIUserMessage(text) {
            const container = document.getElementById('ki-chat-messages');
            const div = document.createElement('div');
            div.className = 'ki-message user-message';
            div.innerHTML = `
                <div class="ki-message-avatar"><i class="fas fa-user"></i></div>
                <div class="ki-message-content"><p>${escapeHtml(text)}</p></div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addKIBotMessage(html) {
            const container = document.getElementById('ki-chat-messages');
            const div = document.createElement('div');
            div.className = 'ki-message bot-message';
            div.innerHTML = `
                <div class="ki-message-avatar"><i class="fas fa-robot"></i></div>
                <div class="ki-message-content">${html}</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showKITyping() {
            const container = document.getElementById('ki-chat-messages');
            const div = document.createElement('div');
            div.id = 'ki-typing';
            div.className = 'ki-message bot-message';
            div.innerHTML = `
                <div class="ki-message-avatar"><i class="fas fa-robot"></i></div>
                <div class="ki-message-content">
                    <div class="typing-indicator"><span></span><span></span><span></span></div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function hideKITyping() {
            const typing = document.getElementById('ki-typing');
            if (typing) typing.remove();
        }

        // VERBESSERTE Response-Logik mit intelligentem Matching
        function findKIResponse(message) {
            const lower = message.toLowerCase();
            
            // Direkte Phrase-Matches (hÃ¶chste PrioritÃ¤t) - ERWEITERT
            const directMatches = {
                // EinwÃ¤nde
                'zu teuer': 'zu_teuer',
                'teuer': 'zu_teuer',
                'preis': 'zu_teuer',
                'rabatt': 'zu_teuer',
                'gÃ¼nstiger': 'zu_teuer',
                'billiger': 'zu_teuer',
                'Ã¼berlegen': 'ueberlegen',
                'nachdenken': 'ueberlegen',
                'Ã¼berleg': 'ueberlegen',
                'muss noch': 'ueberlegen',
                'partner fragen': 'partner_fragen',
                'frau fragen': 'partner_fragen',
                'mann fragen': 'partner_fragen',
                'kein interesse': 'kein_interesse',
                'nicht interessiert': 'kein_interesse',
                'brauche nicht': 'kein_interesse',
                'vertrag lÃ¤uft': 'vertrag_laeuft',
                'noch vertrag': 'vertrag_laeuft',
                'laufzeit': 'vertrag_laeuft',
                'zufrieden': 'bin_zufrieden',
                'alles gut': 'bin_zufrieden',
                // Produkte
                'handyvertrag': 'mobilfunk_beratung',
                'mobilfunk': 'mobilfunk_beratung',
                'tarif': 'mobilfunk_beratung',
                'handy': 'mobilfunk_beratung',
                'smartphone': 'mobilfunk_beratung',
                'iphone': 'mobilfunk_beratung',
                'samsung': 'mobilfunk_beratung',
                'o2': 'mobilfunk_beratung',
                'telekom': 'mobilfunk_beratung',
                '1&1': 'mobilfunk_beratung',
                'sim only': 'sim_only',
                'sim-only': 'sim_only',
                'nur tarif': 'sim_only',
                'ohne handy': 'sim_only',
                'dsl': 'dsl_empfehlung',
                'internet': 'dsl_empfehlung',
                'glasfaser': 'dsl_empfehlung',
                'wlan': 'dsl_empfehlung',
                'router': 'dsl_empfehlung',
                'strom': 'strom_gas',
                'gas': 'strom_gas',
                'energie': 'strom_gas',
                'versicherung': 'versicherung',
                'schutz': 'versicherung',
                'absichern': 'versicherung',
                // Verkaufstechniken
                'abschluss': 'abschluss_tipps',
                'abschlieÃŸen': 'abschluss_tipps',
                'verkaufen': 'abschluss_tipps',
                'sim': 'sim_only',
                'nur tarif': 'sim_only',
                'portierung': 'portierung',
                'rufnummer': 'portierung',
                'nummer mitnehmen': 'portierung',
                'gesprÃ¤ch': 'gespraechseinstieg',
                'einstieg': 'gespraechseinstieg',
                'begrÃ¼ÃŸ': 'gespraechseinstieg',
                'kaufsignal': 'kaufsignale',
                'signal': 'kaufsignale',
                'interesse erkennen': 'kaufsignale'
            };

            // Erst direkte Matches prÃ¼fen
            for (const [phrase, topic] of Object.entries(directMatches)) {
                if (lower.includes(phrase) && kiKnowledgeBase[topic]) {
                    console.log('ğŸ¤– KI-Trainer Match:', topic);
                    return kiKnowledgeBase[topic].response;
                }
            }

            // Dann Keyword-Scoring
            let bestMatch = null;
            let bestScore = 0;

            for (const [key, data] of Object.entries(kiKnowledgeBase)) {
                if (key === 'default' || !data.keywords) continue;
                
                let score = 0;
                for (const keyword of data.keywords) {
                    if (lower.includes(keyword)) {
                        score += 2;
                    }
                }

                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = data.response;
                }
            }

            if (bestScore >= 2) {
                return bestMatch;
            }

            // Fallback
            console.log('ğŸ¤– KI-Trainer: Kein Match fÃ¼r:', message);
            return kiKnowledgeBase.default.response;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // =====================================================
        // ğŸ›’ PRODUKT-BERATER - ERWEITERT MIT HANDY-AUSWAHL
        // =====================================================

        // Toggle Handy-Optionen je nach Kategorie
        function toggleHandyOptions() {
            const kategorie = document.getElementById('ki-produkt-kategorie').value;
            const handyGruppe = document.getElementById('ki-handy-gruppe');
            if (kategorie === 'mobilfunk') {
                handyGruppe.style.display = 'block';
            } else {
                handyGruppe.style.display = 'none';
            }
        }

        function getProduktEmpfehlung() {
            const kategorie = document.getElementById('ki-produkt-kategorie').value;
            const budget = document.getElementById('ki-produkt-budget').value;
            const handy = document.getElementById('ki-produkt-handy')?.value || '';
            const netz = document.getElementById('ki-produkt-netz')?.value || '';
            const daten = document.getElementById('ki-produkt-daten')?.value || '';
            
            if (!kategorie) {
                alert('Bitte wÃ¤hle eine Kategorie!');
                return;
            }

            const prios = {
                preis: document.getElementById('ki-prio-preis')?.checked || false,
                netz: document.getElementById('ki-prio-netz')?.checked || false,
                daten: document.getElementById('ki-prio-daten')?.checked || false,
                handy: document.getElementById('ki-prio-handy')?.checked || false,
                g5: document.getElementById('ki-prio-5g')?.checked || false,
                ausland: document.getElementById('ki-prio-ausland')?.checked || false
            };

            let empfehlung = generateProduktEmpfehlung(kategorie, budget, handy, netz, daten, prios);

            document.getElementById('ki-empfehlung-content').innerHTML = empfehlung;
            document.getElementById('ki-empfehlung-result').style.display = 'block';
            document.getElementById('ki-empfehlung-result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // =====================================================
        // ğŸ“± ECHTE TARIF-DATENBANK - DEINCHECK PARTNER
        // Korrekte Provisionen: SIM-Only 35-120â‚¬, Mit Handy bis 1.000â‚¬
        // =====================================================
        
        // =====================================================
        // ECHTE PARTNER-TOOL TARIFE (Stand: Januar 2026)
        // Alle Provisionen und Preise aus dem Partner-Tool!
        // =====================================================
        const tarifDatenbank = {
            // === O2 DIREKT TARIFE ===
            'o2-mobile-s': { anbieter: 'O2', name: 'O2 Mobile S (2024)', preis: '14,99â‚¬', daten: '10 GB', netz: 'O2', simOnly: true, provision: '15â‚¬', features: ['Allnet-Flat', 'EU-Roaming', '5G'] },
            'o2-mobile-m': { anbieter: 'O2', name: 'O2 Mobile M (2024)', preis: '19,99â‚¬', daten: '30 GB', netz: 'O2', simOnly: true, provision: '25â‚¬', features: ['Allnet-Flat', 'EU-Roaming', '5G'] },
            'o2-mobile-l': { anbieter: 'O2', name: 'O2 Mobile L (2024)', preis: '24,99â‚¬', daten: '100 GB', netz: 'O2', simOnly: true, provision: '35â‚¬', features: ['Allnet-Flat', '5G', 'Connect'] },
            'o2-mobile-xl': { anbieter: 'O2', name: 'O2 Mobile XL (2024)', preis: '29,99â‚¬', daten: '300 GB', netz: 'O2', simOnly: true, provision: '40â‚¬', features: ['Allnet-Flat', '5G Max', 'Connect'] },
            'o2-unlimited-smart': { anbieter: 'O2', name: 'O2 Unlimited Smart (2024)', preis: '19,99â‚¬', daten: 'Unlimited', netz: 'O2', simOnly: true, provision: '35â‚¬', features: ['Unlimited 15 Mbit/s', 'Allnet-Flat'] },
            'o2-unlimited-max': { anbieter: 'O2', name: 'O2 Mobile Unlimited Max (2025)', preis: '34,99â‚¬', daten: 'Unlimited', netz: 'O2', simOnly: true, provision: '40â‚¬', features: ['Unlimited Max Speed', '5G Max'] },
            
            // === FREENET O2 (TOP PROVISIONEN!) ===
            'freenet-o2-unlimited-max': { anbieter: 'freenet O2', name: 'O2 Unlimited Max 300 MBit/s', preis: '34,99â‚¬', daten: 'Unlimited', netz: 'O2', simOnly: true, provision: '105â‚¬', features: ['300 MBit/s', 'Unlimited', '5G'] },
            'freenet-o2-mobile-s': { anbieter: 'freenet O2', name: 'O2 Mobile S', preis: '29,99â‚¬', daten: '10 GB', netz: 'O2', simOnly: true, provision: '160â‚¬', features: ['Allnet-Flat', '5G'] },
            'freenet-o2-mobile-m': { anbieter: 'freenet O2', name: 'O2 Mobile M', preis: '34,99â‚¬', daten: '30 GB', netz: 'O2', simOnly: true, provision: '170â‚¬', features: ['Allnet-Flat', '5G'] },
            'freenet-o2-mobile-l-plus': { anbieter: 'freenet O2', name: 'O2 Mobile L Plus', preis: '49,99â‚¬', daten: '100 GB', netz: 'O2', simOnly: true, provision: '270â‚¬', features: ['Allnet-Flat', '5G', 'Top-Provision'] },
            'freenet-o2-mobile-xl': { anbieter: 'freenet O2', name: 'O2 Mobile XL', preis: '49,99â‚¬', daten: '300 GB', netz: 'O2', simOnly: true, provision: '255â‚¬', features: ['Allnet-Flat', '5G Max'] },
            'freenet-o2-unlimited-max-2024': { anbieter: 'freenet O2', name: 'O2 Mobile Unlimited Max 2024', preis: '99,99â‚¬', daten: 'Unlimited', netz: 'O2', simOnly: true, provision: '510â‚¬', features: ['Top-Provision!', 'Unlimited Max', '5G Max'] },
            'freenet-o2-allnet-100': { anbieter: 'freenet O2', name: 'Allnet Flat 100 GB', preis: '39,99â‚¬', daten: '100 GB', netz: 'O2', simOnly: true, provision: '190â‚¬', features: ['Allnet-Flat', '5G'] },
            'freenet-o2-allnet-200': { anbieter: 'freenet O2', name: 'Allnet Flat 200 GB', preis: '44,99â‚¬', daten: '200 GB', netz: 'O2', simOnly: true, provision: '225â‚¬', features: ['Allnet-Flat', '5G'] },
            
            // === FREENET TELEKOM (BESTES NETZ + TOP PROVISION) ===
            'freenet-telekom-xl': { anbieter: 'freenet Telekom', name: 'Magenta Mobil XL', preis: '94,95â‚¬', daten: 'Unlimited', netz: 'Telekom', simOnly: true, provision: '425â‚¬', features: ['BESTE PROVISION!', 'Unlimited', 'D1-Netz'] },
            'freenet-telekom-xl-young': { anbieter: 'freenet Telekom', name: 'Magenta Mobil XL Young 5G', preis: '84,95â‚¬', daten: 'Unlimited', netz: 'Telekom', simOnly: true, provision: '405â‚¬', features: ['Young-Tarif', 'Unlimited 5G'] },
            'freenet-telekom-l': { anbieter: 'freenet Telekom', name: 'Magenta Mobil L', preis: '69,95â‚¬', daten: '100 GB', netz: 'Telekom', simOnly: true, provision: '332â‚¬', features: ['100 GB', 'D1-Netz', '5G'] },
            'freenet-telekom-m': { anbieter: 'freenet Telekom', name: 'Magenta Mobil M', preis: '59,95â‚¬', daten: '50 GB', netz: 'Telekom', simOnly: true, provision: '290â‚¬', features: ['50 GB', 'D1-Netz', '5G'] },
            'freenet-telekom-allnet-80': { anbieter: 'freenet Telekom', name: 'Allnet Flat 80 GB Premium', preis: '59,99â‚¬', daten: '80 GB', netz: 'Telekom', simOnly: true, provision: '335â‚¬', features: ['80 GB', 'D1-Netz', 'Premium'] },
            'freenet-telekom-allnet-60': { anbieter: 'freenet Telekom', name: 'Allnet Flat 60 GB Premium', preis: '59,99â‚¬', daten: '60 GB', netz: 'Telekom', simOnly: true, provision: '320â‚¬', features: ['60 GB', 'D1-Netz'] },
            'freenet-telekom-s': { anbieter: 'freenet Telekom', name: 'Magenta Mobil S', preis: '49,95â‚¬', daten: '30 GB', netz: 'Telekom', simOnly: true, provision: '237â‚¬', features: ['30 GB', 'D1-Netz', '5G'] },
            
            // === FREENET VODAFONE (HOHE PROVISIONEN) ===
            'freenet-vf-100-h10': { anbieter: 'freenet Vodafone', name: 'Allnet Flat 100 GB m.H.10', preis: '64,99â‚¬', daten: '100 GB', netz: 'Vodafone', simOnly: true, provision: '420â‚¬', features: ['TOP PROVISION!', '100 GB', 'D2-Netz'] },
            'freenet-vf-80-h10': { anbieter: 'freenet Vodafone', name: 'Allnet Flat 80 GB m.H.10', preis: '69,99â‚¬', daten: '80 GB', netz: 'Vodafone', simOnly: true, provision: '400â‚¬', features: ['80 GB', 'D2-Netz'] },
            'freenet-vf-gigamobil-xl': { anbieter: 'freenet Vodafone', name: 'GigaMobil XL m.H.10', preis: '89,99â‚¬', daten: 'Unlimited', netz: 'Vodafone', simOnly: true, provision: '330â‚¬', features: ['Unlimited', 'D2-Netz'] },
            'freenet-vf-gigamobil-l': { anbieter: 'freenet Vodafone', name: 'GigaMobil L m.H.10', preis: '69,99â‚¬', daten: '280 GB', netz: 'Vodafone', simOnly: true, provision: '320â‚¬', features: ['280 GB', 'D2-Netz'] },
            'freenet-vf-100': { anbieter: 'freenet Vodafone', name: 'Allnet Flat 100 GB', preis: '49,99â‚¬', daten: '100 GB', netz: 'Vodafone', simOnly: true, provision: '340â‚¬', features: ['100 GB', 'D2-Netz'] },
            
            // === 1&1 TARIFE (GUTES PREIS-LEISTUNGS-VERHÃ„LTNIS) ===
            '1und1-30': { anbieter: '1&1', name: 'All-Net-Flat 30 GB', preis: '14,99â‚¬', daten: '30 GB', netz: 'Vodafone/O2', simOnly: true, provision: '50â‚¬', features: ['300 MBit/s 5G', '3 Mon. 9,99â‚¬'] },
            '1und1-60': { anbieter: '1&1', name: 'All-Net-Flat 60 GB', preis: '19,99â‚¬', daten: '60 GB', netz: 'Vodafone/O2', simOnly: true, provision: '75â‚¬', features: ['300 MBit/s 5G', 'TIPP', '3 Mon. 9,99â‚¬'] },
            '1und1-120': { anbieter: '1&1', name: 'All-Net-Flat 120 GB', preis: '24,99â‚¬', daten: '120 GB', netz: 'Vodafone/O2', simOnly: true, provision: '100â‚¬', features: ['300 MBit/s 5G', '3 Mon. 9,99â‚¬'] },
            '1und1-unlimited': { anbieter: '1&1', name: 'Unlimited', preis: '39,99â‚¬', daten: 'Unlimited', netz: 'Vodafone/O2', simOnly: true, provision: '120â‚¬', features: ['300 MBit/s 5G', 'DAUERHAFT'] },
            
            // === AY YILDIZ (TÃœRKEI-FLAT) ===
            'ayyildiz-allnet': { anbieter: 'Ay YÄ±ldÄ±z', name: 'AY Allnet', preis: '14,99â‚¬', daten: '12 GB', netz: 'O2', simOnly: true, provision: '100â‚¬', features: ['TÃ¼rkei-Flat', 'Allnet-Flat'] },
            'ayyildiz-allnet-plus': { anbieter: 'Ay YÄ±ldÄ±z', name: 'AY Allnet Plus', preis: '27,99â‚¬', daten: '60 GB', netz: 'O2', simOnly: true, provision: '250â‚¬', features: ['TÃ¼rkei-Flat', 'Top-Provision'] },
            'ayyildiz-allnet-max': { anbieter: 'Ay YÄ±ldÄ±z', name: 'AY Allnet Max', preis: '37,99â‚¬', daten: '120 GB', netz: 'O2', simOnly: true, provision: '260â‚¬', features: ['TÃ¼rkei-Flat', 'Top-Provision'] },
            
            // === YOURFONE ===
            'yourfone-10': { anbieter: 'Yourfone', name: 'Yourfone 10GB', preis: '19,98â‚¬', daten: '10 GB', netz: 'O2', simOnly: true, provision: '125â‚¬', features: ['300 MBit/s', 'Allnet-Flat'] },
            'yourfone-20': { anbieter: 'Yourfone', name: 'Yourfone 20GB', preis: '24,98â‚¬', daten: '20 GB', netz: 'O2', simOnly: true, provision: '170â‚¬', features: ['300 MBit/s', 'Allnet-Flat'] },
            'yourfone-50': { anbieter: 'Yourfone', name: 'Yourfone 50GB', preis: '34,98â‚¬', daten: '50 GB', netz: 'O2', simOnly: true, provision: '200â‚¬', features: ['300 MBit/s', 'Top-Tarif'] },
            
            // === KLARMOBIL VODAFONE ===
            'klarmobil-vf-gigamobil-m': { anbieter: 'Klarmobil VF', name: 'GigaMobil M m.H.10', preis: '59,99â‚¬', daten: '50 GB', netz: 'Vodafone', simOnly: true, provision: '280â‚¬', features: ['D2-Netz', '5G'] },
            'klarmobil-vf-gigamobil-young': { anbieter: 'Klarmobil VF', name: 'GigaMobil Young XL m.H.10', preis: '79,99â‚¬', daten: 'Unlimited', netz: 'Vodafone', simOnly: true, provision: '275â‚¬', features: ['Young-Tarif', 'Unlimited'] },
            'klarmobil-vf-gigamobil-s': { anbieter: 'Klarmobil VF', name: 'GigaMobil S m.H.10', preis: '49,99â‚¬', daten: '25 GB', netz: 'Vodafone', simOnly: true, provision: '225â‚¬', features: ['D2-Netz', '5G'] }
        };
        
        // Handy-Datenbank mit korrekten Provisions-Bereichen (Handy-Provision kommt ZUSÃ„TZLICH zum Tarif)
        const handyDatenbank = {
            'iphone-15-pro-max': { name: 'iPhone 15 Pro Max', preis: '1.449â‚¬', bild: 'ğŸ', provision: '150-300â‚¬', klasse: 'premium', features: ['256GB+', 'Titan', 'Action Button', '5x Zoom'] },
            'iphone-15-pro': { name: 'iPhone 15 Pro', preis: '1.199â‚¬', bild: 'ğŸ', provision: '120-250â‚¬', klasse: 'premium', features: ['128GB+', 'Titan', 'A17 Pro', '48MP'] },
            'iphone-15': { name: 'iPhone 15', preis: '949â‚¬', bild: 'ğŸ', provision: '100-200â‚¬', klasse: 'high', features: ['128GB+', 'Dynamic Island', 'USB-C', '48MP'] },
            'iphone-14': { name: 'iPhone 14', preis: '729â‚¬', bild: 'ğŸ', provision: '80-150â‚¬', klasse: 'mid', features: ['128GB+', 'Crash Detection', 'A15', '12MP'] },
            'iphone-se': { name: 'iPhone SE', preis: '529â‚¬', bild: 'ğŸ', provision: '50-100â‚¬', klasse: 'entry', features: ['64GB+', 'Touch ID', 'A15', 'Kompakt'] },
            'samsung-s24-ultra': { name: 'Samsung Galaxy S24 Ultra', preis: '1.449â‚¬', bild: 'ğŸ“±', provision: '150-280â‚¬', klasse: 'premium', features: ['256GB+', 'S-Pen', '200MP', 'Galaxy AI'] },
            'samsung-s24': { name: 'Samsung Galaxy S24', preis: '899â‚¬', bild: 'ğŸ“±', provision: '100-180â‚¬', klasse: 'high', features: ['128GB+', 'Galaxy AI', '50MP', '120Hz'] },
            'samsung-a55': { name: 'Samsung Galaxy A55', preis: '479â‚¬', bild: 'ğŸ“±', provision: '60-100â‚¬', klasse: 'mid', features: ['128GB+', 'Super AMOLED', '50MP', 'Wasserfest'] },
            'samsung-a35': { name: 'Samsung Galaxy A35', preis: '379â‚¬', bild: 'ğŸ“±', provision: '45-80â‚¬', klasse: 'entry', features: ['128GB+', 'AMOLED', '50MP', '5G'] },
            'samsung-a15': { name: 'Samsung Galaxy A15', preis: '199â‚¬', bild: 'ğŸ“±', provision: '30-50â‚¬', klasse: 'basic', features: ['128GB', 'AMOLED', '50MP', 'Einsteiger'] },
            'xiaomi-14': { name: 'Xiaomi 14', preis: '999â‚¬', bild: 'ğŸ”·', provision: '80-150â‚¬', klasse: 'high', features: ['256GB', 'Leica', 'Snapdragon 8 Gen 3', '90W'] },
            'xiaomi-redmi': { name: 'Xiaomi Redmi Note 13', preis: '249â‚¬', bild: 'ğŸ”·', provision: '35-60â‚¬', klasse: 'entry', features: ['128GB', 'AMOLED', '108MP', 'Preis-Leistung'] },
            'google-pixel': { name: 'Google Pixel 8', preis: '799â‚¬', bild: 'ğŸ“²', provision: '80-140â‚¬', klasse: 'high', features: ['128GB', 'Tensor G3', 'Beste KI', '7 Jahre Updates'] },
            'oneplus': { name: 'OnePlus 12', preis: '899â‚¬', bild: 'ğŸ“²', provision: '80-150â‚¬', klasse: 'high', features: ['256GB', 'Hasselblad', '100W', 'Snapdragon 8 Gen 3'] },
            'guenstig': { name: 'Einsteiger-Smartphone', preis: 'ab 0â‚¬ mit Vertrag', bild: 'ğŸ“±', provision: '20-40â‚¬', klasse: 'basic', features: ['Basic', 'FÃ¼r Senioren', 'Kinder', 'Zweithandy'] }
        };

        // Letzte Empfehlung speichern fÃ¼r Button
        let letzteEmpfehlung = null;

        function generateProduktEmpfehlung(kategorie, budget, handy, netz, daten, prios) {
            
            // =====================================================
            // MOBILFUNK MIT HANDY - Provision bis 1.000â‚¬
            // =====================================================
            if (kategorie === 'mobilfunk') {
                const selectedHandy = handyDatenbank[handy] || null;
                
                // Besten Tarif basierend auf Kriterien finden
                let empfohlenerTarif = null;
                let tarifScore = 0;
                
                for (const [key, tarif] of Object.entries(tarifDatenbank)) {
                    let score = 0;
                    
                    // Netz-PrÃ¤ferenz
                    if (netz && tarif.netz.toLowerCase().includes(netz.toLowerCase())) score += 30;
                    
                    // Budget-Match
                    const tarifPreis = parseFloat(tarif.preis.replace('â‚¬', '').replace(',', '.'));
                    if (budget === 'low' && tarifPreis <= 20) score += 25;
                    if (budget === 'medium' && tarifPreis > 20 && tarifPreis <= 35) score += 25;
                    if (budget === 'high' && tarifPreis > 35) score += 25;
                    if (!budget) score += 15; // Neutral wenn kein Budget
                    
                    // Daten-Bedarf
                    if (daten === 'unlimited' && tarif.daten === 'Unlimited') score += 20;
                    if (daten === 'viel' && (tarif.daten.includes('40') || tarif.daten.includes('50') || tarif.daten === 'Unlimited')) score += 15;
                    if (daten === 'normal' && (tarif.daten.includes('10') || tarif.daten.includes('15') || tarif.daten.includes('20'))) score += 15;
                    if (daten === 'wenig' && (tarif.daten.includes('3') || tarif.daten.includes('5') || tarif.daten.includes('6'))) score += 15;
                    
                    // PrioritÃ¤ten
                    if (prios.preis && tarifPreis <= 20) score += 10;
                    if (prios.netz && tarif.netz === 'Telekom') score += 15;
                    if (prios.g5 && tarif.features.some(f => f.includes('5G'))) score += 10;
                    
                    // Bonus fÃ¼r gute Provision
                    const provNum = parseInt(tarif.provision.replace('â‚¬', ''));
                    score += provNum / 10;
                    
                    if (score > tarifScore) {
                        tarifScore = score;
                        empfohlenerTarif = { ...tarif, key };
                    }
                }
                
                // Fallback
                if (!empfohlenerTarif) {
                    empfohlenerTarif = { ...tarifDatenbank['o2-free-m'], key: 'o2-free-m' };
                }
                
                // Provision berechnen
                const tarifProv = parseInt(empfohlenerTarif.provision.replace('â‚¬', ''));
                let handyProvMin = 0, handyProvMax = 0;
                if (selectedHandy) {
                    const provParts = selectedHandy.provision.replace('â‚¬', '').split('-');
                    handyProvMin = parseInt(provParts[0]);
                    handyProvMax = parseInt(provParts[1] || provParts[0]);
                }
                const gesamtMin = tarifProv + handyProvMin;
                const gesamtMax = tarifProv + handyProvMax;
                
                // Empfehlung speichern
                letzteEmpfehlung = {
                    kategorie: 'mobilfunk',
                    tarif: empfohlenerTarif,
                    handy: selectedHandy,
                    gesamtProvision: `${gesamtMin}â‚¬ - ${gesamtMax}â‚¬`
                };

                let handyHtml = '';
                if (selectedHandy) {
                    handyHtml = `
                        <div style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span style="font-size: 2.5rem;">${selectedHandy.bild}</span>
                                <div>
                                    <h4 style="margin: 0; color: #1e40af;">${selectedHandy.name}</h4>
                                    <p style="margin: 0; color: #3b82f6; font-weight: 700;">UVP: ${selectedHandy.preis}</p>
                                </div>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                ${selectedHandy.features.map(f => `<span style="background: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem;">âœ“ ${f}</span>`).join('')}
                            </div>
                        </div>
                    `;
                }

                return `
                    ${handyHtml}
                    <div style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="background: ${empfohlenerTarif.anbieter === 'Telekom' ? '#e20074' : empfohlenerTarif.anbieter === 'O2' ? '#009de0' : '#333'}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">${empfohlenerTarif.anbieter}</span>
                            <span style="background: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">ğŸ“¶ ${empfohlenerTarif.netz}</span>
                        </div>
                        <h4 style="color: #166534; margin: 0 0 8px 0;">ğŸ“± ${empfohlenerTarif.name}</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                            <span style="font-size: 1.4rem; font-weight: 700; color: #22c55e;">${empfohlenerTarif.preis}/Monat</span>
                            <span style="background: white; padding: 6px 12px; border-radius: 20px; font-weight: 600;">ğŸ“Š ${empfohlenerTarif.daten}</span>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                            ${empfohlenerTarif.features.map(f => `<span style="background: rgba(255,255,255,0.7); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">âœ… ${f}</span>`).join('')}
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div style="background: #f1f5f9; padding: 14px; border-radius: 10px; text-align: center;">
                            <p style="margin: 0 0 4px 0; font-size: 0.8rem; color: #64748b;">Tarif-Provision</p>
                            <p style="margin: 0; font-size: 1.3rem; font-weight: 700; color: #6366f1;">${empfohlenerTarif.provision}</p>
                        </div>
                        <div style="background: #fef3c7; padding: 14px; border-radius: 10px; text-align: center;">
                            <p style="margin: 0 0 4px 0; font-size: 0.8rem; color: #92400e;">Handy-Provision</p>
                            <p style="margin: 0; font-size: 1.3rem; font-weight: 700; color: #d97706;">${selectedHandy ? selectedHandy.provision : 'Kein Handy'}</p>
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 16px; border-radius: 12px; margin-top: 16px; text-align: center;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85rem; opacity: 0.9;">ğŸ’° Deine Gesamt-Provision</p>
                        <p style="margin: 0; font-size: 1.8rem; font-weight: 800;">${letzteEmpfehlung.gesamtProvision}</p>
                        <p style="margin: 8px 0 0 0; font-size: 0.75rem; opacity: 0.8;">Tarif + Handy kombiniert</p>
                    </div>
                    <div style="margin-top: 16px; padding: 12px; background: #fef3c7; border-radius: 8px;">
                        <p style="margin: 0; font-size: 0.9rem; color: #92400e;">
                            <strong>ğŸ’¬ Verkaufs-Pitch:</strong> "${selectedHandy ? `${selectedHandy.name} mit ${empfohlenerTarif.daten} Daten im ${empfohlenerTarif.netz}-Netz fÃ¼r nur ${empfohlenerTarif.preis}/Monat - unschlagbar!` : `${empfohlenerTarif.name} - ${empfohlenerTarif.daten} im ${empfohlenerTarif.netz}-Netz, perfekte Wahl!`}"
                        </p>
                    </div>
                    <button onclick="goToPartnerTool()" style="width: 100%; margin-top: 16px; padding: 16px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s;">
                        <i class="fas fa-shopping-cart"></i> Jetzt im Partner-Tool abschlieÃŸen
                    </button>
                `;
            }

            // =====================================================
            // SIM-ONLY TARIFE - Provision 35â‚¬ - 120â‚¬
            // =====================================================
            if (kategorie === 'sim-only') {
                // Beste SIM-Only Tarife finden
                let empfohlenerTarif = null;
                let tarifScore = 0;
                
                for (const [key, tarif] of Object.entries(tarifDatenbank)) {
                    if (!tarif.simOnly) continue;
                    
                    let score = 0;
                    const tarifPreis = parseFloat(tarif.preis.replace('â‚¬', '').replace(',', '.'));
                    
                    // Budget-Match
                    if (budget === 'low' && tarifPreis <= 15) score += 25;
                    if (budget === 'medium' && tarifPreis > 15 && tarifPreis <= 30) score += 25;
                    if (budget === 'high' && tarifPreis > 30) score += 25;
                    if (!budget) score += 15;
                    
                    // Netz-PrÃ¤ferenz
                    if (netz && tarif.netz.toLowerCase().includes(netz.toLowerCase())) score += 20;
                    
                    // Daten
                    if (daten === 'unlimited' && tarif.daten === 'Unlimited') score += 20;
                    if (daten === 'viel' && parseInt(tarif.daten) >= 20) score += 15;
                    
                    // Provision
                    const provNum = parseInt(tarif.provision.replace('â‚¬', ''));
                    score += provNum / 5;
                    
                    if (score > tarifScore) {
                        tarifScore = score;
                        empfohlenerTarif = { ...tarif, key };
                    }
                }
                
                if (!empfohlenerTarif) {
                    empfohlenerTarif = { ...tarifDatenbank['1und1-m'], key: '1und1-m' };
                }
                
                letzteEmpfehlung = { kategorie: 'sim-only', tarif: empfohlenerTarif };
                
                return `
                    <div style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="background: #6366f1; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">${empfohlenerTarif.anbieter}</span>
                            <span style="background: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">ğŸ“¶ ${empfohlenerTarif.netz}</span>
                        </div>
                        <h4 style="color: #166534; margin: 0 0 8px 0;">ğŸ’³ ${empfohlenerTarif.name}</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                            <span style="font-size: 1.4rem; font-weight: 700; color: #22c55e;">${empfohlenerTarif.preis}/Monat</span>
                            <span style="background: white; padding: 6px 12px; border-radius: 20px; font-weight: 600;">ğŸ“Š ${empfohlenerTarif.daten}</span>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                            ${empfohlenerTarif.features.map(f => `<span style="background: rgba(255,255,255,0.7); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">âœ… ${f}</span>`).join('')}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 16px; border-radius: 12px; text-align: center;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85rem; opacity: 0.9;">ğŸ’° Deine Provision</p>
                        <p style="margin: 0; font-size: 2rem; font-weight: 800;">${empfohlenerTarif.provision}</p>
                    </div>
                    <div style="margin-top: 16px; padding: 12px; background: #fef3c7; border-radius: 8px;">
                        <p style="margin: 0; font-size: 0.9rem; color: #92400e;">
                            <strong>ğŸ’¬ Verkaufs-Pitch:</strong> "${empfohlenerTarif.name} - ${empfohlenerTarif.daten} im ${empfohlenerTarif.netz}-Netz, ideal fÃ¼r preisbewusste Kunden!"
                        </p>
                    </div>
                    <button onclick="goToPartnerTool()" style="width: 100%; margin-top: 16px; padding: 16px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-shopping-cart"></i> Jetzt im Partner-Tool abschlieÃŸen
                    </button>
                `;
            }

            // =====================================================
            // DSL / INTERNET (ECHTE PARTNER-TOOL TARIFE)
            // =====================================================
            const dslTarife = {
                low: { anbieter: '1&1', name: '1&1 DSL 50', preis: '16,98â‚¬', speed: '50 Mbit/s', provision: '50â‚¬', features: ['Router inkl.', 'Flat', '3 Mon. Aktion'] },
                medium: { anbieter: '1&1', name: '1&1 DSL 100', preis: '16,98â‚¬', speed: '100 Mbit/s', provision: '70â‚¬', features: ['Router inkl.', 'Flat', 'TIPP'] },
                high: { anbieter: '1&1', name: '1&1 Glasfaser 1000', preis: '36,98â‚¬', speed: '1000 Mbit/s', provision: '100â‚¬', features: ['Glasfaser', 'Top-Speed', 'Gaming'] }
            };
            
            if (kategorie === 'dsl') {
                const budgetKey = budget || 'medium';
                const tarif = dslTarife[budgetKey];
                letzteEmpfehlung = { kategorie: 'dsl', tarif };
                
                return `
                    <div style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <span style="background: #3b82f6; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">${tarif.anbieter}</span>
                        <h4 style="color: #1e40af; margin: 10px 0 8px 0;">ğŸŒ ${tarif.name}</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                            <span style="font-size: 1.4rem; font-weight: 700; color: #2563eb;">${tarif.preis}/Monat</span>
                            <span style="background: white; padding: 6px 12px; border-radius: 20px; font-weight: 700;">âš¡ ${tarif.speed}</span>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px;">
                            ${tarif.features.map(f => `<span style="background: rgba(255,255,255,0.7); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">âœ… ${f}</span>`).join('')}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 16px; border-radius: 12px; text-align: center;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85rem; opacity: 0.9;">ğŸ’° Deine Provision</p>
                        <p style="margin: 0; font-size: 2rem; font-weight: 800;">${tarif.provision}</p>
                    </div>
                    <button onclick="goToPartnerTool()" style="width: 100%; margin-top: 16px; padding: 16px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-shopping-cart"></i> Jetzt im Partner-Tool abschlieÃŸen
                    </button>
                `;
            }

            // =====================================================
            // STROM & GAS
            // =====================================================
            const energieTarife = {
                strom: { name: 'Ã–ko-Stromtarif', preis: 'Nach Verbrauch', provision: '80â‚¬ - 120â‚¬', features: ['100% Ã–ko', 'Preisgarantie', 'Sofortbonus'] },
                gas: { name: 'Gastarif Comfort', preis: 'Nach Verbrauch', provision: '70â‚¬ - 110â‚¬', features: ['Preisgarantie', 'Flexibel', 'Bonus'] }
            };
            
            if (kategorie === 'strom' || kategorie === 'gas') {
                const tarif = energieTarife[kategorie];
                letzteEmpfehlung = { kategorie, tarif };
                
                return `
                    <div style="background: linear-gradient(135deg, ${kategorie === 'strom' ? '#fef3c7, #fde68a' : '#fed7aa, #fdba74'}); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <h4 style="color: ${kategorie === 'strom' ? '#92400e' : '#c2410c'}; margin: 0 0 8px 0;">${kategorie === 'strom' ? 'âš¡' : 'ğŸ”¥'} ${tarif.name}</h4>
                        <p style="color: #78350f; margin: 0 0 12px 0;">Preis: ${tarif.preis}</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                            ${tarif.features.map(f => `<span style="background: rgba(255,255,255,0.7); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">âœ… ${f}</span>`).join('')}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 16px; border-radius: 12px; text-align: center;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85rem; opacity: 0.9;">ğŸ’° Deine Provision</p>
                        <p style="margin: 0; font-size: 2rem; font-weight: 800;">${tarif.provision}</p>
                    </div>
                    <button onclick="goToPartnerTool()" style="width: 100%; margin-top: 16px; padding: 16px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-shopping-cart"></i> Jetzt im Partner-Tool abschlieÃŸen
                    </button>
                `;
            }

            // =====================================================
            // VERSICHERUNG (Handy-Schutz etc.)
            // =====================================================
            if (kategorie === 'versicherung') {
                const versicherung = { name: 'Handy-Schutz Plus', preis: '7,99â‚¬/Monat', provision: '40â‚¬', features: ['Displaybruch', 'Diebstahl', 'Wasserschaden', 'Weltweit'] };
                letzteEmpfehlung = { kategorie, tarif: versicherung };
                
                return `
                    <div style="background: linear-gradient(135deg, #e0e7ff, #c7d2fe); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <h4 style="color: #4338ca; margin: 0 0 8px 0;">ğŸ›¡ï¸ ${versicherung.name}</h4>
                        <p style="font-size: 1.3rem; font-weight: 700; color: #6366f1; margin: 0 0 12px 0;">${versicherung.preis}</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                            ${versicherung.features.map(f => `<span style="background: rgba(255,255,255,0.7); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;">âœ… ${f}</span>`).join('')}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 16px; border-radius: 12px; text-align: center;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85rem; opacity: 0.9;">ğŸ’° Deine Provision</p>
                        <p style="margin: 0; font-size: 2rem; font-weight: 800;">${versicherung.provision}</p>
                    </div>
                    <button onclick="goToPartnerTool()" style="width: 100%; margin-top: 16px; padding: 16px 24px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-shopping-cart"></i> Jetzt im Partner-Tool abschlieÃŸen
                    </button>
                `;
            }

            return '<p>Bitte wÃ¤hle eine Kategorie aus.</p>';
        }
        
        // Button zum Partner-Tool - Ã–FFNET DAS TOOL DIREKT
        function goToPartnerTool() {
            // Kategorie fÃ¼r URL-Parameter ermitteln
            let kategorie = 'sim-only'; // Standard
            if (letzteEmpfehlung) {
                if (letzteEmpfehlung.kategorie === 'mobilfunk' && letzteEmpfehlung.handy) {
                    kategorie = 'handy-tarif';
                } else if (letzteEmpfehlung.kategorie === 'mobilfunk' || letzteEmpfehlung.kategorie === 'sim-only') {
                    kategorie = 'sim-only';
                } else if (letzteEmpfehlung.kategorie === 'dsl') {
                    kategorie = 'internet';
                } else if (letzteEmpfehlung.kategorie === 'strom' || letzteEmpfehlung.kategorie === 'gas') {
                    kategorie = 'strom-gas';
                }
            }
            
            // Empfehlung in localStorage speichern fÃ¼r das Partner-Tool
            if (letzteEmpfehlung) {
                localStorage.setItem('ki_empfehlung', JSON.stringify(letzteEmpfehlung));
            }
            
            // Partner-Tool in neuem Tab Ã¶ffnen mit Kategorie-Parameter
            const toolUrl = `Partner-Tool.html?kategorie=${kategorie}&ki_empfehlung=true`;
            window.open(toolUrl, '_blank');
            
            // Erfolgsmeldung anzeigen
            const resultDiv = document.getElementById('ki-empfehlung-result');
            if (resultDiv) {
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'background: linear-gradient(135deg, #dcfce7, #bbf7d0); padding: 16px; border-radius: 12px; margin-top: 16px; text-align: center; animation: fadeIn 0.3s;';
                successMsg.innerHTML = `
                    <p style="margin: 0; color: #166534; font-weight: 700;">
                        <i class="fas fa-check-circle"></i> Partner-Tool wurde geÃ¶ffnet!
                    </p>
                    <p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #15803d;">
                        WÃ¤hle dort den passenden Tarif und fÃ¼lle das Formular fÃ¼r deinen Kunden aus.
                    </p>
                `;
                resultDiv.appendChild(successMsg);
                
                // Nach 5 Sekunden wieder entfernen
                setTimeout(() => successMsg.remove(), 5000);
            }
        }

        // =====================================================
        // ğŸ›¡ï¸ EINWANDBEHANDLUNG
        // =====================================================

        const einwandAntworten = {
            zu_teuer: {
                title: 'ğŸ’° "Das ist mir zu teuer!"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">Schritt 1: Nachfragen</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; border-left: 3px solid #6366f1; margin: 0;">
                            "Ich verstehe. Darf ich fragen: Was genau erscheint Ihnen zu teuer - der monatliche Betrag oder die Gesamtkosten?"
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">Schritt 2: Wert zeigen</h4>
                        <ul>
                            <li><strong>Tagespreis berechnen:</strong> "Das sind nur Xâ‚¬ pro Tag"</li>
                            <li><strong>Vergleich:</strong> "Weniger als ein Kaffee am Tag"</li>
                            <li><strong>Inklusivleistungen:</strong> Alle Features aufzeigen</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #f59e0b; margin: 0 0 8px 0;">Schritt 3: Alternative</h4>
                        <p style="background: #fef3c7; padding: 12px; border-radius: 8px; margin: 0;">
                            "Wir haben auch gÃ¼nstigere Alternativen. Was wÃ¤re denn Ihr Wunschbudget pro Monat?"
                        </p>
                    </div>
                    <div style="margin-top: 16px; padding: 12px; background: #dcfce7; border-radius: 8px;">
                        <strong>ğŸ’¡ Profi-Tipp:</strong> Niemals sofort Rabatt geben! Erst den Wert kommunizieren.
                    </div>
                `
            },
            ueberlegen: {
                title: 'ğŸ¤” "Ich muss darÃ¼ber nachdenken"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">Die Power-Frage:</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; border-left: 3px solid #6366f1; margin: 0;">
                            "Das verstehe ich vollkommen. Nur um sicher zu gehen: <strong>Was genau mÃ¶chten Sie sich Ã¼berlegen?</strong> Vielleicht kann ich Ihnen dabei helfen."
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">MÃ¶gliche echte EinwÃ¤nde:</h4>
                        <ul>
                            <li><strong>Preis:</strong> â†’ Wertargumentation nutzen</li>
                            <li><strong>Partner fragen:</strong> â†’ Termin vereinbaren</li>
                            <li><strong>Unsicherheit:</strong> â†’ Garantien betonen</li>
                            <li><strong>Zeitdruck:</strong> â†’ Aktion/Angebot hervorheben</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #f59e0b; margin: 0 0 8px 0;">Termin sichern:</h4>
                        <p style="background: #fef3c7; padding: 12px; border-radius: 8px; margin: 0;">
                            "Kein Problem! Wann darf ich mich bei Ihnen melden? Morgen oder Ã¼bermorgen?"
                        </p>
                    </div>
                `
            },
            partner_fragen: {
                title: 'ğŸ‘« "Ich muss meinen Partner fragen"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">VerstÃ¤ndnis zeigen & einbeziehen:</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; margin: 0;">
                            "Das ist sehr vernÃ¼nftig! Wichtige Entscheidungen trifft man am besten gemeinsam. Ist Ihr Partner vielleicht erreichbar? Ich erklÃ¤re gerne nochmal alles."
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">Termin mit beiden vereinbaren:</h4>
                        <p style="background: #dcfce7; padding: 12px; border-radius: 8px; margin: 0;">
                            "Wann wÃ¤re ein guter Zeitpunkt, wenn Sie beide da sind? Dann kann ich alle Fragen direkt beantworten."
                        </p>
                    </div>
                    <div>
                        <h4 style="color: #f59e0b; margin: 0 0 8px 0;">Material mitgeben:</h4>
                        <p style="margin: 0;">
                            Angebot schriftlich mitgeben mit allen wichtigen Punkten markiert!
                        </p>
                    </div>
                `
            },
            kein_interesse: {
                title: 'ğŸ™… "Kein Interesse"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">Soft-Nachfrage:</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; margin: 0;">
                            "Das ist schade. Darf ich nur kurz fragen: <strong>Was genau ist es, das Sie nicht interessiert?</strong> Vielleicht habe ich Ihren Bedarf nicht richtig verstanden."
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">Nutzen herausfinden:</h4>
                        <ul>
                            <li>"Was wÃ¼rde Sie denn interessieren?"</li>
                            <li>"Gibt es etwas, das Sie aktuell stÃ¶rt an Ihrem Anbieter?"</li>
                            <li>"Wann wÃ¤re ein besserer Zeitpunkt?"</li>
                        </ul>
                    </div>
                    <div style="padding: 12px; background: #fef3c7; border-radius: 8px;">
                        <strong>ğŸ’¡ Tipp:</strong> Manchmal ist "Kein Interesse" nur "Ich habe keine Zeit". Frag nach einem besseren Zeitpunkt!
                    </div>
                `
            },
            vertrag_laeuft: {
                title: 'ğŸ“… "Mein Vertrag lÃ¤uft noch"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">Positiv aufnehmen:</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; margin: 0;">
                            "Perfekt! Dann kÃ¶nnen wir in Ruhe planen. <strong>Wann lÃ¤uft Ihr Vertrag genau aus?</strong> Ich kann Ihnen schon jetzt ein Angebot sichern."
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">Vormerken:</h4>
                        <ul>
                            <li>Kundendaten notieren (mit Einwilligung)</li>
                            <li>Vertragsende festhalten</li>
                            <li>Erinnerung 3 Monate vorher setzen</li>
                        </ul>
                    </div>
                    <div style="padding: 12px; background: #dcfce7; border-radius: 8px;">
                        <strong>ğŸ¯ Profi-Move:</strong> "Ãœbrigens: Wir kÃ¶nnen den neuen Vertrag vorbestellen und zum Wechseldatum automatisch aktivieren!"
                    </div>
                `
            },
            zufrieden: {
                title: 'ğŸ˜Š "Ich bin mit meinem Anbieter zufrieden"',
                content: `
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #6366f1; margin: 0 0 8px 0;">Respektieren & hinterfragen:</h4>
                        <p style="background: #f1f5f9; padding: 12px; border-radius: 8px; margin: 0;">
                            "Das freut mich zu hÃ¶ren! <strong>Was genau gefÃ¤llt Ihnen besonders gut?</strong> Dann weiÃŸ ich, was Ihnen wichtig ist."
                        </p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <h4 style="color: #22c55e; margin: 0 0 8px 0;">Vergleich anbieten:</h4>
                        <p style="background: #dcfce7; padding: 12px; border-radius: 8px; margin: 0;">
                            "Darf ich Ihnen trotzdem kurz zeigen, was wir bieten? Nur zum Vergleich - <strong>vielleicht sparen Sie Geld bei gleicher Leistung!</strong>"
                        </p>
                    </div>
                    <div style="padding: 12px; background: #fef3c7; border-radius: 8px;">
                        <strong>ğŸ’¡ Tipp:</strong> Oft kennen Kunden bessere Angebote gar nicht. Ein kurzer Vergleich Ã¶ffnet TÃ¼ren!
                    </div>
                `
            }
        };

        function showEinwandAntwort(einwand) {
            const data = einwandAntworten[einwand];
            if (!data) return;

            document.getElementById('ki-einwand-title').innerHTML = data.title;
            document.getElementById('ki-einwand-content').innerHTML = data.content;
            document.getElementById('ki-einwand-result').style.display = 'block';

            // Scroll to result
            document.getElementById('ki-einwand-result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // =====================================================
        // ğŸ­ VERKAUFSTRAINING (Rollenspiel)
        // =====================================================

        const trainingScenarios = {
            handyvertrag: {
                title: 'ğŸ“± Handyvertrag verkaufen',
                customer: 'Thomas MÃ¼ller, 35 Jahre',
                situation: 'Interessiert sich fÃ¼r einen neuen Handyvertrag mit Smartphone. Hat aktuell einen alten Vertrag bei 1&1.',
                opening: "Hallo! Ich habe gehÃ¶rt, Sie haben gute HandyvertrÃ¤ge? Mein Vertrag lÃ¤uft bald aus und ich brÃ¤uchte auch mal ein neues Handy...",
                responses: [
                    { keywords: ['willkommen', 'hallo', 'guten tag', 'herzlich'], reply: "Danke! Ja, also ich habe aktuell 1&1, zahle 25â‚¬ im Monat fÃ¼r 5GB. Das reicht manchmal nicht..." },
                    { keywords: ['datenvolumen', 'gb', 'surfen', 'internet', 'nutzen'], reply: "Hmm, wahrscheinlich so 15-20 GB? Ich schaue viel YouTube und Instagram. Manchmal ist es am Ende des Monats knapp." },
                    { keywords: ['handy', 'smartphone', 'gerÃ¤t', 'welches'], reply: "Ich liebÃ¤ugle mit dem iPhone 15. Aber das ist wahrscheinlich teuer, oder? Was wÃ¼rde das so kosten?" },
                    { keywords: ['preis', 'kosten', 'monat', 'zahlen', 'â‚¬', 'euro'], reply: "Hmm, 45â‚¬ ist schon mehr als jetzt... Aber wenn das iPhone dabei ist... Was ist denn alles inklusive?" },
                    { keywords: ['netz', 'telekom', 'vodafone', 'o2'], reply: "Ehrlich gesagt ist mir das Netz nicht so wichtig. Hauptsache es funktioniert Ã¼berall halbwegs." },
                    { keywords: ['abschlieÃŸen', 'vertrag', 'unterschreiben', 'anfangen'], reply: "Okay, das klingt eigentlich gut. Was brauchen Sie von mir fÃ¼r den Abschluss?" }
                ],
                defaultReply: "Das verstehe ich. ErzÃ¤hlen Sie mir mehr Ã¼ber Ihre Tarife?"
            },
            upselling: {
                title: 'â¬†ï¸ Upselling Meistern',
                customer: 'Sandra Weber, 28 Jahre',
                situation: 'Will nur eine gÃ¼nstige SIM-Karte, aber hat Potential fÃ¼r mehr.',
                opening: "Hi! Ich brauche nur eine einfache SIM-Karte, nichts Besonderes. Was ist das GÃ¼nstigste?",
                responses: [
                    { keywords: ['gÃ¼nstig', 'billig', 'einfach', 'sim'], reply: "Genau, ich will nicht viel Geld ausgeben. 10â‚¬ im Monat oder so wÃ¤re ideal." },
                    { keywords: ['nutzen', 'wofÃ¼r', 'brauchen', 'telefonieren'], reply: "HauptsÃ¤chlich WhatsApp und ab und zu telefonieren. Vielleicht mal ein Video schauen..." },
                    { keywords: ['daten', 'gb', 'internet', 'surfen'], reply: "Keine Ahnung, 2-3 GB? Obwohl... ich bin viel unterwegs und da wÃ¤re WLAN praktisch..." },
                    { keywords: ['mehr', 'upgrade', 'besser', 'empfehlung'], reply: "Hmm, 20 GB fÃ¼r nur 5â‚¬ mehr? Das klingt eigentlich nicht schlecht... Und was ist mit einem neuen Handy?" },
                    { keywords: ['handy', 'smartphone', 'gerÃ¤t'], reply: "Naja, mein altes ist schon 3 Jahre alt und der Akku ist mies. Vielleicht wÃ¤re ein neues doch gut..." }
                ],
                defaultReply: "Ich weiÃŸ nicht... Ã¼berzeugen Sie mich!"
            },
            schwieriger_kunde: {
                title: 'ğŸ˜¤ Schwieriger Kunde',
                customer: 'Herr Krause, 52 Jahre',
                situation: 'Ist verÃ¤rgert und skeptisch. Hatte schlechte Erfahrungen mit anderen Anbietern.',
                opening: "Ich sage Ihnen gleich: Ich glaube kein Wort von dem was VerkÃ¤ufer sagen! Die lÃ¼gen doch alle nur!",
                responses: [
                    { keywords: ['versteh', 'nachvollzieh', 'erfahrung', 'schlecht'], reply: "Ja, genau! Beim letzten Anbieter haben die mir was von 'Super-Netz' erzÃ¤hlt und dann hatte ich stÃ¤ndig Empfangsprobleme!" },
                    { keywords: ['ehrlich', 'transparent', 'offen', 'garantie'], reply: "Hmm... das sagen alle. Aber Sie klingen wenigstens nicht wie so ein SprÃ¼cheklopfer. Was haben Sie denn konkret?" },
                    { keywords: ['problem', 'lÃ¶sung', 'helfen', 'wichtig'], reply: "Also ich brauche guten Empfang - auch auf dem Land bei meiner Mutter. Das ist das Wichtigste!" },
                    { keywords: ['netz', 'empfang', 'telekom', 'abdeckung'], reply: "Telekom-Netz? Das ist tatsÃ¤chlich gut... Aber ist das nicht viel teurer?" },
                    { keywords: ['preis', 'kosten', 'fair', 'wert'], reply: "Na gut... das klingt fair. Und wenn ich wieder Probleme habe?" }
                ],
                defaultReply: "Pah! Das glaube ich erst wenn ich es sehe!"
            },
            cross_selling: {
                title: 'ğŸ”— Cross-Selling',
                customer: 'Familie Schneider',
                situation: 'Hat gerade einen Handyvertrag abgeschlossen. Perfekte Gelegenheit fÃ¼r DSL.',
                opening: "Super, der Handyvertrag ist unterschrieben! Vielen Dank fÃ¼r die gute Beratung!",
                responses: [
                    { keywords: ['freut', 'danke', 'zufrieden', 'toll'], reply: "Ja, ich bin wirklich zufrieden! Endlich ein vernÃ¼nftiger Tarif." },
                    { keywords: ['internet', 'dsl', 'zuhause', 'wlan'], reply: "Internet zu Hause? Ja, haben wir natÃ¼rlich. Telekom seit Jahren... aber die sind teuer geworden." },
                    { keywords: ['kombi', 'rabatt', 'sparen', 'zusammen'], reply: "Wirklich? 10â‚¬ Rabatt wenn wir beides hier machen? Das wÃ¤re interessant... Was zahlen wir dann?" },
                    { keywords: ['geschwindigkeit', 'schnell', 'mbit'], reply: "Wir haben 50 Mbit/s... aber mit zwei Kindern die streamen reicht das manchmal nicht." },
                    { keywords: ['upgrade', 'wechsel', 'besser'], reply: "250 Mbit/s fÃ¼r weniger als wir jetzt zahlen? Okay, das schaue ich mir an!" }
                ],
                defaultReply: "Hmm, erzÃ¤hlen Sie mehr!"
            }
        };

        let currentTraining = null;
        let trainingMessageCount = 0;

        function startTraining(scenario) {
            currentTraining = trainingScenarios[scenario];
            trainingMessageCount = 0;

            if (!currentTraining) return;

            document.getElementById('ki-training-title').textContent = 'ğŸ­ ' + currentTraining.title;
            document.getElementById('ki-customer-name').textContent = currentTraining.customer;
            document.getElementById('ki-customer-situation').textContent = currentTraining.situation;

            // Clear messages
            const container = document.getElementById('ki-training-messages');
            container.innerHTML = '';

            // Add opening message
            addTrainingMessage('customer', currentTraining.opening);

            // Show training area
            document.getElementById('ki-training-area').style.display = 'block';
            document.getElementById('ki-training-area').scrollIntoView({ behavior: 'smooth' });
        }

        function endTraining() {
            document.getElementById('ki-training-area').style.display = 'none';
            currentTraining = null;

            // Show feedback
            if (trainingMessageCount >= 3) {
                alert('ğŸ‰ Gut gemacht! Du hast ' + trainingMessageCount + ' Antworten gegeben. Ãœbung macht den Meister!');
            }
        }

        function sendTrainingMessage() {
            const input = document.getElementById('ki-training-input');
            const message = input.value.trim();
            if (!message || !currentTraining) return;

            addTrainingMessage('user', message);
            input.value = '';
            trainingMessageCount++;

            // Find response
            setTimeout(() => {
                const response = findTrainingResponse(message);
                addTrainingMessage('customer', response);
            }, 800);
        }

        function handleTrainingKeypress(event) {
            if (event.key === 'Enter') sendTrainingMessage();
        }

        function addTrainingMessage(type, text) {
            const container = document.getElementById('ki-training-messages');
            const div = document.createElement('div');
            div.className = 'ki-message ' + (type === 'user' ? 'user-message' : 'bot-message');
            
            const icon = type === 'user' ? 'fa-user-tie' : 'fa-user';
            const label = type === 'user' ? 'Du' : currentTraining?.customer?.split(',')[0] || 'Kunde';

            div.innerHTML = `
                <div class="ki-message-avatar" style="background: ${type === 'user' ? 'linear-gradient(135deg, #6366f1, #8b5cf6)' : '#e2e8f0'}; color: ${type === 'user' ? 'white' : '#64748b'};">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="ki-message-content">
                    <small style="color: #64748b; display: block; margin-bottom: 4px;">${label}</small>
                    <p>${text}</p>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function findTrainingResponse(message) {
            const lower = message.toLowerCase();
            for (const resp of currentTraining.responses) {
                for (const keyword of resp.keywords) {
                    if (lower.includes(keyword)) return resp.reply;
                }
            }
            return currentTraining.defaultReply;
        }

        // =====================================================
        // ğŸ”¥ MOTIVATION
        // =====================================================

        const motivationQuotes = [
            { quote: "Der Unterschied zwischen einem erfolgreichen Menschen und anderen ist nicht ein Mangel an StÃ¤rke oder Wissen, sondern ein Mangel an Willen.", author: "Vince Lombardi" },
            { quote: "Erfolg ist nicht endgÃ¼ltig, Misserfolg ist nicht fatal: Es ist der Mut weiterzumachen, der zÃ¤hlt.", author: "Winston Churchill" },
            { quote: "Der beste Weg, die Zukunft vorherzusagen, ist sie zu gestalten.", author: "Peter Drucker" },
            { quote: "Verkaufen ist nicht verkaufen. Verkaufen ist helfen, die beste Entscheidung zu treffen.", author: "Zig Ziglar" },
            { quote: "Jeder Nein bringt dich nÃ¤her zum Ja!", author: "VerkÃ¤ufer-Weisheit" },
            { quote: "Dein Einkommen ist das Ergebnis deiner persÃ¶nlichen Entwicklung.", author: "Jim Rohn" },
            { quote: "Die einzige Grenze fÃ¼r unsere Verwirklichung von morgen sind unsere Zweifel von heute.", author: "Franklin D. Roosevelt" },
            { quote: "Erfolg hat drei Buchstaben: T-U-N!", author: "Johann Wolfgang von Goethe" }
        ];

        const dailyChallenges = [
            "FÃ¼hre heute 3 GesprÃ¤che mit der Einwand-Technik 'Wertargumentation'",
            "Stelle bei jedem Kunden mindestens 5 offene Fragen",
            "Biete bei jedem Abschluss ein Cross-Selling Produkt an",
            "Sammle 5 Telefonnummern fÃ¼r Follow-ups",
            "Nutze heute bei jedem GesprÃ¤ch die Zusammenfassungs-Technik",
            "Frage jeden Kunden nach Empfehlungen",
            "Ãœbe 3x die 'Schweige-Technik' nach deinem Angebot"
        ];

        const dailyTips = [
            "Frage immer 'Was ist Ihnen besonders wichtig?' bevor du ein Produkt empfiehlst.",
            "Nicke wÃ¤hrend der Kunde spricht - das zeigt aktives ZuhÃ¶ren.",
            "Benutze den Namen des Kunden mindestens 3x im GesprÃ¤ch.",
            "Zeige immer 3 Optionen: GÃ¼nstig, Empfohlen, Premium.",
            "Die beste Zeit fÃ¼r den Abschluss ist direkt nach einem Kaufsignal.",
            "Sprich langsamer als der Kunde - das strahlt Kompetenz aus.",
            "Benutze 'Sie' statt 'man' - das macht es persÃ¶nlicher."
        ];

        function getNewMotivation() {
            const quote = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
            document.getElementById('ki-motivation-quote').innerHTML = `
                <i class="fas fa-quote-left"></i>
                <p>"${quote.quote}"</p>
                <span>- ${quote.author}</span>
            `;
        }

        function getNewChallenge() {
            const challenge = dailyChallenges[Math.floor(Math.random() * dailyChallenges.length)];
            document.getElementById('ki-daily-challenge').textContent = challenge;
        }

        function getNewTip() {
            const tip = dailyTips[Math.floor(Math.random() * dailyTips.length)];
            document.getElementById('ki-daily-tip').textContent = tip;
        }

        // =====================================================
        // ğŸ“š AKADEMIE LINK
        // =====================================================

        function goToAkademieModule(modulId) {
            showPage('akademie');
            setTimeout(() => {
                if (typeof openModul === 'function') {
                    openModul(modulId);
                }
            }, 300);
        }

        // Init on page load
        console.log('ğŸ¤– KI Verkaufstrainer geladen!');
    </script>
    
</body>
</html>
