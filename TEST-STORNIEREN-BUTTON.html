<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST: Stornieren-Button</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; padding: 40px; background: #f7fafc; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { margin-bottom: 30px; color: #1a202c; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        th, td { padding: 15px; text-align: left; }
        tbody tr { border-bottom: 1px solid #e2e8f0; }
        tbody tr:hover { background: #f7fafc; }
        .btn-danger { background: linear-gradient(135deg, #f56565, #c53030); color: white; border: none; padding: 0.5rem 1rem; font-size: 0.875rem; border-radius: 8px; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s; }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4); }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 600; }
        .status-success { background: #c6f6d5; color: #22543d; }
        .status-warning { background: #fed7aa; color: #7c2d12; }
        .status-info { background: #bee3f8; color: #1a365d; }
        .version-banner { background: linear-gradient(135deg, #48bb78, #38a169); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; }
        .version-banner h2 { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="version-banner">
            <h2>âœ… TEST: Partner-Dashboard V2</h2>
            <p>Diese Seite testet den neuen "Stornieren"-Button in der Vertrags-Tabelle</p>
        </div>
        
        <h1><i class="fas fa-file-contract"></i> Neueste VertrÃ¤ge <span style="background: #48bb78; color: white; padding: 6px 16px; border-radius: 20px; font-size: 0.875rem; margin-left: 15px;">âœ… Mit Stornieren-Button</span></h1>
        
        <table>
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Kunde</th>
                    <th>Kategorie</th>
                    <th>Provision</th>
                    <th>Status</th>
                    <th style="text-align:center;">Aktionen</th>
                </tr>
            </thead>
            <tbody id="vertraege-tbody">
                <!-- Wird mit JavaScript gefÃ¼llt -->
            </tbody>
        </table>
    </div>

    <script>
        // Demo-VertrÃ¤ge
        const demoVertraege = [
            { id: 'demo-1', datum: '08.12.2025', kunde: 'Max Mustermann', kategorie: 'Mobilfunk', produkt: 'Vodafone', provision: '75,00â‚¬', status: 'Aktiviert', created_at: Date.now() - (2 * 86400000) },
            { id: 'demo-2', datum: '07.12.2025', kunde: 'Lisa MÃ¼ller', kategorie: 'Strom', produkt: 'Telekom', provision: '100,00â‚¬', status: 'In Bearbeitung', created_at: Date.now() - (7 * 86400000) },
            { id: 'demo-3', datum: '06.12.2025', kunde: 'Tom Schmidt', kategorie: 'Gas', produkt: 'E.ON', provision: '50,00â‚¬', status: 'Neu', created_at: Date.now() - (20 * 86400000) },
            { id: 'demo-4', datum: '05.12.2025', kunde: 'Anna Becker', kategorie: 'Internet', produkt: '1&1', provision: '120,00â‚¬', status: 'Abgelehnt', created_at: Date.now() - (30 * 86400000) },
            { id: 'demo-5', datum: '04.12.2025', kunde: 'Peter Klein', kategorie: 'Mobilfunk', produkt: 'O2', provision: '60,00â‚¬', status: 'Storniert', created_at: Date.now() - (40 * 86400000) }
        ];
        
        // Tabelle fÃ¼llen
        const tbody = document.getElementById('vertraege-tbody');
        tbody.innerHTML = demoVertraege.map(v => {
            // âœ… Stornieren-Button nur wenn Status NICHT "Abgelehnt" oder "Storniert"
            const showStornierenBtn = v.status !== 'Abgelehnt' && v.status !== 'Storniert';
            const stornierenBtn = showStornierenBtn ? `
                <button 
                    onclick="testStornierung('${v.id}', '${v.kunde}', ${v.created_at});" 
                    class="btn-danger" 
                    title="Vertrag stornieren">
                    <i class="fas fa-times-circle"></i> Stornieren
                </button>
            ` : '<span style="opacity:0.5; font-size:0.875rem;">-</span>';
            
            const statusClass = v.status === 'Aktiviert' ? 'status-success' : 
                              v.status === 'In Bearbeitung' ? 'status-warning' :
                              v.status === 'Abgelehnt' ? 'status-danger' :
                              v.status === 'Storniert' ? 'status-danger' : 
                              'status-info';
            
            return `
                <tr>
                    <td>${v.datum}</td>
                    <td>${v.kunde}</td>
                    <td>${v.kategorie}</td>
                    <td><strong>${v.provision}</strong></td>
                    <td><span class="status-badge ${statusClass}">${v.status}</span></td>
                    <td style="text-align:center;">${stornierenBtn}</td>
                </tr>
            `;
        }).join('');
        
        // Test-Funktion
        function testStornierung(vertragId, kunde, createdAt) {
            const tage = Math.floor((Date.now() - createdAt) / 86400000);
            const warnung = tage < 14 ? `âš ï¸ WARNUNG: Der Vertrag ist nur ${tage} Tage alt! (< 14 Tage)` : `âœ… Der Vertrag ist ${tage} Tage alt (â‰¥ 14 Tage)`;
            
            alert(`ðŸ”¥ STORNIEREN-BUTTON FUNKTIONIERT!\n\nVertrag-ID: ${vertragId}\nKunde: ${kunde}\n${warnung}\n\nâœ… Button ist sichtbar und klickbar!`);
            console.log('âœ… Stornieren-Button geklickt!', { vertragId, kunde, tage, warnung });
        }
        
        console.log('âœ… Test-Seite geladen!');
        console.log('ðŸ“Š Anzahl VertrÃ¤ge:', demoVertraege.length);
        console.log('ðŸ”˜ VertrÃ¤ge mit Button:', demoVertraege.filter(v => v.status !== 'Abgelehnt' && v.status !== 'Storniert').length);
        console.log('âŒ VertrÃ¤ge OHNE Button:', demoVertraege.filter(v => v.status === 'Abgelehnt' || v.status === 'Storniert').length);
    </script>
</body>
</html>